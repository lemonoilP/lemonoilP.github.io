<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Archives: 2017 | PIVIX</title>
  <meta name="description" content="A minimal hexo theme." />
  <meta name="keywords" content="hexo,theme,typescript,otakism,otaku" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="PIVIX">
<meta property="og:url" content="https://lemonoilP.github.io/archives/2017/page/4/index.html">
<meta property="og:site_name" content="PIVIX">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PIVIX">
  
  
    <link rel="icon" href="/favicon.png">
  

	<script src="https://use.typekit.net/eyf3hir.js"></script>
  <script>try{Typekit.load({ async: false });}catch(e){}</script>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
  

</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

  <script>setLoadingBarProgress(20)</script>
  
  <div id="site-wrapper">
    
    <header id="header">
	<div id="header-wrapper" class="clearfix">
		<a id="logo" href="/">
			<img src="/images/logo.png" />
			<span id="site-desc">
			  otaku keeps alive
      </span>
		</a>
		<button id="site-nav-switch">
	    <span class="icon icon-menu"></span>
	  </button>
	</div>
	<aside id="site-menu">
  	<nav>
  		
        <a href="/" class="nav-home nav">
          Home
        </a>
      
        <a href="/about" class="nav-about nav">
          About
        </a>
      
        <a href="/archives" class="nav-archives nav">
          Archives
        </a>
      
    </nav>
	</aside>
</header>
    <script>setLoadingBarProgress(40);</script>
    
    <main id="main" role="main">
      
	


	<section class="page-header archive">
    <h1>- <span>2017</span> -</h1>
  </section>




<section class="post-list">
	
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/数据结构专题/">
      数据结构专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h2 id="最后一题无语（有序链剖……）"><a href="#最后一题无语（有序链剖……）" class="headerlink" title="最后一题无语（有序链剖……）"></a>最后一题无语（有序链剖……）</h2><h1 id="Problem-1-rotinv"><a href="#Problem-1-rotinv" class="headerlink" title="Problem 1. rotinv"></a>Problem 1. rotinv</h1><p><img src="http://img.blog.csdn.net/20170318170923717?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170049180?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170155620?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000000</span> + <span class="number">10</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="keyword">int</span> a[N+N];</div><div class="line"><span class="keyword">int</span> bit[N*<span class="number">24</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans,cnt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> delta)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = pos;i&lt;=n;i+=i&amp;-i)bit[i] += delta;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> right)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> rt=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=right;i;i-=i&amp;-i)rt += bit[i];</div><div class="line">	<span class="keyword">return</span> rt;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"rotinv.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"rotinv.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</div><div class="line">		readin(a[i]);</div><div class="line">		a[n+i]=a[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++ ) &#123;</div><div class="line">		cnt+=(i<span class="number">-1</span>)-query(a[i]);</div><div class="line">		build(a[i],+<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= n + n; i++ ) &#123;</div><div class="line">		build(a[i-n],<span class="number">-1</span>);</div><div class="line">		cnt+=n<span class="number">-1</span>-query(a[i]);</div><div class="line">		cnt-=query(a[i-n]<span class="number">-1</span>);</div><div class="line">		build(a[i],+<span class="number">1</span>);</div><div class="line">		ans+=cnt;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-2-rise"><a href="#Problem-2-rise" class="headerlink" title="Problem 2. rise"></a>Problem 2. rise</h1><p><img src="http://img.blog.csdn.net/20170318170939374?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170336324?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170421605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500000</span>+<span class="number">10</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> left,right,child_left,child_right,maxn;</div><div class="line">	Node *ch[<span class="number">2</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> h)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(left==right)<span class="keyword">return</span> h&lt;maxn;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">return</span> (h&lt;ch[<span class="number">0</span>]-&gt;maxn)?ch[<span class="number">0</span>]-&gt;find(h)+child_right:ch[<span class="number">1</span>]-&gt;find(h);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</div><div class="line">		maxn=max(ch[<span class="number">0</span>]-&gt;maxn,ch[<span class="number">1</span>]-&gt;maxn);</div><div class="line">		child_right=ch[<span class="number">1</span>]-&gt;find(ch[<span class="number">0</span>]-&gt;maxn);</div><div class="line">		child_left=ch[<span class="number">0</span>]-&gt;child_left+child_right;</div><div class="line">	&#125;</div><div class="line">&#125;pool[N&lt;&lt;<span class="number">1</span>],*point=pool,*root,*a[N];</div><div class="line"><span class="keyword">int</span> n,m,high[N],head,tail,l,r;</div><div class="line"><span class="function">Node *<span class="title">build</span><span class="params">(<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>&#123;</div><div class="line">	Node *node=++point;</div><div class="line">	node-&gt;left=left;</div><div class="line">	node-&gt;right=right;</div><div class="line">	<span class="keyword">if</span>(left==right)&#123;</div><div class="line">		node-&gt;child_left=<span class="number">1</span>;</div><div class="line">		node-&gt;child_right=<span class="number">0</span>;</div><div class="line">		node-&gt;maxn=high[left];</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(left+right)&gt;&gt;<span class="number">1</span>;</div><div class="line">		node-&gt;ch[<span class="number">0</span>]=build(left,mid);</div><div class="line">		node-&gt;ch[<span class="number">1</span>]=build(mid+<span class="number">1</span>,right);</div><div class="line">		node-&gt;update();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> node;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(Node *node,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L&lt;=node-&gt;left&amp;&amp;node-&gt;right&lt;=R)&#123;</div><div class="line">		a[++tail]=node;<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid=(node-&gt;left+node-&gt;right)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(L&lt;=mid)ask(node-&gt;ch[<span class="number">0</span>],L,R);</div><div class="line">	<span class="keyword">if</span>(R&gt;mid)ask(node-&gt;ch[<span class="number">1</span>],L,R);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	head=<span class="number">1</span>,tail=<span class="number">0</span>;</div><div class="line">	ask(root,L,R);</div><div class="line">	<span class="keyword">int</span> cnt=<span class="number">0</span>,ans=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=head;i&lt;=tail;i++)&#123;</div><div class="line">		ans+=a[i]-&gt;find(cnt);</div><div class="line">		cnt=max(cnt,a[i]-&gt;maxn);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"rise.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"rise.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)readin(high[i]);</div><div class="line">	root=build(<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		readin(l),readin(r);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(l,r));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-3-seqmod"><a href="#Problem-3-seqmod" class="headerlink" title="Problem 3. seqmod"></a>Problem 3. seqmod</h1><p>（神题特此附上两张图！！！）<br><img src="http://img.blog.csdn.net/20170318171013771?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318171029381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170530702?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170634904?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>idy002大神发明了有序链剖。。。然而并不知道。。。<br><a href="http://www.cnblogs.com/idy002/p/4563611.html" target="_blank" rel="external">有序链剖（神！！！）</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100000</span> + <span class="number">10</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=N&lt;&lt;<span class="number">1</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod=<span class="number">31</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=res*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> v,len;</div><div class="line">	Point()&#123;&#125;</div><div class="line">	Point(<span class="keyword">int</span> v,<span class="keyword">int</span> len):v(v),len(len)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">int</span> head[N],wght[M],dest[M],last[M],etot;</div><div class="line"><span class="keyword">int</span> depf[N],siz[N],son[N],top[N],father[N],val[N],in[N],rank[N],deps[N],pos_id;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></div><div class="line">	Point ab,ba;</div><div class="line">	Node *ls,*rs;</div><div class="line">&#125;point_pool[N*<span class="number">4</span>],*tail=point_pool,*root;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">	deps[<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;N;i++)</div><div class="line">		deps[i]=deps[i<span class="number">-1</span>]*<span class="number">10</span>%Mod;</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">link</span><span class="params">(<span class="keyword">const</span> Point &amp;a,<span class="keyword">const</span> Point &amp;b)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> Point((a.v * deps[b.len] + b.v) % Mod,a.len + b.len);</div><div class="line">&#125;</div><div class="line"><span class="function">Node *<span class="title">build</span><span class="params">(<span class="keyword">int</span> lf,<span class="keyword">int</span> rg)</span></span>&#123;</div><div class="line">	Node *nd=++tail;</div><div class="line">	<span class="keyword">if</span>(lf == rg)&#123;</div><div class="line">		nd-&gt;ab=nd-&gt;ba=Point(val[rank[lf]],<span class="number">1</span>);</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">		nd-&gt;ls=build(lf,mid);</div><div class="line">		nd-&gt;rs=build(mid + <span class="number">1</span>,rg);</div><div class="line">		nd-&gt;ab=link(nd-&gt;ls-&gt;ab,nd-&gt;rs-&gt;ab);</div><div class="line">		nd-&gt;ba=link(nd-&gt;rs-&gt;ba,nd-&gt;ls-&gt;ba);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> nd;</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">query_ab</span><span class="params">(Node *nd,<span class="keyword">int</span> lf,<span class="keyword">int</span> rg,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L &lt;= lf &amp;&amp; rg &lt;= R) <span class="keyword">return</span> nd-&gt;ab;</div><div class="line">	<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(R &lt;= mid) <span class="keyword">return</span> query_ab(nd-&gt;ls,lf,mid,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(L&gt;mid) <span class="keyword">return</span> query_ab(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> link(</div><div class="line">			query_ab(nd-&gt;ls,lf,mid,L,R),</div><div class="line">			query_ab(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R));</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">query_father</span><span class="params">(Node *nd,<span class="keyword">int</span> lf,<span class="keyword">int</span> rg,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L &lt;= lf &amp;&amp; rg &lt;= R) <span class="keyword">return</span> nd-&gt;ba;</div><div class="line">	<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(R &lt;= mid) <span class="keyword">return</span> query_father(nd-&gt;ls,lf,mid,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(L&gt;mid) <span class="keyword">return</span> query_father(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> link(</div><div class="line">			query_father(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R),</div><div class="line">			query_father(nd-&gt;ls,lf,mid,L,R));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">adde</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d)</span></span>&#123;</div><div class="line">	etot++;</div><div class="line">	dest[etot]=v;</div><div class="line">	last[etot]=head[u];</div><div class="line">	wght[etot]=d;</div><div class="line">	head[u]=etot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	siz[u]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> t=head[u]; t; t=last[t])&#123;</div><div class="line">		<span class="keyword">int</span> v=dest[t];</div><div class="line">		<span class="keyword">if</span>(v == father[u]) <span class="keyword">continue</span>;</div><div class="line">		father[v]=u;</div><div class="line">		depf[v]=depf[u] + <span class="number">1</span>;</div><div class="line">		val[v]=wght[t];</div><div class="line">		dfs1(v);</div><div class="line">		siz[u] += siz[v];</div><div class="line">		<span class="keyword">if</span>(siz[v]&gt;siz[son[u]]) son[u]=v;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	in[u]=++pos_id;</div><div class="line">	rank[pos_id]=u;</div><div class="line">	<span class="keyword">if</span>(son[u])&#123;</div><div class="line">		top[son[u]]=top[u];</div><div class="line">		dfs2(son[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> t=head[u]; t; t=last[t])&#123;</div><div class="line">		<span class="keyword">int</span> v=dest[t];</div><div class="line">		<span class="keyword">if</span>(v == father[u] || v == son[u]) <span class="keyword">continue</span>;</div><div class="line">		top[v]=v;</div><div class="line">		dfs2(v);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	Point y_x(0,0),x_y(0,0);</div><div class="line">	<span class="keyword">while</span>(top[u]!=top[v])&#123;</div><div class="line">		<span class="keyword">if</span>(depf[top[u]]&gt;depf[top[v]])&#123;</div><div class="line">			y_x=link(y_x,query_father(root,<span class="number">1</span>,pos_id,in[top[u]],in[u]));</div><div class="line">			u=father[top[u]];</div><div class="line">		&#125; <span class="keyword">else</span>&#123;</div><div class="line">			x_y=link(query_ab(root,<span class="number">1</span>,pos_id,in[top[v]],in[v]),x_y);</div><div class="line">			v=father[top[v]];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(depf[u]&gt;depf[v])&#123;</div><div class="line">		y_x=link(y_x,query_father(root,<span class="number">1</span>,pos_id,in[v]+<span class="number">1</span>,in[u]));</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(depf[v]&gt;depf[u])&#123;</div><div class="line">		x_y=link(query_ab(root,<span class="number">1</span>,pos_id,in[u]+<span class="number">1</span>,in[v]),x_y);</div><div class="line">	&#125;</div><div class="line">	Point ans=link(y_x,x_y);</div><div class="line">	<span class="keyword">return</span> ans.v;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"seqmod.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"seqmod.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">int</span> u,v,d;</div><div class="line">		readin(u),readin(v),readin(d),</div><div class="line">		adde(u,v,d);</div><div class="line">		adde(v,u,d);</div><div class="line">	&#125;</div><div class="line">	init();</div><div class="line">	father[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	depf[<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">	dfs1(<span class="number">1</span>);</div><div class="line">	top[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	dfs2(<span class="number">1</span>);</div><div class="line">	root=build(<span class="number">1</span>,pos_id);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="keyword">int</span> u,v;</div><div class="line">		readin(u),readin(v);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(u,v));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构/">数据结构</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/数论专题/">
      数论专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>第一道题题意不明，1.5h，100分。。。无语。</p>
<h1 id="单峰数列"><a href="#单峰数列" class="headerlink" title="单峰数列"></a>单峰数列</h1><p><img src="http://img.blog.csdn.net/20170318165027651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318163703436?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p> 单峰数列<br>我们从大到小放，除最大数以外每一个数只能放在前面放的所有数的最左边或最右边.<br>于是去除单调递增单调递减重复计算，答案为2^n-2，特判n = 1 和p = 1.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PROB <span class="meta-string">"sequence"</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="function">qword <span class="title">times_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">0</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=(ret+x)%mod;</div><div class="line">				x=(x+x)%mod;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>%mod;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)</div><div class="line">						ret=times_mod(ret,x,mod);</div><div class="line">				x=times_mod(x,x,mod);</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		freopen(PROB<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(PROB<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		qword n,mod;</div><div class="line">		<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">"%I64u%I64u"</span>,&amp;n,&amp;mod))</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (n==<span class="number">1</span>)</div><div class="line">				&#123;</div><div class="line">						<span class="built_in">printf</span>(<span class="string">"%I64u\n"</span>,<span class="number">1</span>%mod);</div><div class="line">						<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				qword ans=pow_mod(<span class="number">2</span>,n,mod)<span class="number">-2</span>;</div><div class="line">				ans=(ans+mod)%mod;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%I64u\n"</span>,ans);</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="数学题（裸题）"><a href="#数学题（裸题）" class="headerlink" title="数学题（裸题）"></a>数学题（裸题）</h1><p><img src="http://img.blog.csdn.net/20170318165218637?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318163954296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>题意：已知B，A%p，求(A/B)%p.<br>设A  B ans (mod p)<br>原问题变成了已知B  ans mod p 求ans.<br>我们直接套用拓展欧几里得算法模板.<br>B ans + k p = n<br>由于保证gcd 为1，所以ans 在p 内只有一个解.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="function">qword <span class="title">ext_gcd</span><span class="params">(qword a,qword b,qword &amp;x,qword &amp;y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">        <span class="keyword">if</span> (a%b==<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">                <span class="comment">//a*x+b*y==b</span></div><div class="line">                x=<span class="number">0</span>;y=<span class="number">1</span>;</div><div class="line">                <span class="keyword">return</span> y;</div><div class="line">        &#125;</div><div class="line">        qword ret=ext_gcd(b,a%b,x,y);</div><div class="line">        qword tx=x,ty=y;</div><div class="line">        x=ty;</div><div class="line">        y=tx-a/b*ty;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=ret*x%mod;</div><div class="line">				x=x*x%mod;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		<span class="keyword">int</span> nn;</div><div class="line">		freopen(<span class="string">"calc.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(<span class="string">"calc.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;nn);</div><div class="line">		<span class="keyword">while</span> (nn--)</div><div class="line">		&#123;</div><div class="line">				qword n,b;</div><div class="line">				qword p;</div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%I64d%I64d%I64d"</span>,&amp;n,&amp;b,&amp;p);</div><div class="line">				<span class="comment">//n=A%9973</span></div><div class="line">				<span class="comment">//n=b*d%9973</span></div><div class="line">				<span class="comment">//n=b*d+9973*k</span></div><div class="line">				qword d0,k0;</div><div class="line">				<span class="comment">//d0=pow_mod(b,9971,9973);</span></div><div class="line">				ext_gcd(b,p,d0,k0);</div><div class="line">				d0=d0*n%p;</div><div class="line">				d0=(d0+p)%p;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,d0);</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="定情信物（bzoj-3823）"><a href="#定情信物（bzoj-3823）" class="headerlink" title="定情信物（bzoj 3823）"></a>定情信物（bzoj 3823）</h1><p><img src="http://img.blog.csdn.net/20170318165609399?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>Description<br>都说程序员找不到妹子,可是无人知晓,三生石上竟然还刻着属于小 E 的一笔。<br>那一天,小 E 穷尽毕生的积蓄,赠与了妹子一个非同寻常的定情信物。那是一个小小的正方体,但透过它,可以看到过去,可以洞彻天机。<br>这份信物仿佛一只深邃的眼。当看透它看似简单的外表后,深邃的内心却最是可以叩击人的灵魂的。不出所料,妹子果然被这个信物超越空间的美所吸引。<br>“易有太极,是生两仪,两仪生四象,四象生八卦。,八卦定吉凶,吉凶生大业。”<br>这句箴言在其上得到了完美的诠释。是的,这正是一个超正方体。<br>小 E 告诉妹子,他的情意也如这份信物一样深厚。现在妹子想知道,小 E 对她的情意究竟有几分?<br>我们知道,点动成线,线动成面,面动成体……即 n 维超立方体可看作由 n-1 维超立方体沿垂直于它的所有的棱的方向平移得到的立体图形。我们可以将点看作 0 维超立方体,将直线看作 1 维超立方体,将正方形看作 2 维超立方体……依此类推。<br>任何一个 n 维超立方体(n&gt;0)都是由低维的超立方体元素组成的:它的 n-1 维表面是 n-1 维的超立方体,它的 n-2 维边缘是 n-2 维的超立方体,它的 n-3 维元素是 n-3 维的超立方体……<br>小 E 对妹子的情意即为在他的定情信物——K 维超立方体中,含有每一维的元素个数。由于元素个数可能较大,只需要输出它所包含的每一维元素个数模 P 后的异或和。<br>Input<br>两个整数 K、P,详见题目叙述。<br>Output<br>一个非负整数,表示小 E 的定情信物所包含的每一维元素个数模 P 后的异或和。注意:异或和可能会大于 P。</p>
<blockquote>
<p>Sample Input<br>input 1<br>3 7<br>Input 2<br>4 2333<br>Input 3<br>12 7723<br>Sample Output<br>Output1<br>3<br>Output 2<br>33<br>Output 3<br>360</p>
</blockquote>
<p>Hint<br>对于样例2的解释:<br>一个三维超立方体含有 8 个零维元素、12 个一维元素、6 个二维元素、1 个三维元素,模 7 后分别为 1,5,6,1,异或和为 1^5^6^1=3。<br>对于 100%的数据,N≤10^7,P 为 10^9 内的素数。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>找规律可得：\(a<em>i = C(n,i)2</em>{n-i}\)<br>脑补也很容易能把规律推出来，一个n 维超正方体有n 个维度，那么要确定其中的一个k 维元素，就是在这n 个维度中选择k 个维度，个数\(C(n,k)\)，剩下\(n-k\)个维度可以任意平移，所以再乘\(2^{n-k}\)于是下一步就是如何求ai，直接扫一遍，将答案表示成//(t*p^k//)，存下了t，k就存下了答案，线性筛预处理处逆元，分别推出\(C(n,i)\)，\(2^i\)，乘起来再异或就是答案了。 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cassert&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 11000000</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="keyword">int</span> inv[MAXN];</div><div class="line"><span class="keyword">int</span> prime[<span class="number">1100000</span>],topp=<span class="number">-1</span>;</div><div class="line"><span class="keyword">bool</span> pflag[MAXN];</div><div class="line">qword n,p;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=ret*x%p;</div><div class="line">				x=x*x%p;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		inv[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (!pflag[i])</div><div class="line">				&#123;</div><div class="line">						prime[++topp]=i;</div><div class="line">						inv[i]=pow_mod(i,p<span class="number">-2</span>);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=topp &amp;&amp; (qword)i*prime[j]&lt;MAXN;j++)</div><div class="line">				&#123;</div><div class="line">						pflag[i*prime[j]]=<span class="literal">true</span>;</div><div class="line">						inv[i*prime[j]]=(qword)inv[i]*inv[prime[j]]%p;</div><div class="line">						<span class="keyword">if</span> (i%prime[j]==<span class="number">0</span>)<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">		&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		freopen(<span class="string">"cube.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(<span class="string">"cube.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%I64d%I64d"</span>,&amp;n,&amp;p);</div><div class="line">		qword x,y,z;</div><div class="line">		<span class="keyword">int</span> i,j,k;</div><div class="line">		qword ans=<span class="number">0</span>;</div><div class="line">		init();</div><div class="line">		x=<span class="number">1</span>;y=<span class="number">1</span>;</div><div class="line">		ans^=x*y%p;</div><div class="line">		<span class="keyword">int</span> totp=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">		&#123;</div><div class="line">				x=x*<span class="number">2</span>%p;</div><div class="line">				z=n-i+<span class="number">1</span>;</div><div class="line">				<span class="keyword">while</span> (z%p==<span class="number">0</span>)totp++,z/=p;</div><div class="line">				y=y*z%p;</div><div class="line">				z=i;</div><div class="line">				<span class="keyword">while</span> (z%p==<span class="number">0</span>)totp--,z/=p;</div><div class="line">				y=y*inv[z%p]%p;</div><div class="line">				ans^=totp?<span class="number">0</span>:x*y%p;</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数论/">数论</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/dp专题/">
      dp专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h2 id="220分，加上long-long-成320分。。。无语，果真需要更加细致地分析数据啊！！！"><a href="#220分，加上long-long-成320分。。。无语，果真需要更加细致地分析数据啊！！！" class="headerlink" title="220分，加上long long 成320分。。。无语，果真需要更加细致地分析数据啊！！！"></a>220分，加上long long 成320分。。。无语，果真需要更加细致地分析数据啊！！！</h2><h1 id="天平（balance-in-balance-out）"><a href="#天平（balance-in-balance-out）" class="headerlink" title="天平（balance.in/balance.out）"></a>天平（balance.in/balance.out）</h1><p><img src="http://img.blog.csdn.net/20170325165516496?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>物理老师YJ有一个长杆天平，天平的两臂长均为15，将长杆看作x轴，则平衡点在0位置处，负数位置在左臂上，正数位置在右臂上。长杆上有n个位置有挂钩可以挂秤砣。YJ有m个秤砣，质量分别为gi，每个挂钩可以不挂也可以挂任意个秤砣。YJ想要知道，在使用所有秤砣的条件下，有多少种不同的挂秤砣的方案，可以使得天平平衡？问题太过复杂，仅凭物理知识难以解决，所以请你来帮助他。<br>天平的平衡条件是所有秤砣的位置<em>质量之和为0。例如有质量为2,3,4的秤砣分别挂在-3,-2,3位置处，则2</em>(-3) + 3<em>(-2) + 4</em>3 == 0，天平是平衡的。<br>【输入格式】<br>第一行两个数n，m。表示挂钩的数目和秤砣的数目。<br>第二行n个不同且递增的数，第i个数表示第i个挂钩的位置，数的范围在[-15,15]内。<br>第三行m个不同且递增的数，第i个数表示第i个秤砣的质量，数的范围在[1,25]内。<br>【输出格式】<br>一个整数，代表能使得天平平衡的方案数。</p>
<blockquote>
<p>【输入样例】<br>2 4<br>-2 3<br>3 4 5 8<br>【输出样例】<br>2</p>
</blockquote>
<p>【样例解释】<br>方案1: (-2)<em>(3+4+5) + 3 </em>8 = 0<br>方案2: (-2)<em> (4+8) +  3 </em>(3+5) = 0<br>【数据规模】<br>10% 数据满足2≤n,m≤4。<br>100% 数据满足2≤n,m≤20。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>简单的DP。<br>考虑天平的状态可以用秤砣质量<em>距离来表示，而题目情况下，天平的全部秤砣质量</em>距离在(-7500,7500)(20<em> 25</em>15 = 7500)以内。故可以以此状态来dp。<br>类似背包问题，把每一个秤砣挂在不同地方，对应成n<em>m个物品，转移方程f[i][j]+=f[i-1][j-dis[k]</em>mg[i]] (i=1..n,j=0..15000,k=1..m)。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"balance"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,c[<span class="number">100</span>],w[<span class="number">100</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span>  dp[<span class="number">30</span>][<span class="number">15001</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)readin(c[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)readin(w[i]);</div><div class="line">	dp[<span class="number">0</span>][<span class="number">7500</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">15000</span>;j++)</div><div class="line">			<span class="keyword">if</span>(dp[i<span class="number">-1</span>][j])<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=n;k++)</div><div class="line">				dp[i][j+w[i]*c[k]]+=dp[i<span class="number">-1</span>][j];</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;dp[m][<span class="number">7500</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="山峰数（hill-in-hill-out）"><a href="#山峰数（hill-in-hill-out）" class="headerlink" title="山峰数（hill.in/hill.out）"></a>山峰数（hill.in/hill.out）</h1><p><img src="http://img.blog.csdn.net/20170325165450469?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>山峰数是指数字排列中不存在山谷(先降后升)的数，例如0,5,13,12321都是山峰数，101，1110000111都不是山峰数。<br>现给出n个数，请依次判断它们是否为山峰数，如果不是，输出-1。如果是，求出比它小的数中有多少个山峰数。<br>【输入格式】<br>第一行一个数n，表示询问数目。<br>接下来n行，每一行一个数x，表示询问的数。<br>【输出格式】<br>输出有n行，x如果不是山峰数，输出-1。x如果是山峰数，则输出有多少个比它小的山峰数。</p>
<blockquote>
<p>【输入样例】<br>5<br>10<br>55<br>101<br>1000<br>1234321<br>【输出样例】<br>10<br>55<br>-1<br>715<br>94708</p>
</blockquote>
<p>【数据规模】<br>20% 数据满足x ≤ 10^6。<br>100% 数据满足n ≤ 10, x ≤ 10^60</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>数位DP<br>在数位dp的模板基础上，加入参数nu和isdown，nu表示上一个数填的多少，isdown表示当前是在上升期还是在下降期，然后使用模板记忆化搜索即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"hill"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> T;</div><div class="line">ll dp[<span class="number">77</span>][<span class="number">11</span>][<span class="number">2</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">77</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> pre,<span class="keyword">int</span> state,<span class="keyword">int</span> fp)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(pos&lt;<span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(!fp&amp;&amp;dp[pos][pre][state]!=<span class="number">-1</span>)<span class="keyword">return</span> dp[pos][pre][state];</div><div class="line">    ll ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> fpmax=fp?s[pos]-<span class="string">'0'</span>:<span class="number">9</span>;</div><div class="line">    <span class="keyword">if</span>(state)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=min(fpmax,pre<span class="number">-1</span>);i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">0</span>,fp&amp;&amp;i==fpmax);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=pre;i&lt;=fpmax;i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">1</span>,fp&amp;&amp;i==fpmax);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=min(fpmax,pre);i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">0</span>,fp&amp;&amp;i==fpmax);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!fp)dp[pos][pre][state]=ans;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="built_in">memset</span>(dp,<span class="number">-1</span>,<span class="keyword">sizeof</span>(dp));</div><div class="line">    readin(T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">        <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s),flag=<span class="number">0</span>,gg=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>,j=len<span class="number">-1</span>;i&lt;j;i++,j--)swap(s[i],s[j]);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len<span class="number">-1</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(s[i]&lt;s[i+<span class="number">1</span>]&amp;&amp;flag)&#123;</div><div class="line">                gg=<span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(s[i]&gt;s[i+<span class="number">1</span>])flag=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(gg)<span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,dfs(len<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="粉刷匠2（draw-in-draw-out）"><a href="#粉刷匠2（draw-in-draw-out）" class="headerlink" title="粉刷匠2（draw.in/draw.out）"></a>粉刷匠2（draw.in/draw.out）</h1><p><img src="http://img.blog.csdn.net/20170325165405906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>有一个4*N的木板需要粉刷，第i行j列的颜色记为A(i, j)。<br>有256种颜色，记为0..255，为了使得粉刷比较好看，粉刷需要满足如下要求:</p>
<ol>
<li>A(x,y) &gt;= A(x,y-1)</li>
<li>有一些指定的(x1, y1)和(x2, y2)，要求A(x1, y1) = A(x2, y2)<br>请问有多少种满足要求的粉刷方式？输出答案的最后5位即可。<br>【输入格式】<br>第一行两个数n, m，表示木板的长度，和指定规则的条目个数。<br>接下来m行，每行四个数x1,y1,x2,y1，此规则表示A(x1, y1) 需要等于 A(x2, y2)<br>。<br>【输出格式】<br>一个整数，表示答案的末5位。<blockquote>
<p>【输入样例1】<br>1 0<br>【输出样例1】<br>67296<br>【输入样例2】<br>1 3<br>1 1 2 1<br>1 1 3 1<br>4 1 3 1<br>【输出样例2】<br>00256</p>
</blockquote>
</li>
</ol>
<p>【提示】<br>5<br>输出可以使用%05d输出。<br>【数据规模】<br>30% 数据满足 n ≤ 3，m = 0。<br>100% 数据满足1 ≤ n ≤ 15，0 ≤ M ≤ 100，X1,X2≤4，Y1,Y2≤n</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>30分的做法：dp[i][c1][c2][c3]表示第i行，第一列填到c1，第二列填到c2,，第三列填到c3的方法总数。转移时如果暴力枚举转移仍然会TLE，需要使用完全背包的降低维度思想，列出转移方程：dp[i][c1][c2][c3]= dp[i-1][c1][c2][c3] + dp[i] [c1-1][c2][c3] + dp[i] [c1][c2-1][c3] + dp[i][c1][c2][c3-1]。这样才不会TLE。<br>100分的做法：换一种dp思路，我们不按照常规思维枚举行列，而是从小到大枚举颜色。若当前枚举到的颜色为i，我们使用dp[l1][l2][l3][l4]表示每一行使用当前颜色涂到哪一个位置。<br>假设有一行现在是123344556，现在涂7，显然涂7只能涂序列的后缀，比如涂成123777777，或者123344577才能符合条件。所以考虑枚举当前颜色涂到哪个后缀来转移，转移时同样需要使用完全背包的降维思想优化。<br>对于限制条件，我们需要把不符合限制条件的去掉，什么样的方案符合限制条件呢？对于限制条件A(x1, y1) = A(x2, y2)，和当前枚举到的颜色i，要么x1行和x2行，当前颜色都涂到了y1,y2位置，要么都没有涂到y1,y2位置。除此之外的都是不合法的方案，我们事先处理好一个vis数组，vis[l1][l2][l3][l4]表示四行分别涂到l1,l2,l3,l4，是否可行，在dp时如果遇到标记不可行的vis，这dp值设为0即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x) for(register int i=1;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rek(i,x) for(register int i=0;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x) for(i=0;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> f[<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>];</div><div class="line"><span class="keyword">bool</span> vis[<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>];</div><div class="line"><span class="keyword">int</span> x1[<span class="number">105</span>],x2[<span class="number">105</span>],y1[<span class="number">105</span>],y2[<span class="number">105</span>];</div><div class="line"><span class="keyword">int</span> n,m,c[<span class="number">4</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>);resez = ch - <span class="number">48</span>;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)resez = resez * <span class="number">10</span> + ch - <span class="number">48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123; </div><div class="line">	freopen(<span class="string">"draw.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"draw.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	res(i,m)&#123;</div><div class="line">		readin(x1[i]),readin(y1[i]),readin(x2[i]),readin(y2[i]);</div><div class="line">		x1[i]--;x2[i]--;</div><div class="line">	&#125;</div><div class="line">	res(i,m)rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)&#123;</div><div class="line">		<span class="keyword">if</span>(c[x1[i]]&gt;=y1[i] ^ c[x2[i]]&gt;=y2[i])</div><div class="line">			vis[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">	rek(color,<span class="number">255</span>)&#123;</div><div class="line">		rek(col,<span class="number">3</span>)rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)</div><div class="line">			<span class="keyword">if</span>(c[col]&lt;n)&#123;</div><div class="line">				<span class="keyword">int</span> tmp=f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]];</div><div class="line">				c[col]++;</div><div class="line">				f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=(f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]+tmp)%<span class="number">100000</span>;</div><div class="line">				c[col]--;</div><div class="line">			&#125;</div><div class="line">		rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)</div><div class="line">			<span class="keyword">if</span>(vis[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]])</div><div class="line">				f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%05d\n"</span>,f[n][n][n][n]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="棋盘（knight-in-knight-out）"><a href="#棋盘（knight-in-knight-out）" class="headerlink" title="棋盘（knight.in/knight.out）"></a>棋盘（knight.in/knight.out）</h1><p><img src="http://img.blog.csdn.net/20170325165340745?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>有一个N*M的棋盘，要在上面摆上knight，每个格子可以放至多一个knight。<br>knight的攻击范围如下图：<br><img src="http://img.blog.csdn.net/20170325165115620?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>所有knight不能互相攻击，请问总共有多少可行的摆法？答案对1000000007取模。<br>【输入格式】<br>第一行个数t，表示测试的组数。<br>接下来t组，每组两个整数，n和m。<br>【输出格式】<br>一共t行，第i行表示第i组的答案。</p>
<blockquote>
<p>【输入样例】<br>4<br>1 2<br>2 2<br>3 2<br>3 31415926<br>【输出样例】<br>4<br>16<br>36<br>933912086</p>
</blockquote>
<p>【数据规模】<br>70% 数据满足m≤100。<br>100% 数据满足t≤10, n≤3, m≤10^9。</p>
<h2 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h2><p>n非常小，所以考虑状态压缩动态规划，每一行使用一个二级制串表示当前行的摆knight情况。用f[i][j][k]表示第i行，前一行为j，前一行的前一行为k时的方法总数，转移时枚举三行的状态，判断合法情况转移即可。<br>如果枚举每一行转移，可以得70分。如果将状态转移矩阵化，使用矩阵快速幂，可以通过全部测试数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"knight"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 256</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 1000000007ll</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> Matrix[maxn][maxn];<span class="comment">//矩阵 </span></div><div class="line">    <span class="keyword">int</span> row,col;<span class="comment">//矩阵行列数 </span></div><div class="line">&#125;;</div><div class="line"><span class="function">Matrix <span class="title">mod_mul</span><span class="params">(Matrix a,Matrix b,ll p)</span></span>&#123;<span class="comment">//矩阵乘法 </span></div><div class="line">    Matrix ans;</div><div class="line">    ans.row=a.row;</div><div class="line">    ans.col=b.col;</div><div class="line">    <span class="built_in">memset</span>(ans.Matrix,<span class="number">0</span>,<span class="keyword">sizeof</span>(ans.Matrix));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ans.row;i++)      </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;a.col;k++)</div><div class="line">            <span class="keyword">if</span>(a.Matrix[i][k])</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;ans.col;j++)</div><div class="line">                &#123;</div><div class="line">                    ans.Matrix[i][j]+=<span class="number">1l</span>l*a.Matrix[i][k]*b.Matrix[k][j]%p;</div><div class="line">                    ans.Matrix[i][j]%=p;</div><div class="line">                &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function">Matrix <span class="title">mod_pow</span><span class="params">(Matrix a,<span class="keyword">int</span> k,ll p)</span></span>&#123;<span class="comment">//矩阵快速幂 昨天才打的。。。。 </span></div><div class="line">    Matrix ans;</div><div class="line">    ans.row=a.row;</div><div class="line">    ans.col=a.col;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.row;i++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a.col;j++)</div><div class="line">            ans.Matrix[i][j]=(i==j);</div><div class="line">    <span class="keyword">while</span>(k)&#123;</div><div class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>)ans=mod_mul(ans,a,p);</div><div class="line">        a=mod_mul(a,a,p);</div><div class="line">        k&gt;&gt;=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> T,n,m,a[<span class="number">5</span>][<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>*m;i++)</div><div class="line">        <span class="keyword">if</span>(x&amp;(<span class="number">1</span>&lt;&lt;i))a[i/m][i%m]=<span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span> a[i/m][i%m]=<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">-2</span>,<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">int</span> dy[]=&#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)</div><div class="line">            <span class="keyword">if</span>(a[i][j])<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">8</span>;k++)&#123;</div><div class="line">                    <span class="keyword">int</span> ii=i+dx[k],jj=j+dy[k];</div><div class="line">                    <span class="keyword">if</span>(ii&lt;<span class="number">0</span>||ii&gt;=<span class="number">3</span>||jj&lt;<span class="number">0</span>||jj&gt;=m)<span class="keyword">continue</span>;</div><div class="line">                    <span class="keyword">if</span>(a[ii][jj])<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line">Matrix A,B;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>);resez = ch - <span class="number">48</span>;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)resez = resez * <span class="number">10</span> + ch - <span class="number">48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    readin(T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        readin(m),readin(n);</div><div class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">1</span>&lt;&lt;m);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> M=<span class="number">1</span>&lt;&lt;(m&lt;&lt;<span class="number">1</span>),N=<span class="number">1</span>&lt;&lt;(<span class="number">3</span>*m);</div><div class="line">        B.row=M,B.col=<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++)&#123;</div><div class="line">            deal(i);</div><div class="line">            B.Matrix[i][<span class="number">0</span>]=check();</div><div class="line">        &#125;</div><div class="line">        A.row=A.col=M;</div><div class="line">        <span class="built_in">memset</span>(A.Matrix,<span class="number">0</span>,<span class="keyword">sizeof</span>(A.Matrix));</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)&#123;</div><div class="line">            <span class="keyword">int</span> x=i&gt;&gt;m,y=i&amp;(M<span class="number">-1</span>);</div><div class="line">            deal(i);</div><div class="line">            <span class="keyword">if</span>(check())A.Matrix[x][y]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        A=mod_pow(A,n<span class="number">-2</span>,mod);</div><div class="line">        A=mod_mul(A,B,mod);</div><div class="line">        ll ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++)ans=(ans+A.Matrix[i][<span class="number">0</span>])%mod;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/DP/">DP</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/03/16/平衡树/">
      平衡树
    </a>
  </h2>
  
  <time>
    Mar 16, 2017
  </time>
  <section class="content">
	  <h2 id="对平衡树的研究与探索"><a href="#对平衡树的研究与探索" class="headerlink" title="对平衡树的研究与探索"></a>对平衡树的研究与探索</h2><p>[TOC]</p>
<h1 id="【摘要】"><a href="#【摘要】" class="headerlink" title="【摘要】"></a>【摘要】</h1><blockquote>
<pre><code>本文较全面地介绍了各种常用平衡树及其特点，复杂度和实用性。 
</code></pre><p>第一部分提出各种不同的二叉搜索树的性质、性能、实现方法、模板。第二部分主要介绍了可持久化treap。第三部分详细地对各种平衡树进行实战比较。</p>
<h1 id="【关键字】-二叉搜索树-treap-splay-sbt-rbt-替罪羊树-AVL"><a href="#【关键字】-二叉搜索树-treap-splay-sbt-rbt-替罪羊树-AVL" class="headerlink" title="【关键字】 二叉搜索树 treap splay sbt rbt 替罪羊树 AVL"></a>【关键字】 二叉搜索树 treap splay sbt rbt 替罪羊树 AVL</h1></blockquote>
<h1 id="【正文】"><a href="#【正文】" class="headerlink" title="【正文】"></a>【正文】</h1><h2 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h2><pre><code>平衡树在信息学竞赛中十分常见，作为较易实现各种功能以及自己自身的特有的代码短、时间优的特点，占据了信息学竞赛的至少30%的数据结构考点。平衡二叉树（Balanced Binary Tree）具有以下性质：它是一 棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。平衡二叉树的常用实现方法有红黑树（rbt）、AVL、替罪羊树、Treap、伸展树（spaly）平衡树的节点的公式如下 F(n)=F(n-1)+F(n-2)+1 这个类似于一个递归的数列，可以参考Fibonacci数列，1是根节点，F(n-1)是左子树的节点数量，F(n-2)是右子树的节点数量。
</code></pre><h2 id="二、各类平衡树的基本介绍"><a href="#二、各类平衡树的基本介绍" class="headerlink" title="二、各类平衡树的基本介绍"></a>二、各类平衡树的基本介绍</h2><h3 id="平衡二叉树"><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h3><p>一个长度为n的有序序列，从中查找一个指定的值，要花多少时间？<br>一个最简单的做法就是一个个去试。如果你运气好，第一个就碰上了；如果你运气不好，最后一个才是你要查的值，那就需要把n个值都检查一遍。时间复杂度O(n)。<br>当然你可能注意到了有序这个有用的性质，所以可以采用二分查找的方式，具体就不赘述了。时间复杂度O(log(n))。<br>但是如果要添加一个数据（及动态更新）怎么办？要保证序列的有序性，你必须要插入到适当的位置。这个位置同样可以通过二分查找在O(log(n))的时间中找出。<br>可是插入的过程呢？我们必须把后面的数据一个个顺次往后挪一格，而这需要O(n)的时间。 这也意味着删除的时间复杂度也就是O（n）。太慢了！无法满足大数据底线O（nlogn）左右的时间复杂度。所以我们需要快一点的方法（数据结构）。</p>
<h3 id="treap"><a href="#treap" class="headerlink" title="treap"></a>treap</h3><h4 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h4><pre><code>树堆，在数据结构中也称Treap，是指有一个随机附加域满足堆的性质的二叉搜索树，其结构相当于以随机数据插入的二叉搜索树。其基本操作的期望时间复杂度为O(logn)。相对于其他的平衡二叉搜索树，Treap的特点是实现简单，且能基本实现随机平衡的结构。
Treap=Tree+Heap
Treap是一棵二叉排序树，它的左子树和右子树分别是一个Treap，和一般的二叉排序树不同的是，Treap纪录一个额外的数据，就是优先级。Treap在以关键码构成二叉排序树的同时，还满足堆的性质(在这里我们假设节点的优先级大于该节点的孩子的优先级)。但是这里要注意的是Treap和二叉堆有一点不同，就是二叉堆必须是完全二叉树，而Treap可以并不一定是。
</code></pre><h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><h5 id="替代rand（）"><a href="#替代rand（）" class="headerlink" title="替代rand（）"></a>替代rand（）</h5><p>对于现在的treap，附加域往往还会选用另一种方法——选用以下代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">random</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> seed=<span class="number">703</span>; <span class="comment">//seed可以随便取</span></div><div class="line">    <span class="keyword">return</span> seed=<span class="keyword">int</span>(seed*<span class="number">48271L</span>L%<span class="number">2147483647</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>以上就可以取遍2147483647中每一个数，对于rand（）的可能重复附加域的情况有效地排除了
</code></pre><h5 id="可持久化"><a href="#可持久化" class="headerlink" title="可持久化"></a>可持久化</h5><p><strong>支持部分可持久化功能，详细信息见可持久化模块。</strong></p>
<h4 id="核心的步骤"><a href="#核心的步骤" class="headerlink" title="核心的步骤"></a>核心的步骤</h4><h5 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h5><pre><code>事实上，想要一棵树恰巧满足以上的条件并不容易。绝大多数情况下，我们都需要通过旋转的方法来调整树的形态，使得它满足以上的条件。 
旋转分左旋和右旋两种，他们都不破坏二叉查找树的性质。如图所示：
</code></pre><p><img src="http://img.blog.csdn.net/20170113091321032?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h5 id="插入、删除和选择第k小项"><a href="#插入、删除和选择第k小项" class="headerlink" title="插入、删除和选择第k小项"></a>插入、删除和选择第k小项</h5><pre><code>插入和普通的二叉查找树差不多。但是要注意，插入有可能会破坏Treap的堆性质，所以要通过旋转来维护堆性质。下图就是一个例子：
</code></pre><p><img src="http://img.blog.csdn.net/20170113091505941?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<pre><code>删除就相对容易很多了，由于Treap满足堆性质，只需要将待删除的节点旋转到叶子节点再删除就可以了。
</code></pre><h4 id="操作及模板"><a href="#操作及模板" class="headerlink" title="操作及模板"></a>操作及模板</h4><p>以下代码来自黄学长（hzwer）</p>
<blockquote>
<p>支持以下操作</p>
<ol>
<li>插入x数</li>
<li>删除x数(若有多个相同的数，因只删除一个)</li>
<li>查询x数的排名(若有多个相同的数，因输出最小的排名)</li>
<li>查询排名为x的数</li>
<li>求x的前驱(前驱定义为小于x，且最大的数)</li>
<li>求x的后继(后继定义为大于x，且最小的数)<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> l,r,v,size,rnd,w;</div><div class="line">&#125;tr[<span class="number">100005</span>];</div><div class="line"><span class="keyword">int</span> n,size,root,ans;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k)</span><span class="comment">//更新结点信息</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    tr[k].size=tr[tr[k].l].size+tr[tr[k].r].size+tr[k].w;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rturn</span><span class="params">(<span class="keyword">int</span> &amp;k)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">int</span> t=tr[k].l;tr[k].l=tr[t].r;tr[t].r=k;</div><div class="line">    tr[t].size=tr[k].size;update(k);k=t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lturn</span><span class="params">(<span class="keyword">int</span> &amp;k)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">int</span> t=tr[k].r;tr[k].r=tr[t].l;tr[t].l=k;</div><div class="line">    tr[t].size=tr[k].size;update(k);k=t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        size++;k=size;</div><div class="line">        tr[k].size=tr[k].w=<span class="number">1</span>;tr[k].v=x;tr[k].rnd=rand();</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    tr[k].size++;</div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)tr[k].w++;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">    &#123;</div><div class="line">        insert(tr[k].r,x);</div><div class="line">        <span class="keyword">if</span>(tr[tr[k].r].rnd&lt;tr[k].rnd)lturn(k);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> </div><div class="line">    &#123;</div><div class="line">        insert(tr[k].l,x);</div><div class="line">        <span class="keyword">if</span>(tr[tr[k].l].rnd&lt;tr[k].rnd)rturn(k);</div><div class="line">    &#125; </div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>; </div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(tr[k].w&gt;<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            tr[k].w--;tr[k].size--;<span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(tr[k].l*tr[k].r==<span class="number">0</span>)k=tr[k].l+tr[k].r;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tr[tr[k].l].rnd&lt;tr[tr[k].r].rnd)</div><div class="line">            rturn(k),del(k,x);</div><div class="line">        <span class="keyword">else</span> lturn(k),del(k,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">        tr[k].size--,del(tr[k].r,x);</div><div class="line">    <span class="keyword">else</span> tr[k].size--,del(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_rank</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)<span class="keyword">return</span> tr[tr[k].l].size+<span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">        <span class="keyword">return</span> tr[tr[k].l].size+tr[k].w+query_rank(tr[k].r,x);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> query_rank(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_num</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(x&lt;=tr[tr[k].l].size)</div><div class="line">        <span class="keyword">return</span> query_num(tr[k].l,x);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[tr[k].l].size+tr[k].w)</div><div class="line">        <span class="keyword">return</span> query_num(tr[k].r,x-tr[tr[k].l].size-tr[k].w);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> tr[k].v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_pro</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v&lt;x)</div><div class="line">    &#123;</div><div class="line">        ans=k;query_pro(tr[k].r,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> query_pro(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_sub</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v&gt;x)</div><div class="line">    &#123;</div><div class="line">        ans=k;query_sub(tr[k].l,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> query_sub(tr[k].r,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">    <span class="keyword">int</span> opt,x;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;opt,&amp;x);</div><div class="line">        <span class="keyword">switch</span>(opt)</div><div class="line">        &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>:insert(root,x);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">2</span>:del(root,x);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">3</span>:<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query_rank(root,x));<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">4</span>:<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query_num(root,x));<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">5</span>:ans=<span class="number">0</span>;query_pro(root,x);<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tr[ans].v);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">6</span>:ans=<span class="number">0</span>;query_sub(root,x);<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tr[ans].v);<span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
</blockquote>
<h3 id="sbt-节点大小平衡树"><a href="#sbt-节点大小平衡树" class="headerlink" title="sbt(节点大小平衡树)"></a>sbt(节点大小平衡树)</h3><h4 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h4><pre><code>它是由中国广东中山纪念中学的陈启峰发明的。陈启峰于2006年底完成论文《Size Balanced Tree》，并在2007年的全国青少年信息学奥林匹克竞赛冬令营中发表。相比红黑树、AVL树等自平衡二叉查找树，SBT更易于实现。据陈启峰在论文中称，SBT是“目前为止速度最快的高级二叉搜索树”。SBT能在O(log n)的时间内完成所有二叉搜索树(BST)的相关操作，而与普通二叉搜索树相比，SBT仅仅加入了简洁的核心操作Maintain。由于SBT赖以保持平衡的是size域而不是其他“无用”的域，它可以很方便地实现动态顺序统计中的select和rank操作。
由于普通sbt在实用中很频繁，所以本文重点介绍另一种在竞赛条件下可能更快的退化版sbt。
</code></pre><h4 id="补充-1"><a href="#补充-1" class="headerlink" title="补充"></a>补充</h4><h5 id="与标准版的比较"><a href="#与标准版的比较" class="headerlink" title="与标准版的比较"></a>与标准版的比较</h5><table>
<thead>
<tr>
<th>标准版SBT</th>
<th>退化版SBT</th>
</tr>
</thead>
<tbody>
<tr>
<td>平衡方式：Maintain</td>
<td>平衡方式：Maintain</td>
</tr>
<tr>
<td></td>
<td></td>
<td>If s[left[left[t]]]&gt;s[right[t]]</td>
</tr>
<tr>
<td></td>
<td></td>
<td>right_rotate(t);</td>
</tr>
<tr>
<td></td>
<td></td>
<td>If s[right[right[t]]]&gt;s[left[t]]</td>
</tr>
<tr>
<td></td>
<td></td>
<td>left_rotate(t);</td>
</tr>
<tr>
<td></td>
<td>特点：相对SPLAY,AVL,TREAP速度很快，代码短，不会退化，保证深度非常小。</td>
<td>特点：相对标准版SBT速度更快，代码更短，随机、有序数据不会退化（除人字形数据），深度也很小。</td>
</tr>
<tr>
<td></td>
<td>适用范围：任何程序中。</td>
<td>使用范围：在信息学竞赛中很实用，因为不太可能有人字型数据。但在实际应用中就不能保证一定不退化。</td>
</tr>
</tbody>
</table>
<h6 id="插入人字形数据后退化的SBT"><a href="#插入人字形数据后退化的SBT" class="headerlink" title="插入人字形数据后退化的SBT"></a>插入人字形数据后退化的SBT</h6><p><img src="http://img.blog.csdn.net/20170113094002723?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h4 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//标准版</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;//形如INT_MAX一类的</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 111111</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7FFFFFFF</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> REP(i,s,t) for(int i=(s);i&lt;=(t);++i)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a,b) memset(a,b,sizeof(a))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mp(a,b) make_pair(a,b)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L(x) x&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R(x) x&lt;&lt;1|1</span></div><div class="line"><span class="meta"># <span class="meta-keyword">define</span> eps 1e-5</span></div><div class="line"><span class="comment">//#pragma comment(linker, "/STACK:36777216") ///传说中的外挂</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sbt</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> l,r,s,key;</div><div class="line">&#125; tr[MAX];</div><div class="line"><span class="keyword">int</span> top , root;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">left_rot</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y = tr[x].r;</div><div class="line">    tr[x].r = tr[y].l;</div><div class="line">    tr[y].l = x;</div><div class="line">    tr[y].s = tr[x].s; <span class="comment">//转上去的节点数量为先前此处节点的size</span></div><div class="line">    tr[x].s = tr[tr[x].l].s + tr[tr[x].r].s + <span class="number">1</span>;</div><div class="line">    x = y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">right_rot</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y = tr[x].l;</div><div class="line">    tr[x].l = tr[y].r;</div><div class="line">    tr[y].r = x;</div><div class="line">    tr[y].s = tr[x].s;</div><div class="line">    tr[x].s = tr[tr[x].l].s + tr[tr[x].r].s + <span class="number">1</span>;</div><div class="line">    x = y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">bool</span> flag)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(flag == <span class="number">0</span>) &#123; <span class="comment">//左边</span></div><div class="line">        <span class="keyword">if</span>(tr[tr[tr[x].l].l].s &gt; tr[tr[x].r].s) &#123;<span class="comment">//左孩子左子树size大于右孩子size</span></div><div class="line">            right_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(tr[tr[tr[x].l].r].s &gt; tr[tr[x].r].s) &#123;<span class="comment">//左孩子右子树size大于右孩子size</span></div><div class="line">            left_rot(tr[x].l);</div><div class="line">            right_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> ;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">//右边</span></div><div class="line">        <span class="keyword">if</span>(tr[tr[tr[x].r].r].s &gt; tr[tr[x].l].s) &#123; <span class="comment">//右孩子的右子树大于左孩子</span></div><div class="line">            left_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(tr[tr[tr[x].r].l].s &gt; tr[tr[x].l].s) &#123; <span class="comment">//右孩子的左子树大于左孩子</span></div><div class="line">            right_rot(tr[x].r);</div><div class="line">            left_rot(x);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    maintain(tr[x].l,<span class="number">0</span>);</div><div class="line">    maintain(tr[x].r,<span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) &#123; <span class="comment">//空节点</span></div><div class="line">        x = ++ top;</div><div class="line">        tr[x].l = tr[x].r = <span class="number">0</span>;</div><div class="line">        tr[x].s = <span class="number">1</span>;</div><div class="line">        tr[x].key = key;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        tr[x].s ++;</div><div class="line">        <span class="keyword">if</span>(key &lt; tr[x].key) insert(tr[x].l,key);</div><div class="line">        <span class="keyword">else</span> insert(tr[x].r,key);</div><div class="line">        maintain(x,key &gt;= tr[x].key);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> &amp;p,<span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (tr[p].key==w || (tr[p].l == <span class="number">0</span> &amp;&amp; w &lt; tr[p].key) || (tr[p].r == <span class="number">0</span> &amp;&amp; w &gt; tr[p].key)) &#123;</div><div class="line">        <span class="keyword">int</span> delnum = tr[p].key;</div><div class="line">        <span class="keyword">if</span> (tr[p].l == <span class="number">0</span> || tr[p].r == <span class="number">0</span>) p = tr[p].l + tr[p].r;</div><div class="line">        <span class="keyword">else</span> tr[p].key=del(tr[p].l,INF);</div><div class="line">        <span class="keyword">return</span> delnum;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (w &lt; tr[p].key) <span class="keyword">return</span> del(tr[p].l,w);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> del(tr[p].r,w);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> k;</div><div class="line">    tr[x].s --;</div><div class="line">    <span class="keyword">if</span>(key == tr[x].key || (key &lt; tr[x].key &amp;&amp; tr[x].l == <span class="number">0</span>) || (key &gt; tr[x].key &amp;&amp; tr[x].r == <span class="number">0</span>)) &#123;</div><div class="line">        k = tr[x].key;</div><div class="line">        <span class="keyword">if</span>(tr[x].l &amp;&amp; tr[x].r) &#123;</div><div class="line">            tr[x].key = remove(tr[x].l,tr[x].key + <span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            x = tr[x].l + tr[x].r;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(key &gt; tr[x].key) &#123;</div><div class="line">        k = remove(tr[x].r,key);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(key &lt; tr[x].key) &#123;</div><div class="line">        k = remove(tr[x].l,key);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">()</span> </span>&#123; <span class="comment">//二叉搜索树找最小值</span></div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">for</span>(x = root; tr[x].l; x = tr[x].l) ;</div><div class="line">    <span class="keyword">return</span> tr[x].key;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmax</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">for</span>(x = root ; tr[x].r; x = tr[x].r) ;</div><div class="line">    <span class="keyword">return</span> tr[x].key;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pred</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y,<span class="keyword">int</span> key)</span></span></div><div class="line"><span class="function"><span class="comment">//前驱 小于</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(tr[x].key &lt; key)<span class="comment">//加上等号，就是小于等于</span></div><div class="line">        <span class="keyword">return</span> pred(tr[x].r,x,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> pred(tr[x].l,y,key);</div><div class="line">&#125;<span class="comment">//pred(root,0,key)</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">succ</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> y,<span class="keyword">int</span> key)</span> </span>&#123; <span class="comment">//后继 大于</span></div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(tr[x].key &gt; key)</div><div class="line">        <span class="keyword">return</span> succ(tr[x].l,x,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> succ(tr[x].r,y,key);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> k)</span> </span>&#123; <span class="comment">//求第k小数</span></div><div class="line">    <span class="keyword">int</span> r = tr[tr[x].l].s + <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(r == k) <span class="keyword">return</span> tr[x].key;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(r &lt; k) <span class="keyword">return</span> select(tr[x].r,k - r);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> select(tr[x].l,k);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">rank</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> key)</span> </span>&#123; <span class="comment">//求第K小数的逆运算</span></div><div class="line">    <span class="keyword">if</span>(key &lt; tr[x].key) <span class="keyword">return</span> rank(tr[x].l,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(key &gt; tr[x].key) <span class="keyword">return</span> rank(tr[x].r,key);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> tr[tr[x].l].s + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">inorder</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(x == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        inorder(tr[x].l);</div><div class="line">        <span class="built_in">cout</span>&lt;&lt; x &lt;&lt;<span class="string">" "</span>&lt;&lt; tr[x].key &lt;&lt; <span class="string">" "</span> &lt;&lt;tr[x].s &lt;&lt; <span class="string">" "</span> &lt;&lt;tr[tr[x].l].key &lt;&lt; <span class="string">" "</span> &lt;&lt; tr[tr[x].r].key &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">        inorder(tr[x].r);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//This is a degenerated but fast version.（退化版）</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(t) (t==NULL?0:t-&gt;s)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> key,s;</div><div class="line">	Node *left,*right;</div><div class="line">	Node(<span class="keyword">int</span> a):s(<span class="number">1</span>),left(<span class="literal">NULL</span>),right(<span class="literal">NULL</span>),key(a)&#123;&#125;	</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(Node *a,Node *b)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> a-&gt;key-b-&gt;key;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Node *t)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!t)</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	t-&gt;s=sz(t-&gt;left)+sz(t-&gt;right)+<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rr</span><span class="params">(Node *&amp;t,Node *k)</span></span>&#123;</div><div class="line">	t-&gt;left=k-&gt;right;</div><div class="line">	k-&gt;right=t;</div><div class="line">	update(t);</div><div class="line">	update(k);</div><div class="line">	t=k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lr</span><span class="params">(Node *&amp;t,Node *k)</span></span>&#123;</div><div class="line">	t-&gt;right=k-&gt;left;</div><div class="line">	k-&gt;left=t;</div><div class="line">	update(t);</div><div class="line">	update(k);</div><div class="line">	t=k;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Node *&amp;t,Node *k)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(t==<span class="literal">NULL</span>)</div><div class="line">		t=k;</div><div class="line">	<span class="keyword">else</span></div><div class="line">		<span class="keyword">if</span>(cmp(k,t)&lt;<span class="number">0</span>)&#123;</div><div class="line">			insert(t-&gt;left,k);</div><div class="line">			<span class="keyword">if</span>(sz(t-&gt;left-&gt;left)&gt;sz(t-&gt;right))</div><div class="line">				rr(t,t-&gt;left);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			insert(t-&gt;right,k);</div><div class="line">			<span class="keyword">if</span>(sz(t-&gt;right-&gt;right)&gt;sz(t-&gt;left))</div><div class="line">				lr(t,t-&gt;right);</div><div class="line">		&#125;</div><div class="line">	update(t);</div><div class="line">&#125;</div><div class="line"><span class="function">Node <span class="title">findmin</span><span class="params">(Node *t)</span></span>&#123;</div><div class="line">	<span class="keyword">while</span>(t-&gt;left!=<span class="literal">NULL</span>)</div><div class="line">		t=t-&gt;left;</div><div class="line">	<span class="keyword">return</span> *t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node *&amp;t,Node *k)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(t==<span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">if</span>(cmp(k,t)==<span class="number">0</span>)</div><div class="line">		<span class="keyword">if</span>(t-&gt;right==<span class="literal">NULL</span>)&#123;</div><div class="line">			k=t-&gt;left;</div><div class="line">			<span class="keyword">delete</span> t;</div><div class="line">			t=k;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span>&#123;</div><div class="line">			Node tmp=findmin(t-&gt;right);</div><div class="line">			remove(t-&gt;right,&amp;tmp);</div><div class="line">			tmp.left=t-&gt;left;</div><div class="line">			tmp.right=t-&gt;right;</div><div class="line">			*t=tmp;</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">		<span class="keyword">if</span>(cmp(k,t)&lt;<span class="number">0</span>)</div><div class="line">			remove(t-&gt;left,k);</div><div class="line">		<span class="keyword">else</span></div><div class="line">			remove(t-&gt;right,k);</div><div class="line">	update(t);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">preorder</span><span class="params">(Node *t)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(t==<span class="literal">NULL</span>)</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	preorder(t-&gt;left);</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d "</span>,t-&gt;key);</div><div class="line">	preorder(t-&gt;right);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="splay"><a href="#splay" class="headerlink" title="splay"></a>splay</h3><h4 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>伸展树（Splay Tree），也叫分裂树，是一种二叉排序树，它能在O(log n)内完成插入、查找和删除操作。它由Daniel Sleator和Robert Tarjan创造，后勃刚对其进行了改进。它的优势在于不需要记录用于平衡树的冗余信息。在伸展树上的一般操作都基于伸展操作。创造者是Daniel Sleator和Robert Tarjan。优点有每次查询会调整树的结构，使被查询频率高的条目更靠近树根。</p>
<h4 id="实现操作"><a href="#实现操作" class="headerlink" title="实现操作"></a>实现操作</h4><p>Tree Rotation<br><img src="http://img.my.csdn.net/uploads/201210/10/1349877565_2986.png" alt="这里写图片描述"><br>树的旋转是splay的基础，对于二叉查找树来说，树的旋转不破坏查找树的结构。<br>Splaying<br>Splaying是Splay Tree中的基本操作，为了让被查询的条目更接近树根，Splay Tree使用了树的旋转操作，同时保证二叉排序树的性质不变。<br>Splaying的操作受以下三种因素影响：<br>1.节点x是父节点p的左孩子还是右孩子<br>2.节点p是不是根节点，如果不是<br>3.节点p是父节点g的左孩子还是右孩子<br>同时有三种基本操作：<br>1.Zig Step<br><img src="http://img.my.csdn.net/uploads/201210/10/1349877709_4105.png" alt="这里写图片描述"><br>当p为根节点时，进行zip step操作。<br>当x是p的左孩子时，对x右旋；<br>当x是p的右孩子时，对x左旋。<br>2.Zig-Zig Step<br><img src="http://img.my.csdn.net/uploads/201210/10/1349877744_7090.png" alt="这里写图片描述"><br>当p不是根节点，且x和p同为左孩子或右孩子时进行Zig-Zig操作。<br>当x和p同为左孩子时，依次将p和x右旋；<br>当x和p同为右孩子时，依次将p和x左旋。<br>3.Zig-Zag Step<br><img src="http://img.my.csdn.net/uploads/201210/10/1349877779_5253.png" alt="这里写图片描述"><br>当p不是根节点，且x和p不同为左孩子或右孩子时，进行Zig-Zag操作。<br>当p为左孩子，x为右孩子时，将x左旋后再右旋。<br>当p为右孩子，x为左孩子时，将x右旋后再左旋。<br>Splay Tree可以方便的解决一些区间问题，根据不同形状二叉树先序遍历结果不变的特性，可以将区间按顺序建二叉查找树。</p>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>每次自下而上的一套splay都可以将x移动到根节点的位置，利用这个特性，可以方便的利用Lazy的思想进行区间操作。<br>对于每个节点记录size，代表子树中节点的数目，这样就可以很方便地查找区间中的第k小或第k大元素。<br>对于一段要处理的区间[x, y]，首先splay x-1到root，再splay y+1到root的右孩子，这时root的右孩子的左孩子对应子树就是整个区间。<br>这样，大部分区间问题都可以很方便的解决，操作同样也适用于一个或多个条目的添加或删除，和区间的移动。</p>
<h4 id="补充-2"><a href="#补充-2" class="headerlink" title="补充"></a>补充</h4><p>splay在竞赛中有时会被写成单旋</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//单旋</span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> g=<span class="number">0</span>)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(t[x].p==g)pd(x);</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">while</span>(t[x].p!=g)rot(x);</div><div class="line">        pu(x);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但这在有序数据下是达不到O（logn）的，试想一下如果当前是一条链的话，在查询完最深的节点后，只用N个单旋把节点单旋上去的话，splay操作后的树仍然是一条链。<br><img src="http://doc.ithao123.cn/uploads02/u02/7b/74/7b74a24b45e3a6a136c4d3cb12c8ccf7.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/31/de/31de9f40957f66a1bab5eda192921597.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/27/e5/27e5a02a2380f2be47f3a392fb6cdc56.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/11/8f/118fe91a80a43d64a05089d456f9c93e.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/38/15/3815f024db41b09df42d9fa66347687b.jpg" alt="这里写图片描述"><br>所以要使用双选来维持二叉搜索树的平衡。<br><img src="http://doc.ithao123.cn/uploads02/u02/e5/4d/e54daaf625cdf345c0a112daa0e2241e.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/e3/7c/e37c065106296eff8eb0b637c0ba9e71.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/4e/b1/4eb1bab56e209733c8bd655bcc6b0586.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/51/7d/517d6eb490ba1c92e7b66398dc4b8ae5.jpg" alt="这里写图片描述"><br><img src="http://doc.ithao123.cn/uploads02/u02/91/4a/914a55d03ed5351a1405eb6ce914b026.jpg" alt="这里写图片描述"><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//双旋</span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">spaly</span><span class="params">(node *t, node *p)</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span> (t-&gt;father != p) &#123;</div><div class="line">        node *f = t-&gt;father;</div><div class="line">        node *g = f-&gt;father;</div><div class="line">        <span class="keyword">if</span> (g == p)</div><div class="line">            rotate(t);</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span> (son(g, f) ^ son(f, t))</div><div class="line">                rotate(t), rotate(t);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                rotate(f), rotate(t);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="序列之王"><a href="#序列之王" class="headerlink" title="序列之王"></a>序列之王</h4><p>在有可持久化treap之前，动态树（LCT）几乎全由splay完成，包括各种序列操作以及文本编辑器类型的题。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//含merge与split的splay模板</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,l,r;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">splay</span>&#123;</span></div><div class="line">    splay *ch[<span class="number">2</span>],*fa;</div><div class="line">    <span class="keyword">int</span> val,sz;</div><div class="line">    <span class="keyword">bool</span> flip;</div><div class="line">    splay(<span class="keyword">int</span>);</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> k)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span>(k&lt;=ch[<span class="number">0</span>]-&gt;sz)  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span>(k&gt;ch[<span class="number">0</span>]-&gt;sz+<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;sz=<span class="number">1</span>+ch[<span class="number">0</span>]-&gt;sz+ch[<span class="number">1</span>]-&gt;sz;&#125;</div><div class="line">    <span class="function">splay* <span class="title">find_it</span><span class="params">(<span class="keyword">int</span> k)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        push_down();</div><div class="line">        <span class="keyword">int</span> d=cmp(k);</div><div class="line">        <span class="keyword">if</span>(d==<span class="number">-1</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        <span class="keyword">if</span>(d==<span class="number">1</span>) k-=ch[<span class="number">0</span>]-&gt;sz+<span class="number">1</span>;</div><div class="line">        <span class="keyword">return</span> ch[d]-&gt;find_it(k);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">()</span></span>;</div><div class="line">&#125;*null=<span class="keyword">new</span> splay(<span class="number">0</span>),*V,*x,*y;</div><div class="line">splay :: splay(<span class="keyword">int</span> x)</div><div class="line">&#123;</div><div class="line">    sz=null?<span class="number">1</span>:<span class="number">0</span>;</div><div class="line">    val=x;flip=<span class="literal">false</span>;</div><div class="line">    ch[<span class="number">0</span>]=ch[<span class="number">1</span>]=fa=null;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> splay :: push_down()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>(!flip) <span class="keyword">return</span>;</div><div class="line">    flip=<span class="literal">false</span>;</div><div class="line">    swap(ch[<span class="number">0</span>],ch[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">if</span>(ch[<span class="number">0</span>]!=null) ch[<span class="number">0</span>]-&gt;flip=!ch[<span class="number">0</span>]-&gt;flip;</div><div class="line">    <span class="keyword">if</span>(ch[<span class="number">1</span>]!=null) ch[<span class="number">1</span>]-&gt;flip=!ch[<span class="number">1</span>]-&gt;flip;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">turn</span><span class="params">(splay *c,<span class="keyword">int</span> d)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    splay *y=c-&gt;fa;</div><div class="line">    y-&gt;ch[d^<span class="number">1</span>]=c-&gt;ch[d];</div><div class="line">    <span class="keyword">if</span>(c-&gt;ch[d]!=null) c-&gt;ch[d]-&gt;fa=y;</div><div class="line">    c-&gt;ch[d]=y;</div><div class="line">    c-&gt;fa=y-&gt;fa;</div><div class="line">         <span class="keyword">if</span>(y-&gt;fa-&gt;ch[<span class="number">0</span>]==y) y-&gt;fa-&gt;ch[<span class="number">0</span>]=c;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(y-&gt;fa-&gt;ch[<span class="number">1</span>]==y) y-&gt;fa-&gt;ch[<span class="number">1</span>]=c;</div><div class="line">    y-&gt;fa=c;</div><div class="line">    y-&gt;maintain();</div><div class="line">    c-&gt;maintain();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">splaying</span><span class="params">(splay *c)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    splay *y,*z;</div><div class="line">    <span class="keyword">while</span>(c-&gt;fa!=null)</div><div class="line">    &#123;</div><div class="line">        y=c-&gt;fa;z=y-&gt;fa;</div><div class="line">        <span class="keyword">int</span> d1=y-&gt;ch[<span class="number">0</span>]==c?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(z!=null)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">int</span> d2=z-&gt;ch[<span class="number">0</span>]==y?<span class="number">0</span>:<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(d1==d2) turn(y,d1^<span class="number">1</span>),turn(c,d1^<span class="number">1</span>);</div><div class="line">            <span class="keyword">else</span>       turn(c,d1^<span class="number">1</span>),turn(c,d1);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> turn(c,d1^<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(splay *&amp;c,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(l&gt;r) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">    c=<span class="keyword">new</span> splay(mid);</div><div class="line">    build(c-&gt;ch[<span class="number">0</span>],l,mid<span class="number">-1</span>);</div><div class="line">    build(c-&gt;ch[<span class="number">1</span>],mid+<span class="number">1</span>,r);</div><div class="line">    <span class="keyword">if</span>(c-&gt;ch[<span class="number">0</span>]!=null) c-&gt;ch[<span class="number">0</span>]-&gt;fa=c;</div><div class="line">    <span class="keyword">if</span>(c-&gt;ch[<span class="number">1</span>]!=null) c-&gt;ch[<span class="number">1</span>]-&gt;fa=c;</div><div class="line">    c-&gt;maintain();</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">splay* <span class="title">Merge</span><span class="params">(splay *x,splay *y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(x==null) <span class="keyword">return</span> y;</div><div class="line">    <span class="keyword">if</span>(y==null) <span class="keyword">return</span> x;</div><div class="line">    splay *c=x-&gt;find_it(x-&gt;sz);</div><div class="line">    splaying(c);</div><div class="line">    c-&gt;ch[<span class="number">1</span>]=y;</div><div class="line">    y-&gt;fa=c;</div><div class="line">    c-&gt;maintain();</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Split</span><span class="params">(splay *V,splay *&amp;x,splay *&amp;y,<span class="keyword">int</span> k)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k&lt;=<span class="number">0</span>)     &#123;x=null;y=V;<span class="keyword">return</span>;&#125;</div><div class="line">    <span class="keyword">if</span>(k&gt;=V-&gt;sz) &#123;x=V;y=null;<span class="keyword">return</span>;&#125;</div><div class="line">    splay *c=V-&gt;find_it(k);</div><div class="line">    splaying(c);</div><div class="line">    y=c-&gt;ch[<span class="number">1</span>];y-&gt;fa=null;</div><div class="line">    x=c;       x-&gt;ch[<span class="number">1</span>]=null;</div><div class="line">    x-&gt;maintain();</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cs</span><span class="params">(splay *c)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(c==null) <span class="keyword">return</span>;</div><div class="line">    c-&gt;push_down();</div><div class="line">    cs(c-&gt;ch[<span class="number">0</span>]);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d "</span>,c-&gt;val);</div><div class="line">    cs(c-&gt;ch[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">    build(V,<span class="number">1</span>,n);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;l,&amp;r);</div><div class="line">        Split(V,V,x,l<span class="number">-1</span>);</div><div class="line">        Split(x,x,y,r-l+<span class="number">1</span>);</div><div class="line">        <span class="keyword">if</span>(x!=null) x-&gt;flip=!x-&gt;flip;</div><div class="line">        V=Merge(V,x);</div><div class="line">        V=Merge(V,y);</div><div class="line">    &#125;</div><div class="line">    cs(V);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="RBT（红黑树）"><a href="#RBT（红黑树）" class="headerlink" title="RBT（红黑树）"></a>RBT（红黑树）</h3><p><strong>这是一个在当今信息界公认的最快的平衡二叉树之一!!!STL里的&lt;  set &gt;与&lt; map &gt;就由其作为底层数据结构</strong><br><img src="http://img.ph.126.net/-OxLivX5AQzRieHXS8Gpow==/3226266183059321046.jpg" alt="这里写图片描述"></p>
<h4 id="基本介绍-3"><a href="#基本介绍-3" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。<br>它是在1972年由Rudolf Bayer发明的，当时被称为平衡二叉B树（symmetric binary B-trees）。后来，在1978年被 Leo J. Guibas 和 Robert Sedgewick 修改为如今的“红黑树”。<br>红黑树和AVL树类似，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能。<br>它虽然是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的： 它可以在O(log n)时间内做查找，插入和删除，这里的n 是树中元素的数目。<br>它的统计性能要好于平衡二叉树（AVL）因此，红黑树在很多地方都有应用。在C++ STL中，很多部分(包括set, multiset, map, multimap)应用了红黑树的变体(SGI STL中的红黑树有一些变化，这些修改提供了更好的性能，以及对set操作的支持。</p>
<h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><p>红黑树是每个节点都带有颜色属性的二叉查找树，颜色或红色或黑色。在二叉查找树强制一般要求以外，对于任何有效的红黑树我们增加了如下的额外要求:</p>
<blockquote>
<p>性质1. 节点是红色或黑色。<br>性质2. 根节点是黑色。<br>性质3 每个叶节点（NIL节点，空节点）是黑色的。<br>性质4 每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)<br>性质5. 从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。</p>
</blockquote>
<p>这些约束强制了红黑树的关键性质: 从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。结果是这个树大致上是平衡的。因为操作比如插入、删除和查找某个值的最坏情况时间都要求与树的高度成比例，这个在高度上的理论上限允许红黑树在最坏情况下都是高效的，而不同于普通的二叉查找树。<br>要知道为什么这些特性确保了这个结果，注意到性质4导致了路径不能有两个毗连的红色节点就足够了。最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点。因为根据性质5所有最长的路径都有相同数目的黑色节点，这就表明了没有路径能多于任何其他路径的两倍长。<br>在很多树数据结构的表示中，一个节点有可能只有一个子节点，而叶子节点不包含数据。用这种范例表示红黑树是可能的，但是这会改变一些属性并使算法复杂。为此，本文中我们使用 “nil 叶子” 或”空(null)叶子”，如上图所示，它不包含数据而只充当树在此结束的指示。这些节点在绘图中经常被省略，导致了这些树好象同上述原则相矛盾，而实际上不是这样。与此有关的结论是所有节点都有两个子节点，尽管其中的一个或两个可能是空叶子。</p>
<h4 id="引理"><a href="#引理" class="headerlink" title="引理"></a>引理</h4><blockquote>
<p>引理：一棵有n个内结点的红黑树的高度至多为2lg(n+1)。</p>
</blockquote>
<p>这个引理怎么证明呢，这里需要一个工具  对以x为根的子树，它所包含的内部结点数至少为2^[bh(x)]-1。这里bh(x)（bh嘛，black height）被定义为结点x的黑高度，就是说，从结点x（不包括它本身）到它任一个叶结点的路径上所有黑色结点的个数。<br>下面用归纳法证明：<br>    1)若x高度为0，那么它就是一叶子结点，它确实至少包含2^0-1=0个内部结点<br>    2)假设x为红黑树的某一内部结点，且它高度h&gt;0，那么它的黑高度就是bh(x)，但是它的两个孩子结点呢？这个就根据它们的颜色来判断了：<br>       如果x有一个红色的孩子y，那么y的黑高度bh(y)=bh(x)，看看上面对黑高度的定义你就明白了——既然它是红色的，那么它的黑高度就应该和它父亲的黑高度是一样的；<br>       如果x有一个黑色的孩子z，那么z的黑高度bh(z)=bh(x)-1，这个怎么解释呢，因为它自己就是个黑结点，那么在计算它的黑高度时，必须把它自己排除在外（还是根据定义），所以它是bh(x)-1。<br>    3)x的孩子结点所构成的子树的高度肯定小于x这颗子树，那么对于这两个孩子，不管它们颜色如何，一定满足归纳假设的是至少hb 高度为bh(x)-1。所以，对x来说，它所包含的内部结点个数“至少”为两个孩子结点所包含的内部结点数，再加上它自己，于是就为2^[bh(x)-1]-1+2^[bh(x)-1]-1+1=2^[bh(x)]-1，归纳证明完毕。<br>也就是说n&gt;=2^[bh(x)]-1———①<br>把一 中红黑树性质中 4）、5）两个特性结合起来，其实我们可以得到黑节点至少是红节点的2倍。用一句话来说就是“有红必有黑，但有黑未必一定有红”。为什么这么说呢，因为从特性4）我们知道，如果有一个红结点存在，那么它的儿子结点一定是黑的，最极端的情况下，该路径上所有的结点就被红、黑两种结点给平分了那就是黑节点至少是红节点的2倍。不知这个问题我解释清楚没有，因为这是往下理解的关键。<br>如果一棵红黑树的高为h，那么在这个高度上（不包括根结点本身）至少有1/2h的黑结点，再结合上面对“黑高度”的定义，我们说，红黑树根结点的黑高度至少是1/2h，好了，我们拿出公式①，设n为该红黑树所包含的内部结点数，我们得出如下结论： n&gt;=2^(1/2h)-1。 我们把它整理整理，就得到了h&lt;=2lg(n+1)，就是我们要证明的结论：红黑树的高度最多也就是2lg(n+1)。</p>
<h4 id="补充与模板"><a href="#补充与模板" class="headerlink" title="补充与模板"></a>补充与模板</h4><p>由于红黑树有5种插入、6种删除情况，而篇幅有限所以就不讨论其实现方式。下面是一篇红黑树的简介代码，可以参考实现方式。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> Max_N = <span class="number">110000</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> data, s, c;</div><div class="line">    <span class="keyword">bool</span> color;</div><div class="line">    Node *fa, *ch[<span class="number">2</span>];</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> _v, <span class="keyword">bool</span> _color, <span class="keyword">int</span> i, Node *p)</span> </span>&#123;</div><div class="line">        data = _v, color = _color, s = c = i;</div><div class="line">        fa = ch[<span class="number">0</span>] = ch[<span class="number">1</span>] = p;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_up</span><span class="params">()</span> </span>&#123;</div><div class="line">        s = ch[<span class="number">0</span>]-&gt;s + ch[<span class="number">1</span>]-&gt;s + c;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">push_down</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (Node *x = <span class="keyword">this</span>; x-&gt;s; x = x-&gt;fa) x-&gt;s--;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> v)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data == v ? <span class="number">-1</span> : v &gt; data;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RedBlackTree</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> top;</div><div class="line">    Node *root, *null;</div><div class="line">    Node <span class="built_in">stack</span>[Max_N], *tail, *store[Max_N];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        tail = &amp;<span class="built_in">stack</span>[<span class="number">0</span>];</div><div class="line">        null = tail++;</div><div class="line">        null-&gt;<span class="built_in">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</div><div class="line">        root = null;</div><div class="line">        top = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> Node *<span class="title">newNode</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">        Node *p = null;</div><div class="line">        <span class="keyword">if</span> (!top) p = tail++;</div><div class="line">        <span class="keyword">else</span> p = store[--top];</div><div class="line">        p-&gt;<span class="built_in">set</span>(v, <span class="number">1</span>, <span class="number">1</span>, null);</div><div class="line">        <span class="keyword">return</span> p;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(Node* &amp;x, <span class="keyword">bool</span> d )</span> </span>&#123;</div><div class="line">        Node *y = x-&gt;ch[!d];</div><div class="line">        x-&gt;ch[!d] = y-&gt;ch[d];</div><div class="line">        <span class="keyword">if</span> (y-&gt;ch[d]-&gt;s) y-&gt;ch[d]-&gt;fa = x;</div><div class="line">        y-&gt;fa = x-&gt;fa;</div><div class="line">        <span class="keyword">if</span> (!x-&gt;fa-&gt;s) root = y;</div><div class="line">        <span class="keyword">else</span> x-&gt;fa-&gt;ch[x-&gt;fa-&gt;ch[<span class="number">0</span>] != x] = y;</div><div class="line">        y-&gt;ch[d] = x;</div><div class="line">        x-&gt;fa = y;</div><div class="line">        y-&gt;s = x-&gt;s;</div><div class="line">        x-&gt;push_up();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">        Node *x = root, *y = null;</div><div class="line">        <span class="keyword">while</span> (x-&gt;s) &#123;</div><div class="line">            x-&gt;s++, y = x;    </div><div class="line">            <span class="keyword">int</span> d = x-&gt;cmp(v);</div><div class="line">            <span class="keyword">if</span> (<span class="number">-1</span> == d) &#123;</div><div class="line">                x-&gt;c++;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            x = x-&gt;ch[d];</div><div class="line">        &#125;</div><div class="line">        x = newNode(v);</div><div class="line">        <span class="keyword">if</span> (y-&gt;s) y-&gt;ch[v &gt; y-&gt;data] = x;</div><div class="line">        <span class="keyword">else</span> root = x;</div><div class="line">        x-&gt;fa = y;</div><div class="line">        insert_fix(x);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert_fix</span><span class="params">(Node* &amp;x)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (x-&gt;fa-&gt;color) &#123;</div><div class="line">            Node *par = x-&gt;fa, *Gp = par-&gt;fa;</div><div class="line">            <span class="keyword">bool</span> d = par == Gp-&gt;ch[<span class="number">0</span>];</div><div class="line">            Node *uncle = Gp-&gt;ch[d];</div><div class="line">            <span class="keyword">if</span> (uncle-&gt;color) &#123;</div><div class="line">                par-&gt;color = uncle-&gt;color = <span class="number">0</span>;</div><div class="line">                Gp-&gt;color = <span class="number">1</span>;</div><div class="line">                x = Gp;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == par-&gt;ch[d]) &#123;</div><div class="line">                rotate(x = par, !d);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Gp-&gt;color = <span class="number">1</span>;</div><div class="line">                par-&gt;color = <span class="number">0</span>;</div><div class="line">                rotate(Gp, d);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        root-&gt;color = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> Node *<span class="title">find</span><span class="params">(Node *x, <span class="keyword">int</span> data)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (x-&gt;s &amp;&amp; x-&gt;data != data) x = x-&gt;ch[x-&gt;data &lt; data];</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">del_fix</span><span class="params">(Node* &amp;x)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (x != root &amp;&amp; !x-&gt;color) &#123;</div><div class="line">            <span class="keyword">bool</span> d = x == x-&gt;fa-&gt;ch[<span class="number">0</span>];</div><div class="line">            Node *par = x-&gt;fa, *sibling = par-&gt;ch[d];</div><div class="line">            <span class="keyword">if</span> (sibling-&gt;color) &#123;</div><div class="line">                sibling-&gt;color = <span class="number">0</span>;</div><div class="line">                par-&gt;color = <span class="number">1</span>;</div><div class="line">                rotate(x-&gt;fa, !d);</div><div class="line">                sibling = par-&gt;ch[d];</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sibling-&gt;ch[<span class="number">0</span>]-&gt;color &amp;&amp; !sibling-&gt;ch[<span class="number">1</span>]-&gt;color) &#123;</div><div class="line">                sibling-&gt;color = <span class="number">1</span>, x = par;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (!sibling-&gt;ch[d]-&gt;color) &#123;</div><div class="line">                    sibling-&gt;ch[!d]-&gt;color = <span class="number">0</span>;</div><div class="line">                    sibling-&gt;color = <span class="number">1</span>;</div><div class="line">                    rotate(sibling, d);</div><div class="line">                    sibling = par-&gt;ch[d];</div><div class="line">                &#125;</div><div class="line">                sibling-&gt;color = par-&gt;color;</div><div class="line">                sibling-&gt;ch[d]-&gt;color = par-&gt;color = <span class="number">0</span>;</div><div class="line">                rotate(par, !d);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        x-&gt;color = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> data)</span> </span>&#123;</div><div class="line">        Node *z = find(root, data);</div><div class="line">        <span class="keyword">if</span> (!z-&gt;s) <span class="keyword">return</span>;</div><div class="line">        <span class="keyword">if</span> (z-&gt;c &gt; <span class="number">1</span>) &#123;        </div><div class="line">            z-&gt;c--;</div><div class="line">            z-&gt;push_down();</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        Node *y = z, *x = null;</div><div class="line">        <span class="keyword">if</span> (z-&gt;ch[<span class="number">0</span>]-&gt;s &amp;&amp; z-&gt;ch[<span class="number">1</span>]-&gt;s) &#123;</div><div class="line">            y = z-&gt;ch[<span class="number">1</span>];</div><div class="line">            <span class="keyword">while</span> (y-&gt;ch[<span class="number">0</span>]-&gt;s) y = y-&gt;ch[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">        x = y-&gt;ch[!y-&gt;ch[<span class="number">0</span>]-&gt;s];</div><div class="line">        x-&gt;fa = y-&gt;fa;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;fa-&gt;s) root = x;</div><div class="line">        <span class="keyword">else</span> y-&gt;fa-&gt;ch[y-&gt;fa-&gt;ch[<span class="number">1</span>] == y] = x;</div><div class="line">        <span class="keyword">if</span> (z != y) z-&gt;data = y-&gt;data, z-&gt;c = y-&gt;c;</div><div class="line">        y-&gt;fa-&gt;push_down();</div><div class="line">        <span class="keyword">for</span> (Node *k = y-&gt;fa; y-&gt;c &gt; <span class="number">1</span> &amp;&amp; k-&gt;s &amp;&amp; k != z; k = k-&gt;fa) k-&gt;s -= y-&gt;c - <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (!y-&gt;color) del_fix(x);</div><div class="line">        store[top++] = y;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">kth</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> t;</div><div class="line">        Node *x = root;</div><div class="line">        <span class="keyword">for</span> (; x-&gt;s;) &#123;</div><div class="line">            t = x-&gt;ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            <span class="keyword">if</span> (k &lt;= t) x = x-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (t + <span class="number">1</span> &lt;= k &amp;&amp; k &lt;= t + x-&gt;c) <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">else</span> k -= t + x-&gt;c, x = x-&gt;ch[<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, x-&gt;data);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rank</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> t, cur = <span class="number">0</span>;</div><div class="line">        Node *x = root;</div><div class="line">        <span class="keyword">for</span> (; x-&gt;s;) &#123;</div><div class="line">            t = x-&gt;ch[<span class="number">0</span>]-&gt;s;</div><div class="line">            <span class="keyword">if</span> (v == x-&gt;data) <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (v &lt; x-&gt;data) x = x-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">else</span> cur += t + x-&gt;c, x = x-&gt;ch[<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, cur + t + <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">succ</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        Node *x = root;</div><div class="line">        <span class="keyword">while</span> (x-&gt;s) &#123;</div><div class="line">            <span class="keyword">if</span> (x-&gt;data &gt; v) ret = x-&gt;data, x = x-&gt;ch[<span class="number">0</span>];</div><div class="line">            <span class="keyword">else</span> x = x-&gt;ch[<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pred</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</div><div class="line">        Node *x = root;</div><div class="line">        <span class="keyword">while</span> (x-&gt;s) &#123;</div><div class="line">            <span class="keyword">if</span> (x-&gt;data &lt; v) ret = x-&gt;data, x = x-&gt;ch[<span class="number">1</span>];</div><div class="line">            <span class="keyword">else</span> x = x-&gt;ch[<span class="number">0</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ret);</div><div class="line">    &#125;</div><div class="line">&#125;rbt;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    rbt.init();</div><div class="line">    <span class="keyword">int</span> n, op, v;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</div><div class="line">    <span class="keyword">while</span> (n--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;op, &amp;v);</div><div class="line">        <span class="keyword">if</span> (<span class="number">1</span> == op) rbt.insert(v);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">2</span> == op) rbt.del(v);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">3</span> == op) rbt.rank(v);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">4</span> == op) rbt.kth(v);</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">5</span> == op) rbt.pred(v);</div><div class="line">        <span class="keyword">else</span> rbt.succ(v);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="AVL树-二叉查找树"><a href="#AVL树-二叉查找树" class="headerlink" title="AVL树-二叉查找树"></a>AVL树-二叉查找树</h3><h4 id="基本介绍-4"><a href="#基本介绍-4" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>AVL在计算机科学中是最先发明的自平衡二叉查找树。AVL树得名于它的发明者 G.M. Adelson-Velsky 和 E.M. Landis，他们在 1962 年的论文《An algorithm for the organization of information》中发表了它。</p>
<h4 id="计算节点"><a href="#计算节点" class="headerlink" title="计算节点"></a>计算节点</h4><p>高度为 h 的 AVL 树，节点数 N 最多2^h − 1； 最少 （其中）。<br>最少节点数 n 如以斐波那契数列可以用数学归纳法证明：<br>Nh=F【h+ 2】 - 1 (F【h+ 2】是 Fibonacci polynomial 的第h+2个数）。<br>即：<br>N0 = 0 （表示 AVL Tree 高度为0的节点总数）<br>N1 = 1 （表示 AVL Tree 高度为1的节点总数）<br>N2 = 2 （表示 AVL Tree 高度为2的节点总数）<br>Nh=N【h− 1】 +N【h− 2】 + 1 （表示 AVL Tree 高度为h的节点总数）<br>换句话说，当节点数为 N 时，高度 h 最多为节点的平衡因子是它的右子树的高度减去它的左子树的高度。带有平衡因子 1、0 或 -1 的节点被认为是平衡的。带有平衡因子 -2 或 2 的节点被认为是不平衡的，并需要重新平衡这个树。平衡因子可以直接存储在每个节点中，或从可能存储在节点中的子树高度计算出来。</p>
<h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><p>AVL树的基本操作一般涉及运做同在不平衡的二叉查找树所运做的同样的算法。但是要进行预先或随后做一次或多次所谓的”AVL 旋转”。<br>假设由于在二叉排序树上插入结点而失去平衡的最小子树根结点的指针为a（即a是离插入点最近，且平衡因子绝对值超过1的祖先结点），则失去平衡后进行进行的规律可归纳为下列四种情况：<br>单向右旋平衡处理RR：由于在<em>a的左子树根结点的左子树上插入结点，</em>a的平衡因子由1增至2，致使以<em>a为根的子树失去平衡，则需进行一次右旋转操作；<br>单向左旋平衡处理LL：由于在</em>a的右子树根结点的右子树上插入结点，<em>a的平衡因子由-1变为-2，致使以</em>a为根的子树失去平衡，则需进行一次左旋转操作；<br>双向旋转（先左后右）平衡处理LR：由于在<em>a的左子树根结点的右子树上插入结点，</em>a的平衡因子由1增至2，致使以<em>a为根的子树失去平衡，则需进行两次旋转（先左旋后右旋）操作。<br>双向旋转（先右后左）平衡处理RL：由于在</em>a的右子树根结点的左子树上插入结点，<em>a的平衡因子由-1变为-2，致使以</em>a为根的子树失去平衡，则需进行两次旋转（先右旋后左旋）操作。<br>其他操作与其他平衡树类似。<br>此数据结构插入、查找和删除的时间复杂度均为O(logN)，但是插入和删除需要额外的旋转算法需要的时间，有时旋转过多也会影响效率。</p>
<h4 id="完整模板"><a href="#完整模板" class="headerlink" title="完整模板"></a>完整模板</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/***********</span></div><div class="line"><span class="comment">*AvlTree.h*</span></div><div class="line"><span class="comment">***********/</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvlTree</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    AvlTree() &#123;</div><div class="line">        root = <span class="literal">NULL</span>;</div><div class="line">    &#125; <span class="comment">// Constructor</span></div><div class="line"></div><div class="line">    AvlTree(<span class="keyword">const</span> AvlTree &amp; rhs) &#123;</div><div class="line">        root = <span class="literal">NULL</span>;</div><div class="line">        *<span class="keyword">this</span> = rhs;</div><div class="line">    &#125; <span class="comment">// Copy Constructor</span></div><div class="line"></div><div class="line">    <span class="keyword">const</span> AvlTree &amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> AvlTree &amp; rhs) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;rhs) &#123;</div><div class="line">            makeEmpty();</div><div class="line">            root = clone(rhs.root);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    &#125; <span class="comment">// Overload "operator="</span></div><div class="line"></div><div class="line">    ~AvlTree() &#123;</div><div class="line">        makeEmpty();</div><div class="line">    &#125; <span class="comment">// Destructor</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">const</span> Comparable &amp; <span class="title">findMin</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> findMin(root);</div><div class="line">    &#125; <span class="comment">// Find Minimum Element</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">const</span> Comparable &amp; <span class="title">findMax</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> findMax(root);</div><div class="line">    &#125; <span class="comment">// Find Maximum Element</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">contains</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> contains(x, root);</div><div class="line">    &#125; <span class="comment">// Test if an item is in the tree.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isEmpty</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> root == <span class="literal">NULL</span>;</div><div class="line">    &#125; <span class="comment">// Test if the tree is empty.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line">        makeEmpty(root);</div><div class="line">    &#125; <span class="comment">// Make the tree empty.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x)</span> </span>&#123;</div><div class="line">        insert(x, root);</div><div class="line">    &#125; <span class="comment">// Insert an item into the tree.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x)</span> </span>&#123;</div><div class="line">        remove(x, root);</div><div class="line">    &#125; <span class="comment">// Remove an item from the tree.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printTree</span><span class="params">(<span class="built_in">std</span>::ostream &amp; out = <span class="built_in">std</span>::<span class="built_in">cout</span>)</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isEmpty())</div><div class="line">            out &lt;&lt; <span class="string">"Empty Tree"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            printTree(root, out);</div><div class="line">    &#125; <span class="comment">// Print the tree in sorted order.</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">treeHeight</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> treeHeight(root);</div><div class="line">    &#125; <span class="comment">// Compute the height of the tree.</span></div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">AvlNode</span> &#123;</span></div><div class="line">        Comparable element;</div><div class="line">        AvlNode *left;</div><div class="line">        AvlNode *right;</div><div class="line">        <span class="keyword">int</span> height;</div><div class="line"></div><div class="line">        AvlNode(<span class="keyword">const</span> Comparable &amp; theElement, AvlNode *lt, AvlNode *rt, <span class="keyword">int</span> h = <span class="number">0</span>) : element(theElement), left(lt), right(rt), height(h) &#123;&#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    AvlNode *root;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x, AvlNode * &amp; t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x, AvlNode * &amp; t)</span></span>;</div><div class="line">    <span class="function">AvlNode * <span class="title">findMin</span><span class="params">(AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function">AvlNode * <span class="title">findMax</span><span class="params">(AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">contains</span><span class="params">(<span class="keyword">const</span> Comparable &amp; x, AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeEmpty</span><span class="params">(AvlNode * &amp; t)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printTree</span><span class="params">(AvlNode *t, <span class="built_in">std</span>::ostream &amp; out)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">treeHeight</span><span class="params">(AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function">AvlNode * <span class="title">clone</span><span class="params">(AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">height</span><span class="params">(AvlNode *t)</span> <span class="keyword">const</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotateWithLeftChild</span><span class="params">(AvlNode * &amp; k2)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotateWithRightChild</span><span class="params">(AvlNode * &amp; k2)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doubleWithLeftChild</span><span class="params">(AvlNode * &amp; k3)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doubleWithRightChild</span><span class="params">(AvlNode * &amp; k3)</span></span>;</div><div class="line">&#125;</div><div class="line">;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*************</span></div><div class="line"><span class="comment">*AvlTree.cpp*</span></div><div class="line"><span class="comment">*************/</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"AvlTree.h"</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">typename</span> AvlTree&lt;Comparable&gt;::AvlNode * AvlTree&lt;Comparable&gt;::findMin(</div><div class="line">        AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span> (t-&gt;left == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    <span class="keyword">return</span> findMin(t-&gt;left);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">typename</span> AvlTree&lt;Comparable&gt;::AvlNode * AvlTree&lt;Comparable&gt;::findMax(</div><div class="line">        AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">if</span> (t-&gt;right == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> t;</div><div class="line">    <span class="keyword">return</span> findMax(t-&gt;left);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to test if an item is in a subtree.</span></div><div class="line"><span class="comment">* x is item to search for.</span></div><div class="line"><span class="comment">* t is the node that roots the subtree.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">bool</span> AvlTree&lt;Comparable&gt;::contains(<span class="keyword">const</span> Comparable &amp; x, AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t-&gt;element &gt; x)</div><div class="line">        <span class="keyword">return</span> contains(x, t-&gt;left);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; t-&gt;element)</div><div class="line">        <span class="keyword">return</span> contains(x, t-&gt;right);</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Match</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to insert into a subtree.</span></div><div class="line"><span class="comment">* x is the item to insert.</span></div><div class="line"><span class="comment">* t is the node that roots the subtree.</span></div><div class="line"><span class="comment">* Set the new root of the subtree.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::insert(<span class="keyword">const</span> Comparable &amp; x, AvlNode * &amp; t) &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        t = <span class="keyword">new</span> AvlNode(x, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t-&gt;element &gt; x) &#123;</div><div class="line">        insert(x, t-&gt;left);</div><div class="line">        <span class="keyword">if</span> (height(t-&gt;left) - height(t-&gt;right) == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (t-&gt;left-&gt;element &gt; x)</div><div class="line">                rotateWithLeftChild(t);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                doubleWithLeftChild(t);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; t-&gt;element) &#123;</div><div class="line">        insert(x, t-&gt;right);</div><div class="line">        <span class="keyword">if</span> (height(t-&gt;right) - height(t-&gt;left) == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (x &gt; t-&gt;right-&gt;element)</div><div class="line">                rotateWithRightChild(t);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                doubleWithRightChild(t);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">        ; <span class="comment">// Duplicate; do nothing</span></div><div class="line">    t-&gt;height = <span class="built_in">std</span>::max(height(t-&gt;left), height(t-&gt;right)) + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to remove from a subtree.</span></div><div class="line"><span class="comment">* x is the item to remove.</span></div><div class="line"><span class="comment">* t is the node that roots the subtree.</span></div><div class="line"><span class="comment">* Set the new root of the subtree.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::remove(<span class="keyword">const</span> Comparable &amp; x, AvlNode * &amp; t) &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="comment">// Item not found; do nothing</span></div><div class="line">    <span class="keyword">if</span> (t-&gt;element &gt; x) &#123;</div><div class="line">        remove(x, t-&gt;left);</div><div class="line">        <span class="keyword">if</span> (height(t-&gt;right) - height(t-&gt;left) == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (height(t-&gt;right-&gt;right) &gt;= height(t-&gt;right-&gt;left))</div><div class="line">                rotateWithRightChild(t);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                doubleWithRightChild(t);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x &gt; t-&gt;element) &#123;</div><div class="line">        remove(x, t-&gt;right);</div><div class="line">        <span class="keyword">if</span> (height(t-&gt;left) - height(t-&gt;right) == <span class="number">2</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (height(t-&gt;left-&gt;left) &gt;= height(t-&gt;left-&gt;right))</div><div class="line">                rotateWithLeftChild(t);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                doubleWithLeftChild(t);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t-&gt;left != <span class="literal">NULL</span> &amp;&amp; t-&gt;right != <span class="literal">NULL</span>) &#123;</div><div class="line">        t-&gt;element = findMin(t-&gt;right)-&gt;element;</div><div class="line">        remove(t-&gt;element, t-&gt;right);</div><div class="line">        t-&gt;height = <span class="built_in">std</span>::max(height(t-&gt;left), height(t-&gt;right)) + <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        AvlNode *oldNode = t;</div><div class="line">        t = (t-&gt;left != <span class="literal">NULL</span>) ? t-&gt;left : t-&gt;right;</div><div class="line">        <span class="keyword">delete</span> oldNode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (t != <span class="literal">NULL</span>)</div><div class="line">        t-&gt;height = <span class="built_in">std</span>::max(height(t-&gt;left), height(t-&gt;right)) + <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to make subtree empty.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::makeEmpty(AvlNode * &amp; t) &#123;</div><div class="line">    <span class="keyword">if</span> (t != <span class="literal">NULL</span>) &#123;</div><div class="line">        makeEmpty(t-&gt;left);</div><div class="line">        makeEmpty(t-&gt;right);</div><div class="line">        <span class="keyword">delete</span> t;</div><div class="line">    &#125;</div><div class="line">    t = <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to clone subtree.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">typename</span> AvlTree&lt;Comparable&gt;::AvlNode * AvlTree&lt;Comparable&gt;::clone(</div><div class="line">        AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> AvlNode(t-&gt;element, clone(t-&gt;left), clone(t-&gt;right));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to print a subtree rooted at t in sorted order.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::printTree(AvlNode *t, <span class="built_in">std</span>::ostream &amp; out) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t != <span class="literal">NULL</span>) &#123;</div><div class="line">        printTree(t-&gt;left, out);</div><div class="line">        out &lt;&lt; t-&gt;element &lt;&lt; <span class="string">' '</span>;</div><div class="line">        printTree(t-&gt;right, out);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Return the height of node t or -1 if NULL.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">int</span> AvlTree&lt;Comparable&gt;::height(AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">return</span> t == <span class="literal">NULL</span> ? <span class="number">-1</span> : t-&gt;height;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Rotate binary tree node with left child.</span></div><div class="line"><span class="comment">* For AVL trees, this is a single rotation for case 1.</span></div><div class="line"><span class="comment">* Update heights, then set new root.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::rotateWithLeftChild(AvlNode * &amp; k2) &#123;</div><div class="line">    AvlNode *k1 = k2-&gt;left;</div><div class="line">    k2-&gt;left = k1-&gt;right;</div><div class="line">    k1-&gt;right = k2;</div><div class="line">    k2-&gt;height = <span class="built_in">std</span>::max(height(k2-&gt;left), height(k2-&gt;right)) + <span class="number">1</span>;</div><div class="line">    k1-&gt;height = <span class="built_in">std</span>::max(height(k1-&gt;left), k2-&gt;height) + <span class="number">1</span>;</div><div class="line">    k2 = k1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Rotate binary tree node with right child.</span></div><div class="line"><span class="comment">* For AVL trees, this is a single rotation for case 1.</span></div><div class="line"><span class="comment">* Update heights, then set new root.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::rotateWithRightChild(AvlNode * &amp; k2) &#123;</div><div class="line">    AvlNode *k1 = k2-&gt;right;</div><div class="line">    k2-&gt;right = k1-&gt;left;</div><div class="line">    k1-&gt;left = k2;</div><div class="line">    k2-&gt;height = <span class="built_in">std</span>::max(height(k2-&gt;right), height(k2-&gt;left)) + <span class="number">1</span>;</div><div class="line">    k1-&gt;height = <span class="built_in">std</span>::max(height(k1-&gt;right), k2-&gt;height) + <span class="number">1</span>;</div><div class="line">    k2 = k1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Double rotate binary tree node: first left child</span></div><div class="line"><span class="comment">* with its right child; then node k3 with new left child.</span></div><div class="line"><span class="comment">* For AVL trees, this is a double rotation for case 2.</span></div><div class="line"><span class="comment">* Update heights, then set new root.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::doubleWithLeftChild(AvlNode * &amp; k3) &#123;</div><div class="line">    rotateWithRightChild(k3-&gt;left);</div><div class="line">    rotateWithLeftChild(k3);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Double rotate binary tree node: first right child</span></div><div class="line"><span class="comment">* with its left child; then node k3 with new right child.</span></div><div class="line"><span class="comment">* For AVL trees, this is a double rotation for case 2.</span></div><div class="line"><span class="comment">* Update heights, then set new root.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">void</span> AvlTree&lt;Comparable&gt;::doubleWithRightChild(AvlNode * &amp; k3) &#123;</div><div class="line">    rotateWithLeftChild(k3-&gt;right);</div><div class="line">    rotateWithRightChild(k3);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Internal method to compute the height of a subtree rooted at t.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Comparable&gt;</div><div class="line"><span class="keyword">int</span> AvlTree&lt;Comparable&gt;::treeHeight(AvlNode *t) <span class="keyword">const</span> &#123;</div><div class="line">    <span class="keyword">if</span> (t == <span class="literal">NULL</span>)</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="number">1</span> + <span class="built_in">std</span>::max(treeHeight(t-&gt;left), treeHeight(t-&gt;right));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*********</span></div><div class="line"><span class="comment">*main.cpp*</span></div><div class="line"><span class="comment">**********/</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"AvlTree.cpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    AvlTree&lt;<span class="keyword">int</span>&gt; t1;</div><div class="line">    srand(time(<span class="literal">NULL</span>));</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">127</span>; i++) &#123;</div><div class="line">        t1.insert(rand());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1's height="</span> &lt;&lt; t1.treeHeight() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1 is &#123; "</span>;</div><div class="line">    t1.printTree();</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"&#125;"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    AvlTree&lt;<span class="keyword">int</span>&gt; t2(t1);</div><div class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (n &lt; <span class="number">96</span>) &#123;</div><div class="line">        <span class="keyword">int</span> j = rand();</div><div class="line">        <span class="keyword">if</span> (t2.contains(j)) &#123;</div><div class="line">            t2.remove(j);</div><div class="line">            n++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    t1 = t2;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1's height="</span> &lt;&lt; t1.treeHeight() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"t1 is &#123; "</span>;</div><div class="line">    t1.printTree();</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"&#125;"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="替罪羊树"><a href="#替罪羊树" class="headerlink" title="替罪羊树"></a>替罪羊树</h3><h4 id="基本介绍-5"><a href="#基本介绍-5" class="headerlink" title="基本介绍"></a>基本介绍</h4><p>替罪羊树是计算机科学中，一种基于部分重建的自平衡二叉搜索树。在替罪羊树上，插入或删除节点的平摊最坏时间复杂度是O(log n)，搜索节点的最坏时间复杂度是O(log n)。<br>在非平衡的二叉搜索树中，每次操作以后检查操作路径，找到最高的满足max(size(son_L),size(son_R))&gt;alpha*size(this)的结点，重建整个子树。这样就得到了替罪羊树，而被重建的子树的原来的根就被称为替罪羊节点。<br>对于一棵二叉搜索树，最重要的事情就是维护他的平衡，以保证对于每次操作（插入，查找，删除）的时间均摊下来都是乃至（红黑树，但是常数大而且难写，此处不展开介绍）。<br>为了维护树的平衡，各种平衡二叉树绞尽脑汁方法五花八门，但几乎都是通过旋转的操作来实现，只不过是在判断什么时候应该旋转上有所不同。但替罪羊树就是那么一棵特立独行的猪，哦不，是一只特立独行的树。</p>
<h4 id="操作-1"><a href="#操作-1" class="headerlink" title="操作"></a>操作</h4><h5 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h5><p>重构允许重构整棵替罪羊树，也允许重构替罪羊树其中的一棵子树。<br>重构这个操作看似高端，实则十分暴力。主要操作就是把需要重构的子树拍平（由于子树一定是二叉搜索树，所以拍平之后的序列一定也是有序的），然后拎起序列的中点，作为根部，剩下的左半边序列为左子树，右半边序列为右子树，接着递归对左边和右边进行同样的操作，直到最后形成的树中包含的全部为点而不是序列（这样形成的一定是一棵完全二叉搜索树，也是最优的方案）。<br><img src="https://pic3.zhimg.com/6b2b81f8c144dd3f0915fd9391f5f56e_b.png" alt="这里写图片描述"><br>这是一棵需要维护的子树，虽然目前不知道基于什么判断条件，但这棵是明显需要维护的。<br><img src="https://pic2.zhimg.com/5c762c4398628a34ef568710573ec681_b.png" alt="这里写图片描述"><br>拍平之后的结果，直接遍历即可。<br><img src="https://pic2.zhimg.com/d83932f83e6465dd90bb897ec2594e15_b.png" alt="这里写图片描述"><br>子树的重构就完成了。</p>
<h5 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h5><p>插入操作一开始和普通的二叉搜索树无异，但在插入操作结束以后，从插入位置开始一层一层往上回溯的时候，对于每一层都进行一次判断，一直找到最后一层不满足该条件的层序号<img src="https://zhihu.com/equation?tex=h%28v%29%20%3E%20log%281/%5Calpha%20%29%28size%28tree%29%29" alt="这里写图片描述">（也就是从根开始的第一层不满足该条件的层序号），然后从该层开始重构以该层为根的子树（一个节点导致树的不平衡，就要导致整棵子树被拍扁，估计这也是“替罪羊”这个名字的由来吧）。<br>每次插入操作的复杂度为<img src="https://zhihu.com/equation?tex=O%28log_%7Bn%7D%29" alt="这里写图片描述">，每次重构树的复杂度为<img src="https://zhihu.com/equation?tex=O%28n%29" alt="这里写图片描述">，但由于不会每次都要进行重构，也不会每次都重构一整棵树，所以均摊下来的复杂度还是<img src="https://zhihu.com/equation?tex=O%28log_%7Bn%7D%29" alt="这里写图片描述">。<br>α在这里是一个常数，可以通过调整的大小来控制树的平衡度，使程序具有很好的可控性。<br>（0.5,1）区间内α的取值对于程序性能并没有很大的影响，所以一般区0.7±0.05左右。</p>
<h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p>删除操作是替罪羊树中最独特的地方，替罪羊树的删除节点并不是真正的删除，而是惰性删除（即给节点增加一个已经删除的标记，删除后的节点与普通节点无异，只是不参与查找操作而已）。当删除的数量超过树的节点数的一半时，直接重构！可以证明均摊下来的复杂度还是<img src="https://zhihu.com/equation?tex=O%28log_%7Bn%7D%29" alt="这里写图片描述">。</p>
<h5 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h5><p>其他操作大致相同，只需要注意一下是否标记。</p>
<h4 id="代码模板"><a href="#代码模板" class="headerlink" title="代码模板"></a>代码模板</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> Scapegoat_Tree &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN (100000 + 10)</span></div><div class="line">	<span class="keyword">const</span> <span class="keyword">double</span> alpha = <span class="number">0.75</span>;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">	Node * ch[<span class="number">2</span>];</div><div class="line">	<span class="keyword">int</span> key, size, cover; <span class="comment">// size为有效节点的数量，cover为节点总数量 </span></div><div class="line">	<span class="keyword">bool</span> exist;	<span class="comment">// 是否存在（即是否被删除） </span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">PushUp</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">		size = ch[<span class="number">0</span>]-&gt;size + ch[<span class="number">1</span>]-&gt;size + (<span class="keyword">int</span>)exist;</div><div class="line">		cover = ch[<span class="number">0</span>]-&gt;cover + ch[<span class="number">1</span>]-&gt;cover + <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isBad</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; <span class="comment">// 判断是否需要重构 </span></div><div class="line">		<span class="keyword">return</span> ((ch[<span class="number">0</span>]-&gt;cover &gt; cover * alpha + <span class="number">5</span>) || </div><div class="line">				(ch[<span class="number">1</span>]-&gt;cover &gt; cover * alpha + <span class="number">5</span>));</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">STree</span> &#123;</span></div><div class="line">	<span class="keyword">protected</span>:</div><div class="line">		Node mem_poor[MAXN]; <span class="comment">//内存池，直接分配好避免动态分配内存占用时间 </span></div><div class="line">		Node *tail, *root, *null; <span class="comment">// 用null表示NULL的指针更方便，tail为内存分配指针，root为根 </span></div><div class="line">		Node *bc[MAXN]; <span class="keyword">int</span> bc_top; <span class="comment">// 储存被删除的节点的内存地址，分配时可以再利用这些地址 </span></div><div class="line"></div><div class="line">		<span class="function">Node * <span class="title">NewNode</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</div><div class="line">			Node * p = bc_top ? bc[--bc_top] : tail++;</div><div class="line">			p-&gt;ch[<span class="number">0</span>] = p-&gt;ch[<span class="number">1</span>] = null;</div><div class="line">			p-&gt;size = p-&gt;cover = <span class="number">1</span>; p-&gt;exist = <span class="literal">true</span>;</div><div class="line">			p-&gt;key = key;</div><div class="line">			<span class="keyword">return</span> p;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Travel</span><span class="params">(Node * p, <span class="built_in">vector</span>&lt;Node *&gt;&amp;v)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span> (p == null) <span class="keyword">return</span>;</div><div class="line">			Travel(p-&gt;ch[<span class="number">0</span>], v);</div><div class="line">			<span class="keyword">if</span> (p-&gt;exist) v.push_back(p); <span class="comment">// 构建序列 </span></div><div class="line">			<span class="keyword">else</span> bc[bc_top++] = p; <span class="comment">// 回收 </span></div><div class="line">			Travel(p-&gt;ch[<span class="number">1</span>], v);</div><div class="line">		&#125;</div><div class="line">		<span class="function">Node * <span class="title">Divide</span><span class="params">(<span class="built_in">vector</span>&lt;Node *&gt;&amp;v, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> null;</div><div class="line">			<span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line">			Node * p = v[mid];</div><div class="line">			p-&gt;ch[<span class="number">0</span>] = Divide(v, l, mid);</div><div class="line">			p-&gt;ch[<span class="number">1</span>] = Divide(v, mid + <span class="number">1</span>, r);</div><div class="line">			p-&gt;PushUp(); <span class="comment">// 自底向上维护，先维护子树 </span></div><div class="line">			<span class="keyword">return</span> p;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Rebuild</span><span class="params">(Node * &amp;p)</span> </span>&#123;</div><div class="line">			<span class="keyword">static</span> <span class="built_in">vector</span>&lt;Node *&gt;v; v.clear();</div><div class="line">			Travel(p, v); p = Divide(v, <span class="number">0</span>, v.size());</div><div class="line">		&#125;</div><div class="line">		<span class="function">Node ** <span class="title">Insert</span><span class="params">(Node *&amp;p, <span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">			<span class="keyword">if</span> (p == null) &#123;</div><div class="line">				p = NewNode(val);</div><div class="line">				<span class="keyword">return</span> &amp;null;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				p-&gt;size++; p-&gt;cover++;</div><div class="line">				</div><div class="line">				<span class="comment">// 返回值储存需要重构的位置，若子树也需要重构，本节点开始也需要重构，以本节点为根重构 </span></div><div class="line">				Node ** res = Insert(p-&gt;ch[val &gt;= p-&gt;key], val);</div><div class="line">				<span class="keyword">if</span> (p-&gt;isBad()) res = &amp;p;</div><div class="line">				<span class="keyword">return</span> res;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Erase</span><span class="params">(Node *p, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">			p-&gt;size--;</div><div class="line">			<span class="keyword">int</span> offset = p-&gt;ch[<span class="number">0</span>]-&gt;size + p-&gt;exist;</div><div class="line">			<span class="keyword">if</span> (p-&gt;exist &amp;&amp; id == offset) &#123;</div><div class="line">				p-&gt;exist = <span class="literal">false</span>;</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">if</span> (id &lt;= offset) Erase(p-&gt;ch[<span class="number">0</span>], id);</div><div class="line">				<span class="keyword">else</span> Erase(p-&gt;ch[<span class="number">1</span>], id - offset);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">public</span>:</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">			tail = mem_poor;</div><div class="line">			null = tail++;</div><div class="line">			null-&gt;ch[<span class="number">0</span>] = null-&gt;ch[<span class="number">1</span>] = null;</div><div class="line">			null-&gt;cover = null-&gt;size = null-&gt;key = <span class="number">0</span>;</div><div class="line">			root = null; bc_top = <span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		STree(<span class="keyword">void</span>) &#123; Init(); &#125;</div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">			Node ** p = Insert(root, val);</div><div class="line">			<span class="keyword">if</span> (*p != null) Rebuild(*p);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">int</span> <span class="title">Rank</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">			Node * now = root;</div><div class="line">			<span class="keyword">int</span> ans = <span class="number">1</span>;</div><div class="line">			<span class="keyword">while</span> (now != null) &#123; <span class="comment">// 非递归求排名 </span></div><div class="line">				<span class="keyword">if</span> (now-&gt;key &gt;= val) now = now-&gt;ch[<span class="number">0</span>];</div><div class="line">				<span class="keyword">else</span> &#123;</div><div class="line">					ans += now-&gt;ch[<span class="number">0</span>]-&gt;size + now-&gt;exist;</div><div class="line">					now = now-&gt;ch[<span class="number">1</span>];</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> ans;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">int</span> <span class="title">Kth</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">			Node * now = root;</div><div class="line">			<span class="keyword">while</span> (now != null) &#123; <span class="comment">// 非递归求第K大 </span></div><div class="line">				<span class="keyword">if</span> (now-&gt;ch[<span class="number">0</span>]-&gt;size + <span class="number">1</span> == k &amp;&amp; now-&gt;exist) <span class="keyword">return</span> now-&gt;key;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (now-&gt;ch[<span class="number">0</span>]-&gt;size &gt;= k) now = now-&gt;ch[<span class="number">0</span>];</div><div class="line">				<span class="keyword">else</span> k -= now-&gt;ch[<span class="number">0</span>]-&gt;size + now-&gt;exist, now = now-&gt;ch[<span class="number">1</span>];</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Erase</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">			Erase(root, Rank(k));</div><div class="line">			<span class="keyword">if</span> (root-&gt;size &lt; alpha * root-&gt;cover) Rebuild(root);</div><div class="line">		&#125;</div><div class="line">		<span class="function"><span class="keyword">void</span> <span class="title">Erase_kth</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">			Erase(root, k);</div><div class="line">			<span class="keyword">if</span> (root-&gt;size &lt; alpha * root-&gt;cover) Rebuild(root);</div><div class="line">		&#125;</div><div class="line">	&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> MAXN</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="基本介绍总结"><a href="#基本介绍总结" class="headerlink" title="基本介绍总结"></a>基本介绍总结</h3><p>到这里，6种常见平衡树的基本介绍就完毕了。</p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/BST-DATA——S/">BST DATA——S</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/03/16/ACN-v-first/">
      ACN_v_first
    </a>
  </h2>
  
  <time>
    Mar 16, 2017
  </time>
  <section class="content">
	  <h2 id="CDQZ-高新2016级ACM模拟赛第一套"><a href="#CDQZ-高新2016级ACM模拟赛第一套" class="headerlink" title="CDQZ 高新2016级ACM模拟赛第一套"></a>CDQZ 高新2016级ACM模拟赛第一套</h2><h1 id="result"><a href="#result" class="headerlink" title="result"></a>result</h1><p><img src="http://img.blog.csdn.net/20170212204425343?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>结果如上，因为人数问题，我们队只有两人但规则上允许每人都拥有一台电脑。<br>这次比赛还是蛮有意思的，在过程中能看见其他人的进度对自己也是一种鼓励（特别是看了自己A了四块深绿）。<br>深绿胜者可获得笔记本。。。。（没有电脑）一个。</p>
<p>一共九道题，难度（对于自己来说）F&gt;J&gt;I&gt;C&gt;G&gt;B&gt;A&gt;D&gt;E&gt;H。<br>于是乎我还是按照字典序发题解吧。</p>
<h1 id="A"><a href="#A" class="headerlink" title="A"></a>A</h1><p><img src="http://img.blog.csdn.net/20170212210813362?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5900" target="_blank" rel="external">A - QSC and Master HDU - 5900</a></p>
<p>dp题，用dp[[i][j]表示从i到j之间的最优解，转移方程可以这样写<br>当i&gt;=j的时，dp[i][j]=0;<br>当i+1==j且key[i]和key[j]互质时，dp[i][j]=0;<br>当i+1==j且key[i]和key[j]不互质时，dp[i][j]=val[i]+val[j]<br>其他情况为，枚举k从i到j-1, dp[i][j]=max(dp[i][k]+dp[k+1][j]).<br>上面还遗漏了一种情况，就是i+1到j-1之间都可以取，且i和j不互质，这种情况i到j所有的数都可以取。<br>以上就是所有情况，接下来写代码就可以了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">302</span>;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> key[maxn],val[maxn],sum[maxn],dp[maxn][maxn];<span class="comment">//sum为前缀和</span></div><div class="line"><span class="keyword">bool</span> ok[maxn][maxn];</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>) &#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span> ((ch=getchar())&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>);</div><div class="line">	res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span> ((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)</div><div class="line">	res=ch<span class="number">-48</span>+res*<span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">gcd</span><span class="params">(<span class="keyword">long</span> <span class="keyword">long</span> a,<span class="keyword">long</span> <span class="keyword">long</span> b)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> b==<span class="number">0</span>?a:gcd(b,a%b);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n,cas;</div><div class="line">	readin(cas);</div><div class="line">	<span class="keyword">while</span> (cas--) &#123;</div><div class="line">		readin(n);</div><div class="line">		sum[<span class="number">0</span>]=<span class="number">0</span>;</div><div class="line">		<span class="built_in">memset</span>(ok,<span class="literal">false</span>,<span class="keyword">sizeof</span>(ok));</div><div class="line">		<span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="keyword">sizeof</span>(dp));</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) </div><div class="line">			readin(key[i]);</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</div><div class="line">			readin(val[i]);</div><div class="line">			sum[i]=sum[i<span class="number">-1</span>]+val[i];</div><div class="line">		&#125;		</div><div class="line"><span class="comment">/*		for (int i=1;i&lt;=n;i++)</span></div><div class="line"><span class="comment">		for (int j=1;j&lt;=n;j++) &#123;</span></div><div class="line"><span class="comment">			if (j&lt;=i) ok[i][j]=false;</span></div><div class="line"><span class="comment">			else if (gcd(key[i],key[j])==1) ok[i][j]=false;</span></div><div class="line"><span class="comment">			else ok[i][j]=true;</span></div><div class="line"><span class="comment">		&#125;*/</span></div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;=n;j++) &#123;</div><div class="line">			<span class="keyword">if</span> (gcd(key[i],key[j])!=<span class="number">1</span>) ok[i][j]=<span class="literal">true</span>;</div><div class="line">		&#125;					</div><div class="line">  		<span class="keyword">for</span> (<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++) </div><div class="line">		<span class="keyword">if</span> (ok[i][i+<span class="number">1</span>])	dp[i][i+<span class="number">1</span>]=val[i]+val[i+<span class="number">1</span>]; </div><div class="line"><span class="comment">/*		for(int i=1;i&lt;=n;i++)  </span></div><div class="line"><span class="comment">        &#123;  </span></div><div class="line"><span class="comment">            for(int j=1;j&lt;=n;j++)  </span></div><div class="line"><span class="comment">            &#123;  </span></div><div class="line"><span class="comment">                if(j==i+1&amp;&amp;ok[i][j]) dp[i][j]=val[i]+val[j];  </span></div><div class="line"><span class="comment">                else dp[i][j]=0;  </span></div><div class="line"><span class="comment">            &#125;  </span></div><div class="line"><span class="comment">        &#125;*/</span></div><div class="line"><span class="comment">/*		for (register int i=1;i&lt;n;i++)</span></div><div class="line"><span class="comment">		for (register int j=i+1;j&lt;=n;j++)</span></div><div class="line"><span class="comment">		for (register int k=i;k&lt;=j;k++) &#123;*/</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> l=<span class="number">1</span>;l&lt;=n;l++)  </div><div class="line">        &#123;  </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i+l&lt;=n;i++)  </div><div class="line">            &#123;  </div><div class="line">                <span class="keyword">int</span> j=i+l;  </div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=i;k&lt;=j;k++)  </div><div class="line">                &#123;  </div><div class="line">			<span class="keyword">if</span> (ok[i][k]&amp;&amp;dp[i+<span class="number">1</span>][k<span class="number">-1</span>]==sum[k<span class="number">-1</span>]-sum[i])</div><div class="line">				dp[i][j]=max(dp[i][j],dp[i+<span class="number">1</span>][k<span class="number">-1</span>]+val[i]+dp[k+<span class="number">1</span>][j]+val[k]);</div><div class="line">			<span class="comment">//</span></div><div class="line">			<span class="keyword">if</span> (ok[k][j]&amp;&amp;dp[k+<span class="number">1</span>][j<span class="number">-1</span>]==sum[j]-sum[k+<span class="number">1</span>])</div><div class="line">				dp[i][j]=max(dp[i][j],dp[i][k<span class="number">-1</span>]+val[k]+dp[k+<span class="number">1</span>][j<span class="number">-1</span>]+val[j]);</div><div class="line">			<span class="comment">//</span></div><div class="line">			dp[i][j]=max(dp[i][j],dp[i+<span class="number">1</span>][j<span class="number">-1</span>]);</div><div class="line">			dp[i][j]=max(dp[i][j],dp[i+<span class="number">1</span>][j]);</div><div class="line">			dp[i][j]=max(dp[i][j],dp[i][j<span class="number">-1</span>]);</div><div class="line"><span class="comment">//		&#125;</span></div><div class="line">		&#125;&#125;&#125;</div><div class="line">		<span class="built_in">cout</span>&lt;&lt;dp[<span class="number">1</span>][n]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="B"><a href="#B" class="headerlink" title="B"></a>B</h1><p><img src="http://img.blog.csdn.net/20170212210843830?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://codeforces.com/problemset/problem/734/E" target="_blank" rel="external">B - Anton and Tree CodeForces - 734E</a><br>这题考察了树的直径的作用。题意中的paint(v)就是把所有的与v同色的并从这个点到v不经过其他颜色的点都涂成一种颜色，包括v;<br>这样缩点是必然的，用dfs缩点后重构树（可证：重构图必然是树）<br>然后因为paint（v）对所有点有效，我们很容易看出树的直径/2就是答案。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">#include&lt;iostream&gt;</div><div class="line">#include&lt;cstdio&gt;</div><div class="line">#include&lt;cstring&gt;</div><div class="line">#include&lt;string&gt;</div><div class="line">#include&lt;set&gt;</div><div class="line">#include&lt;queue&gt;</div><div class="line">#include&lt;algorithm&gt;</div><div class="line">#include&lt;vector&gt;</div><div class="line">#include&lt;cstdlib&gt;</div><div class="line">#include&lt;cmath&gt;</div><div class="line">#include&lt;ctime&gt;</div><div class="line">#include&lt;stack&gt;</div><div class="line">#define rez(i,x,y) for(int i=x;i&gt;=y;i--)</div><div class="line">#define res(i,x,y) for(int i=x;i&lt;=y;i++)</div><div class="line">#define INF 2100000000</div><div class="line">#define LL long long</div><div class="line">#define clr(x)  memset(x,0,sizeof(x))</div><div class="line">using namespace std;</div><div class="line">template&lt;class T&gt;inline void readin(T &amp;res)&#123;</div><div class="line">	static char ch;</div><div class="line">	while((ch=getchar())&gt;&apos;9&apos;||ch&lt;&apos;0&apos;);</div><div class="line">	res=ch-48;</div><div class="line">	while((ch=getchar())&lt;=&apos;9&apos;&amp;&amp;ch&gt;=&apos;0&apos;)</div><div class="line">	res=ch-48+res*10;</div><div class="line">&#125;</div><div class="line">const int maxn = 1e5+7;  </div><div class="line">int c[maxn&lt;&lt;1],d[maxn&lt;&lt;1];  </div><div class="line">vector&lt;int&gt;e[maxn&lt;&lt;1]; </div><div class="line">void dfs(int u,int fa)&#123;  </div><div class="line">    for(register int i=0;i&lt;e[u].size();i++)&#123;  </div><div class="line">        int v=e[u][i];</div><div class="line">        if(v==fa)continue;  </div><div class="line">        d[v]=d[u]+(c[u]^c[v]);  </div><div class="line">        dfs(v,u);  </div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line">int main()&#123;</div><div class="line">    int n;  </div><div class="line">    readin(n);  </div><div class="line">    for(register int i = 1;i&lt;=n;i++) readin(c[i]);  </div><div class="line">    for(register int i = 1;i&lt;=n-1;i++)&#123;  </div><div class="line">        int u,v;</div><div class="line">        readin(u),readin(v);</div><div class="line">        e[u].push_back(v);  </div><div class="line">        e[v].push_back(u);  </div><div class="line">    &#125;</div><div class="line">    int u=1;  </div><div class="line">    dfs(u,-1);</div><div class="line">    int maxlen=d[u];</div><div class="line">    for(register int i = 1;i&lt;=n;i++)  </div><div class="line">        if(d[i]&gt;maxlen)  </div><div class="line">            maxlen=d[i],u=i;</div><div class="line">    memset(d,0,sizeof(d));  </div><div class="line">    dfs(u,-1);</div><div class="line">    maxlen = d[u];</div><div class="line">    for(register int i=1;i&lt;=n;i++)&#123;</div><div class="line">        if(d[i]&gt;maxlen)&#123; </div><div class="line">            maxlen = d[i];  </div><div class="line">            u=i;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">    printf(&quot;%d\n&quot;,(d[u]+1)/2);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="C"><a href="#C" class="headerlink" title="C"></a>C</h1><p><img src="http://img.blog.csdn.net/20170212210907206?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://codeforces.com/problemset/problem/729/C" target="_blank" rel="external">C - Road to Cinema CodeForces - 729C</a></p>
<p>题意：首先给出N，K，S，T分别代表汽车类型数量，加油站数量，路程全程，最大耗时。<br>接着N行，每行给出一种汽车的价格和邮箱容积，最后一行给出K个加油站的位置。<br>汽车每到一个加油站都可以瞬间加满油，汽车有两种行驶方式，高速：一公里一分钟一升油，低速：一公里两分钟一升油。可以在任意时间选择任意一种行驶方式。<br>在小于最大耗时的前提下，选择价格最小的汽车跑完全程。输出最小价格，如果找不到就输出-1.</p>
<p>思路：根据最大耗时可以二分查找出最小油量，根据最小油量去汽车类型中找到最小价格。<br>对于二分过程，设出x1和x2代表高低速所走的路程，解个二元一次方程组即可。这时要处理好边界情况，比如就算全程慢速油料也不够用或者全程高速也用不完油料。实现时我直接忽略掉了x1,x2的中间结果，直接累加的时间<br>注意点一：二分出的结果并不一定合法。需要设置标记变量记录二分过程中是否真的找到过合法的油量，只要找到过一次，就可以拿这个合法的油量去汽车类型中求最小价格，如果一次都找不到，那么二分出的答案本身就不合法，也没必要去汽车类型中找答案了，直接输出-1吧。<br>注意点二：给出的油站位置是乱序的，记得排个序，把起点和终点都当作一个油站会方便运算。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* a,<span class="keyword">const</span> <span class="keyword">void</span>* b)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">return</span> (*(<span class="keyword">int</span>*)a-*(<span class="keyword">int</span>*)b);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> c[<span class="number">262144</span>],v[<span class="number">262144</span>],g[<span class="number">262144</span>],px[<span class="number">262144</span>],px2[<span class="number">262144</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp2</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span>* a,<span class="keyword">const</span> <span class="keyword">void</span>* b)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">int</span> cc=*(<span class="keyword">int</span>*)a,dd=*(<span class="keyword">int</span>*)b;</div><div class="line">	<span class="keyword">return</span> c[cc]-c[dd];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">int</span> n,k,s,t;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;n,&amp;k,&amp;s,&amp;t);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;c[i],&amp;v[i]);</div><div class="line">		px[i]=i;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;k;i++)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;g[i]);</div><div class="line">	&#125;</div><div class="line">	qsort(g,k,<span class="number">4</span>,&amp;cmp);</div><div class="line">	qsort(px,n,<span class="number">4</span>,&amp;cmp2);</div><div class="line">	g[k]=s;</div><div class="line">	c[n]=<span class="number">-1</span>;</div><div class="line">	px[n]=n;</div><div class="line">	<span class="keyword">int</span> max=<span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> j=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(v[px[i]]&gt;max)</div><div class="line">		&#123;</div><div class="line">			max=v[px[i]];</div><div class="line">			px2[j++]=px[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	px2[j]=n;</div><div class="line">	<span class="keyword">int</span> left=<span class="number">0</span>,right=j;</div><div class="line">	<span class="keyword">while</span>(left&lt;right)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> i=(left+right)&gt;&gt;<span class="number">1</span>;</div><div class="line">		<span class="keyword">int</span> oil=v[px2[i]];</div><div class="line">		<span class="keyword">int</span> j=<span class="number">0</span>;</div><div class="line">		<span class="keyword">int</span> wz=<span class="number">0</span>;</div><div class="line">		<span class="keyword">int</span> tim=<span class="number">0</span>;</div><div class="line">		<span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(tim&gt;t)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(oil&lt;g[j]-wz)</div><div class="line">			&#123;</div><div class="line">				tim=t+<span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">int</span> spd=oil-(g[j]-wz);</div><div class="line">			oil-=spd&lt;&lt;<span class="number">1</span>;</div><div class="line">			<span class="keyword">if</span>(oil&gt;<span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				wz+=spd;</div><div class="line">				tim+=spd;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				tim+=g[j]-wz;</div><div class="line">				wz=g[j];</div><div class="line">			&#125;</div><div class="line">			tim+=(g[j]-wz)&lt;&lt;<span class="number">1</span>;</div><div class="line">			wz=g[j];</div><div class="line">			oil=v[px2[i]];</div><div class="line">			j++;</div><div class="line">			<span class="keyword">if</span>(j&gt;k)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(tim&lt;=t)</div><div class="line">		&#123;</div><div class="line">			right=i;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			left=i+<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>,c[px2[left]]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="D"><a href="#D" class="headerlink" title="D"></a>D</h1><p><img src="http://img.blog.csdn.net/20170212211412118?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://codeforces.com/problemset/problem/735/D" target="_blank" rel="external">D - Taxes CodeForces - 735D</a><br><strong>吐槽一下，答案只有1,2,3真的没问题吗？（原因你可以把哥德巴赫猜想给证明一遍。。。。。。）</strong><br>题意：<br>某人要交税，交的税钱是收入n的最大因子（!=n，若该数是质数则是1），但是这人作弊，把钱拆成几份，使交税最少，输出税钱。<br>解法：<br>如果n为质数不拆，<br>如果n是偶数可以拆成两个质数的和。<br>如果n可以拆成2+一个质数输出2<br>剩下的只能成3份。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>) &#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span> ((ch=getchar())&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>);</div><div class="line">	res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span> ((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)</div><div class="line">	res=ch<span class="number">-48</span>+res*<span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> n;</div><div class="line"><span class="keyword">int</span> prime[<span class="number">60002</span>],sum=<span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> j,vis[<span class="number">60002</span>];</div><div class="line">	vis[<span class="number">2</span>]=<span class="number">0</span>,vis[<span class="number">3</span>]=<span class="number">0</span>,sum=<span class="number">1</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=<span class="number">60002</span>;i++) &#123;</div><div class="line">		<span class="keyword">if</span> (!vis[i]) &#123;</div><div class="line">			vis[i]=<span class="number">1</span>;</div><div class="line">			prime[sum++]=i;</div><div class="line">			j=<span class="number">2</span>*i;</div><div class="line">			<span class="keyword">while</span> (j&lt;<span class="number">60001</span>) &#123;</div><div class="line">				vis[j]=<span class="number">1</span>;</div><div class="line">				j+=i;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	readin(n);</div><div class="line">	<span class="keyword">int</span> flag1=<span class="number">0</span>,flag2=<span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (n==<span class="number">2</span>) &#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">1</span>);</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (n%<span class="number">2</span>==<span class="number">0</span>) &#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">2</span>);</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		init();		</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;prime[i]*prime[i]&lt;=n;i++) &#123;</div><div class="line">			<span class="keyword">if</span> (n%prime[i]==<span class="number">0</span>) &#123;</div><div class="line">				flag1=<span class="number">1</span>;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (flag1) &#123;</div><div class="line">			n-=<span class="number">2</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;prime[i]*prime[i]&lt;=n;i++) &#123;</div><div class="line">				<span class="keyword">if</span> (n%prime[i]==<span class="number">0</span>) &#123;</div><div class="line">					flag2=<span class="number">1</span>;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (flag2) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">3</span>);</div><div class="line">			<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">2</span>); </div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="E"><a href="#E" class="headerlink" title="E"></a>E</h1><p><img src="http://img.blog.csdn.net/20170212211550073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://acm.scu.edu.cn/soj/problem.action?id=4436" target="_blank" rel="external">E - Easy Math SCU - 4436</a><br>一句话：无理数+任意整数数都为无理数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></div><div class="line"><span class="keyword">int</span> a[<span class="number">131072</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">int</span> n;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)&gt;<span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> r=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</div><div class="line">		&#123;</div><div class="line">			</div><div class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[i]);</div><div class="line">			<span class="keyword">int</span> m=(<span class="keyword">int</span>)<span class="built_in">sqrt</span>(<span class="number">1.0</span>*a[i]+<span class="number">0.5</span>)+<span class="number">1</span>;</div><div class="line">			<span class="keyword">while</span>(r)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">if</span>((<span class="keyword">long</span> <span class="keyword">long</span>)m*m==a[i])</div><div class="line">				&#123;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>((<span class="keyword">long</span> <span class="keyword">long</span>)m*m&lt;a[i])</div><div class="line">				&#123;</div><div class="line">					r=<span class="number">0</span>;</div><div class="line">				&#125;</div><div class="line">				m--;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(r)</div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"Yes\n"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"No\n"</span>);</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="F"><a href="#F" class="headerlink" title="F"></a>F</h1><p><img src="http://img.blog.csdn.net/20170212211840836?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5770" target="_blank" rel="external">F - Treasure HDU - 5770</a><br>令subtree(i)表示以i为根节点的子树，对于某个宝箱a,b,v，令c=lca(a,b)<br>1.若a!=c且b!=c，那么要想得到这个宝箱的权值，起点必须在subtree(a)中，终点必须在subtree(b)中<br>2.若a=c，说明b是a的祖先，要想拿到此宝箱，起点不能在subtree(a)中，终点必须在subtree(b)中<br>3.若b=c，与a=c类似，起点不能在subtree(b)中，终点必须在subtree(b)中<br>4.若a=b，说明宝箱和其对应的钥匙在同一点，那么起点和终点只要不同的subtree(son)中即可（son为a的儿子节点）<br>考虑到每种情况起点终点都在某棵子树中任意选取，故首先求出每个节点的dfs序，用dfs序将一棵子树subtree(i)映射成一个连续的区间[l[i],r[i]]，进而上面四种情况中起点和终点的选则就对应二维平面的一个矩阵，平面上点(x,y)的实际意义是走以x为起点y为终点的简单路径能够得到的权值，通过对每个宝箱的讨论可以在平面上扔若干个矩阵，最后从整个平面上找一个点权最大的点即为答案，后者用扫描线加线段树即可（即将一个矩阵看作两条横线，扫到下方横线就权值加v，扫到上方横线就权值减v表示消除影响）<br>注意前三种情况每种情况最多加两个矩阵，但是第四种情况由于起点终点可以在a的若干儿子子树中选取，故最多会出现n^2个矩阵，这显然不行，故可以采取总体累加，局部消除的方法，即先给加一个全平面矩阵，权值为v，然后加所有的不合法矩阵，权值为-v，不非法矩阵有四种情况：<br>1.起点终点都在a的某个subtree(son)中，son为a的儿子节点（累加至多n个）<br>2.起点终点都在suntree(left_brother)中，left_brother为a的左兄弟节点（即dfs序比l[a]小的点)（至多一个）<br>2.起点终点都在suntree(right_brother)中，right_brother为a的右兄弟节点（即dfs序比r[a]大的点)（至多一个）<br>3.起点和终点，一个在suntree(left_brother)中一个在suntree(right_brother)中（至多两个）<br>不合法矩阵累加不超过4*n个，这样就可以保证复杂度是O(nlogn)的了<br>对于上面第一种情况所加矩阵至多n个的解释：虽然每个节点的儿子节点数可以达到n-1个，但是如果将位于同一个节点处的宝箱看作一个来考虑的话，那么每个节点作为其父亲节点的儿子节点在这种情况下被加进去至多一次，故累加不超过n个，这里因为没有这么强的数据所以没有合并宝箱 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x,y) for(int i=x;i&gt;=y;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x,y) for(int i=x;i&lt;=y;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x3f3f3f3f</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 111111</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls (t&lt;&lt;1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs (t&lt;&lt;1|1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x)  memset(x,0,sizeof(x))</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>);</div><div class="line">	res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)</div><div class="line">	res=ch<span class="number">-48</span>+res*<span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> y,l,r,v;</div><div class="line">    node()&#123;&#125;;</div><div class="line">    node(<span class="keyword">int</span> _y,<span class="keyword">int</span> _l,<span class="keyword">int</span> _r,<span class="keyword">int</span> _v)&#123;</div><div class="line">        y=_y,l=_l,r=_r,v=_v;</div><div class="line">    &#125; </div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> &lt;(<span class="keyword">const</span> node &amp;b)<span class="keyword">const</span>&#123;</div><div class="line">        <span class="keyword">return</span> y&lt;b.y;</div><div class="line">    &#125;</div><div class="line">&#125;a[maxn*<span class="number">10</span>];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;g[maxn];</div><div class="line"><span class="keyword">int</span> p[maxn][<span class="number">20</span>],deep[maxn],vis[maxn];</div><div class="line"><span class="keyword">int</span> index,l[maxn],r[maxn];</div><div class="line"><span class="keyword">int</span> T,n,m,res,Case=<span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">    l[u]=++index;</div><div class="line">    vis[u]=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;g[u].size();i++)&#123;</div><div class="line">        <span class="keyword">int</span> v=g[u][i];</div><div class="line">        <span class="keyword">if</span>(vis[v])<span class="keyword">continue</span>;</div><div class="line">        deep[v]=deep[u]+<span class="number">1</span>;</div><div class="line">        p[v][<span class="number">0</span>]=u;</div><div class="line">        dfs(v);</div><div class="line">    &#125;</div><div class="line">    r[u]=index;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lca</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(deep[a]&lt;deep[b])swap(a,b);</div><div class="line">    <span class="keyword">register</span> <span class="keyword">int</span> i,j;</div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;(<span class="number">1</span>&lt;&lt;i)&lt;=deep[a];i++);</div><div class="line">    i--;</div><div class="line">    <span class="keyword">for</span>(j=i;j&gt;=<span class="number">0</span>;j--)</div><div class="line">        <span class="keyword">if</span>(deep[a]-(<span class="number">1</span>&lt;&lt;j)&gt;=deep[b])</div><div class="line">            a=p[a][j];</div><div class="line">    <span class="keyword">if</span>(a==b) <span class="keyword">return</span> a;</div><div class="line">    <span class="keyword">for</span>(j=i;j&gt;=<span class="number">0</span>;j--)</div><div class="line">        <span class="keyword">if</span>(p[a][j]!=<span class="number">-1</span>&amp;&amp;p[a][j]!=p[b][j])</div><div class="line">            a=p[a][j],b=p[b][j];</div><div class="line">    <span class="keyword">return</span> p[a][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> step)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)</div><div class="line">        <span class="keyword">if</span>(step&amp;(<span class="number">1</span>&lt;&lt;i))x=p[x][i];</div><div class="line">    <span class="keyword">return</span> x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;(<span class="number">1</span>&lt;&lt;j)&lt;=n;j++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">            <span class="keyword">if</span>(~p[i][j<span class="number">-1</span>])p[i][j]=p[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(<span class="keyword">int</span> y1,<span class="keyword">int</span> y2,<span class="keyword">int</span> x1,<span class="keyword">int</span> x2,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    a[res++]=node(y1,x1,x2,v);</div><div class="line">    <span class="keyword">if</span>(y2&lt;n)a[res++]=node(y2+<span class="number">1</span>,x1,x2,-v);</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tree</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> Max,lazy;</div><div class="line">&#125;tree[maxn&lt;&lt;<span class="number">2</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_up</span><span class="params">(<span class="keyword">int</span> t)</span></span>&#123;</div><div class="line">    tree[t].Max=max(tree[ls].Max,tree[rs].Max);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> t)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> lazy=tree[t].lazy;</div><div class="line">    <span class="keyword">if</span>(!lazy)<span class="keyword">return</span> ;</div><div class="line">    tree[ls].Max+=lazy,tree[ls].lazy+=lazy;</div><div class="line">    tree[rs].Max+=lazy,tree[rs].lazy+=lazy;</div><div class="line">    tree[t].lazy=<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> t)</span></span>&#123;</div><div class="line">    tree[t].Max=tree[t].lazy=<span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(l==r)<span class="keyword">return</span> ;</div><div class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    build(l,mid,ls),build(mid+<span class="number">1</span>,r,rs);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> L,<span class="keyword">int</span> R,<span class="keyword">int</span> t,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(l==L&amp;&amp;r==R)&#123;</div><div class="line">        tree[t].Max+=v,tree[t].lazy+=v;</div><div class="line">        <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    push_down(t);</div><div class="line">    <span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(R&lt;=mid)update(l,mid,L,R,ls,v);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(L&gt;mid)update(mid+<span class="number">1</span>,r,L,R,rs,v);</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        update(l,mid,L,mid,ls,v);</div><div class="line">        update(mid+<span class="number">1</span>,r,mid+<span class="number">1</span>,R,rs,v);</div><div class="line">    &#125;</div><div class="line">    push_up(t);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)g[i].clear();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">            <span class="keyword">int</span> u,v;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;u,&amp;v);</div><div class="line">            g[u].push_back(v),g[v].push_back(u);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">memset</span>(p,<span class="number">-1</span>,<span class="keyword">sizeof</span>(p));</div><div class="line">        <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</div><div class="line">        deep[<span class="number">1</span>]=<span class="number">1</span>;index=<span class="number">0</span>;</div><div class="line">        dfs(<span class="number">1</span>);</div><div class="line">        init(n);</div><div class="line">        res=<span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span>(m--)&#123;</div><div class="line">            <span class="keyword">int</span> a,b,v;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;a,&amp;b,&amp;v);</div><div class="line">            <span class="keyword">int</span> c=lca(a,b);</div><div class="line">            <span class="keyword">if</span>(a==b)&#123;</div><div class="line">                deal(<span class="number">1</span>,n,<span class="number">1</span>,n,v);</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;g[a].size();i++)&#123;</div><div class="line">                    <span class="keyword">int</span> d=g[a][i];</div><div class="line">                    <span class="keyword">if</span>(deep[d]&lt;deep[a])<span class="keyword">continue</span>;</div><div class="line">                    deal(l[d],r[d],l[d],r[d],-v);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span>(l[a]&gt;<span class="number">1</span>)deal(<span class="number">1</span>,l[a]<span class="number">-1</span>,<span class="number">1</span>,l[a]<span class="number">-1</span>,-v);</div><div class="line">                <span class="keyword">if</span>(r[a]&lt;n)deal(r[a]+<span class="number">1</span>,n,r[a]+<span class="number">1</span>,n,-v);</div><div class="line">                <span class="keyword">if</span>(l[a]&gt;<span class="number">1</span>&amp;&amp;r[a]&lt;n)&#123;</div><div class="line">                    deal(<span class="number">1</span>,l[a]<span class="number">-1</span>,r[a]+<span class="number">1</span>,n,-v);</div><div class="line">                    deal(r[a]+<span class="number">1</span>,n,<span class="number">1</span>,l[a]<span class="number">-1</span>,-v);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a!=c&amp;&amp;b!=c)&#123;</div><div class="line">                deal(l[a],r[a],l[b],r[b],v);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a==c)&#123;</div><div class="line">                <span class="keyword">int</span> d=find(b,deep[b]-deep[a]<span class="number">-1</span>);</div><div class="line">                <span class="keyword">if</span>(l[d]&gt;<span class="number">1</span>)deal(<span class="number">1</span>,l[d]<span class="number">-1</span>,l[b],r[b],v);</div><div class="line">                <span class="keyword">if</span>(r[d]&lt;n)deal(r[d]+<span class="number">1</span>,n,l[b],r[b],v);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(b==c)&#123;</div><div class="line">                <span class="keyword">int</span> d=find(a,deep[a]-deep[b]<span class="number">-1</span>);</div><div class="line">                <span class="keyword">if</span>(l[d]&gt;<span class="number">1</span>)deal(l[a],r[a],<span class="number">1</span>,l[d]<span class="number">-1</span>,v);</div><div class="line">                <span class="keyword">if</span>(r[d]&lt;n)deal(l[a],r[a],r[d]+<span class="number">1</span>,n,v);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        sort(a,a+res);</div><div class="line">        <span class="keyword">int</span> ans=-INF;</div><div class="line">        build(<span class="number">1</span>,n,<span class="number">1</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,j=<span class="number">0</span>;i&lt;=n;i++)&#123;</div><div class="line">            <span class="keyword">for</span>(;j&lt;res&amp;&amp;a[j].y==i;j++)</div><div class="line">                update(<span class="number">1</span>,n,a[j].l,a[j].r,<span class="number">1</span>,a[j].v);</div><div class="line">            ans=max(ans,tree[<span class="number">1</span>].Max);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d: %d\n"</span>,Case++,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="G"><a href="#G" class="headerlink" title="G"></a>G</h1><p><img src="http://img.blog.csdn.net/20170212212325350?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://codeforces.com/problemset/problem/506/A" target="_blank" rel="external">G - Mr. Kitayuta, the Treasure Hunter CodeForces - 506A</a></p>
<p>一共有30001个岛屿，下标为0~30000，有些岛屿藏有宝藏。你从0往下标大的方向跳，第一步跳的距离为d。如果上一步跳的距离为l，这一步就可以跳l-1或l或l+1（距离必须大于0）。问最多拿到多少宝藏。<br>设dp[i][j]表示到达第i个岛屿，跳了j步得到的最大宝藏数，那么动态转移方程：<br>dp[to][j]=max(dp[to][j],dp[i][j]+treasure[to])<br>dp[to+1][j+1]=max(dp[to+1][j+1],dp[i][j]+treasure[to+1])<br>dp[to-1][j-1]=max(dp[to-1][j-1],dp[i][j]+treasure[to-1])<br>如果开一个dp[30000][30000]的数组的话会MLE，那么在到达30000之前，最大步长是1+2+3+…+250&gt;30000。所以第二维开到500就够了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x) memset(x,0,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ms(a,x) memset(x,a,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WIN32</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> AUTO <span class="meta-string">"%I64d"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> AUTO <span class="meta-string">"%lld"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">30005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> stp = <span class="number">505</span>;</div><div class="line"><span class="keyword">int</span> n,d,x,ans,maxx;</div><div class="line"><span class="keyword">int</span> num[maxn],sum[maxn];</div><div class="line"><span class="keyword">int</span> dp[maxn][stp];</div><div class="line"><span class="keyword">int</span> sp[] = &#123;<span class="number">-1</span>, <span class="number">0</span>, <span class="number">1</span>&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> l)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sit = pos+l+d;</div><div class="line">    <span class="keyword">if</span>(l+d &lt; <span class="number">1</span> || sit &gt; maxx) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(dp[sit][l+<span class="number">250</span>] != <span class="number">-1</span>) <span class="keyword">return</span> dp[sit][l+<span class="number">250</span>];</div><div class="line">    <span class="keyword">if</span>(l+d &lt;= <span class="number">2</span>) &#123;</div><div class="line">        dp[sit][l+<span class="number">250</span>] = sum[sit];</div><div class="line">        <span class="keyword">return</span> dp[sit][l+<span class="number">250</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(l+d == <span class="number">3</span>) &#123;</div><div class="line">        dp[sit][l+<span class="number">250</span>] = sum[sit+<span class="number">2</span>]+num[sit];</div><div class="line">        <span class="keyword">return</span> dp[sit][l+<span class="number">250</span>];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> he = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="keyword">int</span> xl = l+sp[i];</div><div class="line">        he = max(he, dfs(sit, xl));</div><div class="line">    &#125;</div><div class="line">    he += num[sit];</div><div class="line">    <span class="keyword">return</span> dp[sit][l+<span class="number">250</span>] = he;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">	ms(<span class="number">-1</span>, dp);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;d);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x), maxx = max(x, maxx), num[x]++;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = maxx; i &gt;= <span class="number">1</span>; i--) sum[i] = sum[i+<span class="number">1</span>]+num[i];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	init();</div><div class="line">    ans = dfs(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="H"><a href="#H" class="headerlink" title="H"></a>H</h1><p><img src="http://img.blog.csdn.net/20170212212755700?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><a href="http://codeforces.com/problemset/problem/555/A" target="_blank" rel="external">H - Case of Matryoshkas CodeForces - 555A</a></p>
<p> 规定两种操作：<br>1、拆下编号最大的娃娃。<br>2、将一条链上的娃娃套在一个没有套在任何其他链子上的娃娃上（有点绕）。意思就是比如有一条链1→2→4→5，你可以拆下5，然后变成两条链1→2→4和5，或者将这条链套在6上，但是6不能已经套在任何其他链子上（即6必须是单独一个），变成1→2→4→5→6。题目要求用最少的操作步数将所有的娃娃套在一个链子上。<br>思       路：  编号为1的娃娃所在的那条链子上，1是不需要拆下来的。也就是不用进行任何操作。如果1套在2上，那么2也不用拆下来，再接着如果2套在3上，那么3也不用拆 ……<br>以此类推，这条链上从1开始连续的数字都是不用拆的。直到某个地方不连续，比如1→2→3→4→6→7→8，其中4套在6上，那么5肯定在别的链子上，需要把6（包括6）以后的所有娃娃都拆下来，然后把5接上去，再把6 7 8接上去。由此看来，这条链上从1开始连续的数字不用拆。一旦遇到不连续，则从这个不连续的娃娃开始后面的全部都要拆。<br> 然后依据要输入几组数据来计算要拆的次数，在计算要套的次数。例如输入n个，m组数据，从一开始连续的用k个，则：<br>    需要次数= 要拆的次数 ( n - k - m + 1 ) + 要套的次数( n - k )<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> a[<span class="number">100005</span>];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="keyword">int</span> k;</div><div class="line"><span class="keyword">int</span> cnt;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)!=EOF) &#123;</div><div class="line">        <span class="keyword">int</span> t = <span class="number">0</span>;</div><div class="line">        cnt = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;k);</div><div class="line">            <span class="keyword">int</span> flag = <span class="number">0</span>;</div><div class="line">            <span class="keyword">int</span> minn = <span class="number">999999</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;k; j++) &#123;</div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;a[j]);</div><div class="line">                <span class="keyword">if</span>(j == <span class="number">0</span> &amp;&amp; a[<span class="number">0</span>] == <span class="number">1</span>) &#123;</div><div class="line">                    flag = <span class="number">1</span>;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(flag == <span class="number">1</span>) &#123;</div><div class="line">                    <span class="keyword">if</span>(a[j] - <span class="number">1</span> != a[j<span class="number">-1</span>]) &#123;</div><div class="line">                        flag = <span class="number">2</span>;</div><div class="line">                        t = a[j<span class="number">-1</span>];</div><div class="line">                        cnt += k - j;</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(flag == <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span>(a[j]&gt;minn) &#123;</div><div class="line">                        cnt++;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        minn = a[j];</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(flag == <span class="number">1</span>) &#123;</div><div class="line">                t = a[k<span class="number">-1</span>];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        cnt += n - t;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,cnt);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="I"><a href="#I" class="headerlink" title="I"></a>I</h1><p><img src="http://img.blog.csdn.net/20170212213232345?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><a href="http://acm.hdu.edu.cn/showproblem.php?pid=5775" target="_blank" rel="external">I - Bubble Sort HDU - 5775</a></p>
<p>题意：给出一个序列，求每一个数字在冒泡排序中出现的最大最小下标差。<br>从小到大考虑每一个数组，一个数字右边有多少个比他大的数字就是他右移的数量。用树状数组维护下就好了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 100010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxm 1000010</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> T,n,cas=<span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> num[maxn&lt;&lt;<span class="number">1</span>],f[maxn&lt;&lt;<span class="number">1</span>],ans[maxn&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> x&amp;(-x);&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">while</span>(x&lt;=n)&#123;</div><div class="line">        f[x]++;</div><div class="line">        x+=lowbit(x);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> t=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(x!=<span class="number">0</span>)&#123;</div><div class="line">        t+=f[x];</div><div class="line">        x-=lowbit(x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">memset</span>(f,<span class="number">0</span>,<span class="keyword">sizeof</span>(f));</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;num[i]);</div><div class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>,l=<span class="number">0</span>,r=<span class="number">0</span>,nx=<span class="number">0</span>,minn=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            update(num[i]);</div><div class="line">            nx=i-Sum(num[i]);</div><div class="line">            minn=num[i]+nx-i;</div><div class="line">            l=min(i,num[i]);</div><div class="line">            r=max(i,i+minn);</div><div class="line">            ans[num[i]]=<span class="built_in">abs</span>(r-l);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Case #%d:"</span>,++cas);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">" %d"</span>,ans[i]);</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="J"><a href="#J" class="headerlink" title="J"></a>J</h1><p><img src="http://img.blog.csdn.net/20170212213306143?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><a href="https://hihocoder.com/problemset/problem/1391" target="_blank" rel="external">J - Countries HihoCoder - 1391</a></p>
<p>题目大意：<br>　　A和B两个国家互射导弹，每个国家都有一个防御系统，在防御系统开启的时间内可以将到达本国的导弹反弹回去(掉头，防御系统不能开开关关)。<br>　　现在已知：Ta、Tb为A、B两国导弹防御能开启的持续时间，X为B国开启导弹防御系统的时刻(持续时间为[X,Tb+X]，包含端点)<br>　　A向B发射N枚导弹，B向A发射M枚导弹。每枚导弹有3个值：发射时间，从A到B或从B到A的飞行时间，伤害值。<br>　　现在A可以在任意时刻开启防御系统，求A所受到的最小伤害值。<br>题目思路：<br>　　【预处理+排序+堆】<br>　　首先预处理，求出每枚导弹不会打到A需要A国防御系统开启的时间段[st,et]，只有A开启防御的时间段[Y,Y+Ta]包含[st,et]那么这枚导弹不会打到A。<br>　　预处理之后将每枚导弹按照et从小到大排序。<br>　　从1到n+m枚导弹，对于当前这枚导弹，如果需要被防御，那么A防御系统的结束时间就为et，那么开启时间就为et-Ta<br>　　那么将之前已经被防御的导弹中st&lt;et-Ta的移除出去，表示这些导弹不能在当前决策中被防御。<br>　　可以开个STL的优先队列或者堆记录之前被防御的导弹序号，按照st从小到大存，每次比较最小的st和开启时间et-Ta。并在过程中增减伤害值，并记录最小伤害。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x,y) for(int i=x;i&gt;=y;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x,y) for(int i=x;i&lt;=y;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2100000000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x)  memset(x,0,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 0x3f3f3f3f</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 20004</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;<span class="string">'9'</span>||ch&lt;<span class="string">'0'</span>);</div><div class="line">	res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)</div><div class="line">	res=ch<span class="number">-48</span>+res*<span class="number">10</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m,cnt,ans;</div><div class="line"><span class="keyword">int</span> Ta,Tb,X,sum;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">    LL t,c,e,d;</div><div class="line">&#125;a[N],b[N];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmpf</span>&#123;</span></div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span> <span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;lhs,<span class="keyword">const</span> <span class="keyword">int</span> &amp;rhs)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> a[lhs].t&gt;a[rhs].t;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(node lhs,node rhs)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> lhs.e&lt;rhs.e;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> x,y,i,j;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;Ta,&amp;Tb)!=EOF)&#123;</div><div class="line">        cnt=<span class="number">0</span>,ans=MAX,sum=<span class="number">0</span>;</div><div class="line">        readin(X),readin(n),readin(m);</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">            readin(b[i].t),readin(b[i].c),readin(b[i].d);</div><div class="line">            b[i].e=b[i].t+b[i].c;</div><div class="line">            <span class="keyword">if</span>(b[i].e&gt;=X&amp;&amp;b[i].e&lt;=X+Tb)&#123;</div><div class="line">                sum+=b[i].d;</div><div class="line">                a[++cnt].t=b[i].e+b[i].c;</div><div class="line">                j=Tb+X-a[cnt].t;</div><div class="line">                j=j%(<span class="number">2</span>*b[i].c);</div><div class="line">                a[cnt].e=Tb+X-j;</div><div class="line">                a[cnt].d=b[i].d;</div><div class="line">                <span class="keyword">if</span>(j&gt;=b[i].c)a[cnt].e+=b[i].c+b[i].c;</div><div class="line">                <span class="keyword">if</span>(a[cnt].t+b[i].c&lt;X||a[cnt].t&gt;Tb+X)a[cnt].e=a[cnt].t;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">            readin(b[i].t),readin(b[i].c),readin(b[i].d);</div><div class="line">            b[i].e=b[i].t+b[i].c;</div><div class="line">            sum+=b[i].d;</div><div class="line">            a[++cnt].t=b[i].e;</div><div class="line">            j=Tb+X-a[cnt].t;</div><div class="line">            j=j%(<span class="number">2</span>*b[i].c);</div><div class="line">            a[cnt].e=Tb+X-j;</div><div class="line">            a[cnt].d=b[i].d;</div><div class="line">            <span class="keyword">if</span>(j&gt;=b[i].c)a[cnt].e+=b[i].c+b[i].c;</div><div class="line">            <span class="keyword">if</span>(a[cnt].t+b[i].c&lt;X||a[cnt].t&gt;Tb+X)a[cnt].e=a[cnt].t;</div><div class="line">        &#125;</div><div class="line">        sort(a+<span class="number">1</span>,a+cnt+<span class="number">1</span>,cmp);</div><div class="line">        priority_queue&lt;<span class="keyword">int</span>,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;,cmpf&gt;q;</div><div class="line">        <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=cnt;i++)&#123;</div><div class="line">            q.push(i);y=a[i].e;</div><div class="line">            sum-=a[i].d;</div><div class="line">            x=q.top();</div><div class="line">            <span class="keyword">while</span>(y-a[x].t&gt;Ta&amp;&amp;!q.empty())&#123;</div><div class="line">                sum+=a[x].d;</div><div class="line">                q.pop();x=q.top();</div><div class="line">            &#125;</div><div class="line">            ans=min(ans,sum);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/ACM/">ACM</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/03/12/My-New-Post/">
      My New Post
    </a>
  </h2>
  
  <time>
    Mar 12, 2017
  </time>
  <section class="content">
	  <p>这blog太难维护了！！！！<br>自己调试、维护、debug……无数的深夜……<br>终于建成了，虽然常常脑抽，但是自己还是很满意的，这个blog就用在写自己的<strong>好东西</strong>上吧，毕竟是<strong>暗网</strong>，所以没打算公示出来，就当做成为OIer的回忆吧！</p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/lemonoil/">lemonoil</a>
	  </div>
    

  </section>
</article>
  
</section>


  <nav id="page-nav">
    
    <a class="prev" rel="prev" href="/archives/2017/page/3/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
  </nav>
  


      <script>setLoadingBarProgress(60);</script>
    </main>
    
    <footer id="footer" class="clearfix">
  
  
	<div class="search">
	  <form name="searchform" id="searchform" class="u-search-form">
	    <input type="text" id="searchinput" class="u-search-input" placeholder="Looking for something?" />
	    <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit">
	      <span class="icon icon-search"></span>
	    </button>
	  </form>
	</div>
	

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/artchen" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/otakism" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
        <a href="https://plus.google.com/+ArtChenOtakism/posts" class="social google"
          target="_blank" rel="external">
          <span class="icon icon-google"></span>
        </a>
      
        <a href="http://weibo.com/otakism/" class="social sina-weibo"
          target="_blank" rel="external">
          <span class="icon icon-sina-weibo"></span>
        </a>
      
    
  </div>
  
  <div>Theme <span class="codename">Typescript</span> designed by <a href="http://rakugaki.me/" target="_blank">Art Chen</a>.</div>
  <div>&copy; <a href="/">PIVIX</a></div>
  
</footer>


    <script>setLoadingBarProgress(80);</script>
    
  </div>

  
<script>
  var disqus_shortname = 'https://lemonoilP.github.io';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>




<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>

<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "google";
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
  
</body>
</html>
