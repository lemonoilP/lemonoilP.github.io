<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Archives: 2017 | PIVIX</title>
  <meta name="description" content="A minimal hexo theme." />
  <meta name="keywords" content="hexo,theme,typescript,otakism,otaku" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="PIVIX">
<meta property="og:url" content="https://lemonoilP.github.io/archives/2017/page/3/index.html">
<meta property="og:site_name" content="PIVIX">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PIVIX">
  
  
    <link rel="icon" href="/favicon.png">
  

	<script src="https://use.typekit.net/eyf3hir.js"></script>
  <script>try{Typekit.load({ async: false });}catch(e){}</script>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
  

</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

  <script>setLoadingBarProgress(20)</script>
  
  <div id="site-wrapper">
    
    <header id="header">
	<div id="header-wrapper" class="clearfix">
		<a id="logo" href="/">
			<img src="/images/logo.png" />
			<span id="site-desc">
			  otaku keeps alive
      </span>
		</a>
		<button id="site-nav-switch">
	    <span class="icon icon-menu"></span>
	  </button>
	</div>
	<aside id="site-menu">
  	<nav>
  		
        <a href="/" class="nav-home nav">
          Home
        </a>
      
        <a href="/about" class="nav-about nav">
          About
        </a>
      
        <a href="/archives" class="nav-archives nav">
          Archives
        </a>
      
    </nav>
	</aside>
</header>
    <script>setLoadingBarProgress(40);</script>
    
    <main id="main" role="main">
      
	


	<section class="page-header archive">
    <h1>- <span>2017</span> -</h1>
  </section>




<section class="post-list">
	
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/06/02/后缀平衡树/">
      后缀平衡树
    </a>
  </h2>
  
  <time>
    Jun 2, 2017
  </time>
  <section class="content">
	  <p>本是打算研究<strong>后缀</strong>结构，但是发现不管是倍增还是DC3都异常容易错，知道最近才学习到了倍增算法的简易写法，但是仍然不爽，于是乎进入了后缀平衡树这样一个大坑。<br><img src="http://img.blog.csdn.net/20170603154340290?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="风雨，残花，遇见你"><a href="#风雨，残花，遇见你" class="headerlink" title="风雨，残花，遇见你"></a>风雨，残花，遇见你</h1><p>首先遇到的一个问题就是treap常数太大，虽然网上的裸题可以过，但是却异常的缓慢。。。。<br>以<strong>bzoj3682</strong>为例<br>用treap解决为2400ms<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"></div><div class="line">----------</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;T flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)res=(res&lt;&lt;<span class="number">1</span>)+(res&lt;&lt;<span class="number">3</span>)+ch<span class="number">-48</span>;res*=flag;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="keyword">int</span> n,m,len,type,lastans,x,y;</div><div class="line"><span class="keyword">int</span> ch[N][<span class="number">2</span>],rd[N],cl[N],cnt,root;</div><div class="line">LL rk[N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">randlmy</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">int</span> seed=<span class="number">173</span>;</div><div class="line">    <span class="keyword">return</span> seed=<span class="keyword">int</span>(seed*<span class="number">48271L</span>L%<span class="number">2147483647</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> cl[x]&lt;cl[y]||(cl[x]==cl[y]&amp;&amp;rk[x<span class="number">-1</span>]&lt;rk[y<span class="number">-1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rt)<span class="keyword">return</span>;</div><div class="line">	rk[rt]=l+r;</div><div class="line">	LL mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	rebuild(ch[rt][<span class="number">0</span>],l,mid);</div><div class="line">	rebuild(ch[rt][<span class="number">1</span>],mid,r);</div><div class="line">	</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> &amp;p,<span class="keyword">int</span> d,LL l,LL r)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> q=ch[p][d^<span class="number">1</span>];</div><div class="line">	ch[p][d^<span class="number">1</span>]=ch[q][d];</div><div class="line">	ch[q][d]=p;</div><div class="line">	p=q;</div><div class="line">	rebuild(p,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	LL mid=(r+l)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(!rt)&#123;rt=cnt;rk[rt]=l+r;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">if</span>(cmp(cnt,rt))&#123;insert(ch[rt][<span class="number">0</span>],l,mid);<span class="keyword">if</span>(rd[ch[rt][<span class="number">0</span>]]&gt;rd[rt])rotate(rt,<span class="number">1</span>,l,r);&#125;</div><div class="line">    <span class="keyword">else</span>&#123;insert(ch[rt][<span class="number">1</span>],mid,r);<span class="keyword">if</span>(rd[ch[rt][<span class="number">1</span>]]&gt;rd[rt])rotate(rt,<span class="number">0</span>,l,r);&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	cl[++cnt]=v;</div><div class="line">	rd[cnt]=randlmy()*randlmy();</div><div class="line">	insert(root,<span class="number">1</span>,<span class="number">1L</span>L&lt;&lt;<span class="number">61</span>);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R(rt) rt&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L(rt) rt&lt;&lt;1</span></div><div class="line"><span class="keyword">int</span> minn[N&lt;&lt;<span class="number">2</span>],p[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)read(p[l]),minn[rt]=l;</div><div class="line">	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">		build(lc,l,mid);</div><div class="line">		build(rc,mid+<span class="number">1</span>,r);</div><div class="line">		minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> id)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(id&lt;=mid)updata(lc,l,mid,id);</div><div class="line">	<span class="keyword">else</span> updata(rc,mid+<span class="number">1</span>,r,id);</div><div class="line">	minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> ql,<span class="keyword">int</span> qr)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(ql&lt;=l&amp;&amp;r&lt;=qr)<span class="keyword">return</span> minn[rt];</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(qr&lt;=mid)<span class="keyword">return</span> query(lc,l,mid,ql,qr);</div><div class="line">	<span class="keyword">if</span>(ql&gt;mid)<span class="keyword">return</span> query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">int</span> vl=query(lc,l,mid,ql,qr),vr=query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">return</span> rk[p[vl]]&lt;=rk[p[vr]]?vl:vr;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> s[N],cmd[<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	read(n),read(m),read(len),read(type);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len;i++)</div><div class="line">		insert(s[len-i]-<span class="string">'a'</span>);</div><div class="line">	build(<span class="number">1</span>,<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,cmd);</div><div class="line">		<span class="keyword">if</span>(!type)lastans=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'I'</span>)</div><div class="line">			read(x),insert(x^lastans),++len;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'C'</span>)</div><div class="line">			read(x),read(p[x]),updata(<span class="number">1</span>,<span class="number">1</span>,n,x);</div><div class="line">		<span class="keyword">else</span></div><div class="line">			read(x),read(y),</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,lastans=query(<span class="number">1</span>,<span class="number">1</span>,n,x,y));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而同等条件下，我生硬地植入SBT，所得结果出人意料<br>用时1600ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;T flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)res=(res&lt;&lt;<span class="number">1</span>)+(res&lt;&lt;<span class="number">3</span>)+ch<span class="number">-48</span>;res*=flag;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="keyword">int</span> n,m,len,type,lastans,x,y;</div><div class="line"><span class="keyword">int</span> ch[N][<span class="number">2</span>],sz[N],cl[N],cnt,root;</div><div class="line">LL rk[N];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> cl[x]&lt;cl[y]||(cl[x]==cl[y]&amp;&amp;rk[x<span class="number">-1</span>]&lt;rk[y<span class="number">-1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rt)<span class="keyword">return</span>;</div><div class="line">	rk[rt]=l+r;</div><div class="line">	LL mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	rebuild(ch[rt][<span class="number">0</span>],l,mid);</div><div class="line">	rebuild(ch[rt][<span class="number">1</span>],mid,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">left_rot</span><span class="params">(<span class="keyword">int</span> &amp;x,LL l,LL r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y=ch[x][<span class="number">1</span>];</div><div class="line">    ch[x][<span class="number">1</span>]=ch[y][<span class="number">0</span>];</div><div class="line">    ch[y][<span class="number">0</span>]=x;</div><div class="line">    sz[y]=sz[x]; </div><div class="line">    sz[x]=sz[ch[x][<span class="number">0</span>]]+sz[ch[x][<span class="number">1</span>]]+<span class="number">1</span>;</div><div class="line">    x=y;</div><div class="line">    rebuild(x,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">right_rot</span><span class="params">(<span class="keyword">int</span> &amp;x,LL l,LL r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> y=ch[x][<span class="number">0</span>];</div><div class="line">    ch[x][<span class="number">0</span>]=ch[y][<span class="number">1</span>];</div><div class="line">    ch[y][<span class="number">1</span>]=x;</div><div class="line">    sz[y]=sz[x];</div><div class="line">    sz[x]=sz[ch[x][<span class="number">0</span>]]+sz[ch[x][<span class="number">1</span>]]+<span class="number">1</span>;</div><div class="line">    x=y;</div><div class="line">    rebuild(x,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">bool</span> f,LL l,LL r)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(f == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span>(sz[ch[ch[x][<span class="number">0</span>]][<span class="number">0</span>]] &gt; sz[ch[x][<span class="number">1</span>]]) &#123;</div><div class="line">            right_rot(x,l,r);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sz[ch[ch[x][<span class="number">0</span>]][<span class="number">1</span>]] &gt; sz[ch[x][<span class="number">1</span>]]) &#123;</div><div class="line">            left_rot(ch[x][<span class="number">0</span>],l,r);</div><div class="line">            right_rot(x,l,r);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">return</span> ;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span>(sz[ch[ch[x][<span class="number">1</span>]][<span class="number">1</span>]] &gt; sz[ch[x][<span class="number">0</span>]]) &#123; </div><div class="line">            left_rot(x,l,r);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sz[ch[ch[x][<span class="number">1</span>]][<span class="number">0</span>]] &gt; sz[ch[x][<span class="number">0</span>]]) &#123; </div><div class="line">            right_rot(ch[x][<span class="number">1</span>],l,r);</div><div class="line">            left_rot(x,l,r);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> ;</div><div class="line">    &#125;</div><div class="line">    maintain(ch[x][<span class="number">0</span>],<span class="number">0</span>,l,r);</div><div class="line">    maintain(ch[x][<span class="number">1</span>],<span class="number">1</span>,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	LL mid=(r+l)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(!rt)&#123;rt=cnt;rk[rt]=l+r;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">if</span>(cmp(cnt,rt))insert(ch[rt][<span class="number">0</span>],l,mid),maintain(rt,<span class="number">0</span>,l,r);</div><div class="line">    <span class="keyword">else</span> insert(ch[rt][<span class="number">1</span>],mid,r),maintain(rt,<span class="number">1</span>,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	cl[++cnt]=v;</div><div class="line">	insert(root,<span class="number">1</span>,<span class="number">1L</span>L&lt;&lt;<span class="number">61</span>);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R(rt) rt&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L(rt) rt&lt;&lt;1</span></div><div class="line"><span class="keyword">int</span> minn[N&lt;&lt;<span class="number">2</span>],p[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)read(p[l]),minn[rt]=l;</div><div class="line">	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">		build(lc,l,mid);</div><div class="line">		build(rc,mid+<span class="number">1</span>,r);</div><div class="line">		minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> id)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(id&lt;=mid)updata(lc,l,mid,id);</div><div class="line">	<span class="keyword">else</span> updata(rc,mid+<span class="number">1</span>,r,id);</div><div class="line">	minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> ql,<span class="keyword">int</span> qr)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(ql&lt;=l&amp;&amp;r&lt;=qr)<span class="keyword">return</span> minn[rt];</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(qr&lt;=mid)<span class="keyword">return</span> query(lc,l,mid,ql,qr);</div><div class="line">	<span class="keyword">if</span>(ql&gt;mid)<span class="keyword">return</span> query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">int</span> vl=query(lc,l,mid,ql,qr),vr=query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">return</span> rk[p[vl]]&lt;=rk[p[vr]]?vl:vr;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> s[N],cmd[<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	read(n),read(m),read(len),read(type);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len;i++)</div><div class="line">		insert(s[len-i]-<span class="string">'a'</span>);</div><div class="line">	build(<span class="number">1</span>,<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,cmd);</div><div class="line">		<span class="keyword">if</span>(!type)lastans=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'I'</span>)</div><div class="line">			read(x),insert(x^lastans),++len;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'C'</span>)</div><div class="line">			read(x),read(p[x]),updata(<span class="number">1</span>,<span class="number">1</span>,n,x);</div><div class="line">		<span class="keyword">else</span></div><div class="line">			read(x),read(y),</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,lastans=query(<span class="number">1</span>,<span class="number">1</span>,n,x,y));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>；</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="在丽洁姐的论文中，只谈及SGT与TREAP是重量平衡树，没有说到SBT，既然如此是否存在一种可能就是。。。。丽姐忘了SBT或者不确定SBT也是"><a href="#在丽洁姐的论文中，只谈及SGT与TREAP是重量平衡树，没有说到SBT，既然如此是否存在一种可能就是。。。。丽姐忘了SBT或者不确定SBT也是" class="headerlink" title="在丽洁姐的论文中，只谈及SGT与TREAP是重量平衡树，没有说到SBT，既然如此是否存在一种可能就是。。。。丽姐忘了SBT或者不确定SBT也是?"></a>在丽洁姐的论文中，只谈及SGT与TREAP是重量平衡树，没有说到SBT，既然如此是否存在一种可能就是。。。。丽姐忘了SBT或者不确定SBT也是?</h2><p>SBT是以节点自适应平衡的，size是节点，可不可以就意味着重量呢？貌似是可行的耶。</p>
<hr>
<p>那么接下来，我的目的也就很明确了。<br><img src="http://img.blog.csdn.net/20170603154423556?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="隐隐，约约，咫尺间"><a href="#隐隐，约约，咫尺间" class="headerlink" title="隐隐，约约，咫尺间"></a>隐隐，约约，咫尺间</h1><p>首先引入比较任意两个点之间的rank值的方法：<br>1.当然是hash了啊！！！\(O(log_n)\)<br>2.然后是论文中提到的序列排序方式，暴力重建子节点。期望\(O(1)\)</p>
<p>首先是一个大问题，（但其实也不是问题），那就是如何提取sa与rank，进而得到height。<br>既然是平衡树，首先应该想到的肯定是中序遍历，这里应该注意的是我们一开始insert的时候是倒序插入的，所以在提取的时候要反过来，具体代码如下：（rk数组不是rank数组，应为rk是用来动态\(O(1)\)比较大小，而不是用来作为真正的rank。）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SA</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rt)<span class="keyword">return</span>;</div><div class="line">	SA(ch[rt][<span class="number">0</span>]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=w[rt];++i)</div><div class="line">		sa[t]=len-rt-i,rank[len-rt-i]=t++;</div><div class="line">	SA(ch[rt][<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_height</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;++i)&#123;  </div><div class="line">        <span class="keyword">if</span>(!rank[i]) <span class="keyword">continue</span>;  </div><div class="line">        <span class="keyword">int</span> j=sa[rank[i]<span class="number">-1</span>];  </div><div class="line">        <span class="keyword">if</span>(k)k--;  </div><div class="line">        <span class="keyword">while</span>(s[i+k]==s[j+k])++k;  </div><div class="line">        height[rank[i]]=k;  </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就可以\(O(n)\)实现获得后缀数组。非常优秀。<br>仿佛已经可以看见SBT在向我挥手了。</p>
<p><img src="http://img.blog.csdn.net/20170603154558227?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="红红火火，恍恍惚惚"><a href="#红红火火，恍恍惚惚" class="headerlink" title="红红火火，恍恍惚惚"></a>红红火火，恍恍惚惚</h1><p>tyvj的后缀数组太毒了，hzwer学长的代码都超时了，更何况常数更大的平衡树?所以我选择<del>死亡</del>uoj后缀排序来进行测试。</p>
<p><img src="http://img.blog.csdn.net/20170603154121548?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>可以看见SBT在这一mol多的q下GG了，大量的旋转导致了我的SBT完美TLE。。<br>那么运用cnt记录连续的字母呢？<br>就像这样：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	++cnt;</div><div class="line">	<span class="keyword">if</span>(cl[tot]==v)&#123;</div><div class="line">		++w[tot];</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		tot=cnt;</div><div class="line">		cl[cnt]=v;</div><div class="line">		insert(root,<span class="number">1</span>,<span class="number">1L</span>L&lt;&lt;<span class="number">61</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">SA</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rt)<span class="keyword">return</span>;</div><div class="line">	SA(ch[rt][<span class="number">0</span>]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=w[rt];++i)</div><div class="line">		sa[t]=len-rt-i,rank[len-rt-i]=t++;</div><div class="line">	SA(ch[rt][<span class="number">1</span>]);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后。。。。</p>
<p><img src="http://img.blog.csdn.net/20170603154252535?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>就这样WA了。</p>
<p>然而treap稳健地过了。。。泪目。。。。。<br><img src="http://img.blog.csdn.net/20170603154649464?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="山长水阔知何处？"><a href="#山长水阔知何处？" class="headerlink" title="山长水阔知何处？"></a>山长水阔知何处？</h1><p>事实证明sbt不行（如果可以请务必告诉我！！！）<br>而treap的时间复杂度又太高，后缀平衡树真的就永无翻身之日？<br>实则不然，后缀平衡树有着在动态与可持久化上绝对的优势，对于<strong>删除、可持久化</strong>操作，后缀平衡树不可替代。<br>那么最大的问题就是如何降低由于重建size的l与r而引起的常数。<br>1.treap的优化，详见我的 <a href="https://lemonoil.github.io/2017/05/20/%E6%9C%80%E5%BC%BA%E5%B9%B3%E8%A1%A1%E6%A0%91%E2%80%94%E2%80%94Treap-%E4%BB%A5%E6%88%91%E7%9A%84%E6%9C%80%E5%BC%B1%E6%88%98%E8%83%9C%E4%BD%A0%E7%9A%84%E6%9C%80%E5%BC%BA/" target="_blank" rel="external">最强平衡树</a>以及<a href="https://lemonoil.github.io/2017/03/16/%E5%B9%B3%E8%A1%A1%E6%A0%91/" target="_blank" rel="external">平衡树归纳</a><br>2.指针改数组加速，register，递归转递推。<br>3.用SGT替代treap，SGT的理论常数比treap小很多。<br>4.离线，用笛卡尔建树方法，O(n)建树。</p>
<h1 id="三十年河东三十年河西"><a href="#三十年河东三十年河西" class="headerlink" title="三十年河东三十年河西"></a>三十年河东三十年河西</h1><p>虽然sbt不是后缀平衡树，后缀平衡树现在也不能完全取代后缀数组，后缀自动机在很多方面也可以碾压平衡树然而它是一颗冉冉升起的红星，给予了后缀新的可能性。<br>今后的路需要在座的各位一起去开辟。<br><img src="http://img.blog.csdn.net/20170603154713698?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/后缀平衡树-后缀-平衡树-treap/">后缀平衡树 后缀 平衡树 treap</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/05/29/搜索专题/">
      搜索专题
    </a>
  </h2>
  
  <time>
    May 29, 2017
  </time>
  <section class="content">
	  <p>今天胡老说考搜索就是考暴力，没有分的就不用来了，结果最后。。。<br>我是唯一有分的，GG。<br>第三道题太难了，我就不写了。。。</p>
<h1 id="魔法数字"><a href="#魔法数字" class="headerlink" title="魔法数字"></a>魔法数字</h1><p><img src="http://img.blog.csdn.net/20170529195825244?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>（A.pas/.c/.cpp）<br>时间限制：1.0s，空间限制131072 KB<br>题目描述：<br>给一个六位数A 和另外一个六位数B.<br>你有一根魔法棒，初始时指向A 的最左边数字，每一次你可以选择下列操作<br>之一：<br>1.将当前魔杖指向的数字与最左端的一个数字调换位置。<br>2.将当前魔杖指向的数字与最右端的一个数字调换位置。<br>3.将当前魔杖指向的数字+1。(若当前魔杖指向的数字为9 则无效)<br>4.将当前魔杖指向的数字−1。(若当前魔杖指向的数字为0 则无效)<br>5.将当前魔杖向右移动一位。<br>6.将当前魔杖向左移动一位。<br>输入描述：<br>多组数据，处理到EOF<br>对于每组数据，包含两个6 位数A,B<br>输出描述：<br>对于每组数据，输出一行表示答案..</p>
<blockquote>
<p>样例输入：<br>1<br>123456 654321<br>样例输出：<br>11</p>
</blockquote>
<p>数据范围：<br>100%的数据保证：1 &lt;= 数据组数 &lt;= 200</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>直接暴力搜索所有数字？不可行<br>只需要考虑这些数字在哪些位置是否出现过，6^6状态</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1000005</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> HASH=<span class="number">1428571</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> k,v;</div><div class="line">	<span class="keyword">bool</span> a[<span class="number">6</span>];</div><div class="line">&#125;q[maxn];</div><div class="line"><span class="keyword">int</span> vis[HASH+<span class="number">1</span>],v[maxn],tennum[<span class="number">8</span>]=&#123;<span class="number">1000000</span>&#125;,sum[<span class="number">8</span>],num[<span class="number">8</span>],a,b,head,tail,LM;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> h=q[u].v%HASH,t=vis[h];</div><div class="line">	<span class="keyword">while</span>(t!=<span class="number">-1</span>)&#123;</div><div class="line">		<span class="keyword">if</span>(q[u].v==q[t].v)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		t=v[t];</div><div class="line">	&#125;</div><div class="line">	v[u]=vis[h],vis[h]=u;	</div><div class="line">	<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">FH</span><span class="params">(data u,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line">	q[tail].k=u.k+<span class="number">1</span>,q[tail++].a[k]=<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">FS</span><span class="params">(<span class="keyword">int</span> f,<span class="keyword">int</span> k,<span class="keyword">int</span> id,data u)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(f)&#123;</div><div class="line">        q[tail]=u;</div><div class="line">     	<span class="keyword">int</span> t=num[k],v=<span class="number">0</span>;num[k]=num[id],num[id]=t;</div><div class="line">     	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">6</span>;++i)v+=num[i]*tennum[i];</div><div class="line">   	    q[tail].v=v;</div><div class="line">   	    <span class="keyword">if</span>(judge(tail))FH(u,k);</div><div class="line">  	   	num[id]=num[k],num[k]=t;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">FT</span><span class="params">(<span class="keyword">int</span> f,data p,<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	q[tail]=p;</div><div class="line">	<span class="keyword">int</span> v=LM+f;</div><div class="line">	q[tail].v=v;</div><div class="line">	<span class="keyword">if</span>(judge(tail))FH(p,u+f);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</div><div class="line">	head=<span class="number">0</span>,tail=<span class="number">1</span>;</div><div class="line">	judge(head);</div><div class="line">	<span class="keyword">while</span>(head&lt;tail)&#123;</div><div class="line">		data p=q[head++];</div><div class="line">		LM=p.v;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">6</span>;i&gt;=<span class="number">0</span>;--i)num[i]=p.v%<span class="number">10</span>,p.v/=<span class="number">10</span>;</div><div class="line">		<span class="keyword">int</span> u=num[<span class="number">6</span>],f;</div><div class="line">		f=<span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>((!num[u])||(!u))f=<span class="number">0</span>;</div><div class="line">		FS(f,<span class="number">0</span>,u,p);</div><div class="line">		f=<span class="number">1</span>;</div><div class="line">		<span class="keyword">if</span>(((!num[<span class="number">5</span>])&amp;&amp;(!u))||u==<span class="number">5</span>)f=<span class="number">0</span>;</div><div class="line">		FS(f,<span class="number">5</span>,u,p);</div><div class="line">		<span class="keyword">if</span>(u&lt;<span class="number">5</span>)FT(<span class="number">1</span>,p,u);</div><div class="line">		<span class="keyword">if</span>(u) FT(<span class="number">-1</span>,p,u);</div><div class="line">	&#125;</div><div class="line"> 	<span class="keyword">return</span> tail;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"A.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"A.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">6</span>;++i)</div><div class="line">		tennum[i]=tennum[i<span class="number">-1</span>]/<span class="number">10</span>;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b)!=EOF)&#123;</div><div class="line">		<span class="built_in">memset</span>(vis,<span class="number">-1</span>,<span class="keyword">sizeof</span>(vis));</div><div class="line">		<span class="built_in">memset</span>(q[<span class="number">0</span>].a,<span class="number">0</span>,<span class="keyword">sizeof</span>(q[<span class="number">0</span>].a));</div><div class="line">		q[<span class="number">0</span>].v=a*<span class="number">10</span>,q[<span class="number">0</span>].k=<span class="number">0</span>,q[<span class="number">0</span>].a[<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">5</span>;i&gt;=<span class="number">0</span>;--i)sum[i]=b%<span class="number">10</span>,b/=<span class="number">10</span>;</div><div class="line">		<span class="keyword">int</span> res=bfs(),ans=<span class="number">999999</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;res;++i)&#123;</div><div class="line">			q[i].v/=<span class="number">10</span>;</div><div class="line">			<span class="keyword">int</span> num[<span class="number">6</span>],rez=q[i].k;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">5</span>;j&gt;=<span class="number">0</span>;--j)&#123;</div><div class="line">				num[j]=q[i].v%<span class="number">10</span>;</div><div class="line">				q[i].v/=<span class="number">10</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">6</span>;++k)</div><div class="line">				<span class="keyword">if</span>(sum[k]!=num[k]&amp;&amp;!q[i].a[k])&#123;</div><div class="line">		  			rez=<span class="number">999999</span>;<span class="keyword">break</span>;</div><div class="line">		  		&#125;<span class="keyword">else</span> rez+=((sum[k]-num[k])&gt;<span class="number">0</span>?(sum[k]-num[k]):-(sum[k]-num[k]));</div><div class="line">			ans=ans&gt;rez?rez:ans;</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="BitMask"><a href="#BitMask" class="headerlink" title="BitMask"></a>BitMask</h1><p>（B.pas/.c/.cpp）<br><img src="http://img.blog.csdn.net/20170529195901495?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>时间限制： 3.0s，空间限制 131072 KB<br>题目描述：<br>给出 2 x n的方格，每个方格初始都没有颜色，每次你可以选择其中一矩形区域，将其涂成某个颜色 C，现给出最终状态，请问少需要多步能到达 最终状态？<br>输入描述：<br>输入第一行为一个整数T，表示数据组数<br>对于每组数据输入的第一行表示n( 1 &lt;= n &lt;= 8 )，接下来 2行，每个一长度n的字符串，保证字符串只包含大写字母<br>输出描述：<br>对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 对于每组数据，输出一行表示答案 。<br>样例输入：<br>3<br>3<br>ABA<br>CBC<br>3<br>BAA<br>CCB<br>3<br>BBB<br>BAB<br>样例输出：<br>3<br>3<br>2<br>数据范围：<br>50%的数据保证： 1 &lt;= T &lt;= 200且 n是随机产生的 是随机产生的<br>50%的数据保证： 1 &lt;= T &lt;= 25 且 n 为 8</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>直接暴力BFS即可，每次抽取一个矩形进行位运算即可</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,x,y) for(register int i=x;i&lt;y;++i)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CM(x,v) memset((x),v,sizeof(x))</span></div><div class="line"><span class="keyword">char</span> mp[<span class="number">3</span>][<span class="number">10</span>];</div><div class="line"><span class="keyword">bool</span> vis[<span class="number">27</span>];</div><div class="line"><span class="keyword">int</span> t,n,m,head,tail,tot,u,v,dis[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],Q[<span class="number">1</span>&lt;&lt;<span class="number">19</span>]; </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    CM(dis,<span class="number">-1</span>);</div><div class="line">    head=tail=dis[x]=<span class="number">0</span>;</div><div class="line">    Q[tail++]=x;</div><div class="line">    <span class="keyword">while</span>(head!=tail)&#123;</div><div class="line">        u=Q[head++];</div><div class="line">        rep(F1,<span class="number">0</span>,n)rep(F2,F1,n)rep(F3,<span class="number">0</span>,<span class="number">2</span>)rep(F4,F3,<span class="number">2</span>)&#123;</div><div class="line">            CM(vis,<span class="number">0</span>),tot=<span class="number">0</span>;</div><div class="line">            rep(i,F3,F4+<span class="number">1</span>)rep(j,F1,F2+<span class="number">1</span>)&#123;</div><div class="line">            	<span class="keyword">if</span>(tot&gt;<span class="number">1</span>)<span class="keyword">break</span>;</div><div class="line">            	<span class="keyword">if</span>((u&amp;(<span class="number">1</span>&lt;&lt;(i*n+j))))<span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span>(!vis[mp[i][j]-<span class="string">'A'</span>])++tot,vis[mp[i][j]-<span class="string">'A'</span>]=<span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(tot==<span class="number">1</span>)&#123;</div><div class="line">                v=u;</div><div class="line">                rep(i,F3,F4+<span class="number">1</span>)rep(j,F1,F2+<span class="number">1</span>)v|=<span class="number">1</span>&lt;&lt;(i*n+j);</div><div class="line">                <span class="keyword">if</span>(dis[v]==<span class="number">-1</span>)&#123;</div><div class="line">                    dis[v]=dis[u]+<span class="number">1</span>;</div><div class="line">                    <span class="keyword">if</span>(v==m)<span class="keyword">return</span>;</div><div class="line">                    <span class="keyword">if</span>(dis[v]&lt;(n&lt;&lt;<span class="number">1</span>))Q[tail++]=v;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">    	&#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;T flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)res=res*<span class="number">10</span>+ch<span class="number">-48</span>;res*=flag;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readst</span><span class="params">(<span class="keyword">char</span> x[])</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> len=<span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'A'</span>||ch&gt;<span class="string">'Z'</span>);x[len++]=ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'A'</span>&amp;&amp;ch&lt;=<span class="string">'Z'</span>)x[len++]=ch;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"B.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"B.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    readin(t);</div><div class="line">    <span class="keyword">while</span>(t--)&#123;</div><div class="line">        readin(n),readst(mp[<span class="number">0</span>]),readst(mp[<span class="number">1</span>]);</div><div class="line">        m=(<span class="number">1</span>&lt;&lt;(n&lt;&lt;<span class="number">1</span>))<span class="number">-1</span>,bfs(<span class="number">0</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,dis[m]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="BruteForce"><a href="#BruteForce" class="headerlink" title="BruteForce"></a>BruteForce</h1><p><img src="http://img.blog.csdn.net/20170529195923823?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170529195530524?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>只有一组测试数据，保证 T&lt;= 10且 n=12的数据不超过 2组， n=11的数据不的数据不的数据不超过2组</p>
<h1 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h1><p>首先暴力的求出环的方案数<br>之后暴力枚举环之后缩点用Matrix-Tree定理计算生成树即可</p>
<h1 id="没有code"><a href="#没有code" class="headerlink" title="没有code"></a>没有code</h1><blockquote>
<p>MARK一下MARIX—TREE</p>
</blockquote>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/搜索/">搜索</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/05/20/最强平衡树——Treap-以我的最弱战胜你的最强/">
      最强平衡树——Treap[以我的最弱战胜你的最强]
    </a>
  </h2>
  
  <time>
    May 20, 2017
  </time>
  <section class="content">
	  <h2 id="仆の最弱を以て，君の最强を打ち破る。！！——Treap"><a href="#仆の最弱を以て，君の最强を打ち破る。！！——Treap" class="headerlink" title="仆の最弱を以て，君の最强を打ち破る。！！——Treap"></a>仆の最弱を以て，君の最强を打ち破る。！！——Treap</h2><p><img src="http://res.moe.netease.com/pc/gw/20161108122825/img/hero/yx5_c069ff3.png" alt=""><br>本人蒟蒻，在平衡树坑中深陷数年。为了早日逃离此天坑，特作此文。</p>
<p>什么是平衡树?<a href="http://baike.baidu.com/link?url=4GYDSGCx6M6cZ2dRHuT0N7qGLghtgWXesG4MDie_HSyXiQydGVj8N2dXu1uyNRRFkDP2MendVCyBcZxusOSbJQuewukqV-GEgmVfUoaGaKm-_WE0lTfFP8Frs4Ug1L7f" target="_blank" rel="external">度娘传送门</a><br>什么是treap？<a href="http://blog.csdn.net/acdreamers/article/details/11309971" target="_blank" rel="external">ACdreamers%%%</a><br>注：本篇所有代码都在片尾！！<strong>（醒目）</strong></p>
<hr>
<h1 id="CMP"><a href="#CMP" class="headerlink" title="CMP"></a>CMP</h1><p>那么了解了这些，我们先列出一个list<br>NAME    优势    劣势<br>splay    LCT，序列之王    常数大，代码量稍大<br>RBT    自适应深度平衡树，速度在同类BST中遥遥领先    代码量大<br>SBT    代码简短，速度快，（退化版很好写）    功能平平，（退化版会被人字梯数据卡掉）</p>
<p>大体上来说，treap的敌人多为这三类。我们逆着证明treap是最强的。</p>
<h1 id="TREAP-VS-SBT"><a href="#TREAP-VS-SBT" class="headerlink" title="TREAP VS SBT"></a>TREAP VS SBT</h1><p>就以常数来说，sbt与treap的常数皆为12左右，当然以数学证明\(log_n\)<br>sbt的常数肯定要比用期望\(log_n\)的treap要稳很多，但是就我们平时直观所感觉的速度差，大多是因为<strong>rand()</strong>调用太耗时，所以解决此问题可以这样</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">random</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> seed=<span class="number">703</span>; <span class="comment">//seed可以随便取</span></div><div class="line">    <span class="keyword">return</span> seed=<span class="keyword">int</span>(seed*<span class="number">48271L</span>L%<span class="number">2147483647</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以数学的方法快速取得rand值 <a href="http://blog.csdn.net/h348592532/article/details/52837228" target="_blank" rel="external">相关链接</a></p>
<p>这样一来比较不加读优，sbt为260ms+，treap为360ms+，速度已经很相近了。。。并且由于treap比sbt多一个rd数组存rand值，能有70%左右的速度已经非常可观了，但这不是重点。</p>
<p>Treap真正能够超越sbt的在于可以<strong>快速分裂与合并</strong>，这是sbt很难做到的，而且一旦去做，就必定会加入Father指针，这样会拖慢sbt旋转的速度。<br>详见<a href="http://blog.csdn.net/xianxingwuguan1/article/details/20630181" target="_blank" rel="external">代码 HERE</a></p>
<h1 id="TREAP-VS-RBT"><a href="#TREAP-VS-RBT" class="headerlink" title="TREAP VS RBT"></a>TREAP VS RBT</h1><p>这可能是treap最大的敌人，速度足够碾压刚刚还得瑟的SBT（cqf的论文中虽然号称比AVL快[实际情况我还没有试过]，但是不敢说比RBT快），STL中set，map这些常用类型的底层实现方式。<br>这就是让人<strong>恐惧并无法自拔（？）</strong>的RBT（红黑树）！！<br>那么这么强大的平衡树，为什么区区一介treap敢于挑战？<br>在与。。。还记得我对RBT的描述吗？<strong>深度平衡树</strong><br>那么就用你的优势成为你失败的伏笔！！！<br>引出重量级</p>
<p>##<strong>重量平衡树与后缀平衡树</strong> <a href="http://www.docin.com/p-649133451.html" target="_blank" rel="external">丽洁姐的论文</a><br>可以发现能够支撑起平衡树向字符串领域进军的，就是treap！！<br>复杂度在加入了一个类似于线段树的结构后并没有改变 \(log_n\)呢！暂且不论跳表的普及型以及删除时的恶心程度，一般非确定型跳表的空间复杂的是高于树形结构的BST的，其次跳表根本不是主流吧！！然后替罪羊树比起treap来说要难写一点（毕竟要重建笛卡尔树。。）<br>综上，treap可以完成许多深度平衡树（AVL、RBT）（SBT算什么？）无法做到的效果。</p>
<h1 id="TREAP-VS-SPLAY"><a href="#TREAP-VS-SPLAY" class="headerlink" title="TREAP VS SPLAY"></a>TREAP VS SPLAY</h1><p>首先分裂与合并已经在讨论sbt时解决了，再者splay的常数又是在平衡数中排得上名号的（大根堆），单旋<strong>spaly</strong>直接被链式数据卡死，所以splay只有在序列与LCT上称王称霸。<a href="http://www.cnblogs.com/BLADEVIL/p/3510997.html" target="_blank" rel="external">LCT有关</a><br>但真的是这样吗?<br>谈谈Treap与LCT，既然都能不旋转来分裂合并了，那么LCT自然是手到擒来。<a href="http://www.cnblogs.com/SymenYang/p/3721833.html" target="_blank" rel="external">LCT例子</a><br>CDQZ本部的几个大神就是LCT只打treap。<br>所以splay能得瑟的就是<strong>序列之王</strong>这个名号了！<br>光速打脸 <a href="http://blog.csdn.net/d891320478/article/details/8801402" target="_blank" rel="external">NOI2005 维护数列</a><br>呵呵，虽然分裂合并式的Treap，速度慢，但是代码很好写，毕竟靠随机值无脑合并分裂啊。</p>
<h1 id="结论（彩蛋？）"><a href="#结论（彩蛋？）" class="headerlink" title="结论（彩蛋？）"></a>结论（彩蛋？）</h1><p>的确，treap在速度上输给了sbt、rbt（远远地），代码量上也仅仅与sbt持平（基础部分不到40行），分裂合并的常数值也比splay大。。<br>（观众：好像一无是处耶？）<br>但是treap反向证明了它自己可以做到那么多不同平衡树自己独具特点的功能，就好比金庸集各家之大成，虽未超越，但单单地将其聚合起来也足以称王了。<br>从重量平衡引申出的后缀平衡树，非旋转式引出分裂与合并，treap很弱，因为它不完整（从定义上就不完整），但也正是如此他对于OIer来说不是如RBT般的神，splay般的功能强大，sbt般的简洁飞速，所以它需要成长，对于没一点常数的争取，对于自身结构的改变，以及。。。。。本文最后的彩蛋！！</p>
<h1 id="可持久化平衡树"><a href="#可持久化平衡树" class="headerlink" title="可持久化平衡树"></a>可持久化平衡树</h1><p>这是多少OIer在可持久化treap发明前学平衡树的心结，那么强大的平衡树为什么没有能简单可持久化的方式呢？直到可持久化treap横空出世，震惊全球（夸张。），多少代OIer的愿望通过treap残缺的美在此得以实现。</p>
<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><h3 id="普普通通的treap——rand-优化后"><a href="#普普通通的treap——rand-优化后" class="headerlink" title="普普通通的treap——rand()优化后"></a>普普通通的treap——rand()优化后</h3><p>bzoj3224 普通平衡树<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> l,r,v,size,rnd,w;</div><div class="line">&#125;tr[<span class="number">100005</span>];</div><div class="line"><span class="keyword">int</span> n,size,root,ans;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">randad</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> seed=<span class="number">703</span>; <span class="comment">//seed可以随便取</span></div><div class="line">    <span class="keyword">return</span> seed=<span class="keyword">int</span>(seed*<span class="number">48271L</span>L%<span class="number">2147483647</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> k)</span><span class="comment">//更新结点信息</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    tr[k].size=tr[tr[k].l].size+tr[tr[k].r].size+tr[k].w;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rturn</span><span class="params">(<span class="keyword">int</span> &amp;k)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">int</span> t=tr[k].l;tr[k].l=tr[t].r;tr[t].r=k;</div><div class="line">    tr[t].size=tr[k].size;update(k);k=t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">lturn</span><span class="params">(<span class="keyword">int</span> &amp;k)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">int</span> t=tr[k].r;tr[k].r=tr[t].l;tr[t].l=k;</div><div class="line">    tr[t].size=tr[k].size;update(k);k=t;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        size++;k=size;</div><div class="line">        tr[k].size=tr[k].w=<span class="number">1</span>;tr[k].v=x;tr[k].rnd=randad();</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    tr[k].size++;</div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)tr[k].w++;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">    &#123;</div><div class="line">        insert(tr[k].r,x);</div><div class="line">        <span class="keyword">if</span>(tr[tr[k].r].rnd&lt;tr[k].rnd)lturn(k);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        insert(tr[k].l,x);</div><div class="line">        <span class="keyword">if</span>(tr[tr[k].l].rnd&lt;tr[k].rnd)rturn(k);</div><div class="line">    &#125; </div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>; </div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span>(tr[k].w&gt;<span class="number">1</span>)</div><div class="line">        &#123;</div><div class="line">            tr[k].w--;tr[k].size--;<span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(tr[k].l*tr[k].r==<span class="number">0</span>)k=tr[k].l+tr[k].r;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tr[tr[k].l].rnd&lt;tr[tr[k].r].rnd)</div><div class="line">            rturn(k),del(k,x);</div><div class="line">        <span class="keyword">else</span> lturn(k),del(k,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">        tr[k].size--,del(tr[k].r,x);</div><div class="line">    <span class="keyword">else</span> tr[k].size--,del(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_rank</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v==x)<span class="keyword">return</span> tr[tr[k].l].size+<span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[k].v)</div><div class="line">        <span class="keyword">return</span> tr[tr[k].l].size+tr[k].w+query_rank(tr[k].r,x);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> query_rank(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query_num</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(x&lt;=tr[tr[k].l].size)</div><div class="line">        <span class="keyword">return</span> query_num(tr[k].l,x);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x&gt;tr[tr[k].l].size+tr[k].w)</div><div class="line">        <span class="keyword">return</span> query_num(tr[k].r,x-tr[tr[k].l].size-tr[k].w);</div><div class="line">    <span class="keyword">else</span> <span class="keyword">return</span> tr[k].v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_pro</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v&lt;x)</div><div class="line">    &#123;</div><div class="line">        ans=k;query_pro(tr[k].r,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> query_pro(tr[k].l,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">query_sub</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k==<span class="number">0</span>)<span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span>(tr[k].v&gt;x)</div><div class="line">    &#123;</div><div class="line">        ans=k;query_sub(tr[k].l,x);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> query_sub(tr[k].r,x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">    <span class="keyword">int</span> opt,x;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;opt,&amp;x);</div><div class="line">        <span class="keyword">switch</span>(opt)</div><div class="line">        &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>:insert(root,x);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">2</span>:del(root,x);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">3</span>:<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query_rank(root,x));<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">4</span>:<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query_num(root,x));<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">5</span>:ans=<span class="number">0</span>;query_pro(root,x);<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tr[ans].v);<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="number">6</span>:ans=<span class="number">0</span>;query_sub(root,x);<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,tr[ans].v);<span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="序列treap"><a href="#序列treap" class="headerlink" title="序列treap"></a>序列treap</h3><p>BZOJ1500 维护数列<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2000000000  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010  </span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>;</span>  </div><div class="line">Node *null,*root;  </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>  </span></div><div class="line"><span class="class">&#123;</span>  </div><div class="line">    <span class="keyword">int</span> w,sz,val,sum,ls,rs,ss,lzy1,lzy2;  </div><div class="line">    Node *lft,*rht;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(<span class="keyword">int</span>,Node*&amp;,Node*&amp;)</span></span>;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">same</span><span class="params">(<span class="keyword">int</span> v)</span>  </span></div><div class="line"><span class="function">    </span>&#123;  </div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>==null) <span class="keyword">return</span>;  </div><div class="line">        lzy2=val=v;  </div><div class="line">        sum=v*sz;  </div><div class="line">        ls=rs=ss=max(sum,v);  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rev</span><span class="params">()</span>  </span></div><div class="line"><span class="function">    </span>&#123;  </div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>==null) <span class="keyword">return</span>;  </div><div class="line">        lzy1^=<span class="number">1</span>;  </div><div class="line">        swap(lft,rht);  </div><div class="line">        swap(ls,rs);  </div><div class="line">    &#125;  </div><div class="line">    <span class="function">Node *<span class="title">pushup</span><span class="params">()</span>  </span></div><div class="line"><span class="function">    </span>&#123;  </div><div class="line">        sz=lft-&gt;sz+<span class="number">1</span>+rht-&gt;sz;  </div><div class="line">        sum=lft-&gt;sum+val+rht-&gt;sum;  </div><div class="line">     </div><div class="line">        ls=max(lft-&gt;ls,lft-&gt;sum+val+max(<span class="number">0</span>,rht-&gt;ls));  </div><div class="line">        rs=max(rht-&gt;rs,rht-&gt;sum+val+max(<span class="number">0</span>,lft-&gt;rs));  </div><div class="line">     </div><div class="line">        ss=max(<span class="number">0</span>,lft-&gt;rs)+val+max(<span class="number">0</span>,rht-&gt;ls);  </div><div class="line">        ss=max(ss,max(lft-&gt;ss,rht-&gt;ss));  </div><div class="line">     </div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function">Node *<span class="title">pushdown</span><span class="params">()</span>  </span></div><div class="line"><span class="function">    </span>&#123;  </div><div class="line">        <span class="keyword">if</span>(lzy1)  </div><div class="line">        &#123;  </div><div class="line">            lft-&gt;rev();  </div><div class="line">            rht-&gt;rev();  </div><div class="line">            lzy1=<span class="number">0</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">if</span>(lzy2!=-INF)  </div><div class="line">        &#123;  </div><div class="line">            lft-&gt;same(lzy2);  </div><div class="line">            rht-&gt;same(lzy2);  </div><div class="line">            lzy2=-INF;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;  </div><div class="line">    &#125;  </div><div class="line">&#125;;  </div><div class="line"><span class="function">Node *<span class="title">merge</span><span class="params">(Node *p,Node *q)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">if</span>(p==null) <span class="keyword">return</span> q;  </div><div class="line">    <span class="keyword">if</span>(q==null) <span class="keyword">return</span> p;  </div><div class="line">    <span class="keyword">if</span>(p-&gt;w&lt;q-&gt;w)  </div><div class="line">    &#123;  </div><div class="line">        p-&gt;pushdown();  </div><div class="line">        p-&gt;rht=merge(p-&gt;rht,q);  </div><div class="line">        <span class="keyword">return</span> p-&gt;pushup();  </div><div class="line">    &#125;  </div><div class="line">    q-&gt;pushdown();  </div><div class="line">    q-&gt;lft=merge(p,q-&gt;lft);  </div><div class="line">    <span class="keyword">return</span> q-&gt;pushup();  </div><div class="line">&#125;  </div><div class="line"><span class="keyword">void</span> Node::split(<span class="keyword">int</span> need,Node *&amp;p,Node *&amp;q)  </div><div class="line">&#123;  </div><div class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>==null)  </div><div class="line">    &#123;  </div><div class="line">        p=q=null;  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    pushdown();  </div><div class="line">    <span class="keyword">if</span>(lft-&gt;sz&gt;=need)  </div><div class="line">    &#123;  </div><div class="line">        lft-&gt;split(need,p,q);  </div><div class="line">        lft=null;  </div><div class="line">        pushup();  </div><div class="line">        q=merge(q,<span class="keyword">this</span>);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    rht-&gt;split(need-(lft-&gt;sz+<span class="number">1</span>),p,q);  </div><div class="line">    rht=null;  </div><div class="line">    pushup();  </div><div class="line">    p=merge(<span class="keyword">this</span>,p);  </div><div class="line">    <span class="keyword">return</span>;  </div><div class="line">&#125;  </div><div class="line">Node data[N],*pool[N];  </div><div class="line"><span class="keyword">int</span> top,cnt;  </div><div class="line"><span class="function">Node* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> c)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    Node *x;  </div><div class="line">    <span class="keyword">if</span>(top) x=pool[top--];  </div><div class="line">    <span class="keyword">else</span> x=&amp;data[cnt++];  </div><div class="line">    x-&gt;lft=x-&gt;rht=null;  </div><div class="line">    x-&gt;sz=<span class="number">1</span>; x-&gt;lzy1=<span class="number">0</span>; x-&gt;lzy2=-INF;  </div><div class="line">    x-&gt;val=x-&gt;sum=x-&gt;ls=x-&gt;rs=x-&gt;ss=c;  </div><div class="line">    x-&gt;w=rands();  </div><div class="line">    <span class="keyword">return</span> x;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    cnt=<span class="number">1</span>; top=<span class="number">0</span>;  </div><div class="line">    null=&amp;data[<span class="number">0</span>];  </div><div class="line">    null-&gt;sz=null-&gt;sum=<span class="number">0</span>;  </div><div class="line">    null-&gt;val=null-&gt;ls=null-&gt;rs=null-&gt;ss=-INF;  </div><div class="line">    null-&gt;lzy1=<span class="number">0</span>;  </div><div class="line">    null-&gt;lzy2=-INF;  </div><div class="line">    null-&gt;lft=null-&gt;rht=null;  </div><div class="line">&#125;  </div><div class="line"><span class="comment">//---------------------------------------------------------  </span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(Node *rt)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">if</span>(rt==null) <span class="keyword">return</span>;  </div><div class="line">    erase(rt-&gt;lft);  </div><div class="line">    erase(rt-&gt;rht);  </div><div class="line">    pool[++top]=rt;  </div><div class="line">&#125;  </div><div class="line"><span class="keyword">int</span> n,m;  </div><div class="line"><span class="keyword">char</span> ord[<span class="number">20</span>];  </div><div class="line"><span class="keyword">int</span> a,b,c;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">init();  </div><div class="line">        root=null;  </div><div class="line">        n=fastget();  </div><div class="line">        m=fastget();  </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)  </div><div class="line">        &#123;  </div><div class="line">            a=fastget();  </div><div class="line">            root=merge(root,newnode(a));  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">while</span> (m--)  </div><div class="line">        &#123;  </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%s"</span>,ord);  </div><div class="line">            Node *p,*q,*r,*s;  </div><div class="line">            <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'I'</span>)  </div><div class="line">            &#123;  </div><div class="line">                a=fastget();  </div><div class="line">                n=fastget();  </div><div class="line">                root-&gt;split(a,p,q);  </div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)  </div><div class="line">                &#123;  </div><div class="line">                    b=fastget();  </div><div class="line">                    p=merge(p,newnode(b));  </div><div class="line">                &#125;  </div><div class="line">                root=merge(p,q);  </div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'D'</span>)  </div><div class="line">            &#123;  </div><div class="line">                a=fastget();  </div><div class="line">                b=fastget();  </div><div class="line">                b=a+b<span class="number">-1</span>;  </div><div class="line">                root-&gt;split(a<span class="number">-1</span>,p,q);  </div><div class="line">                q-&gt;split(b-a+<span class="number">1</span>,r,s);  </div><div class="line">                erase(r);  </div><div class="line">                root=merge(p,s);  </div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'M'</span> &amp;&amp; ord[<span class="number">2</span>]==<span class="string">'K'</span>)  </div><div class="line">            &#123;  </div><div class="line">                a=fastget();  </div><div class="line">                b=fastget();  </div><div class="line">                c=fastget();  </div><div class="line">                b=b+a<span class="number">-1</span>;  </div><div class="line">                root-&gt;split(a<span class="number">-1</span>,p,q);  </div><div class="line">                q-&gt;split(b-a+<span class="number">1</span>,r,s);  </div><div class="line">                r-&gt;same(c);  </div><div class="line">                root=merge(p,merge(r,s));  </div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'R'</span>)  </div><div class="line">            &#123;  </div><div class="line">                a=fastget();  </div><div class="line">                b=fastget();  </div><div class="line">                b=b+a<span class="number">-1</span>;  </div><div class="line">                root-&gt;split(a<span class="number">-1</span>,p,q);  </div><div class="line">                q-&gt;split(b-a+<span class="number">1</span>,r,s);  </div><div class="line">                r-&gt;rev();  </div><div class="line">                root=merge(p,merge(r,s));  </div><div class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'G'</span>)  </div><div class="line">            &#123;  </div><div class="line">                a=fastget();  </div><div class="line">                b=fastget();  </div><div class="line">                b=a+b<span class="number">-1</span>;  </div><div class="line">                root-&gt;split(a<span class="number">-1</span>,p,q);  </div><div class="line">                q-&gt;split(b-a+<span class="number">1</span>,r,s);  </div><div class="line">                fastput(r-&gt;sum);  </div><div class="line">                root=merge(p,merge(r,s));  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ord[<span class="number">0</span>]==<span class="string">'M'</span>) fastput(root-&gt;ss);  </div><div class="line">        &#125;  </div><div class="line">        </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="重量平衡树-amp-后缀平衡树"><a href="#重量平衡树-amp-后缀平衡树" class="headerlink" title="重量平衡树&amp;后缀平衡树"></a>重量平衡树&amp;后缀平衡树</h3><p>BZOJ 3682: Phorni<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;T flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)res=(res&lt;&lt;<span class="number">1</span>)+(res&lt;&lt;<span class="number">3</span>)+ch<span class="number">-48</span>;res*=flag;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 500010</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></div><div class="line"><span class="keyword">int</span> n,m,len,type,lastans,x,y;</div><div class="line"><span class="keyword">int</span> ch[N][<span class="number">2</span>],rd[N],cl[N],cnt,root;</div><div class="line">LL rk[N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">randlmy</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">int</span> seed=<span class="number">173</span>;</div><div class="line">    <span class="keyword">return</span> seed=<span class="keyword">int</span>(seed*<span class="number">48271L</span>L%<span class="number">2147483647</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> cl[x]&lt;cl[y]||(cl[x]==cl[y]&amp;&amp;rk[x<span class="number">-1</span>]&lt;rk[y<span class="number">-1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rebuild</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!rt)<span class="keyword">return</span>;</div><div class="line">	rk[rt]=l+r;</div><div class="line">	LL mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	rebuild(ch[rt][<span class="number">0</span>],l,mid);</div><div class="line">	rebuild(ch[rt][<span class="number">1</span>],mid,r);</div><div class="line">	</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> &amp;p,<span class="keyword">int</span> d,LL l,LL r)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> q=ch[p][d^<span class="number">1</span>];</div><div class="line">	ch[p][d^<span class="number">1</span>]=ch[q][d];</div><div class="line">	ch[q][d]=p;</div><div class="line">	p=q;</div><div class="line">	rebuild(p,l,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> &amp;rt,LL l,LL r)</span></span>&#123;</div><div class="line">	LL mid=(r+l)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(!rt)&#123;rt=cnt;rk[rt]=l+r;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">if</span>(cmp(cnt,rt))&#123;insert(ch[rt][<span class="number">0</span>],l,mid);<span class="keyword">if</span>(rd[ch[rt][<span class="number">0</span>]]&gt;rd[rt])rotate(rt,<span class="number">1</span>,l,r);&#125;</div><div class="line">    <span class="keyword">else</span>&#123;insert(ch[rt][<span class="number">1</span>],mid,r);<span class="keyword">if</span>(rd[ch[rt][<span class="number">1</span>]]&gt;rd[rt])rotate(rt,<span class="number">0</span>,l,r);&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	cl[++cnt]=v;</div><div class="line">	rd[cnt]=randlmy()*randlmy();</div><div class="line">	insert(root,<span class="number">1</span>,<span class="number">1L</span>L&lt;&lt;<span class="number">61</span>);</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> R(rt) rt&lt;&lt;1|1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> L(rt) rt&lt;&lt;1</span></div><div class="line"><span class="keyword">int</span> minn[N&lt;&lt;<span class="number">2</span>],p[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)read(p[l]),minn[rt]=l;</div><div class="line">	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">		build(lc,l,mid);</div><div class="line">		build(rc,mid+<span class="number">1</span>,r);</div><div class="line">		minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> id)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(id&lt;=mid)updata(lc,l,mid,id);</div><div class="line">	<span class="keyword">else</span> updata(rc,mid+<span class="number">1</span>,r,id);</div><div class="line">	minn[rt]=rk[p[minn[lc]]]&lt;=rk[p[minn[rc]]]?minn[lc]:minn[rc];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> ql,<span class="keyword">int</span> qr)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(ql&lt;=l&amp;&amp;r&lt;=qr)<span class="keyword">return</span> minn[rt];</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>,lc=L(rt),rc=R(rt);</div><div class="line">	<span class="keyword">if</span>(qr&lt;=mid)<span class="keyword">return</span> query(lc,l,mid,ql,qr);</div><div class="line">	<span class="keyword">if</span>(ql&gt;mid)<span class="keyword">return</span> query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">int</span> vl=query(lc,l,mid,ql,qr),vr=query(rc,mid+<span class="number">1</span>,r,ql,qr);</div><div class="line">	<span class="keyword">return</span> rk[p[vl]]&lt;=rk[p[vr]]?vl:vr;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> s[N],cmd[<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	read(n),read(m),read(len),read(type);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=len;i++)</div><div class="line">		insert(s[len-i]-<span class="string">'a'</span>);</div><div class="line">	build(<span class="number">1</span>,<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%s"</span>,cmd);</div><div class="line">		<span class="keyword">if</span>(!type)lastans=<span class="number">0</span>;</div><div class="line">		<span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'I'</span>)</div><div class="line">			read(x),insert(x^lastans),++len;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(cmd[<span class="number">0</span>]==<span class="string">'C'</span>)</div><div class="line">			read(x),read(p[x]),updata(<span class="number">1</span>,<span class="number">1</span>,n,x);</div><div class="line">		<span class="keyword">else</span></div><div class="line">			read(x),read(y),</div><div class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,lastans=query(<span class="number">1</span>,<span class="number">1</span>,n,x,y));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="可持久化Treap"><a href="#可持久化Treap" class="headerlink" title="可持久化Treap"></a>可持久化Treap</h3><p>POJ 3580 SuperMemo<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;  </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;  </span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;  </div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">treap_node</span>&#123;</span>  </div><div class="line">    treap_node *left,*right;  </div><div class="line">    <span class="keyword">int</span> val,fix,size,wgt,minn,adel,rdel;  </div><div class="line">    treap_node(<span class="keyword">int</span> val): val(val) &#123;left=right=<span class="literal">NULL</span>; fix=rand(); wgt=size=<span class="number">1</span>; minn=val; rdel=adel=<span class="number">0</span>; &#125;  </div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">lsize</span><span class="params">()</span>  </span></div><div class="line"><span class="function">      </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (left)  </div><div class="line">          <span class="keyword">return</span> left-&gt;size;  </div><div class="line">        <span class="keyword">else</span>   </div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">      &#125;  </div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">rsize</span><span class="params">()</span>  </span></div><div class="line"><span class="function">      </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (right)  </div><div class="line">          <span class="keyword">return</span> right-&gt;size;  </div><div class="line">        <span class="keyword">else</span>  </div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">      &#125;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span>  </span></div><div class="line"><span class="function">      </span>&#123;  </div><div class="line">        minn=val;  </div><div class="line">        <span class="keyword">if</span> (left)  </div><div class="line">          minn=min(minn,left-&gt;minn+left-&gt;adel);  </div><div class="line">        <span class="keyword">if</span> (right)  </div><div class="line">          minn=min(minn,right-&gt;minn+right-&gt;adel);  </div><div class="line">      &#125;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span>  </span></div><div class="line"><span class="function">      </span>&#123;  </div><div class="line">        treap_node *temp;  </div><div class="line">        <span class="keyword">if</span> (adel)  </div><div class="line">          &#123;  </div><div class="line">            minn+=adel;  </div><div class="line">            val+=adel;  </div><div class="line">            <span class="keyword">if</span> (left)  </div><div class="line">              left-&gt;adel+=adel;  </div><div class="line">            <span class="keyword">if</span> (right)  </div><div class="line">              right-&gt;adel+=adel;  </div><div class="line">            adel=<span class="number">0</span>;  </div><div class="line">          &#125;  </div><div class="line">        <span class="keyword">if</span> (rdel%<span class="number">2</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="keyword">if</span> (left==<span class="literal">NULL</span>||right==<span class="literal">NULL</span>)  </div><div class="line">              &#123;  </div><div class="line">                <span class="keyword">if</span> (left==<span class="literal">NULL</span>)  </div><div class="line">                  &#123;  </div><div class="line">                    left=right;  </div><div class="line">                    right=<span class="literal">NULL</span>;  </div><div class="line">                  &#125;  </div><div class="line">                <span class="keyword">else</span>  </div><div class="line">                  &#123;  </div><div class="line">                    right=left;  </div><div class="line">                    left=<span class="literal">NULL</span>;  </div><div class="line">                  &#125;  </div><div class="line">              &#125;  </div><div class="line">            <span class="keyword">else</span>  </div><div class="line">              &#123;  </div><div class="line">                temp=left;  </div><div class="line">                left=right;  </div><div class="line">                right=temp;  </div><div class="line">              &#125;  </div><div class="line">            <span class="keyword">if</span> (left)  </div><div class="line">            left-&gt;rdel+=rdel;  </div><div class="line">            <span class="keyword">if</span> (right)  </div><div class="line">            right-&gt;rdel+=rdel;  </div><div class="line">            rdel=<span class="number">0</span>;  </div><div class="line">          &#125;  </div><div class="line">        updata();  </div><div class="line">      &#125;  </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Maintain</span><span class="params">()</span>  </span></div><div class="line"><span class="function">      </span>&#123;  </div><div class="line">        size=wgt;  </div><div class="line">        size+=lsize()+rsize();  </div><div class="line">      &#125;  </div><div class="line">&#125;;  </div><div class="line"><span class="keyword">int</span> n,m;  </div><div class="line">treap_node *root;  </div><div class="line"><span class="keyword">typedef</span> pair&lt;treap_node*,treap_node*&gt; droot;  </div><div class="line"><span class="function">treap_node *<span class="title">merge</span><span class="params">(treap_node *a,treap_node *b)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">if</span> (!a) <span class="keyword">return</span> b;  </div><div class="line">    <span class="keyword">if</span> (!b) <span class="keyword">return</span> a;  </div><div class="line">    a-&gt;pushdown(); b-&gt;pushdown();  </div><div class="line">    a-&gt;updata(); b-&gt;updata();  </div><div class="line">    <span class="keyword">if</span> (a-&gt;fix&lt;b-&gt;fix)  </div><div class="line">      &#123;  </div><div class="line">        a-&gt;right=merge(a-&gt;right,b);  </div><div class="line">        a-&gt;updata();  </div><div class="line">        a-&gt;Maintain();  </div><div class="line">        <span class="keyword">return</span> a;  </div><div class="line">      &#125;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">      &#123;  </div><div class="line">        b-&gt;left=merge(a,b-&gt;left);  </div><div class="line">        b-&gt;updata();  </div><div class="line">        b-&gt;Maintain();  </div><div class="line">        <span class="keyword">return</span> b;  </div><div class="line">      &#125;   </div><div class="line">&#125;  </div><div class="line"><span class="function">droot <span class="title">split</span><span class="params">(treap_node *a,<span class="keyword">int</span> k)</span>  </span></div><div class="line"><span class="function"></span>&#123;   </div><div class="line">    <span class="keyword">if</span> (!a) <span class="keyword">return</span> droot(<span class="literal">NULL</span>,<span class="literal">NULL</span>);  </div><div class="line">    droot y;  </div><div class="line">    a-&gt;pushdown();   a-&gt;updata();  </div><div class="line">    <span class="keyword">if</span> (a-&gt;lsize()&gt;=k)  </div><div class="line">      &#123;  </div><div class="line">        y=split(a-&gt;left,k);  </div><div class="line">        a-&gt;left=y.second;  </div><div class="line">        a-&gt;updata();  </div><div class="line">        a-&gt;Maintain();  </div><div class="line">        y.second=a;  </div><div class="line">      &#125;  </div><div class="line">    <span class="keyword">else</span>  </div><div class="line">      &#123;  </div><div class="line">        y=split(a-&gt;right,k-a-&gt;lsize()<span class="number">-1</span>);  </div><div class="line">        a-&gt;right=y.first;  </div><div class="line">        a-&gt;updata();  </div><div class="line">        a-&gt;Maintain();  </div><div class="line">        y.first=a;  </div><div class="line">      &#125;  </div><div class="line">    <span class="keyword">return</span> y;  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> value)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    treap_node *temp;  </div><div class="line">    droot y=split(root,k);  </div><div class="line">    temp=<span class="keyword">new</span> treap_node(value);  </div><div class="line">    root=merge(merge(y.first,temp),y.second);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">del</span><span class="params">(<span class="keyword">int</span> k)</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    droot x,y;  </div><div class="line">    x=split(root,k<span class="number">-1</span>);  </div><div class="line">    y=split(x.second,<span class="number">1</span>);  </div><div class="line">    root=merge(x.first,y.second);  </div><div class="line">&#125;  </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></div><div class="line"><span class="function"></span>&#123;  </div><div class="line">    <span class="keyword">char</span> s[<span class="number">20</span>];  </div><div class="line">    droot ai,bi,ci;  </div><div class="line">    treap_node *temp;  </div><div class="line">    <span class="keyword">int</span> i,x,y,a,L,t;  </div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);  </div><div class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;=n;++i)  </div><div class="line">      &#123;  </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);  </div><div class="line">        insert(i,x);  </div><div class="line">      &#125;  </div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;m);  </div><div class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;=m;++i)  </div><div class="line">      &#123;  </div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;s);  </div><div class="line">        <span class="keyword">if</span> (s[<span class="number">0</span>]==<span class="string">'A'</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;a);  </div><div class="line">            ai=split(root,x<span class="number">-1</span>);  </div><div class="line">            bi=split(ai.second,y-x+<span class="number">1</span>);  </div><div class="line">            bi.first-&gt;adel+=a;  </div><div class="line">            ai.second=merge(bi.first,bi.second);  </div><div class="line">            root=merge(ai.first,ai.second);  </div><div class="line">          &#125;  </div><div class="line">        <span class="keyword">if</span> (s[<span class="number">0</span>]==<span class="string">'I'</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;a);  </div><div class="line">            insert(x,a);  </div><div class="line">          &#125;  </div><div class="line">        <span class="keyword">if</span> (s[<span class="number">0</span>]==<span class="string">'D'</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);  </div><div class="line">            del(x);  </div><div class="line">          &#125;  </div><div class="line">        <span class="keyword">if</span> (s[<span class="number">0</span>]==<span class="string">'R'</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="keyword">if</span> (s[<span class="number">3</span>]==<span class="string">'E'</span>)  </div><div class="line">              &#123;  </div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);  </div><div class="line">                ai=split(root,x<span class="number">-1</span>);  </div><div class="line">                bi=split(ai.second,y-x+<span class="number">1</span>);    </div><div class="line">                bi.first-&gt;rdel++;  </div><div class="line">                ai.second=merge(bi.first,bi.second);  </div><div class="line">                root=merge(ai.first,ai.second);  </div><div class="line">              &#125;  </div><div class="line">            <span class="keyword">if</span> (s[<span class="number">3</span>]==<span class="string">'O'</span>)  </div><div class="line">              &#123;  </div><div class="line">                <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;x,&amp;y,&amp;a);  </div><div class="line">                L=y-x+<span class="number">1</span>;  </div><div class="line">                a=(a%L+L)%L;  </div><div class="line">                ai=split(root,x<span class="number">-1</span>);   </div><div class="line">                bi=split(ai.second,L);  </div><div class="line">                ci=split(bi.first,L-a);  </div><div class="line">                bi.first=merge(ci.second,ci.first);  </div><div class="line">                ai.second=merge(bi.first,bi.second);  </div><div class="line">                root=merge(ai.first,ai.second);  </div><div class="line">              &#125;    </div><div class="line">          &#125;  </div><div class="line">        <span class="keyword">if</span> (s[<span class="number">0</span>]==<span class="string">'M'</span>)  </div><div class="line">          &#123;  </div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y);  </div><div class="line">            ai=split(root,x<span class="number">-1</span>);  </div><div class="line">            bi=split(ai.second,y-x+<span class="number">1</span>);   </div><div class="line">            t=bi.first-&gt;minn;  </div><div class="line">            ai.second=merge(bi.first,bi.second);  </div><div class="line">            root=merge(ai.first,ai.second);  </div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,t);    </div><div class="line">          &#125;  </div><div class="line">      &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>补一句，多年的超文本编辑器问题也解决了。。。。<br>TREAP最强！！</p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/平衡树-treap/">平衡树 treap</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/杂题-NOI/">
      杂题---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="救生员的小小问题"><a href="#救生员的小小问题" class="headerlink" title="救生员的小小问题"></a>救生员的小小问题</h1><p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1492151237&amp;di=63078ba6178cb7c887bb4de3469badf1&amp;imgtype=jpg&amp;er=1&amp;src=http%3A%2F%2Fd.hiphotos.baidu.com%2Fzhidao%2Fpic%2Fitem%2F5882b2b7d0a20cf40a46ff2e74094b36adaf9968.jpg" alt=""><br>Description<br>七濑遥作为游泳池的救生员，他正在池边游荡，突然看到一个小女孩落水了！他必须立刻行动！<br>七濑遥工作的泳池是一个凸 n 边形，他在地面上单位距离移动的时间为 tg，在水中单位距离移动的时间为 tw。因为七濑遥有特殊的入水技巧，所以入水和上岸不需要时间。一开始七濑遥站在多边形的边上，而小女孩在多边形的内部。<br>Task<br>Input<br>第一行一个整数 n。<br>第二行 n 对整数 (xi, yi) 表示多边形顶点的坐标，按逆时针排列。<br>接下来一行一个整数 tg。<br>接下来一行一个整数 tw。<br>接下来一行两个整数 (xs, ys) 表示七濑遥的位置，保证在多边形的边上。<br>接下来一行两个整数 (xt, yt) 表示小女孩的位置，保证在多边形的内部。<br>Output<br>输出一个浮点数表示最短时间，四舍五入保留 6 位小数。<br>Sample I<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 5<br>9 5<br>Output<br>108.000000<br>Sample II<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 0<br>9 1<br>Output<br>96.633250<br>Sample III<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 1<br>9 1<br>Output<br>103.266499<br>Sample IV<br>Input<br>8<br>2 0 4 0 6 2 6 4 4 6 2 6 0 4 0 2<br>10<br>12<br>3 0<br>3 5<br>Output<br>60.000000<br>Constraint<br>对于 100% 的数据，3≤n≤10，−100≤xi, yi, xs, ys, xt, yt≤100，1≤tg&lt;tw≤100。</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//orz 又短又快。。。</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> ldb;</div><div class="line"><span class="keyword">const</span> ldb eps=<span class="number">1e-8</span>;</div><div class="line"><span class="keyword">int</span> n,dx[<span class="number">20</span>],dy[<span class="number">20</span>],tg,tw;</div><div class="line"><span class="keyword">int</span> sx,sy,tx,ty,bg;</div><div class="line">ldb ans=<span class="number">1e20</span>,dis=<span class="number">0</span>,lstx,lsty;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cross</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> (x2-x1)*(y-y1)-(y2-y1)*(x-x1);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="keyword">inline</span> <span class="title">nxt</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x==n?<span class="number">1</span>:x+<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="keyword">inline</span> <span class="title">lst</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x==<span class="number">1</span>?n:x<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">dist</span><span class="params">(ldb x1,ldb y1,ldb x2,ldb y2)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">calc</span><span class="params">(ldb x,ldb y,ldb x1,ldb y1)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> dist(x,y,x1,y1)*tg+dist(x1,y1,tx,ty)*tw;</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	ldb lx=x1,ly=y1,rx=x2,ry=y2;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">fabs</span>(lx-rx)&gt;eps||<span class="built_in">fabs</span>(ly-ry)&gt;eps)&#123;</div><div class="line">		ldb x1=(lx+lx+rx)/<span class="number">3.0</span>,y1=(ly+ly+ry)/<span class="number">3.0</span>;</div><div class="line">		ldb x2=(lx+rx+rx)/<span class="number">3.0</span>,y2=(ly+ry+ry)/<span class="number">3.0</span>;</div><div class="line">		ldb ans1=calc(x,y,x1,y1),ans2=calc(x,y,x2,y2);</div><div class="line">		<span class="keyword">if</span>(ans1&gt;ans2)lx=x1,ly=y1;</div><div class="line">		<span class="keyword">else</span> rx=x2,ry=y2;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> calc(x,y,lx,ly);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;dx[i],&amp;dy[i]);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d%d"</span>,&amp;tg,&amp;tw,&amp;sx,&amp;sy,&amp;tx,&amp;ty);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		<span class="keyword">if</span>(cross(dx[i],dy[i],dx[nxt(i)],dy[nxt(i)],sx,sy)==<span class="number">0</span>)&#123;bg=i;<span class="keyword">break</span>;&#125;</div><div class="line">	ans=min(ans,solve(dx[bg],dy[bg],dx[nxt(bg)],dy[nxt(bg)],lstx=sx,lsty=sy));</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nxt(bg);i!=bg;i=nxt(i))&#123;</div><div class="line">		dis+=dist(dx[i],dy[i],lstx,lsty);</div><div class="line">		ans=min(ans,solve(dx[i],dy[i],dx[nxt(i)],dy[nxt(i)],lstx=dx[i],lsty=dy[i])+dis*tg);</div><div class="line">	&#125;</div><div class="line">	dis=<span class="number">0</span>,lstx=sx,lsty=sy;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=lst(bg);i!=bg;i=lst(i))&#123;</div><div class="line">		dis+=dist(dx[nxt(i)],dy[nxt(i)],lstx,lsty);</div><div class="line">		ans=min(ans,solve(dx[nxt(i)],dy[nxt(i)],dx[i],dy[i],lstx=dx[nxt(i)],lsty=dy[nxt(i)])+dis*tg);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.6lf"</span>,ans);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="新司机的小小问题"><a href="#新司机的小小问题" class="headerlink" title="新司机的小小问题"></a>新司机的小小问题</h1><p><img src="http://pic.qingkong.net/pic/tuku/11eyes07.jpg" alt=""><br>Description<br>最近周日天同学因为资金短缺，当起了兼职司机。</p>
<p>有 N 个点，M 个乘客。日天用一款叫“dada”的 app 知道了每个人的出行计划。乘客 i 会在 Ti 时刻在 Ai 上车，下车地点为 Bi。设其乘车时间为 Si，则乘客 i 会支付 max{0, Pi−Si}。日天的出租车最多可以同时坐 K 个人（不包括司机），他 0 时刻在 1 号点。</p>
<p>求日天同学最多能赚多少钱。</p>
<p>Task<br>Input</p>
<p>第一行有 3 个整数 N, M, K。</p>
<p>接下来 M 行，每行 4 个整数 Ti, Ai, Bi, Pi。</p>
<p>接下来一个 N×N 的整数矩阵，Dij 表示从 i 号点到 j 号点要花的时间。</p>
<p>Output</p>
<p>输出一个整数表示日天同学最多能赚多少钱。</p>
<p>Sample I<br>Input</p>
<p>3 2 1<br>1 1 3 10<br>2 2 1 100<br>0 1 2<br>1 0 2<br>2 2 0<br>Output</p>
<p>99<br>Sample II<br>Input</p>
<p>2 2 2<br>2 1 2 100<br>50 2 1 1000<br>0 50<br>50 0<br>Output</p>
<p>950<br>Sample III<br>Input</p>
<p>2 2 2<br>2 1 2 100<br>50 2 1 1000<br>0 48<br>50 0<br>Output</p>
<p>1002<br>Constraint<br>对于 10% 的数据，K=1。</p>
<p>对于 100% 的数据，1≤N, M≤20，1≤K≤4，Ti&lt;Ti+1，1≤Ai, Bi≤N, Ai≠Bi，0≤Pi≤1000，0≤Dij≤100，Dii=0。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;deque&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls (oo &lt;&lt; 1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs (oo &lt;&lt; 1 | 1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((L + R) / 2)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(a, x) memset(a, x, sizeof a)</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">25</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">7005</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> t, x, y, p;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Node &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> t &lt; a.t; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Node a[MAXN];</div><div class="line"><span class="keyword">int</span> G[MAXN][MAXN];</div><div class="line"><span class="keyword">int</span> idx[MAXM], state[<span class="number">1</span> &lt;&lt; <span class="number">20</span>], num[MAXM], cnt;</div><div class="line"><span class="keyword">int</span> dp[<span class="number">20</span>][MAXM];</div><div class="line"><span class="keyword">int</span> S[<span class="number">5</span>], vis[<span class="number">5</span>], top;</div><div class="line"><span class="keyword">int</span> n, m, K;</div><div class="line"><span class="keyword">int</span> ans;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> x, <span class="keyword">int</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cur &gt; K)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span> (x == m) &#123;</div><div class="line">        idx[cnt] = s;</div><div class="line">        num[cnt] = cur;</div><div class="line">        state[s] = cnt++;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    dfs(cur, x + <span class="number">1</span>, s &lt;&lt; <span class="number">1</span>);</div><div class="line">    dfs(cur + <span class="number">1</span>, x + <span class="number">1</span>, s &lt;&lt; <span class="number">1</span> | <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> now, <span class="keyword">int</span> val, <span class="keyword">int</span> pos, <span class="keyword">int</span> s, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cur == top) &#123;</div><div class="line">        <span class="keyword">if</span> (s == <span class="number">0</span>)</div><div class="line">            ans = max(ans, val);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt; m; ++i) &#123;</div><div class="line">            <span class="keyword">int</span> k = state[s | (<span class="number">1</span> &lt;&lt; i)];</div><div class="line">            <span class="keyword">if</span> (now + G[pos][a[i].x] &lt;= a[i].t)</div><div class="line">                dp[i][k] = max(dp[i][k], val);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; top; ++i)</div><div class="line">        <span class="keyword">if</span> (!vis[i]) &#123;</div><div class="line">            vis[i] = <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> v = S[i], nxt = now + G[pos][a[v].y];</div><div class="line">            dfs2(cur + <span class="number">1</span>, nxt, val + max(a[v].p + a[v].t - nxt, <span class="number">0</span>), a[v].y, s,</div><div class="line">                 x);</div><div class="line">            vis[i] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    cnt = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;K);</div><div class="line">    dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;a[i].t, &amp;a[i].x, &amp;a[i].y, &amp;a[i].p);</div><div class="line">        a[i].x--;</div><div class="line">        a[i].y--;</div><div class="line">    &#125;</div><div class="line">    sort(a, a + m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;G[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; ++k) &#123; <span class="comment">// floyd</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</div><div class="line">                G[i][j] = min(G[i][j], G[i][k] + G[k][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    clr(dp, <span class="number">-1</span>);</div><div class="line">    ans = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (G[<span class="number">0</span>][a[i].x] &lt;= a[i].t)</div><div class="line">            dp[i][state[<span class="number">1</span> &lt;&lt; i]] = max(dp[i][state[<span class="number">1</span> &lt;&lt; i]], <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; cnt; ++j)</div><div class="line">            <span class="keyword">if</span> (dp[i][j] != <span class="number">-1</span>) &#123;</div><div class="line">                <span class="keyword">int</span> st = idx[j];</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = st; ~k; k = k ? (st &amp; (k - <span class="number">1</span>)) : <span class="number">-1</span>) &#123;</div><div class="line">                    top = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">int</span> tmp = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; m; ++l) &#123;</div><div class="line">                        <span class="keyword">if</span> (k &amp; (<span class="number">1</span> &lt;&lt; l))</div><div class="line">                            S[top++] = l;</div><div class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (st &amp; (<span class="number">1</span> &lt;&lt; l))</div><div class="line">                            ++tmp;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (tmp &lt; K)</div><div class="line">                        dfs2(<span class="number">0</span>, a[i].t, dp[i][j], a[i].x, st ^ k, i + <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"Taxi.in"</span>,<span class="string">"r"</span>, <span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"Taxi.out"</span>,<span class="string">"w"</span>, <span class="built_in">stdout</span>);</div><div class="line">    solve();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="龙女仆的小小问题"><a href="#龙女仆的小小问题" class="headerlink" title="龙女仆的小小问题"></a>龙女仆的小小问题</h1><p><img src="http://pic.qingkong.net/pic/tuku/11eyes08.jpg" alt=""><br>Description<br>康娜是一个聪明的小孩，经常玩一些益智游戏。但她并不满足于玩别人发明的游戏，她也想着创造一些新的游戏玩法。</p>
<p>某日，康娜灵机一动，又想到了一个数学游戏并且编写了程序给大家玩。首先给定一个整数 M，接着系统随机排列 0 到 M−1 之间的不重复的 M 个数。假设这 M 个数保存在数组 A 中，接着系统给出一个大小也为 M 的数组 B，以及一个非负整数 D。</p>
<p>游戏开始后，每一轮玩家只能执行下面的其中一种操作：</p>
<p>从当前未被选择的数中选一个数 Ai 作为“当前数”，付出 Bi 的代价。<br>设“当前数”为 Ai，对于任意还未被选择的 Aj，如果 j&gt;i 并且存在最小的非负整数 k 使得 Aj≡Ai⋅Dk(modM)，就可以选择 Aj 作为“当前数”，付出 k(Aj+1) 的代价。<br>注意：</p>
<p>第一轮玩家只能进行操作 1。<br>对于操作 2，假设 00=1。<br>游戏的目标是选完所有数，并且代价最小。</p>
<p>Task<br>Input</p>
<p>第一行有两个整数 M, D。</p>
<p>接着一行有 M 个数，表示数组 A 中的 M 个数。</p>
<p>接着一行有 M 个数，表示数组 B 中的 M 个数。</p>
<p>Output</p>
<p>输出通过游戏的最小代价。</p>
<p>Sample I<br>Input</p>
<p>3 2<br>0 2 1<br>10 20 30<br>Output</p>
<p>32<br>Explanation</p>
<p>先用操作 1 选择 0，再用操作 1 选择 2，再用操作 2 选择 1，10+20+2=32。</p>
<p>Sample II<br>Input</p>
<p>3 3<br>1 2 0<br>1 5 3<br>Output</p>
<p>7<br>Explanation</p>
<p>先用操作 1 选择 1，再用操作 2 选择 0，再用操作 1 选择 2，1+1+5=7。</p>
<p>Constraint<br>对于 100% 的数据，1≤M≤100，0≤D≤109，0≤Bi≤100。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//orz root 大佬强无敌</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _GLIBCXX_IOSTREAM</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> uint;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> lf;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> llf;</div><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> xx first</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> yy second</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">max</span><span class="params">(T a,T b)</span></span>&#123;<span class="keyword">return</span> a&gt;b?a:b;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">min</span><span class="params">(T a,T b)</span></span>&#123;<span class="keyword">return</span> a&lt;b?a:b;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">abs</span><span class="params">(T a)</span></span>&#123;<span class="keyword">return</span> a&gt;<span class="number">0</span>?a:-a;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">repr</span><span class="params">(T &amp;a,T b)</span></span>&#123;<span class="keyword">return</span> a&lt;b?a=b,<span class="number">1</span>:<span class="number">0</span>;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">repl</span><span class="params">(T &amp;a,T b)</span></span>&#123;<span class="keyword">return</span> a&gt;b?a=b,<span class="number">1</span>:<span class="number">0</span>;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">gcd</span><span class="params">(T a,T b)</span></span>&#123;T t;<span class="keyword">if</span>(a&lt;b)&#123;<span class="keyword">while</span>(a)&#123;t=a;a=b%a;b=t;&#125;<span class="keyword">return</span> b;&#125;<span class="keyword">else</span>&#123;<span class="keyword">while</span>(b)&#123;t=b;b=a%b;a=t;&#125;<span class="keyword">return</span> a;&#125;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">sqr</span><span class="params">(T x)</span></span>&#123;<span class="keyword">return</span> x*x;&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mp(a,b) std::make_pair(a,b)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> I inline</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mset(a,b) memset(a,b,sizeof(a))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mcpy(a,b) memcpy(a,b,sizeof(a))</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo0(i,n) for(int i=0,i##end=n;i&lt;i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo1(i,n) for(int i=1,i##end=n;i&lt;=i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd0(i,n) for(int i=(n)-1;~i;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd1(i,n) for(int i=n;i;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> foe(i,x)for(__typeof(x.end())i=x.begin();i!=x.end();++i)</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cg</span>&#123;</span><span class="function">I <span class="keyword">char</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> getchar();&#125;&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cp</span>&#123;</span><span class="function">I <span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;<span class="built_in">putchar</span>(x);&#125;&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> OP operator</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RT return *this;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RX x=0;char t=P();while((t<span class="meta-string">&lt;'0'||t&gt;'9')&amp;&amp;t!='-')t=P();bool f=0;\</span></span></div><div class="line"><span class="keyword">if</span>(t==<span class="string">'-'</span>)t=P(),f=<span class="number">1</span>;x=t-<span class="string">'0'</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P())x=x*<span class="number">10</span>+t-<span class="string">'0'</span></div><div class="line">#define RL <span class="keyword">if</span>(t==<span class="string">'.'</span>)&#123;lf u=<span class="number">0.1</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P(),u*=<span class="number">0.1</span>)x+=u*(t-<span class="string">'0'</span>);&#125;<span class="keyword">if</span>(f)x=-x</div><div class="line">#define RU x=<span class="number">0</span>;<span class="keyword">char</span> t=P();<span class="keyword">while</span>(t&lt;<span class="string">'0'</span>||t&gt;<span class="string">'9'</span>)t=P();x=t-<span class="string">'0'</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P())x=x*<span class="number">10</span>+t-<span class="string">'0'</span></div><div class="line">#define TR *<span class="keyword">this</span>,x;<span class="keyword">return</span> x;</div><div class="line"><span class="function">I <span class="keyword">bool</span> <span class="title">IS</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;<span class="keyword">return</span> x==<span class="number">10</span>||x==<span class="number">13</span>||x==<span class="string">' '</span>;&#125;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="class"><span class="keyword">struct</span> <span class="title">Fr</span>&#123;</span>T P;I Fr&amp;OP,(<span class="keyword">int</span> &amp;x)</div><div class="line">&#123;RX;<span class="keyword">if</span>(f)x=-x;RT&#125;<span class="function">I OP <span class="title">int</span><span class="params">()</span></span>&#123;<span class="keyword">int</span> x;TR&#125;I Fr&amp;OP,(ll &amp;x)&#123;RX;<span class="keyword">if</span>(f)x=-x;RT&#125;<span class="function">I OP <span class="title">ll</span><span class="params">()</span></span>&#123;ll x;TR&#125;I Fr&amp;OP,(<span class="keyword">char</span> &amp;x)</div><div class="line">&#123;<span class="keyword">for</span>(x=P();IS(x);x=P());RT&#125;<span class="function">I OP <span class="title">char</span><span class="params">()</span></span>&#123;<span class="keyword">char</span> x;TR&#125;I Fr&amp;OP,(<span class="keyword">char</span> *x)&#123;<span class="keyword">char</span> t=P();<span class="keyword">for</span>(;IS(t);t=P());<span class="keyword">if</span>(~t)&#123;</div><div class="line"><span class="keyword">for</span>(;!IS(t)&amp;&amp;~t;t=P())*x++=t;&#125;*x++=<span class="number">0</span>;RT&#125;I Fr&amp;OP,(lf &amp;x)&#123;RX;RL;RT&#125;<span class="function">I OP <span class="title">lf</span><span class="params">()</span></span>&#123;lf x;TR&#125;I Fr&amp;OP,(llf &amp;x)&#123;RX;RL;RT&#125;<span class="function">I OP <span class="title">llf</span><span class="params">()</span></span>&#123;llf x;TR&#125;</div><div class="line">I Fr&amp;OP,(uint &amp;x)&#123;RU;RT&#125;<span class="function">I OP <span class="title">uint</span><span class="params">()</span></span>&#123;uint x;TR&#125;I Fr&amp;OP,(ull &amp;x)&#123;RU;RT&#125;<span class="function">I OP <span class="title">ull</span><span class="params">()</span></span>&#123;ull x;TR&#125;&#125;;Fr&lt;Cg&gt;in;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WI(S) <span class="meta-keyword">if</span>(x)&#123;<span class="meta-keyword">if</span>(x&lt;0)P(<span class="meta-string">'-'</span>),x=-x;char s[S],c=0;while(x)s[c++]=x%10+<span class="meta-string">'0'</span>,x/=10;while(c--)P(s[c]);&#125;<span class="meta-keyword">else</span> P(<span class="meta-string">'0'</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WL <span class="meta-keyword">if</span>(y)&#123;lf t=0.5;for(int i=y;i--;)t*=0.1;<span class="meta-keyword">if</span>(x&gt;=0)x+=t;<span class="meta-keyword">else</span> x-=t,P(<span class="meta-string">'-'</span>);*this,(ll)(abs(x));P(<span class="meta-string">'.'</span>);<span class="meta-keyword">if</span>(x&lt;0)x=-x;\</span></div><div class="line"><span class="keyword">while</span>(y--)&#123;x*=<span class="number">10</span>;x-=<span class="built_in">floor</span>(x*<span class="number">0.1</span>)*<span class="number">10</span>;P(((<span class="keyword">int</span>)x)%<span class="number">10</span>+<span class="string">'0'</span>);&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)*<span class="keyword">this</span>,(ll)(x+<span class="number">0.5</span>);<span class="keyword">else</span> *<span class="keyword">this</span>,(ll)(x<span class="number">-0.5</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WU(S) <span class="meta-keyword">if</span>(x)&#123;char s[S],c=0;while(x)s[c++]=x%10+<span class="meta-string">'0'</span>,x/=10;while(c--)P(s[c]);&#125;<span class="meta-keyword">else</span> P(<span class="meta-string">'0'</span>)</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="class"><span class="keyword">struct</span> <span class="title">Fw</span>&#123;</span>T P;I Fw&amp;OP,(<span class="keyword">int</span> x)&#123;WI(<span class="number">10</span>);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;WI(<span class="number">10</span>);RT&#125;I Fw&amp;OP,(uint x)&#123;WU(<span class="number">10</span>);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(uint x)</span></span>&#123;WU(<span class="number">10</span>);RT&#125;I Fw&amp;OP,(ll x)&#123;WI(<span class="number">19</span>);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(ll x)</span></span>&#123;WI(<span class="number">19</span>);RT&#125;I Fw&amp;OP,(ull x)&#123;WU(<span class="number">20</span>);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(ull x)</span></span>&#123;WU(<span class="number">20</span>);RT&#125;I Fw&amp;OP,(<span class="keyword">char</span> x)&#123;P(x);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;P(x);RT&#125;I Fw&amp;OP,(<span class="keyword">const</span> <span class="keyword">char</span> *x)&#123;<span class="keyword">while</span>(*x)P(*x++);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *x)</span></span>&#123;<span class="keyword">while</span>(*x)P(*x++);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(lf x,<span class="keyword">int</span> y)</span></span>&#123;WL;RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(llf x,<span class="keyword">int</span> y)</span></span>&#123;WL;RT&#125;&#125;;Fw&lt;Cp&gt;out;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">205</span>,M=<span class="number">400000</span>,Nf=<span class="number">255</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span></span></div><div class="line"><span class="class">&#123;</span></div><div class="line">	<span class="keyword">int</span> to,w,ne,v;</div><div class="line">&#125;e[M*<span class="number">2</span>+<span class="number">2</span>];</div><div class="line"></div><div class="line"><span class="keyword">int</span> p[N+<span class="number">1</span>],em=<span class="number">2</span>,q[N&lt;&lt;<span class="number">1</span>],qe,fa[N+<span class="number">1</span>],dis[N+<span class="number">1</span>];</div><div class="line"><span class="keyword">bool</span> vis[N+<span class="number">1</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> w,<span class="keyword">int</span> v)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	e[em].to=b,e[em].w=w,e[em].v=v,e[em].ne=p[a],p[a]=em++;</div><div class="line">	e[em].to=a,e[em].w=<span class="number">0</span>,e[em].v=-v,e[em].ne=p[b],p[b]=em++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">wxhcoder</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t,<span class="keyword">int</span> &amp;cost)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	cost=<span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(dis));</div><div class="line">		<span class="built_in">memset</span>(fa,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(fa));</div><div class="line">		dis[s]=<span class="number">0</span>; </div><div class="line">		vis[s]=<span class="number">1</span>;</div><div class="line">		q[<span class="number">0</span>]=s,qe=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i^qe;i++)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> k=q[i&amp;Nf];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=p[k];j;j=e[j].ne)</div><div class="line">				<span class="keyword">if</span>(e[j].w&amp;&amp;dis[e[j].to]&gt;dis[k]+e[j].v)</div><div class="line">				&#123;</div><div class="line">					dis[e[j].to]=dis[k]+e[j].v;</div><div class="line">					fa[e[j].to]=j^<span class="number">1</span>;</div><div class="line">					<span class="keyword">if</span>(!vis[e[j].to])q[(qe++)&amp;Nf]=e[j].to,vis[e[j].to]=<span class="number">1</span>;</div><div class="line">				&#125;</div><div class="line">			vis[k]=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(fa[t]==<span class="number">0x3f3f3f3f</span>)<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">int</span> rfl=<span class="number">0x7fffffff</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=e[fa[i]].to)</div><div class="line">			repl(rfl,e[fa[i]^<span class="number">1</span>].w);</div><div class="line">		cost+=dis[t]*rfl;</div><div class="line">		flow+=rfl;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=e[fa[i]].to)</div><div class="line">			e[fa[i]].w+=rfl,e[fa[i]^<span class="number">1</span>].w-=rfl;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> flow;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> n,m,a[<span class="number">100</span>],b[<span class="number">100</span>],g[<span class="number">100</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	in,n,m;</div><div class="line">	fo0(i,n)in,a[i];</div><div class="line">	fo0(i,n)in,b[i];</div><div class="line">	<span class="keyword">int</span> S=n*<span class="number">2</span>,T=n*<span class="number">2</span>+<span class="number">1</span>;</div><div class="line">	fo0(i,n)add(S,i,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	fo0(i,n)add(i+n,T,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	fo0(i,n)</div><div class="line">	&#123;</div><div class="line">		mset(g,<span class="number">0xff</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x=a[i],j=<span class="number">0</span>;!~g[x];x=(ll)x*m%n,j++)</div><div class="line">			g[x]=j;</div><div class="line">		fo(j,i+<span class="number">1</span>,n<span class="number">-1</span>)<span class="keyword">if</span>(~g[a[j]])add(i,j+n,<span class="number">1</span>,g[a[j]]*(a[j]+<span class="number">1</span>));</div><div class="line">	&#125;</div><div class="line">	fo0(i,n)add(S,i+n,<span class="number">1</span>,b[i]);</div><div class="line">	<span class="keyword">int</span> cost,flow=wxhcoder(S,T,cost);</div><div class="line">	out,cost,<span class="string">'\n'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/杂题-NOI/">杂题 NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/DP-NOI/">
      DP---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="飞镖"><a href="#飞镖" class="headerlink" title="飞镖"></a>飞镖</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/dongh.jpg" alt=""><br>【题目描述】<br>小N 和小A 在玩扔飞镖游戏，N<em>M的格子上每个格子有一个0~9 的数<br>字，因为他们技术都不是特别厉害，所以如果瞄准了(x,y)这个格子，就会<br>等概率打中以这个格子为中心的3</em>3 的格子。他们一共轮流投了K 轮飞<br>镖，每一轮都是小N 先投，投完后小A 投。小N 和小A 都十分聪明，他<br>们一定会选择最优的策略，小A 想知道他获胜的概率是多少呢（平局情况<br>视为小A 获胜0.5 局）？<br>【输入数据】<br>第一行2 个整数N,M<br>接下来N 行每行M个整数表示这个格子的分数。<br>最后一个整数K 表示他们投的轮数。<br>【输出数据】<br>输出小A 获胜的概率，保留4 位小数。<br>【样例输入】<br> 7 3<br>8 8 8<br>8 0 8<br>8 8 8<br>0 0 0<br>0 0 0<br>9 9 9<br>9 9 9<br>1<br>【样例输出】<br>0.5370<br>【数据范围】<br>30%的数据满足K≤2。<br>100%的数据满足N,M,K≤20。 </p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>Ada<br>我们考虑一次操作，能影响这次操作决策的仅仅是两为选手的分差，于是可以用一个数组F[0..1][i][j]，表示当前轮到第1（2）个人操作时，还剩下j轮没有操作，当前两人分差时i的获胜概率。这样当j=0时可以直接算出F,然后考虑转移：枚举这个人选择的扔的地点是哪里，然后九个格子取平均（用之前已经算过的F，这时考虑分差的加减），然后对所有扔的地点取获胜概率的最大值即可。<br>时间复杂度：O（N<em>M</em>9K*K）</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lf double</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> cha 190</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 25</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,k,a[N][N];</div><div class="line"><span class="keyword">int</span> fx[<span class="number">10</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">int</span> fy[<span class="number">10</span>]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</div><div class="line">lf f[N][<span class="number">400</span>],g[N][<span class="number">400</span>];<span class="comment">//gÏÈÊÖ,fºóÊÖ </span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span> (c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</div><div class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>) x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"ada.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"ada.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=read(),m=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; j++)	a[i][j]=read();</div><div class="line">	k=read();</div><div class="line">	f[<span class="number">0</span>][cha]=<span class="number">0.5</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">9</span>*k; i++) f[<span class="number">0</span>][i+cha]=<span class="number">1.0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=k; i++) &#123; <span class="comment">//ÂÖÊý </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=-(k-i+<span class="number">1</span>)*<span class="number">9</span>; j&lt;=(k-i+<span class="number">1</span>)*<span class="number">9</span>; j++) <span class="comment">//·Ö²î·¶Î§ </span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">2</span>; x&lt;n; x++) <span class="comment">//Ã¶¾Ùµã </span></div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">2</span>; y&lt;m; y++) &#123;</div><div class="line">					lf res=<span class="number">0</span>;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> kk=<span class="number">0</span>; kk&lt;<span class="number">9</span>; kk++)</div><div class="line">						res+=f[i<span class="number">-1</span>][j-a[x+fx[kk]][y+fy[kk]]+cha]; <span class="comment">//ÖÜÎ§9¸öµã </span></div><div class="line">					g[i][j+cha]=max(g[i][j+cha],<span class="number">1.0</span>-res/<span class="number">9</span>);</div><div class="line">				&#125;</div><div class="line">	<span class="comment">//¸´ÔÓ¶ÈO(20*20*9*2*20*20) </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=-(k-i)*<span class="number">9</span>; j&lt;=(k-i)*<span class="number">9</span>; j++)</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">2</span>; x&lt;n; x++)</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">2</span>; y&lt;m; y++) &#123;</div><div class="line">					lf res=<span class="number">0</span>;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> kk=<span class="number">0</span>; kk&lt;<span class="number">9</span>; kk++)</div><div class="line">						res+=g[i][j+a[x+fx[kk]][y+fy[kk]]+cha];</div><div class="line">					f[i][j+cha]=max(f[i][j+cha],<span class="number">1.0</span>-res/<span class="number">9</span>);</div><div class="line">				&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,<span class="number">1.0</span>-f[k][cha]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="设计铁路"><a href="#设计铁路" class="headerlink" title="设计铁路"></a>设计铁路</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/a18.jpg" alt=""><br>【题目描述】<br>A 省有一条东西向的公路经常堵车，为解决这一问题，省政府对此展<br>开了调查。调查后得知，这条公路两侧有很多村落，每个村落里都住着很<br>多个信仰c 教的教徒，每周日都会开着自家的车沿公路到B 地去“膜拜”<br>他们的教主，这便是堵车的原因。详细调查显示：这里总共有N 个村<br>落，并且它们都在B 地的东边。编号为i 的村落住有Ri 个信仰c 教的教<br>徒，距离B 地的距离为Ti（单位：公里）。<br>为解决这一问题，A 省政府决定在这条公路下修建一条地下快速铁路<br>来缓解交通，并沿线修建若干个车站（B 地会修建终点站，不算车站）。<br>每名教徒都会先往B 地方向开车（如果他所在村庄处恰好有车站就不必开<br>车了），到最近的一个快速铁路车站时换乘（如果直接开到B 地就不用换<br>乘了），再通过快速铁路到B 地。<br>但A 政府遇到一个难题：修建多少个车站以及在哪修建车站。一个修<br>建车站的方案中，如果修建过多的车站则会花费过多的钱，但修建的车站<br>少了或者修建的位置不对又会导致公路的拥堵。A 政府为了协调这两方<br>面，采用评分的方式来衡量一个方案的好坏（分数越大方案越坏）：每修<br>建一个车站会增加m 的分数，在某一次“膜拜”中（只考虑去，不考虑返<br>回），每导致1 个教徒开车行驶1 公里会增加1 分。<br>现请你设计一个修建车站的方案，使得分数最小。请输出这个最小的<br>分数。<br>【输入说明】<br>输入的第一行包含两个正整数n、m。<br>之后n 行每行两个正整数Ti、Ri。<br>【输出说明】<br>输出一个整数，表示最小的分数。<br>【样例输入】<br>4 20<br>25 3<br>5 3<br>25 2<br>20 5<br>【样例输出】<br>55<br>【数据范围】<br>对于20%的数据，n&lt;=200；<br>对于60%的数据，n&lt;=2000；<br>对于100%的数据，n&lt;=40000，m&lt;=2000000000，Ti&lt;=1000000，Ri&lt;=1000。 </p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>Design<br>典型的动态规划，写出转移方程后可以看出能用斜率优化，直接套模板就好了。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">4e5</span>+<span class="number">5</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">peo</span></span></div><div class="line"><span class="class">&#123;</span></div><div class="line">	<span class="keyword">int</span> pos,num;</div><div class="line">&#125;p[maxn];</div><div class="line"><span class="keyword">int</span> q[maxn],n,m;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[maxn],sum[maxn],ans;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> j)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">return</span> (<span class="keyword">double</span>(dp[k]-dp[j])/<span class="keyword">double</span>(p[k].pos-p[j].pos));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(peo x,peo y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">return</span> x.pos&lt;y.pos;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	freopen(<span class="string">"design.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"design.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;p[i].pos,&amp;p[i].num);</div><div class="line">	sort(p+<span class="number">1</span>,p+<span class="number">1</span>+n,cmp);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	sum[i]=sum[i<span class="number">-1</span>]+p[i].num;</div><div class="line">	q[<span class="number">0</span>]=<span class="number">1</span>;<span class="keyword">int</span> l=<span class="number">0</span>,r=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	dp[<span class="number">0</span>]+=p[i].num*p[i].pos;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">	&#123;</div><div class="line">	    <span class="keyword">while</span>(l&lt;r&amp;&amp;judge(q[l+<span class="number">1</span>],q[l])&lt;=sum[i<span class="number">-1</span>]-sum[n])	l++;</div><div class="line">	    dp[i]=dp[q[l]]+m-(sum[n]-sum[i<span class="number">-1</span>])*(p[i].pos-p[q[l]].pos);</div><div class="line">	    <span class="keyword">while</span>(l&lt;r&amp;&amp;judge(i,q[r])&lt;judge(q[r],q[r<span class="number">-1</span>]))	r--;</div><div class="line">	    q[++r]=i;</div><div class="line">	&#125;</div><div class="line">	ans=<span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)	ans=min(dp[i],ans);</div><div class="line"><span class="comment">//	printf("%lld\n",ans);</span></div><div class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="双排序"><a href="#双排序" class="headerlink" title="双排序"></a>双排序</h1><p><img src="http://i1.hdslb.com/bfs/archive/aff9cd795ee2174b317bd82724c7d18badefc0eb.jpg" alt=""><br>【题目描述】<br>一个长方形的网格每个格子里有一个小写英文字母。我们称这个网格<br>是双排序(doubly sorted)的，当每一行从左到右都是不下降的，每一列从上<br>到下也是不下降的。在下面的例子中，前两个网格是双排序的，而后两个<br>不是。</p>
<p>  abc ace  aceg base<br>  def ade  cdef base<br>  ghi bdg  xxyy base</p>
<p>  给你一个部分格子填了英文字母的网格。你的任务是计算有多少种方<br>式把剩下的格子填满，使所得网格是双排序的。答案可能很大，你只要输<br>出方案数对10007 取模的余数。<br>【输入数据】<br>第一行一个整数T，表示数据组数。接下来有T 组数据。每组数据的<br>第一行有两个整数R 和C，表示网格的行数和列数。接下来R 行，每行有<br>一个长度为C 的字符串，表示部分填写的网格。每个字符是一个小写英文<br>字母，或’.’（表示这个格子没有被填写）。<br>【输出数据】<br>对每组数据，输出一行。这行包含”Case #X: y”，X 是这组数据的编号<br>（从1 开始），y 是可能的双排序网格的个数，模10007。<br>【样例输入】<br>3<br>2 2<br>ad<br>c.<br>3 3<br>.a.<br>a.z<br>.z.<br>4 4<br>….<br>.a..<br>.kf.<br>….<br>【样例输出】<br>Case #1: 23<br>Case #2: 7569<br>Case #3: 0<br>【数据范围】<br>T = 40<br>每个字符都是’.’或小写字母。<br>对于30%的数据（10s）<br>1 ≤ R, C ≤ 4<br>对于100%的数据（2min）<br>1 ≤ R, C ≤ 10<br><strong>为了防止各位大神AK 完无聊，如果你这题第二个点的内存在64M。内，且时间在1min 内，将给你额外加40 分。</strong></p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>Sort<br>考虑双排序的网格，从左上到右下不减，也就是说对与一个字母c，所有&lt;=c的字母的轮廓线一定是一个从左下到右上的一条路径。然后可以用状态压缩维护这个路径，由于棋盘为10<em>10，那么这条路径包含10个(向右)和十个(向上)，总共个数为C(10,20)。为了避免重复转移，应按照行的顺序将轮廓线向右边推进。<br>时间复杂度：O（C(10,20)</em>N^2×26）</p>
<h2 id="code-2"><a href="#code-2" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">\\wxh大佬果然达成了附加<span class="number">40</span>分的副本！！！</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> xx first</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> yy second</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fill( x, y ) memset( x, y, sizeof x )</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> copy( x, y ) memset( x, y, sizeof x )</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line"><span class="keyword">typedef</span> pair &lt; <span class="keyword">int</span>, <span class="keyword">int</span> &gt; pa;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">12</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">200010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">1048577</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">10007</span>;</div><div class="line"><span class="keyword">int</span> n, m, h[MAXM], id[MAXV], id_cnt, dp[<span class="number">27</span>][MAXM][MAXN], kth[MAXM][<span class="number">21</span>], cas;</div><div class="line"><span class="keyword">bool</span> vis[<span class="number">27</span>][MAXM][MAXN];</div><div class="line"><span class="keyword">char</span> ch[MAXN][MAXN];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span> </span>&#123; x += y; <span class="keyword">if</span>( x &gt;= mod ) x -= mod; &#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> alpha, <span class="keyword">int</span> S, <span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">int</span> &amp;ret = dp[ alpha ][ S ][ x ];</div><div class="line">	<span class="keyword">if</span>( vis[ alpha ][ S ][ x ] ) <span class="keyword">return</span> ret; vis[ alpha ][ S ][ x ] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>( alpha == <span class="number">26</span> ) <span class="keyword">return</span> ret = ( S == id_cnt );</div><div class="line">	<span class="keyword">if</span>( x &lt; m ) ret = dfs( alpha, S, x + <span class="number">1</span> ); <span class="keyword">else</span> ret = dfs( alpha + <span class="number">1</span>, S, <span class="number">1</span> );</div><div class="line">	<span class="keyword">int</span> k = kth[ S ][ x ];</div><div class="line">	<span class="keyword">if</span>( k != n + m - <span class="number">1</span> &amp;&amp; !( h[ S ] &amp; ( <span class="number">1</span> &lt;&lt; k + <span class="number">1</span> ) ) )</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> t = n + m - k - x;</div><div class="line">		<span class="keyword">if</span>( ch[ t ][ x ] == <span class="string">'.'</span> || ch[ t ][ x ] == alpha + <span class="string">'a'</span> ) inc( ret, dfs( alpha, id[ h[ S ] ^ ( <span class="number">1</span> &lt;&lt; k ) ^ ( <span class="number">1</span> &lt;&lt; k + <span class="number">1</span> ) ] , x ) );</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	fill( vis, <span class="number">0</span> ); id_cnt = <span class="number">0</span>;</div><div class="line">	<span class="built_in">scanf</span>( <span class="string">"%d%d"</span>, &amp;n, &amp;m );</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; i-- )</div><div class="line">		<span class="built_in">scanf</span>( <span class="string">"%s"</span>, ch[ i ] + <span class="number">1</span> );</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; ( <span class="number">1</span> &lt;&lt; n + m ) ; i++ )</div><div class="line">		<span class="keyword">if</span>( __builtin_popcount( i ) == m ) h[ id[ i ] = ++id_cnt ] = i;</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= id_cnt; i++ )</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> S = h[ i ];</div><div class="line">		<span class="keyword">for</span>( <span class="keyword">int</span> j = n + m - <span class="number">1</span>, t = <span class="number">0</span> ; ~j ; j-- )</div><div class="line">			<span class="keyword">if</span>( S &gt;&gt; j &amp; <span class="number">1</span> )</div><div class="line">				kth[ i ][ ++t ] = j;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>( <span class="string">"Case #%d: %d\n"</span>, ++cas, dfs( <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span> ) );</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FIO <span class="meta-string">"sort"</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> wxh010910</span></div><div class="line">	freopen( <span class="string">"data.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span> );</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">	freopen( FIO<span class="string">".in"</span> , <span class="string">"r"</span>, <span class="built_in">stdin</span>  );</div><div class="line">	freopen( FIO<span class="string">".out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span> );</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">	<span class="keyword">int</span> T;</div><div class="line">	<span class="built_in">scanf</span>( <span class="string">"%d"</span>, &amp;T );</div><div class="line">	<span class="keyword">while</span>( T-- ) solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/DP-NOI/">DP NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/最短路-NOI/">
      最短路---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="最短路径-shortest"><a href="#最短路径-shortest" class="headerlink" title="最短路径(shortest)"></a>最短路径(shortest)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1" alt="">.jpg)</p>
<p>256MB 1seconds<br>【题目描述】<br>给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。<br>【输入格式】<br>第一行两个正整数n，m，表示点的数量和边的数量。<br>随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。<br>【输出格式】<br>     仅一行，包含n-2个整数，依次为d2..dn-1。<br>【输入样例】<br>4 4<br>1 2 1<br>1 3 1<br>2 4 2<br>3 4 1<br>【输出样例】<br>2 3<br>【数据规模与约定】<br>对于100%的数据，n, m&lt;=200000。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>如果考试的话，我<strong>绝壁</strong>写个SPFA大暴力，最多改写手写循环队列，了事。orz wxh大佬。。。。<br>自己的大暴力。。。。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x,y) for(int i=x;i&gt;=y;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x,y) for(int i=x;i&lt;=y;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2100000000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x)  memset(x,0,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"ans"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> from,to,dist;</div><div class="line">	Edge(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d):from(u),to(v),dist(d)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">200000</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPFA</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> n,m;</div><div class="line">	<span class="built_in">vector</span>&lt;Edge&gt; edges;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</div><div class="line">	<span class="keyword">bool</span> done[maxn];</div><div class="line">	<span class="keyword">int</span> d[maxn];</div><div class="line">	<span class="keyword">int</span> p[maxn];</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>-&gt;n=n;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)G[i].clear();</div><div class="line">		edges.clear();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddDedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">		edges.push_back(Edge(dist,to,from));</div><div class="line">		m=edges.size();</div><div class="line">		G[dist].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)d[i]=INF;</div><div class="line">		d[s]=<span class="number">0</span>;</div><div class="line">		done[s]=<span class="number">1</span>;</div><div class="line">		Q.push(s);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfas</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)d[i]=INF;</div><div class="line">		d[<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">		done[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		Q.push(<span class="number">1</span>);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(e.to!=s&amp;&amp;d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">SPFA slover;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	slover.init(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">		slover.AddDedge(readin(),readin(),readin());</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">2</span>;i&lt;n;i++)</div><div class="line">		slover.spfas(i),<span class="built_in">cout</span>&lt;&lt;slover.d[n]&lt;&lt;<span class="string">' '</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>fastest正解<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lld long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> lld inf = <span class="number">1e18</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,np,next,va;</div><div class="line">	<span class="keyword">bool</span> mark;</div><div class="line">&#125;e[maxn*<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> head[maxn];</div><div class="line"><span class="keyword">int</span> e_cnt = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> va)</span></span>&#123;</div><div class="line">	e[++e_cnt] = (edge)&#123;u,v,head[u],va,<span class="number">0</span>&#125;;</div><div class="line">	head[u] = e_cnt;</div><div class="line">	e[++e_cnt] = (edge)&#123;v,u,head[v],va,<span class="number">0</span>&#125;;</div><div class="line">	head[v] = e_cnt;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line">lld dis[maxn],dis_n[<span class="number">2</span>][maxn];</div><div class="line"><span class="keyword">int</span> ide[maxn];</div><div class="line"><span class="keyword">bool</span> inq[maxn];</div><div class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; qx;</div><div class="line"><span class="keyword">int</span> co[maxn],co_mx;</div><div class="line"><span class="keyword">int</span> fa[maxn];</div><div class="line">lld anss[maxn];</div><div class="line"><span class="keyword">bool</span> isva[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[x];ne;ne = e[ne].next)&#123;</div><div class="line">		<span class="keyword">if</span>(!e[ne].mark || e[ne].np == fa[x]) <span class="keyword">continue</span>;</div><div class="line">		fa[e[ne].np] = x;</div><div class="line">		<span class="keyword">if</span>(!co[e[ne].np]) co[e[ne].np] = co[x];</div><div class="line">		dfs(e[ne].np);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dat</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> l,r;</div><div class="line">	lld va;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> dat&amp; x) <span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">return</span> va &lt; x.va;</div><div class="line">	&#125;</div><div class="line">&#125;dt[maxn];</div><div class="line"><span class="keyword">int</span> dt_ct = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> pre[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getp</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x == pre[x]?x:(pre[x]=getp(pre[x]));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=n;++i) anss[i] = dis_n[<span class="number">0</span>][i] = dis_n[<span class="number">1</span>][i] = dis[i] = inf;</div><div class="line">	dis[<span class="number">1</span>] = <span class="number">0</span>;</div><div class="line">	qx.push(<span class="number">1</span>);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne = e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">if</span>(dis[cur] &gt; dis[now] + e[ne].va)&#123;</div><div class="line">				dis[cur] = dis[now] + e[ne].va;</div><div class="line">				ide[cur] = ne;</div><div class="line">				<span class="keyword">if</span>(!inq[cur]) inq[cur]=<span class="number">1</span>,qx.push(cur);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	co_mx = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) ++co_mx;</div><div class="line">	co[n] = co_mx+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) isva[e[k].u] = <span class="number">1</span>,co[e[k].u] = co_mx--;</div><div class="line">	co_mx = co[n];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;++i) e[ide[i]].mark = e[ide[i] ^ <span class="number">1</span>].mark = <span class="number">1</span>;	</div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	dis_n[<span class="number">0</span>][n] = <span class="number">0</span>;</div><div class="line">	qx.push(n);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne=e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">bool</span> fg = <span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(dis_n[<span class="number">0</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">				dis_n[<span class="number">0</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">				fg = <span class="number">1</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!isva[cur])&#123;</div><div class="line">				<span class="keyword">if</span>(co[cur] == co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">1</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">1</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(co[cur] &lt; co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(fg &amp;&amp; !inq[cur]) inq[cur] = <span class="number">1</span>,qx.push(cur);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	dis_n[<span class="number">1</span>][n] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= e_cnt;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(e[i].mark) <span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">int</span> u = e[i].u,v = e[i].np,va = e[i].va;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]<span class="number">-1</span>) dt[++dt_ct] = (dat)&#123;co[u]+<span class="number">1</span>,co[v]<span class="number">-1</span>,dis_n[<span class="number">0</span>][v]+va+dis[u]&#125;;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]) anss[co[v]] = min(anss[co[v]],dis_n[<span class="number">1</span>][v]+va+dis[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=co_mx+<span class="number">1</span>;++i) pre[i] = i;</div><div class="line">	sort(dt+<span class="number">1</span>,dt+<span class="number">1</span>+dt_ct);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=dt_ct;++i)&#123;</div><div class="line">		<span class="keyword">int</span> l = dt[i].l,r = dt[i].r;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> nxt = getp(l);nxt &lt;= r;)&#123;</div><div class="line">			anss[nxt] = min(anss[nxt],dt[i].va);</div><div class="line">			pre[nxt] = nxt+<span class="number">1</span>;</div><div class="line">			nxt = getp(nxt+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n<span class="number">-1</span>;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(!isva[i]) <span class="built_in">printf</span>(<span class="string">"%lld "</span>,dis[n]);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld "</span>,anss[co[i]]);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> a1,a2,a3;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"shortest.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"shortest.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=m;++i)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;a1,&amp;a2,&amp;a3);</div><div class="line">		add_e(a1,a2,a3);</div><div class="line">	&#125;</div><div class="line">	solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="第一视角-blind"><a href="#第一视角-blind" class="headerlink" title="第一视角(blind)"></a>第一视角(blind)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(2" alt="">.png)<br>【问题描述】<br>QQ：我来给你出道题！给定一个有向图，包含n个点（编号1至n）和m条边，求1号点到2号点的最短路。<br>你：这个问题太简单了，……<br>QQ：我们增加一些难度，这m条边中有一条指定的边坏掉了，它不能经过。问这种情况下1号点到2号点的最短路。<br>你：直接把坏掉的那条边删掉，然后再求最短路不就好了。问题似乎没有变难呀！<br>QQ：这是由于你开了“上帝视角”，你知道哪条边是坏的，当然简单了！如果你是以“第一视角”去寻找最短路，换句话讲，最初你并不知道哪条边是坏的，只有走到“坏边”的起点后，才知道这条边是不能通过的。这种情况下，你要从1号点走到2号点，最少要走多少距离呀。<br>你：那当然要看是哪条边坏掉啦！不同的边坏掉答案是不一样的。<br>QQ：那……你帮我算算，最坏情况下需要走多远。<br>你：好的！马上就去写程序！<br>【输入格式】<br>第一行包含两个正整数n、m，分别表示点数和边数。<br>随后m行，每行三个正整数x、y、w，表示有一条从x到y的有向边，距离为w。<br>【输出格式】<br>仅一行，包含一个正整数，表示最坏情况下需要走多少距离。若不能到达，输出-1。<br>【样例输入】<br>4 6<br>1 3 1<br>1 4 1<br>3 1 5<br>4 1 10<br>3 2 3<br>4 2 2<br>【样例输出】<br>9<br>【样例说明】<br>首先给出一种错误的思路：<br>假设边（1-3）坏了，最短路是1-4-2，距离为3；<br>假设边（1-4）或（4-2）坏了，最短路是1-3-2，距离为4；<br>假设边（3-1）或（4-1）或（3-2）坏了，最短路仍为1-4-2，距离为3；<br>综上，最坏情况下最短路是4。<br>这种思路的错误在于仍然开启了“上帝视角”。换句话讲，它的决策是基于已知哪条边坏掉的。具体地讲，当我站在1号点时并不能确定边（3-2）和边（4-2）中哪条边坏了，此时我必须决定走（1-3）还是（1-4），而不是根据（3-2）和（4-2）哪条坏了这个信息决定走向3还是走向4。<br>下面介绍正确思路。首先站在1号点，确认（1-3）有没有坏。如果（1-3）坏了，直接走1-4-2到达终点，距离仅为3。如果（1-3）没坏，先从1走到3。此时站在3，确认（3-2）有没有坏。如果（3-2）坏了，则从3回到1再经过4最终到达2，整个路径为1-3-1-4-2，距离为9；如果（3-2）没坏，则整个路径为1-3-2，距离为4。综上最坏情况下距离为9。<br>另一种方法是先确认（1-4）有没有坏，如果坏了走1-3-2，如果没坏就走到2再确认（2-4）有没有坏。这种方法最差的可能是1-4-1-3-2，距离为15，不如上一个方法。<br>【数据规模与约定】<br>对于20%的数据，n&lt;=5；<br>对于30%的数据，n&lt;=10；<br>对于50%的数据，n&lt;=20；<br>对于100%的数据，n&lt;=100, m&lt;=500, 边的距离不超过1000。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> y, w, next;</div><div class="line">&#125; <span class="built_in">map</span>[<span class="number">1010</span>];</div><div class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> d[<span class="number">110</span>], know[<span class="number">110</span>], head[<span class="number">110</span>], head1[<span class="number">110</span>], flag[<span class="number">110</span>], dis[<span class="number">501</span>][<span class="number">110</span>], dis0[<span class="number">110</span>];</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head[x];</div><div class="line">    head[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head1[x];</div><div class="line">    head1[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"blind.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"blind.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        head[i] = <span class="number">-1</span>;</div><div class="line">        head1[i] = <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</div><div class="line">        <span class="keyword">int</span> x, y, w;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;w);</div><div class="line">        newedge(x, y, w, i);</div><div class="line">        newedge1(y, x, w, i+m);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;m; k++) &#123;</div><div class="line">        <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">        d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">        flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis[k][i] = <span class="number">9999999</span>;</div><div class="line">        dis[k][<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">            <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">                <span class="keyword">if</span> (j == k+m) <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (dis[k][i] + <span class="built_in">map</span>[j].w &lt; dis[k][<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    dis[k][<span class="built_in">map</span>[j].y] = dis[k][i] + <span class="built_in">map</span>[j].w;</div><div class="line">                    <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                        flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                        d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            flag[i] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        know[i] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next)</div><div class="line">            know[i] = max(know[i], dis[j][i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">    d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">    flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis0[i] = <span class="number">9999999</span>;</div><div class="line">    dis0[<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">        <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">            <span class="keyword">if</span> (dis0[<span class="built_in">map</span>[j].y] &gt; <span class="built_in">map</span>[j].w + dis0[i] &amp;&amp; dis0[<span class="built_in">map</span>[j].y] &gt; know[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                dis0[<span class="built_in">map</span>[j].y] = max(<span class="built_in">map</span>[j].w + dis0[i], know[<span class="built_in">map</span>[j].y]);</div><div class="line">                <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                    d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        flag[i] = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (dis0[<span class="number">1</span>] == <span class="number">9999999</span>) dis0[<span class="number">1</span>] = <span class="number">-1</span>;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dis0[<span class="number">1</span>]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="打字机-typewriter"><a href="#打字机-typewriter" class="headerlink" title="打字机(typewriter)"></a>打字机(typewriter)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1" alt="">.png)<br>256MB 1seconds<br>【题目描述】<br>最近，小J在搬家的过程中发现了一台古老的打字机，好奇的小J决定研究如何使用它。<br>首先，需要将一条长度为m的纸带放入打字机。打字机上共有26个按键，分别是小写字母’a’-‘z’。每当你按下一个按键时，打字机就会立即在纸带上打印出那个字符，并将纸带平移一个单位距离。<br>聪明的小J很快就掌握了这款打字机的使用技巧，并尝试一些新的挑战。他拿出了一本字典，挑选了n个单词，并给每个单词设定了分数。纸带中每包含一次指定的单词，就会得到它对应的分数。例如单词’eye’分数为2，’year’分数为3，那么纸带’eyeyeyear’分数为9分。小J希望挑战自己，打出分数最高的纸带。<br>特别地，小J也会偶尔手抖，按到自己并不想输入的字符。由于这台古老的打字机没有退格（删除）功能，所以小J只能接受按错这个事实，重新规划他在按错的情况下如何得最高分。倘若小J有可能在任意位置按错按键，并保证整个过程中按错的次数不超过k次，那么请你算出他在最坏情况下的最高得分是多少。<br>【输入格式】<br>输入数据第一行包含3个非负整数n, m, k，分别表示单词数量、纸带长度和最多按错次数。<br>随后n行，每行包含一个字符串Si和正整数Ai，由空格隔开，描述这个单词及其得分。<br>【输出格式】<br>     仅一行，包含一个整数，表示最坏情况下的最大得分。<br>【输入样例】<br>2 4 1<br>w 1<br>ha 9<br>【输出样例】<br>9<br>【样例说明】<br>首先，展示一种错误的思路：<br>共4种情况，即第1位按错、第2位按错、第3位按错和第4位按错。<br>1、第1位按错（不妨假设按成’x’，下同），最高得分为’xwha’，得分为10。<br>2、第2位按错，最高得分为’wxha’，同样为10分。<br>3、第3位按错，最高得分为’haxw’，同样为10分。<br>4、第4位按错，最高得分为’hawx’，同样为10分。<br>综上，最坏情况下最高得分为10分。<br>这种思路的错误之处在于，你不能根据哪一位按错决定你第一位按哪个键。换一种说法，你在哪一位按错，是要在你按下那一个按键之后才能知道的事情。所以正确的思路如下：<br>    1、第1位先按’h’，倘若按对，goto2，倘若按错，goto4，<br>    2、第2位按’a’，倘若按对，goto3，倘若按错，goto5，<br>    3、第3位第4位均按’w’，至多错1次，最终的纸带为’hawx’或’haxw’，得分为10分。<br>    4、由于已经错过1次，后面不会再错，后面三位按’haw’，最终的纸带为’xhaw’，得分为10分。<br>    5、由于已经错过1次，后面不会再错，后面两位按’ha’，最终纸带为’hxha’，得分为9分。<br>综上，最坏情况下，最高得分为9分。<br>【数据规模与约定】<br>对于30%的数据，n=1；<br>另有30%的数据，k=0；<br>对于100%的数据，n&lt;=100，m&lt;=500，∑|Si|&lt;=500，Ai&lt;=1000，k&lt;=5。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>不愧是标准正解，不需要数据分治，我还是一只蒟蒻啊！！！！<br>数据三处分治。。有点怂。。。不过在线提交std却会超时，bzoj上我这道题是rank third！！！<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i) for(register int i=0;i&lt;=cnt;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i) for(register int i=1;i&lt;=26;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,j) for(register int i=0;i&lt;j;i++)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </div><div class="line"><span class="keyword">char</span> s[<span class="number">510</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> di[<span class="number">210</span>][<span class="number">210</span>],ret[<span class="number">210</span>][<span class="number">210</span>],tmp[<span class="number">210</span>][<span class="number">210</span>],ans,M,P,tot;</div><div class="line"><span class="keyword">int</span> a[<span class="number">110</span>],ch[<span class="number">510</span>][<span class="number">27</span>],nxt[<span class="number">510</span>],la[<span class="number">510</span>],w[<span class="number">510</span>],cnt,q[<span class="number">510</span>],h,t,x,y,K,m,f[<span class="number">520</span>][<span class="number">520</span>][<span class="number">6</span>],n;</div><div class="line"><span class="keyword">bool</span> used[<span class="number">510</span>][<span class="number">510</span>][<span class="number">6</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addnew</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> now=<span class="number">0</span>,n=<span class="built_in">strlen</span>(s),x;</div><div class="line">    rep(i,n)&#123;</div><div class="line">        x=s[i]<span class="number">-96</span>;</div><div class="line">        <span class="keyword">if</span>(!ch[now][x])ch[now][x]=++cnt;</div><div class="line">        now=ch[now][x];</div><div class="line">    &#125;</div><div class="line">    w[now]+=v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getnxt</span><span class="params">()</span></span>&#123;</div><div class="line">    h=<span class="number">1</span>;t=<span class="number">0</span>; </div><div class="line">    rez(i)<span class="keyword">if</span>(ch[<span class="number">0</span>][i])t++,q[t]=ch[<span class="number">0</span>][i]; </div><div class="line">    <span class="keyword">while</span>(h&lt;=t)&#123;</div><div class="line">        x=q[h++]; </div><div class="line">        rez(i)&#123;</div><div class="line">            <span class="keyword">int</span> j=ch[x][i]; </div><div class="line">            <span class="keyword">if</span>(!j)&#123;ch[x][i]=ch[nxt[x]][i];<span class="keyword">continue</span>;&#125; </div><div class="line">            y=nxt[x];</div><div class="line">            <span class="keyword">while</span>(y&amp;&amp;!ch[y][i])y=nxt[y]; </div><div class="line">            nxt[j]=ch[y][i];</div><div class="line">            w[j]+=w[nxt[j]]; </div><div class="line">            <span class="keyword">if</span>(w[nxt[j]])la[j]=nxt[j]; </div><div class="line">            <span class="keyword">else</span> la[j]=la[nxt[j]]; </div><div class="line">            q[++t]=j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k&gt;K||used[n][x][k])<span class="keyword">return</span>;</div><div class="line">    used[n][x][k]=<span class="number">1</span>,f[n][x][k]=w[x];</div><div class="line">    <span class="keyword">if</span>(n==m)<span class="keyword">return</span>; </div><div class="line">    <span class="keyword">int</span> maxn=<span class="number">-707185547707185547L</span>L,maxb=<span class="number">0</span>; </div><div class="line">    rez(i)&#123;</div><div class="line">        dp(n+<span class="number">1</span>,ch[x][i],k); </div><div class="line">        <span class="keyword">if</span>(k&lt;K)dp(n+<span class="number">1</span>,ch[x][i],k+<span class="number">1</span>); </div><div class="line">        <span class="keyword">if</span>(f[n+<span class="number">1</span>][ch[x][i]][k]&gt;maxn)maxn=f[n+<span class="number">1</span>][ch[x][i]][k],maxb=i;</div><div class="line">    &#125;</div><div class="line">    maxn=<span class="number">707185547707185547L</span>L;</div><div class="line">    rez(i)<span class="keyword">if</span>(i==maxb)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k]);</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span>(k&lt;K)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k+<span class="number">1</span>]);</div><div class="line">    f[n][x][k]+=maxn;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">slover</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">bool</span> chu)</span></span>&#123;</div><div class="line">    ans=<span class="number">0</span>;<span class="keyword">if</span>(chu)&#123; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">		res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">        res(i)res(j)ret[i][j]=di[i][j];M--;</div><div class="line">        <span class="keyword">while</span>(M)&#123;</div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            <span class="keyword">if</span>(M&amp;<span class="number">1</span>)&#123;</div><div class="line">                res(i)res(k)res(j)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">                res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">            &#125; </div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            res(i)res(k)res(j)tmp[i][j]=max(tmp[i][j],di[i][k]+di[k][j]); </div><div class="line">            res(i)res(j)di[i][j]=tmp[i][j]; </div><div class="line">            M&gt;&gt;=<span class="number">1</span>;</div><div class="line">        &#125; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">        res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">    &#125;<span class="keyword">else</span>&#123; </div><div class="line">        res(i)res(j)&#123; </div><div class="line">            tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            res(k)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">        &#125;</div><div class="line">        res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">    &#125; </div><div class="line">    res(i)ans=max(ans,ret[<span class="number">0</span>][i]); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">    M=m,P=M<span class="number">-300</span>,tot=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(;P&lt;=M<span class="number">-250</span>;P++)&#123;</div><div class="line">        rep(i,<span class="number">300</span>)res(j)rep(k,K+<span class="number">1</span>)used[i][j][k]=<span class="number">0</span>; </div><div class="line">        m=M-P;dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>); </div><div class="line">        slover(P,(P==M<span class="number">-300</span>)); </div><div class="line">        tot=max(tot,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]+ans); </div><div class="line">    &#125; </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>,tot+<span class="number">1</span>); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//freopen(NAME".in","r",stdin);</span></div><div class="line">	<span class="comment">//freopen(NAME".out","w",stdout);</span></div><div class="line">	n=readin(),m=readin(),K=readin();</div><div class="line">    rep(i,n)<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s),a[i+<span class="number">1</span>]=readin(),addnew(a[i+<span class="number">1</span>]);</div><div class="line">    getnxt();</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K==<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">200</span>)&#123;slover(m,<span class="number">1</span>);<span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K!=<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">51</span>)&#123;work();<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>标程<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> L = <span class="number">1010</span>, S=<span class="number">26</span>, M=<span class="number">1010</span>, INF = <span class="number">99999999</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    Node * son[S];</div><div class="line">    Node * next;</div><div class="line">    <span class="keyword">int</span> value;</div><div class="line">&#125; node[L];</div><div class="line"><span class="keyword">int</span> n, m, k, x, num=<span class="number">0</span>;</div><div class="line"><span class="keyword">char</span> s[L];</div><div class="line"><span class="keyword">int</span> g1[L], g2[L];</div><div class="line"><span class="keyword">int</span> f1[L][<span class="number">11</span>], f2[L][<span class="number">11</span>];</div><div class="line">Node * root;</div><div class="line">Node * unknown = node;</div><div class="line"><span class="function">Node * <span class="title">new_node</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node * now = &amp;node[num++];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        now-&gt;son[k] = unknown;</div><div class="line">    now-&gt;next = unknown;</div><div class="line">    now-&gt;value = <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> now;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    unknown = new_node();</div><div class="line">    root = new_node();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        unknown-&gt;son[k] = root;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>, s, &amp;x);</div><div class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</div><div class="line">        Node * now = root;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;len; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[s[j]-<span class="string">'a'</span>] == unknown)</div><div class="line">                now-&gt;son[s[j]-<span class="string">'a'</span>] = new_node();</div><div class="line">            now = now-&gt;son[s[j]-<span class="string">'a'</span>];</div><div class="line">        &#125;</div><div class="line">        now-&gt;value += x;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">    for (int i=0; i&lt;num; i++) &#123;</span></div><div class="line"><span class="comment">        printf("before: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</span></div><div class="line"><span class="comment">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</span></div><div class="line"><span class="comment">                node[i].next - node, node[i].value);</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="built_in">queue</span>&lt;Node *&gt; q;</div><div class="line">    q.push(root);</div><div class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</div><div class="line">        Node * now = q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[k] != unknown) &#123;</div><div class="line">                now-&gt;son[k]-&gt;next = now-&gt;next-&gt;son[k];</div><div class="line">                now-&gt;son[k]-&gt;value += now-&gt;next-&gt;son[k]-&gt;value;</div><div class="line">                q.push(now-&gt;son[k]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                now-&gt;son[k] = now-&gt;next-&gt;son[k];</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">    for (int i=0; i&lt;num; i++) &#123;</span></div><div class="line"><span class="comment">        printf("after: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</span></div><div class="line"><span class="comment">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</span></div><div class="line"><span class="comment">                node[i].next - node, node[i].value);</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line"><span class="comment">    */</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve_without_k</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">        g1[j] = node[j].value;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g2[j] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                g2[j] = max(g2[j], g1[t] + node[j].value);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//printf("g[%d][%d] = %d\n", i, j, g2[j]);</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g1[j] = g2[j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, g2[root-node]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            f1[j][<span class="number">0</span>] = node[j].value;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">1</span>; r&lt;=k; r++) &#123;</div><div class="line">            f1[j][r] = -INF;</div><div class="line">            f1[j][r] = node[j].value;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f2[j][r] = -INF;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                    <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                    f2[j][r] = max(f2[j][r], f1[t][r] + node[j].value);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                        <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                        f2[j][r] = min(f2[j][r], f1[t][r<span class="number">-1</span>] + node[j].value);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//printf("g[%d][%d][%d] = %d\n", i, j, r, f2[j][r]);</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f1[j][r] = f2[j][r];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f2[root-node][k]);</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"typewriter.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"typewriter.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    init();</div><div class="line">    build();</div><div class="line">    <span class="comment">//solve_without_k();</span></div><div class="line">    solve();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/最短路-NOI/">最短路 NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/04/图论专题/">
      图论专题
    </a>
  </h2>
  
  <time>
    Apr 4, 2017
  </time>
  <section class="content">
	  <h2 id="四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。"><a href="#四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。" class="headerlink" title="四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。"></a>四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。</h2><h1 id="Problem-1-bricks"><a href="#Problem-1-bricks" class="headerlink" title="Problem 1. bricks"></a>Problem 1. bricks</h1><p><img src="http://img.hb.aicdn.com/70ddf00fb9aab2509b0e1b86fb9acd80716fd14316d3fd-tlSzfU_fw658" alt=""><br>Input file: bricks.in<br>Output file: bricks.out<br>Time limit: 1 second<br>jyb 在BUAA 天天被大神虐，所以只能去搬砖了。终于在2019 年的夏天，菜菜的jyb 找不到工作，真的去工地搬砖了。jyb 的工头cky 是一个很麻烦的人，他会让jyb 按某种方式搬砖，还问会问一些奇怪的问题。现在有n 块砖，m 次操作。操作有两种：</p>
<ol>
<li>M x y 把编号为x 的砖所在的一摞砖搬到编号为y 的砖所在的一摞砖的上面。如果x 和y 在同一摞砖则忽略这个操作。（最初，每块砖都是单独一摞）</li>
<li>C x 询问x 下面压着多少块砖。<br>jyb 搬砖实在是太累了，想请你帮忙回答一下cky 工头的询问。<br>Input<br>第1 行，2 个整数n; m，表示一共有多少块砖以及有多少操作。<br>接下来m 行，每行一个操作，操作表示形式与前文一致。<br>Output<br>对于每次询问操作，输出答案<br>Sample<br>bricks.in<br>6 6<br>M 1 6<br>C 1<br>M 2 4<br>M 2 6<br>C 3<br>C 4<br>bricks.out<br>1<br>0<br>2<br>Note<br>• 对于30% 的数据，1&lt;=n,m&lt;= \(10^3\)<br>• 对于60% 的数据，1&lt;=n&lt;= \(10^4\) ,1&lt;=m&lt;= \(10^5\)<br>• 对于100% 的数据，1&lt;=n&lt;= \(20^5\),1&lt;=m&lt;= \(30^6\) <h2 id="题解——并查集"><a href="#题解——并查集" class="headerlink" title="题解——并查集"></a>题解——并查集</h2>用链表什么的暴力枚举题意，最坏复杂度是O( \(m^2\) )的。<br>注意到每次都是移动一摞砖，其实问题就是集合的合并，只是这个集合是一个有序的，我们还需要知道每个元素在集合中的位置。我们可以利用并查集高效的来解决。我们引入一个dep数组，对于祖先节点（将每摞砖最上方的一块设为祖先，设最下面的为祖先也是可以的），我们记录该集合中一共有多少块砖，对于其他节点，我们记录它上方有多少块砖，这样我们可以很容易地计算出下方有多少块。这样在合并x和y（设他们祖先为 \(f_x\) ， \(f_y\) ）时，我们将dep[ \(f_x\) ]赋给dep[ \(f_y\) ]（因为移到了上方， \(f_x\) 有多少块 \(f_y\) 上方就有多少块），然后dep[ \(f_x\) ]要加上原本的dep[ \(f_y\) ]。难点就是在合并的过程中，dep数组怎么维护。其实很简单，只需要在路径压缩时顺带维护即可，如果一个节点x的祖先 \(f_x\) 不是祖先（即已被合并过），那么dep[x]加上dep[ \(f_x\) ]即可（等于头上又多了一摞砖，所以要加上）。<br>时间复杂度O( \(α()\) )<h2 id="code"><a href="#code" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"bricks"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez,flag=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> c;</div><div class="line"><span class="keyword">int</span> x,y,n,m,fa[<span class="number">3000020</span>][<span class="number">2</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(x==fa[x][<span class="number">0</span>])<span class="keyword">return</span> x;</div><div class="line">	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> f=fa[x][<span class="number">0</span>];</div><div class="line">		fa[x][<span class="number">0</span>]=find(fa[x][<span class="number">0</span>]);</div><div class="line">		<span class="keyword">if</span>(fa[f][<span class="number">0</span>]!=f)fa[x][<span class="number">1</span>]+=fa[f][<span class="number">1</span>];</div><div class="line">		<span class="keyword">return</span> fa[x][<span class="number">0</span>];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)fa[i][<span class="number">0</span>]=i,fa[i][<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">" %s"</span>,&amp;c);</div><div class="line">		<span class="keyword">if</span>(c==<span class="string">'M'</span>)&#123;</div><div class="line">			<span class="keyword">if</span>((x=find(readin()))!=(y=find(readin())))&#123;</div><div class="line">				fa[y][<span class="number">0</span>]=x,n=fa[y][<span class="number">1</span>];</div><div class="line">				fa[y][<span class="number">1</span>]=fa[x][<span class="number">1</span>];</div><div class="line">				fa[x][<span class="number">1</span>]+=n;</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">if</span>((x=readin())==fa[x][<span class="number">0</span>])<span class="built_in">cout</span>&lt;&lt;fa[x][<span class="number">1</span>]<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			<span class="keyword">else</span> y=find(x),<span class="built_in">cout</span>&lt;&lt;fa[y][<span class="number">1</span>]-fa[x][<span class="number">1</span>]<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Problem-2-drive"><a href="#Problem-2-drive" class="headerlink" title="Problem 2. drive"></a>Problem 2. drive</h1><p><img src="http://img.hb.aicdn.com/95ac6353a3b13c65ed3e1c31492daccc5b9e30cb245378-E01mfY_fw658" alt=""><br>Input file: drive.in<br>Output file: drive.out<br>Time limit: 2 second<br>工头 cky 最近开了一家贸易公司，开始经商。作为 cky 的忠实小弟，jyb 当了 cky 老总的司机。一天晚上，cky 突然找到了一个新的客户，所以第二天一早要急着从成都去上海谈生意（设全国一共有 n 个城市, 成都编号为 1，上海编号为 n），城市之间有高速公路，每条高速公路都有一个最高限速和长度。cky 想：我应该在今晚就告诉客户我最快多久能到上海，不然客户就可能先和别人谈生意了。所以他就让 jyb 计算一下最快多久能到。<br>jyb 作为一名经验丰富的老司机，看了一眼天气预报，天气预报说：全国范围内有一条高速公路第二天可能下大雨（大雨天气的话，车速会下降 75%），但坑爹的是居然不知道是哪一条，准确信息要第二天一早才知道。现在jyb 拥有全国高速公路图，为了回答一个尽量早但又不失信于客户的时间，jyb 想请你帮帮忙。<br>ps: 虽然cky 很急，但是他还是告诫jyb 不能超速行驶。第二天知道哪会下雨后，jyb 自然会作出正确的抉择。迟到肯定就是失信于客户啦！<br>Input<br>第1 行，2 个整数n; m，表示城市数和高速公路数。<br>接下来m行，每行4 个整数u; v; speed; length，表示该条高速公路连接的两个城市u; v，以及最高限速speed<br>和路长length。<br>Output<br>输出满足题意的时间，保留4 位小数。<br>Sample<br>drive.in     drive.out<br>3 3          4.0000<br>1 2 100 100<br>2 3 100 100<br>1 3 100 400<br>2 1          4.0000<br>1 2 100 100<br>Note<br>• 对于30% 的数据，1&lt;=n&lt;= \(10^2\) ,1&lt;=m&lt;=\(10^3\)<br>• 对于100% 的数据,1&lt;=n&lt;= \(4*10^3\) ,1&lt;=m&lt;= \(10^4\) ,60&lt;=speed&lt;=120,200&lt;=length&lt;=1000</p>
<h2 id="题解——最短路"><a href="#题解——最短路" class="headerlink" title="题解——最短路"></a>题解——最短路</h2><p>如果没有大雾天气，很显然就是求一个最短路就行了。但是由于大雾天气的存在，如果大雾天气出现在乐最短路的路径上，那么肯定不能按照最快的时间到达，如果这样的话很可能就失信与客户。所以我们就需要枚举最短路径上每条高速公路出现大雾天气的情况，再求最短路，可得一个最糟的情况，即得到在不失信于客户的前提下的最快时间。<br>注意到数据范围，每条高速公路的行驶时间最多相差10倍，spfa的时间复杂度的上界大概为O( \(kM\) )，k = 10，而朴素Dijkstra求一次最短路为稳定O( \(n^2\) )，总的最坏为O( \(n^3\) )，所以我们采用spfa或者堆优化Dijkstra算法(jyb写的STL堆优被卡了两个点)求最短路。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"drive"</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">20010</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">return</span> resez;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edges</span>&#123;</span><span class="keyword">int</span> u,v,next;<span class="keyword">double</span> w;&#125;edge[M];</div><div class="line"><span class="keyword">int</span> n,m,q[N],head,tail,u,v,hu[N],num,pre[N],vis[N];</div><div class="line"><span class="keyword">double</span> dis[N],tmp,len;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">double</span> w)</span></span>&#123;edge[++num].u=u;edge[num].v=v;edge[num].w=w;edge[num].next=hu[u];hu[u]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">spfa</span><span class="params">(<span class="keyword">bool</span> flag)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)dis[i]=<span class="number">100000000.0</span>;</div><div class="line">	head=<span class="number">0</span>;tail=q[<span class="number">0</span>]=vis[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>(head!=tail)&#123;</div><div class="line">		u=q[head];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u];i;i=edge[i].next)&#123;</div><div class="line">			<span class="keyword">if</span>(v=edge[i].v,dis[v]&gt;dis[u]+edge[i].w)&#123;</div><div class="line">				<span class="keyword">if</span>(dis[v]=dis[u]+edge[i].w,flag)pre[v]=i;</div><div class="line">				<span class="keyword">if</span>(!vis[v])&#123;</div><div class="line">					vis[v]=<span class="number">1</span>;</div><div class="line">					q[tail]=v;</div><div class="line">					tail=(tail+<span class="number">1</span>)%n;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		vis[u]=<span class="number">0</span>;head=(head+<span class="number">1</span>)%n;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> dis[n];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		u=readin(),v=readin();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>,&amp;tmp,&amp;len);</div><div class="line">		addedge(u,v,len/tmp);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">double</span> ans=spfa(<span class="number">1</span>);m=n;</div><div class="line">	<span class="keyword">while</span>(m!=<span class="number">1</span>)&#123;</div><div class="line">		edge[pre[m]].w*=<span class="number">4.0</span>;</div><div class="line">		ans=max(ans,spfa(<span class="number">0</span>));</div><div class="line">		edge[pre[m]].w/=<span class="number">4.0</span>;</div><div class="line">		m=edge[pre[m]].u;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-3-graph"><a href="#Problem-3-graph" class="headerlink" title="Problem 3. graph"></a>Problem 3. graph</h1><p><img src="http://img.hb.aicdn.com/db259e221f0a4a0fc9590648a7be8e8132a97ed22381f2-Qvr1ZT_fw658" alt=""><br>Input file: graph.in<br>Output file: graph.out<br>Time limit: 1 second<br>jyb 给大家讲过强连通分量，强连通分量中的任意两点之间都可以互相到达。这个条件感觉很苛刻，大部分图都不能满足。现在jyb 告诉你一个新的概念：单向连通图；如果有向图中，对于任意节点 \(v_1\)  和 \(v_2\) ，至少存在从 \(v_1\)  到 \(v_2\)  和从 \(v_2\)  到 \(v_1\) 的路径中的一条，则为单向连通图。现在给出若干个有向图，jyb 想问你它们是不是单向连通图。<br>Input<br>第1 行，1 个整数T, 表示数据组数，对于每组数据：<br>第1 行，2 个整数n; m，表示点数和边数<br>接下来m 行，每行2 个整数u,v, 表示u 到v 有一条单向边。题目保证u! = v<br>Output<br>对于每组数据，如果是则输出”Yes”, 不是则输出”No”（均不含引号）<br>Sample<br>graph.in<br>2<br>3 2<br>1 3<br>2 3<br>3 2<br>1 2<br>2 3<br>graph.out<br>No<br>Yes<br>Note<br>• 对于30% 的数据,1 &lt;=n &lt;=100，1  m &lt;= 100<br>• 对于100% 的数据,1  &lt;=T  &lt;=5,1 &lt;=n &lt;=30000，1 &lt;= m&lt;= \(2 *10^5\) 。</p>
<h2 id="题解——tarjan求SCC-拓扑排序"><a href="#题解——tarjan求SCC-拓扑排序" class="headerlink" title="题解——tarjan求SCC+拓扑排序"></a>题解——tarjan求SCC+拓扑排序</h2><p>暴力做法：Floyd求任意两点连通性。（给了30%的分）<br>我们知道，对于在同一SCC中的两点，它们是互相可达的，这也意味着一个SCC中的所有点和其他点的连通性都是一样的，显然我们可以将原图缩点简化问题。经过tarjan缩点后，得到了一个DAG，我们很容易想到如果一个图“分叉”，那么分叉上的点肯定是互不可达的，所以原图必须是“一条链”。为什么对链打引号呢？是因为这条链不用很严格，比如1-&gt;2 2-&gt;3 3-&gt;4 1-&gt;4 2-&gt;4这样的图也是满足的，且可能还有重边，所以只用入度出度去判断的方法容易出错，dfs去走一条链的办法也比较麻烦（我没想出有什么简单的办法）。我们利用拓扑排序，若一直都是一个入度为0的点（队中至多有一个点），那么就是满足题意的。<br>Ps：可以先写一个floyd来对拍（因为时间代价很低）<br>时间复杂度O( \(n+m\))</p>
<h2 id="code-2"><a href="#code-2" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"graph"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x) memset((x),0,sizeof(x))</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">400010</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">return</span> resez;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span><span class="keyword">int</span> v,next;&#125;edge[M];</div><div class="line"><span class="keyword">int</span> T,hu[N][<span class="number">2</span>],num,tot,top,cnt,numm,Q[N],head,tail,u,v,n,m,P[N],temp[N],low[N],vis[N],<span class="built_in">stack</span>[N],fa[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v=<span class="number">0</span>)</span></span>&#123;</div><div class="line">	temp[u]=low[u]=++tot;</div><div class="line">	vis[u]=<span class="number">1</span>;<span class="built_in">stack</span>[++top]=u;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u][<span class="number">0</span>];i!=<span class="number">0</span>;i=edge[i].next)</div><div class="line">		<span class="keyword">if</span>(v=edge[i].v,!temp[v])dfs(v),low[u]=min(low[v],low[u]);</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]&amp;&amp;temp[v]&lt;low[u])low[u]=temp[v];</div><div class="line">	<span class="keyword">if</span>(temp[u]==low[u])&#123;</div><div class="line">		cnt++;</div><div class="line">		<span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">			<span class="keyword">int</span> x=<span class="built_in">stack</span>[top--];</div><div class="line">			vis[x]=<span class="number">0</span>;</div><div class="line">			fa[x]=cnt;</div><div class="line">			<span class="keyword">if</span>(x==u)<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d)</span></span>&#123;edge[++num].v=v;edge[num].next=hu[u][d];hu[u][d]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	T=readin();</div><div class="line">	<span class="keyword">while</span>(T--)&#123;</div><div class="line">		n=readin(),m=readin();</div><div class="line">		num=cnt=tot=<span class="number">0</span>;</div><div class="line">		clr(hu),clr(temp),clr(P),clr(low);</div><div class="line">		<span class="keyword">while</span>(m--)addedge(readin(),readin(),<span class="number">0</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!temp[i])dfs(i);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=hu[i][<span class="number">0</span>];j;j=edge[j].next)</div><div class="line">				<span class="keyword">if</span>(fa[i]!=fa[edge[j].v])&#123;</div><div class="line">					P[fa[edge[j].v]]++;</div><div class="line">					addedge(fa[i],fa[edge[j].v],<span class="number">1</span>);</div><div class="line">				&#125;</div><div class="line">		<span class="keyword">int</span> ans=<span class="number">1</span>;head=tail=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++)<span class="keyword">if</span>(!P[i])Q[tail++]=i;</div><div class="line">		<span class="keyword">while</span>(head&lt;tail)&#123;</div><div class="line">			<span class="keyword">if</span>(tail-head&gt;<span class="number">1</span>)&#123;</div><div class="line">				ans=<span class="number">0</span>;<span class="keyword">break</span>;</div><div class="line">			&#125;u=Q[head];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u][<span class="number">1</span>];i;i=edge[i].next)</div><div class="line">				<span class="keyword">if</span>(v=edge[i].v,P[v]--,P[v]==<span class="number">0</span>)Q[tail++]=v;</div><div class="line">			++head;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(ans)<span class="built_in">cout</span>&lt;&lt;<span class="string">"Yes"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="string">"No"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-4-airplane"><a href="#Problem-4-airplane" class="headerlink" title="Problem 4. airplane"></a>Problem 4. airplane</h1><p><img src="http://img.hb.aicdn.com/4212b1e5badf24cd495a126ec21e4d71fb5f310c250569-GXTxSA_fw658" alt=""><br>Input file: airplane.in<br>Output file: airplane.out<br>Time limit: 1 second<br>cky 公司的运营蒸蒸日上，由于出差实在太频繁，而且坐汽车有些太慢了，所以 cky 想要顺势直接进驻航空业。cky 所在的国家天朝有 n 个城市，m 个航空公司，每两个城市之间可能有一条航线运营（双向），一共有k 条航线，每条航线都属于某一航空公司。现在cky 希望收购一家航空公司（为了涉足航空业以及防垄断，cky 必须且只能购买一家航空公司），使得他能通过飞机从任意城市到达目的城市（允许转机），当然很可能没有一家公司能满足cky 的要求，所以cky 还需收购其他公司掌控的航线。每个航空公司都有一个市值，每条航线都有一个收购价。现在cky 想知道他最少需要花费多少钱。<br>Input<br>第1 行，3 个整数n; m;k，表示城市数量，航空公司数和航线数。城市用1; 2; ……; n 编号。接下来一行，一共 m 个整数，第 i 个整数  \( a_i \) 表示第 i 个航空公司的市值。接下来 k 行，每行 4 个整数 \(u_i, v_i,cost_i,b_i\)。表示第i 条航线连接城市u,v，价值cost，所属航空公司为b。题目保证u! = v题目保证有解。<br>Output<br>输出最少需要花费多少钱。<br>Sample<br>airplane.in<br>4 3 3<br>100 150 200<br>1 2 100 1<br>1 3 160 2<br>1 4 220 3<br>airplane.out<br>460<br>Note<br>• 对于50% 的数据，1&lt;= n&lt;=  1000，1&lt;=  m&lt;= 1000，1&lt;=  k &lt;= 10000；<br>• 对于100% 的数据，1&lt;=  n &lt;= 2000，1 &lt;= m &lt;=2000，1&lt;=  k&lt;=  200000, \( 1&lt;=b_i&lt;=m,1&lt;=cost_i,a_i&lt;=10^8\) 。</p>
<h2 id="题解——最小生成树"><a href="#题解——最小生成树" class="headerlink" title="题解——最小生成树"></a>题解——最小生成树</h2><p>最朴素的做法：枚举航空公司，将本公司的航线加入，然后做一遍MST，时间复杂度是O( \(klog_k+mk\) )的。<br>但我们注意到“在最小生成树中任意一条边都是连接两个集合边权最小的一条边”，这个是MST一个非常重要的结论，是Prim和kruscal算法中贪心的核心。利用这条性质我们可以知道，对于每个航空公司，我们只需要原图MST中得到的航线即可得到最优购买方案。所以更优的做法是：先跑一次MST，把得到的边记录下来，然后枚举航空公司，还是先讲本公司的边全部加进去，然后只用扫一边第一次MST中记录下来的边，用kruscal的方法去构造树即可。时间复杂度为O( \(klog_k+nm \) )。<br>对于本题，50%的数据是可以O(mk)过的，最后30%的数据我特别构造了一下,必须枚举到排序后的最后几条边才能构造出一颗生成树，所以O( \(mk\) )应该是过不了的，此外的20%数据是随机数据，加了构造出树就跳出判断的代码可能会过（但是jyb写的mk的没过。。）；另外，50%的数据需要long long</p>
<h2 id="code-3"><a href="#code-3" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"airplane"</span> </span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">200002</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2002</span>;</div><div class="line"><span class="keyword">const</span> ll INF=<span class="number">1l</span>l&lt;&lt;<span class="number">60</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,v;ll w;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> data &amp;rhs)<span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">return</span> w&lt;rhs.w;</div><div class="line">	&#125;</div><div class="line">&#125;dis[M],mst[N];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edges</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,v,next;</div><div class="line">&#125;edge[M];</div><div class="line"><span class="keyword">int</span> hu[N],num,fa[N],n,m,k,cnt,u,v,tmp,w;</div><div class="line">ll ans,a[N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> tmp,<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;edge[++num].u=u;edge[num].v=v;edge[num].next=hu[tmp];hu[tmp]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> x==fa[x]?x:fa[x]=find(fa[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m),readin(k);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)readin(a[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</div><div class="line">		readin(dis[i].u),readin(dis[i].v),readin(dis[i].w),readin(tmp);</div><div class="line">		addedge(tmp,dis[i].u,dis[i].v);</div><div class="line">	&#125;</div><div class="line">	sort(dis+<span class="number">1</span>,dis+<span class="number">1</span>+k);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)fa[i]=i;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</div><div class="line">		<span class="keyword">int</span> x=find(dis[i].u),y=find(dis[i].v);</div><div class="line">		<span class="keyword">if</span>(x!=y)&#123;</div><div class="line">			fa[y]=x;</div><div class="line">			mst[++cnt]=dis[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	ans=INF;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)fa[j]=j;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=hu[i];j;j=edge[j].next)&#123;</div><div class="line">			<span class="keyword">int</span> x=find(edge[j].u),y=find(edge[j].v);</div><div class="line">			<span class="keyword">if</span>(x!=y)fa[y]=x;</div><div class="line">		&#125;</div><div class="line">		ll tot=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=cnt;j++)&#123;</div><div class="line">			<span class="keyword">int</span> x=find(mst[j].u),y=find(mst[j].v);</div><div class="line">			<span class="keyword">if</span>(x!=y)&#123;</div><div class="line">				fa[y]=x;</div><div class="line">				tot+=mst[j].w;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		ans=min(ans,tot+a[i]);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/图论/">图论</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（三）——从动态到可持久化/">
      可持久化并查集（三）——从动态到可持久化
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h4 id="其实在上一篇：可持久化并查集（二）——从镜像到动态"><a href="#其实在上一篇：可持久化并查集（二）——从镜像到动态" class="headerlink" title="其实在上一篇：可持久化并查集（二）——从镜像到动态"></a>其实在上一篇：<a href="http://blog.csdn.net/lemonoil/article/details/57085381" target="_blank" rel="external">可持久化并查集（二）——从镜像到动态</a></h4><p>中已经可以算是一个伪可持久化了，但是对于历史查询等操作无能为力。。所以本篇重点介绍可持久化操作<br><img src="http://img.blog.csdn.net/20170226155123601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="BZOJ-3673"><a href="#BZOJ-3673" class="headerlink" title="BZOJ 3673"></a>BZOJ 3673</h1><p><a href="https://vjudge.net/problem/HYSBZ-3673" target="_blank" rel="external">题目连接</a></p>
<blockquote>
<p>这题不知道出题人什么做法，但是代码很短的样子<br>UPD：出题人用的是rope，即stl中的可持久化平衡树<br>KuribohG神犇告诉了我可以用可持久化线段树实现可持久化数组T T<br>既然都有可持久化数组了，只要用个再并查集的启发式合并就能妥妥的水过了（这样每次只要修改一个fa）<br>并查集的启发式合并就是按秩合并，初始所有集合秩为0<br>合并把秩小的树根的父亲设为秩大的树根<br>如果秩相同，则随便选取一个作为父节点并将它的秩+1<br>秩和fa一样维护<br>但是其实这题数据随机的话随便合并就行了，根本不用按秩合并什么的<br>UPD：秩其实有的时候很不好用，维护子树大小比较赞。。。<br>另外，ndsf发现只要直接暴力就能虐了T T<br><a href="http://hzwer.com/3951.html" target="_blank" rel="external">引用自hzwer</a></p>
</blockquote>
<p>所以可以发现<del>暴力出奇迹</del>大力发展可持久化并查集是解决当今<del>膜蛤事件</del>。。。的唯一方法！！<br>最终我们还是写份<del>正解</del>（hfu说没有正解，只有更好的暴力）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2000005</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,sz;</div><div class="line"><span class="keyword">int</span> root[N],ls[N],rs[N],v[N],deep[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!k)k=++sz;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;v[k]=l;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	build(ls[k],l,mid);</div><div class="line">	build(rs[k],mid+<span class="number">1</span>,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> &amp;y,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span>&#123;</div><div class="line">	y=++sz;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;v[y]=val;deep[y]=deep[x];<span class="keyword">return</span>;&#125;</div><div class="line">	ls[y]=ls[x];rs[y]=rs[x];</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)</div><div class="line">		modify(l,mid,ls[x],ls[y],pos,val);</div><div class="line">	<span class="keyword">else</span> modify(mid+<span class="number">1</span>,r,rs[x],rs[y],pos,val);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)<span class="keyword">return</span> k;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)<span class="keyword">return</span> query(ls[k],l,mid,pos);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> query(rs[k],mid+<span class="number">1</span>,r,pos);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;deep[k]++;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)add(ls[k],l,mid,pos);</div><div class="line">	<span class="keyword">else</span> add(rs[k],mid+<span class="number">1</span>,r,pos);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> p=query(k,<span class="number">1</span>,n,x);</div><div class="line">	<span class="keyword">return</span> x==v[p]?p:find(k,v[p]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> f,k,a,b;</div><div class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</div><div class="line">	build(root[<span class="number">0</span>],<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">cin</span>&gt;&gt;f;</div><div class="line">		<span class="keyword">if</span>(f==<span class="number">1</span>)&#123;</div><div class="line">			root[i]=root[i<span class="number">-1</span>];</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</div><div class="line">			<span class="keyword">int</span> p=find(root[i],a),q=find(root[i],b);</div><div class="line">			<span class="keyword">if</span>(v[p]==v[q])<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(deep[p]&gt;deep[q])swap(p,q);</div><div class="line">			modify(<span class="number">1</span>,n,root[i<span class="number">-1</span>],root[i],v[p],v[q]);</div><div class="line">			<span class="keyword">if</span>(deep[p]==deep[q])add(root[i],<span class="number">1</span>,n,v[q]);</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">2</span>)&#123;</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;k;root[i]=root[k];</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">3</span>)&#123;</div><div class="line">			root[i]=root[i<span class="number">-1</span>];</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</div><div class="line">		    <span class="keyword">int</span> p=find(root[i],a),q=find(root[i],b);</div><div class="line">			<span class="keyword">if</span>(v[p]==v[q])<span class="built_in">cout</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>又是熟悉的线段树（貌似从主席树开始就阴魂不散了），复杂度因线段树而多加了一个log,但是以数据结构的标准数据范围来说，这点复杂度仍然是极好的，加上读入输出优化后可以从300ms-&gt;40ms<br>亲自手测。</p>
<p>rope大发好！！！！<br>-<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ext/rope&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(i,a,b) for(i=a;i&lt;=b;i++)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">20000</span>+<span class="number">10</span>;</div><div class="line">rope&lt;<span class="keyword">int</span>&gt; *b[maxn];</div><div class="line"><span class="keyword">int</span> a[maxn];</div><div class="line"><span class="keyword">int</span> i,j,k,l,t,n,m,ans;</div><div class="line"><span class="keyword">bool</span> flag;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfa</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (b[id]-&gt;at(x)==<span class="number">0</span>) <span class="keyword">return</span> x;</div><div class="line">    b[id]-&gt;replace(x,getfa(id,b[id]-&gt;at(x)));</div><div class="line">    <span class="keyword">return</span> b[id]-&gt;at(x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    flag=<span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">    fo(i,<span class="number">1</span>,n) a[i]=<span class="number">0</span>;</div><div class="line">    b[<span class="number">0</span>]=<span class="keyword">new</span> rope&lt;<span class="keyword">int</span>&gt; (a,a+n+<span class="number">1</span>);</div><div class="line">    fo(i,<span class="number">1</span>,m)&#123;</div><div class="line">        b[i]=<span class="keyword">new</span> rope&lt;<span class="keyword">int</span>&gt; (*b[i<span class="number">-1</span>]);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</div><div class="line">        <span class="keyword">if</span> (t==<span class="number">1</span>)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;j,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) j^=ans,k^=ans;</div><div class="line">            j=getfa(i,j);</div><div class="line">            k=getfa(i,k);</div><div class="line">            <span class="keyword">if</span> (j!=k) b[i]-&gt;replace(k,j);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t==<span class="number">2</span>)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) k^=ans;</div><div class="line">            b[i]=b[k];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;j,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) j^=ans,k^=ans;</div><div class="line">            j=getfa(i,j);</div><div class="line">            k=getfa(i,k);</div><div class="line">            <span class="keyword">if</span> (j!=k) ans=<span class="number">0</span>;<span class="keyword">else</span> ans=<span class="number">1</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>由于这道题数据太水(zky大大别打我),所以还有一个<del>加强连</del>加强版。</p>
<h1 id="BZOJ-3674"><a href="#BZOJ-3674" class="headerlink" title="BZOJ  3674"></a>BZOJ  3674</h1><p><a href="https://vjudge.net/problem/HYSBZ-3674" target="_blank" rel="external">题目连接</a><br>什么强制在线。。。这种管用的手段。。除了<strong>xor</strong>就没有一点新意吗？（作死吐槽）<br>回归主题，对于上一篇来说，反正都是非离线做法，转个在线水水水！！！！<br>其实用类似于主席树的方法应该可以硬钢过这道题吧<br>代码就用上面的那一份改改就好了，这里就不发出来了。</p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1><p>到这里，可持久化并查集的三部曲就结束了，不知道大家发没发现，这三篇都有一个共同特点？</p>
<p>图片都是博丽灵梦！！！<br>-</p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构-并查集/">数据结构 并查集</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（二）——从镜像到动态/">
      可持久化并查集（二）——从镜像到动态
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>uva 11987<br><a href="https://vjudge.net/problem/UVA-11987" target="_blank" rel="external">题目连接</a><br><img src="http://img.blog.csdn.net/20170225170624845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>code<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100010</span>;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="keyword">int</span> father[MAXN];</div><div class="line"><span class="keyword">int</span> sum[MAXN],num[MAXN];</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=res*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        father[i]=i+n;</div><div class="line">        father[i+n]=i+n;</div><div class="line">        sum[i+n]=i;</div><div class="line">        num[i+n]=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> father[x]!=x?father[x]=find(father[x]):x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> mark,x,y;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)!=EOF)&#123;</div><div class="line">         init();</div><div class="line">         <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</div><div class="line">             readin(mark);</div><div class="line">             <span class="keyword">if</span>(mark==<span class="number">1</span>)&#123;</div><div class="line">                readin(x),readin(y);</div><div class="line">                <span class="keyword">int</span> fx=find(x),fy=find(y);</div><div class="line">                <span class="keyword">if</span>(fx!=fy)&#123;</div><div class="line">                    father[fx]=fy;</div><div class="line">                    sum[fy]+=sum[fx];</div><div class="line">                    num[fy]+=num[fx];</div><div class="line">                &#125;</div><div class="line">             &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mark==<span class="number">2</span>)&#123;</div><div class="line">                readin(x),readin(y);</div><div class="line">                <span class="keyword">int</span> fx=find(x),fy=find(y);</div><div class="line">                <span class="keyword">if</span>(fx!=fy)&#123;</div><div class="line">                   father[x]=fy;</div><div class="line">                   sum[fy]+=x,sum[fx]-=x;</div><div class="line">                   num[fy]++,num[fx]--;</div><div class="line">                &#125;</div><div class="line">             &#125;<span class="keyword">else</span>&#123;</div><div class="line">                 <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</div><div class="line">                 <span class="keyword">int</span> fx=find(x);</div><div class="line">                 <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,num[fx],sum[fx]);</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>紧接着囚犯的是伪可持久化并查集（动态并查集）<br>同样的，这里也用到了<strong>镜像</strong>的思想，以多开一倍空间来存储自己的另外一种状态。从而来实现动态的并查集<code>father[i]=i+n；father[i+n]=i+n;</code> 就是这样，i与i’（i+n）同时指向了i+n这样一个<strong>虚拟id</strong>，接下会发生什么就可以模拟了。如果x union y，则x指向y的虚拟id，重指y时并不会改变x及曾是x的子节点因并查集而变到f[y]只是指向一个虚拟id的事实，从而一切的动态移除，合并，统计就可以在并查集强大的空间复杂度为O(N)，建立一个集合的时间复杂度为O(1)，N次合并M查找的时间复杂度为O(MAlpha(N))的处理下解决了。</p>
<h1 id="模拟镜像"><a href="#模拟镜像" class="headerlink" title="模拟镜像"></a>模拟镜像</h1><p>先来三个点1,2,3<br><img src="http://img.blog.csdn.net/20170226150512963?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>创建它们的镜像<br><img src="http://img.blog.csdn.net/20170226150532135?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>操作1 union 1 与 2（本来应该这样）<br><img src="http://img.blog.csdn.net/20170226150648532?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>实际上是这样<br><img src="http://img.blog.csdn.net/20170226150816830?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>这样union 3 与 1，move 2 to another point<br>就会这样（虚线代表本身的union对象，实线表示路径压缩后的union对象）<br><img src="http://img.blog.csdn.net/20170226151246754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="move"><a href="#move" class="headerlink" title="move"></a>move</h2><p><img src="http://img.blog.csdn.net/20170226151625541?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>我们发现了1与3仍在一个集合内（2的镜像5中），只是2指向了X，但以2为父亲的1与3未受其move的印象。<br>这就是<strong>镜像</strong>的<strong>终极奥义</strong>，在虚拟中完成实际的操作（好中二的说。。。。）<br>欲知后事如何（还有后事？）（废话可持久化还没有实现呢！）：<br>请看下期<br><a href="http://blog.csdn.net/lemonoil/article/details/57416510" target="_blank" rel="external">可持久化并查集（三）——从动态到可持久化</a></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构-并查集/">数据结构 并查集</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（一）——从阿克曼函数到镜像/">
      可持久化并查集（一）——从阿克曼函数到镜像
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>noip2010<br><img src="http://img.blog.csdn.net/20170225174508885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>以下题目可以跳过。</p>
<h1 id="关押罪犯"><a href="#关押罪犯" class="headerlink" title="关押罪犯"></a>关押罪犯</h1><p>(prison.pas/c/cpp)<br>【问题描述】<br>S 城现有两座监狱，一共关押着N 名罪犯，编号分别为1~N。他们之间的关系自然也极不和谐。很多罪犯之间甚至积怨已久，如果客观条件具备则随时可能爆发冲突。我们用“怨气值”（一个正整数值）来表示某两名罪犯之间的仇恨程度，怨气值越大，则这两名罪犯之间的积怨越多。如果两名怨气值为c 的罪犯被关押在同一监狱，他们俩之间会发生摩擦，并造成影响力为c 的冲突事件。<br>每年年末，警察局会将本年内监狱中的所有冲突事件按影响力从大到小排成一个列表，然后上报到S 城Z 市长那里。公务繁忙的Z 市长只会去看列表中的第一个事件的影响力，如果影响很坏，他就会考虑撤换警察局长。<br>在详细考察了N 名罪犯间的矛盾关系后，警察局长觉得压力巨大。他准备将罪犯们在<br>两座监狱内重新分配，以求产生的冲突事件影响力都较小，从而保住自己的乌纱帽。假设只要处于同一监狱内的某两个罪犯间有仇恨，那么他们一定会在每年的某个时候发生摩擦。那么，应如何分配罪犯，才能使Z 市长看到的那个冲突事件的影响力最小？这个最小值是多少？<br>【输入】<br>输入文件名为prison.in。输入文件的每行中两个数之间用一个空格隔开。<br>第一行为两个正整数N 和M，分别表示罪犯的数目以及存在仇恨的罪犯对数。<br>接下来的M 行每行为三个正整数aj，bj，cj，表示aj 号和bj 号罪犯之间存在仇恨，其怨<br>气值为 cj。数据保证 a b N j j 1 ≤ &lt; ≤ ，0 &lt; ≤ 1,000,000,000 j c ，且每对罪犯组合只出现一<br>次。<br>【输出】<br>输出文件prison.out 共1 行，为Z 市长看到的那个冲突事件的影响力。如果本年内监狱中未发生任何冲突事件，请输出0。</p>
<blockquote>
<p>【输入输出样例】<br>prison.in、<br>4 6<br>1 4 2534<br>2 3 3512<br>1 2 28351<br>1 3 6618<br>2 4 1805<br>3 4 12884<br>prison.out<br>3512</p>
</blockquote>
<p>【输入输出样例说明】<br>罪犯之间的怨气值如下面左图所示，右图所示为罪犯的分配方法，市长看到的冲突事件<br><img src="http://img.blog.csdn.net/20170218165823605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>影响力是3512（由2 号和3 号罪犯引发）。其他任何分法都不会比这个分法更优。<br>【数据范围】<br>对于30%的数据有N≤ 15。<br>对于70%的数据有N≤ 2000，M≤ 50000。<br>对于100%的数据有N≤ 20000，M≤ 100000。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>二分暴力可以过，然而我用并查集。开一个<strong>镜像</strong> N来代表当f[x]!=f[y]时若将其连接的情况。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> f[<span class="number">60010</span>],n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> x,y,z;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node &amp;rhs)<span class="keyword">const</span> &#123;<span class="keyword">return</span> z&gt;rhs.z;&#125;</div><div class="line">&#125;p[<span class="number">100010</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> f[x]==x?x:x=find(f[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"prison.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);freopen(<span class="string">"prison.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n*<span class="number">2</span>+<span class="number">10</span>;i++)f[i]=i;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;p[i].x,&amp;p[i].y,&amp;p[i].z);</div><div class="line">	sort(p+<span class="number">1</span>,p+<span class="number">1</span>+m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="keyword">int</span> x=find(p[i].x),y=find(p[i].y);</div><div class="line">		<span class="keyword">if</span>(x==y)&#123;<span class="built_in">cout</span>&lt;&lt;p[i].z&lt;&lt;<span class="built_in">endl</span>;<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">		f[x]=find(p[i].y+n),f[y]=find(p[i].x+n);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="正题-重点"><a href="#正题-重点" class="headerlink" title="正题 重点"></a>正题 重点</h1><p>通过上面的一道noip半水题，我们可以发现一个问题，就是并查集的复杂度？不是O（n）吧。<br><a href="http://baike.baidu.com/link?url=qsPtY-oFSl8qhK-1JjN9W5vT3U1bxdMM_8eueFEX96IDhskreDRWsp2Vnpo7_KTpO6d9vWlPkd9o1nXcSh82b8KQSjsVoxgPwRo8vvEQBoA3ODFxlVTc3ldivcKwob1xT_wYWhNfWseWByNvT2hV_a" target="_blank" rel="external">阿克曼函数</a>普及并查集知识。<br><a href="http://blog.csdn.net/?aspxerrorpath=/youngyangyang04/article/details/7453564" target="_blank" rel="external">http://blog.csdn.net/?aspxerrorpath=/youngyangyang04/article/details/7453564</a><br>正常来说，并查集的复杂度是很优的，至少比二分贪心O(\(nlog_2^n\))要好很多。<br>并查集进行n次查找的时间复杂度是O(n )（执行n-1次合并和m≥n次查找）。其中 是一个增长极其缓慢的函数，它是阿克曼函数（Ackermann Function）的某个反函数。它可以看作是小于5的。所以可以认为并查集的时间复杂度几乎是线性的。</p>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>这个中二的名字就是接下来我要重点讲诉的东西，它以多一倍的空间表示了在原有基础上，i的i’（<strong>虚拟id</strong>），如果任何j指向i时都指向i’那么i变动时不就不会印象j的指向?<br>预知后事如何，请看下回分解：<br><a href="http://blog.csdn.net/lemonoil/article/details/57085381" target="_blank" rel="external">可持久化并查集（二）——从镜像到动态</a></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/可持久化-并查集/">可持久化 并查集</a>
	  </div>
    

  </section>
</article>
  
</section>


  <nav id="page-nav">
    
    <a class="prev" rel="prev" href="/archives/2017/page/2/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/archives/2017/page/4/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>
  


      <script>setLoadingBarProgress(60);</script>
    </main>
    
    <footer id="footer" class="clearfix">
  
  
	<div class="search">
	  <form name="searchform" id="searchform" class="u-search-form">
	    <input type="text" id="searchinput" class="u-search-input" placeholder="Looking for something?" />
	    <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit">
	      <span class="icon icon-search"></span>
	    </button>
	  </form>
	</div>
	

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/artchen" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/otakism" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
        <a href="https://plus.google.com/+ArtChenOtakism/posts" class="social google"
          target="_blank" rel="external">
          <span class="icon icon-google"></span>
        </a>
      
        <a href="http://weibo.com/otakism/" class="social sina-weibo"
          target="_blank" rel="external">
          <span class="icon icon-sina-weibo"></span>
        </a>
      
    
  </div>
  
  <div>Theme <span class="codename">Typescript</span> designed by <a href="http://rakugaki.me/" target="_blank">Art Chen</a>.</div>
  <div>&copy; <a href="/">PIVIX</a></div>
  
</footer>


    <script>setLoadingBarProgress(80);</script>
    
  </div>

  
<script>
  var disqus_shortname = 'https://lemonoilP.github.io';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>




<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>

<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "google";
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
  
</body>
</html>
