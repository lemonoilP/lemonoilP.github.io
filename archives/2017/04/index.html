<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Archives: 2017/4 | PIVIX</title>
  <meta name="description" content="A minimal hexo theme." />
  <meta name="keywords" content="hexo,theme,typescript,otakism,otaku" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="PIVIX">
<meta property="og:url" content="https://lemonoilP.github.io/archives/2017/04/index.html">
<meta property="og:site_name" content="PIVIX">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PIVIX">
  
  
    <link rel="icon" href="/favicon.png">
  

	<script src="https://use.typekit.net/eyf3hir.js"></script>
  <script>try{Typekit.load({ async: false });}catch(e){}</script>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
  

</head>

<body>
  
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

  <script>setLoadingBarProgress(20)</script>
  
  <div id="site-wrapper">
    
    <header id="header">
	<div id="header-wrapper" class="clearfix">
		<a id="logo" href="/">
			<img src="/images/logo.png" />
			<span id="site-desc">
			  otaku keeps alive
      </span>
		</a>
		<button id="site-nav-switch">
	    <span class="icon icon-menu"></span>
	  </button>
	</div>
	<aside id="site-menu">
  	<nav>
  		
        <a href="/" class="nav-home nav">
          Home
        </a>
      
        <a href="/about" class="nav-about nav">
          About
        </a>
      
        <a href="/archives" class="nav-archives nav">
          Archives
        </a>
      
    </nav>
	</aside>
</header>
    <script>setLoadingBarProgress(40);</script>
    
    <main id="main" role="main">
      
	


	<section class="page-header archive">
    <h1>- <span>2017.4</span> -</h1>
  </section>




<section class="post-list">
	
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/杂题-NOI/">
      杂题---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="救生员的小小问题"><a href="#救生员的小小问题" class="headerlink" title="救生员的小小问题"></a>救生员的小小问题</h1><p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1492151237&amp;di=63078ba6178cb7c887bb4de3469badf1&amp;imgtype=jpg&amp;er=1&amp;src=http%3A%2F%2Fd.hiphotos.baidu.com%2Fzhidao%2Fpic%2Fitem%2F5882b2b7d0a20cf40a46ff2e74094b36adaf9968.jpg" alt=""><br>Description<br>七濑遥作为游泳池的救生员，他正在池边游荡，突然看到一个小女孩落水了！他必须立刻行动！<br>七濑遥工作的泳池是一个凸 n 边形，他在地面上单位距离移动的时间为 tg，在水中单位距离移动的时间为 tw。因为七濑遥有特殊的入水技巧，所以入水和上岸不需要时间。一开始七濑遥站在多边形的边上，而小女孩在多边形的内部。<br>Task<br>Input<br>第一行一个整数 n。<br>第二行 n 对整数 (xi, yi) 表示多边形顶点的坐标，按逆时针排列。<br>接下来一行一个整数 tg。<br>接下来一行一个整数 tw。<br>接下来一行两个整数 (xs, ys) 表示七濑遥的位置，保证在多边形的边上。<br>接下来一行两个整数 (xt, yt) 表示小女孩的位置，保证在多边形的内部。<br>Output<br>输出一个浮点数表示最短时间，四舍五入保留 6 位小数。<br>Sample I<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 5<br>9 5<br>Output<br>108.000000<br>Sample II<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 0<br>9 1<br>Output<br>96.633250<br>Sample III<br>Input<br>4<br>0 0 10 0 10 10 0 10<br>10<br>12<br>0 1<br>9 1<br>Output<br>103.266499<br>Sample IV<br>Input<br>8<br>2 0 4 0 6 2 6 4 4 6 2 6 0 4 0 2<br>10<br>12<br>3 0<br>3 5<br>Output<br>60.000000<br>Constraint<br>对于 100% 的数据，3≤n≤10，−100≤xi, yi, xs, ys, xt, yt≤100，1≤tg&lt;tw≤100。</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//orz 又短又快。。。</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> ldb;</div><div class="line"><span class="keyword">const</span> ldb eps=<span class="number">1e-8</span>;</div><div class="line"><span class="keyword">int</span> n,dx[<span class="number">20</span>],dy[<span class="number">20</span>],tg,tw;</div><div class="line"><span class="keyword">int</span> sx,sy,tx,ty,bg;</div><div class="line">ldb ans=<span class="number">1e20</span>,dis=<span class="number">0</span>,lstx,lsty;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">cross</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> (x2-x1)*(y-y1)-(y2-y1)*(x-x1);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="keyword">inline</span> <span class="title">nxt</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x==n?<span class="number">1</span>:x+<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="keyword">inline</span> <span class="title">lst</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x==<span class="number">1</span>?n:x<span class="number">-1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">dist</span><span class="params">(ldb x1,ldb y1,ldb x2,ldb y2)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">calc</span><span class="params">(ldb x,ldb y,ldb x1,ldb y1)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> dist(x,y,x1,y1)*tg+dist(x1,y1,tx,ty)*tw;</div><div class="line">&#125;</div><div class="line"><span class="function">ldb <span class="title">solve</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line">	ldb lx=x1,ly=y1,rx=x2,ry=y2;</div><div class="line">	<span class="keyword">while</span>(<span class="built_in">fabs</span>(lx-rx)&gt;eps||<span class="built_in">fabs</span>(ly-ry)&gt;eps)&#123;</div><div class="line">		ldb x1=(lx+lx+rx)/<span class="number">3.0</span>,y1=(ly+ly+ry)/<span class="number">3.0</span>;</div><div class="line">		ldb x2=(lx+rx+rx)/<span class="number">3.0</span>,y2=(ly+ry+ry)/<span class="number">3.0</span>;</div><div class="line">		ldb ans1=calc(x,y,x1,y1),ans2=calc(x,y,x2,y2);</div><div class="line">		<span class="keyword">if</span>(ans1&gt;ans2)lx=x1,ly=y1;</div><div class="line">		<span class="keyword">else</span> rx=x2,ry=y2;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> calc(x,y,lx,ly);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;dx[i],&amp;dy[i]);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d%d%d"</span>,&amp;tg,&amp;tw,&amp;sx,&amp;sy,&amp;tx,&amp;ty);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)</div><div class="line">		<span class="keyword">if</span>(cross(dx[i],dy[i],dx[nxt(i)],dy[nxt(i)],sx,sy)==<span class="number">0</span>)&#123;bg=i;<span class="keyword">break</span>;&#125;</div><div class="line">	ans=min(ans,solve(dx[bg],dy[bg],dx[nxt(bg)],dy[nxt(bg)],lstx=sx,lsty=sy));</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=nxt(bg);i!=bg;i=nxt(i))&#123;</div><div class="line">		dis+=dist(dx[i],dy[i],lstx,lsty);</div><div class="line">		ans=min(ans,solve(dx[i],dy[i],dx[nxt(i)],dy[nxt(i)],lstx=dx[i],lsty=dy[i])+dis*tg);</div><div class="line">	&#125;</div><div class="line">	dis=<span class="number">0</span>,lstx=sx,lsty=sy;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=lst(bg);i!=bg;i=lst(i))&#123;</div><div class="line">		dis+=dist(dx[nxt(i)],dy[nxt(i)],lstx,lsty);</div><div class="line">		ans=min(ans,solve(dx[nxt(i)],dy[nxt(i)],dx[i],dy[i],lstx=dx[nxt(i)],lsty=dy[nxt(i)])+dis*tg);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.6lf"</span>,ans);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="新司机的小小问题"><a href="#新司机的小小问题" class="headerlink" title="新司机的小小问题"></a>新司机的小小问题</h1><p><img src="http://pic.qingkong.net/pic/tuku/11eyes07.jpg" alt=""><br>Description<br>最近周日天同学因为资金短缺，当起了兼职司机。</p>
<p>有 N 个点，M 个乘客。日天用一款叫“dada”的 app 知道了每个人的出行计划。乘客 i 会在 Ti 时刻在 Ai 上车，下车地点为 Bi。设其乘车时间为 Si，则乘客 i 会支付 max{0, Pi−Si}。日天的出租车最多可以同时坐 K 个人（不包括司机），他 0 时刻在 1 号点。</p>
<p>求日天同学最多能赚多少钱。</p>
<p>Task<br>Input</p>
<p>第一行有 3 个整数 N, M, K。</p>
<p>接下来 M 行，每行 4 个整数 Ti, Ai, Bi, Pi。</p>
<p>接下来一个 N×N 的整数矩阵，Dij 表示从 i 号点到 j 号点要花的时间。</p>
<p>Output</p>
<p>输出一个整数表示日天同学最多能赚多少钱。</p>
<p>Sample I<br>Input</p>
<p>3 2 1<br>1 1 3 10<br>2 2 1 100<br>0 1 2<br>1 0 2<br>2 2 0<br>Output</p>
<p>99<br>Sample II<br>Input</p>
<p>2 2 2<br>2 1 2 100<br>50 2 1 1000<br>0 50<br>50 0<br>Output</p>
<p>950<br>Sample III<br>Input</p>
<p>2 2 2<br>2 1 2 100<br>50 2 1 1000<br>0 48<br>50 0<br>Output</p>
<p>1002<br>Constraint<br>对于 10% 的数据，K=1。</p>
<p>对于 100% 的数据，1≤N, M≤20，1≤K≤4，Ti&lt;Ti+1，1≤Ai, Bi≤N, Ai≠Bi，0≤Pi≤1000，0≤Dij≤100，Dii=0。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cctype&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;deque&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ls (oo &lt;&lt; 1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rs (oo &lt;&lt; 1 | 1)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mid ((L + R) / 2)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(a, x) memset(a, x, sizeof a)</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">25</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">7005</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> t, x, y, p;</div><div class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Node &amp;a) <span class="keyword">const</span> &#123; <span class="keyword">return</span> t &lt; a.t; &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Node a[MAXN];</div><div class="line"><span class="keyword">int</span> G[MAXN][MAXN];</div><div class="line"><span class="keyword">int</span> idx[MAXM], state[<span class="number">1</span> &lt;&lt; <span class="number">20</span>], num[MAXM], cnt;</div><div class="line"><span class="keyword">int</span> dp[<span class="number">20</span>][MAXM];</div><div class="line"><span class="keyword">int</span> S[<span class="number">5</span>], vis[<span class="number">5</span>], top;</div><div class="line"><span class="keyword">int</span> n, m, K;</div><div class="line"><span class="keyword">int</span> ans;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> x, <span class="keyword">int</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cur &gt; K)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">if</span> (x == m) &#123;</div><div class="line">        idx[cnt] = s;</div><div class="line">        num[cnt] = cur;</div><div class="line">        state[s] = cnt++;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    dfs(cur, x + <span class="number">1</span>, s &lt;&lt; <span class="number">1</span>);</div><div class="line">    dfs(cur + <span class="number">1</span>, x + <span class="number">1</span>, s &lt;&lt; <span class="number">1</span> | <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> now, <span class="keyword">int</span> val, <span class="keyword">int</span> pos, <span class="keyword">int</span> s, <span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cur == top) &#123;</div><div class="line">        <span class="keyword">if</span> (s == <span class="number">0</span>)</div><div class="line">            ans = max(ans, val);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = x; i &lt; m; ++i) &#123;</div><div class="line">            <span class="keyword">int</span> k = state[s | (<span class="number">1</span> &lt;&lt; i)];</div><div class="line">            <span class="keyword">if</span> (now + G[pos][a[i].x] &lt;= a[i].t)</div><div class="line">                dp[i][k] = max(dp[i][k], val);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; top; ++i)</div><div class="line">        <span class="keyword">if</span> (!vis[i]) &#123;</div><div class="line">            vis[i] = <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> v = S[i], nxt = now + G[pos][a[v].y];</div><div class="line">            dfs2(cur + <span class="number">1</span>, nxt, val + max(a[v].p + a[v].t - nxt, <span class="number">0</span>), a[v].y, s,</div><div class="line">                 x);</div><div class="line">            vis[i] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    cnt = <span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;K);</div><div class="line">    dfs(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;a[i].t, &amp;a[i].x, &amp;a[i].y, &amp;a[i].p);</div><div class="line">        a[i].x--;</div><div class="line">        a[i].y--;</div><div class="line">    &#125;</div><div class="line">    sort(a, a + m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;G[i][j]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; ++k) &#123; <span class="comment">// floyd</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; ++j) &#123;</div><div class="line">                G[i][j] = min(G[i][j], G[i][k] + G[k][j]);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    clr(dp, <span class="number">-1</span>);</div><div class="line">    ans = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (G[<span class="number">0</span>][a[i].x] &lt;= a[i].t)</div><div class="line">            dp[i][state[<span class="number">1</span> &lt;&lt; i]] = max(dp[i][state[<span class="number">1</span> &lt;&lt; i]], <span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; cnt; ++j)</div><div class="line">            <span class="keyword">if</span> (dp[i][j] != <span class="number">-1</span>) &#123;</div><div class="line">                <span class="keyword">int</span> st = idx[j];</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = st; ~k; k = k ? (st &amp; (k - <span class="number">1</span>)) : <span class="number">-1</span>) &#123;</div><div class="line">                    top = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">int</span> tmp = <span class="number">0</span>;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; m; ++l) &#123;</div><div class="line">                        <span class="keyword">if</span> (k &amp; (<span class="number">1</span> &lt;&lt; l))</div><div class="line">                            S[top++] = l;</div><div class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (st &amp; (<span class="number">1</span> &lt;&lt; l))</div><div class="line">                            ++tmp;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (tmp &lt; K)</div><div class="line">                        dfs2(<span class="number">0</span>, a[i].t, dp[i][j], a[i].x, st ^ k, i + <span class="number">1</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"Taxi.in"</span>,<span class="string">"r"</span>, <span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"Taxi.out"</span>,<span class="string">"w"</span>, <span class="built_in">stdout</span>);</div><div class="line">    solve();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="龙女仆的小小问题"><a href="#龙女仆的小小问题" class="headerlink" title="龙女仆的小小问题"></a>龙女仆的小小问题</h1><p><img src="http://pic.qingkong.net/pic/tuku/11eyes08.jpg" alt=""><br>Description<br>康娜是一个聪明的小孩，经常玩一些益智游戏。但她并不满足于玩别人发明的游戏，她也想着创造一些新的游戏玩法。</p>
<p>某日，康娜灵机一动，又想到了一个数学游戏并且编写了程序给大家玩。首先给定一个整数 M，接着系统随机排列 0 到 M−1 之间的不重复的 M 个数。假设这 M 个数保存在数组 A 中，接着系统给出一个大小也为 M 的数组 B，以及一个非负整数 D。</p>
<p>游戏开始后，每一轮玩家只能执行下面的其中一种操作：</p>
<p>从当前未被选择的数中选一个数 Ai 作为“当前数”，付出 Bi 的代价。<br>设“当前数”为 Ai，对于任意还未被选择的 Aj，如果 j&gt;i 并且存在最小的非负整数 k 使得 Aj≡Ai⋅Dk(modM)，就可以选择 Aj 作为“当前数”，付出 k(Aj+1) 的代价。<br>注意：</p>
<p>第一轮玩家只能进行操作 1。<br>对于操作 2，假设 00=1。<br>游戏的目标是选完所有数，并且代价最小。</p>
<p>Task<br>Input</p>
<p>第一行有两个整数 M, D。</p>
<p>接着一行有 M 个数，表示数组 A 中的 M 个数。</p>
<p>接着一行有 M 个数，表示数组 B 中的 M 个数。</p>
<p>Output</p>
<p>输出通过游戏的最小代价。</p>
<p>Sample I<br>Input</p>
<p>3 2<br>0 2 1<br>10 20 30<br>Output</p>
<p>32<br>Explanation</p>
<p>先用操作 1 选择 0，再用操作 1 选择 2，再用操作 2 选择 1，10+20+2=32。</p>
<p>Sample II<br>Input</p>
<p>3 3<br>1 2 0<br>1 5 3<br>Output</p>
<p>7<br>Explanation</p>
<p>先用操作 1 选择 1，再用操作 2 选择 0，再用操作 1 选择 2，1+1+5=7。</p>
<p>Constraint<br>对于 100% 的数据，1≤M≤100，0≤D≤109，0≤Bi≤100。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//orz root 大佬强无敌</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> _GLIBCXX_IOSTREAM</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> uint;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> lf;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> llf;</div><div class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> xx first</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> yy second</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">max</span><span class="params">(T a,T b)</span></span>&#123;<span class="keyword">return</span> a&gt;b?a:b;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">min</span><span class="params">(T a,T b)</span></span>&#123;<span class="keyword">return</span> a&lt;b?a:b;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">abs</span><span class="params">(T a)</span></span>&#123;<span class="keyword">return</span> a&gt;<span class="number">0</span>?a:-a;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">repr</span><span class="params">(T &amp;a,T b)</span></span>&#123;<span class="keyword">return</span> a&lt;b?a=b,<span class="number">1</span>:<span class="number">0</span>;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">repl</span><span class="params">(T &amp;a,T b)</span></span>&#123;<span class="keyword">return</span> a&gt;b?a=b,<span class="number">1</span>:<span class="number">0</span>;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">gcd</span><span class="params">(T a,T b)</span></span>&#123;T t;<span class="keyword">if</span>(a&lt;b)&#123;<span class="keyword">while</span>(a)&#123;t=a;a=b%a;b=t;&#125;<span class="keyword">return</span> b;&#125;<span class="keyword">else</span>&#123;<span class="keyword">while</span>(b)&#123;t=b;b=a%b;a=t;&#125;<span class="keyword">return</span> a;&#125;&#125;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function"><span class="keyword">inline</span> T <span class="title">sqr</span><span class="params">(T x)</span></span>&#123;<span class="keyword">return</span> x*x;&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mp(a,b) std::make_pair(a,b)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> I inline</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mset(a,b) memset(a,b,sizeof(a))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mcpy(a,b) memcpy(a,b,sizeof(a))</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo0(i,n) for(int i=0,i##end=n;i&lt;i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo1(i,n) for(int i=1,i##end=n;i&lt;=i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(i,a,b) for(int i=a,i##end=b;i&lt;=i##end;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd0(i,n) for(int i=(n)-1;~i;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd1(i,n) for(int i=n;i;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fd(i,a,b) for(int i=a,i##end=b;i&gt;=i##end;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> foe(i,x)for(__typeof(x.end())i=x.begin();i!=x.end();++i)</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cg</span>&#123;</span><span class="function">I <span class="keyword">char</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> getchar();&#125;&#125;;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cp</span>&#123;</span><span class="function">I <span class="keyword">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;<span class="built_in">putchar</span>(x);&#125;&#125;;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> OP operator</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RT return *this;</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> RX x=0;char t=P();while((t<span class="meta-string">&lt;'0'||t&gt;'9')&amp;&amp;t!='-')t=P();bool f=0;\</span></span></div><div class="line"><span class="keyword">if</span>(t==<span class="string">'-'</span>)t=P(),f=<span class="number">1</span>;x=t-<span class="string">'0'</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P())x=x*<span class="number">10</span>+t-<span class="string">'0'</span></div><div class="line">#define RL <span class="keyword">if</span>(t==<span class="string">'.'</span>)&#123;lf u=<span class="number">0.1</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P(),u*=<span class="number">0.1</span>)x+=u*(t-<span class="string">'0'</span>);&#125;<span class="keyword">if</span>(f)x=-x</div><div class="line">#define RU x=<span class="number">0</span>;<span class="keyword">char</span> t=P();<span class="keyword">while</span>(t&lt;<span class="string">'0'</span>||t&gt;<span class="string">'9'</span>)t=P();x=t-<span class="string">'0'</span>;<span class="keyword">for</span>(t=P();t&gt;=<span class="string">'0'</span>&amp;&amp;t&lt;=<span class="string">'9'</span>;t=P())x=x*<span class="number">10</span>+t-<span class="string">'0'</span></div><div class="line">#define TR *<span class="keyword">this</span>,x;<span class="keyword">return</span> x;</div><div class="line"><span class="function">I <span class="keyword">bool</span> <span class="title">IS</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;<span class="keyword">return</span> x==<span class="number">10</span>||x==<span class="number">13</span>||x==<span class="string">' '</span>;&#125;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="class"><span class="keyword">struct</span> <span class="title">Fr</span>&#123;</span>T P;I Fr&amp;OP,(<span class="keyword">int</span> &amp;x)</div><div class="line">&#123;RX;<span class="keyword">if</span>(f)x=-x;RT&#125;<span class="function">I OP <span class="title">int</span><span class="params">()</span></span>&#123;<span class="keyword">int</span> x;TR&#125;I Fr&amp;OP,(ll &amp;x)&#123;RX;<span class="keyword">if</span>(f)x=-x;RT&#125;<span class="function">I OP <span class="title">ll</span><span class="params">()</span></span>&#123;ll x;TR&#125;I Fr&amp;OP,(<span class="keyword">char</span> &amp;x)</div><div class="line">&#123;<span class="keyword">for</span>(x=P();IS(x);x=P());RT&#125;<span class="function">I OP <span class="title">char</span><span class="params">()</span></span>&#123;<span class="keyword">char</span> x;TR&#125;I Fr&amp;OP,(<span class="keyword">char</span> *x)&#123;<span class="keyword">char</span> t=P();<span class="keyword">for</span>(;IS(t);t=P());<span class="keyword">if</span>(~t)&#123;</div><div class="line"><span class="keyword">for</span>(;!IS(t)&amp;&amp;~t;t=P())*x++=t;&#125;*x++=<span class="number">0</span>;RT&#125;I Fr&amp;OP,(lf &amp;x)&#123;RX;RL;RT&#125;<span class="function">I OP <span class="title">lf</span><span class="params">()</span></span>&#123;lf x;TR&#125;I Fr&amp;OP,(llf &amp;x)&#123;RX;RL;RT&#125;<span class="function">I OP <span class="title">llf</span><span class="params">()</span></span>&#123;llf x;TR&#125;</div><div class="line">I Fr&amp;OP,(uint &amp;x)&#123;RU;RT&#125;<span class="function">I OP <span class="title">uint</span><span class="params">()</span></span>&#123;uint x;TR&#125;I Fr&amp;OP,(ull &amp;x)&#123;RU;RT&#125;<span class="function">I OP <span class="title">ull</span><span class="params">()</span></span>&#123;ull x;TR&#125;&#125;;Fr&lt;Cg&gt;in;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WI(S) <span class="meta-keyword">if</span>(x)&#123;<span class="meta-keyword">if</span>(x&lt;0)P(<span class="meta-string">'-'</span>),x=-x;char s[S],c=0;while(x)s[c++]=x%10+<span class="meta-string">'0'</span>,x/=10;while(c--)P(s[c]);&#125;<span class="meta-keyword">else</span> P(<span class="meta-string">'0'</span>)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WL <span class="meta-keyword">if</span>(y)&#123;lf t=0.5;for(int i=y;i--;)t*=0.1;<span class="meta-keyword">if</span>(x&gt;=0)x+=t;<span class="meta-keyword">else</span> x-=t,P(<span class="meta-string">'-'</span>);*this,(ll)(abs(x));P(<span class="meta-string">'.'</span>);<span class="meta-keyword">if</span>(x&lt;0)x=-x;\</span></div><div class="line"><span class="keyword">while</span>(y--)&#123;x*=<span class="number">10</span>;x-=<span class="built_in">floor</span>(x*<span class="number">0.1</span>)*<span class="number">10</span>;P(((<span class="keyword">int</span>)x)%<span class="number">10</span>+<span class="string">'0'</span>);&#125;&#125;<span class="keyword">else</span> <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)*<span class="keyword">this</span>,(ll)(x+<span class="number">0.5</span>);<span class="keyword">else</span> *<span class="keyword">this</span>,(ll)(x<span class="number">-0.5</span>);</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WU(S) <span class="meta-keyword">if</span>(x)&#123;char s[S],c=0;while(x)s[c++]=x%10+<span class="meta-string">'0'</span>,x/=10;while(c--)P(s[c]);&#125;<span class="meta-keyword">else</span> P(<span class="meta-string">'0'</span>)</span></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="class"><span class="keyword">struct</span> <span class="title">Fw</span>&#123;</span>T P;I Fw&amp;OP,(<span class="keyword">int</span> x)&#123;WI(<span class="number">10</span>);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;WI(<span class="number">10</span>);RT&#125;I Fw&amp;OP,(uint x)&#123;WU(<span class="number">10</span>);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(uint x)</span></span>&#123;WU(<span class="number">10</span>);RT&#125;I Fw&amp;OP,(ll x)&#123;WI(<span class="number">19</span>);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(ll x)</span></span>&#123;WI(<span class="number">19</span>);RT&#125;I Fw&amp;OP,(ull x)&#123;WU(<span class="number">20</span>);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(ull x)</span></span>&#123;WU(<span class="number">20</span>);RT&#125;I Fw&amp;OP,(<span class="keyword">char</span> x)&#123;P(x);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">char</span> x)</span></span>&#123;P(x);RT&#125;I Fw&amp;OP,(<span class="keyword">const</span> <span class="keyword">char</span> *x)&#123;<span class="keyword">while</span>(*x)P(*x++);RT&#125;</div><div class="line"><span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *x)</span></span>&#123;<span class="keyword">while</span>(*x)P(*x++);RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(lf x,<span class="keyword">int</span> y)</span></span>&#123;WL;RT&#125;<span class="function">I Fw&amp;<span class="title">OP</span><span class="params">()</span><span class="params">(llf x,<span class="keyword">int</span> y)</span></span>&#123;WL;RT&#125;&#125;;Fw&lt;Cp&gt;out;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">205</span>,M=<span class="number">400000</span>,Nf=<span class="number">255</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span></span></div><div class="line"><span class="class">&#123;</span></div><div class="line">	<span class="keyword">int</span> to,w,ne,v;</div><div class="line">&#125;e[M*<span class="number">2</span>+<span class="number">2</span>];</div><div class="line"></div><div class="line"><span class="keyword">int</span> p[N+<span class="number">1</span>],em=<span class="number">2</span>,q[N&lt;&lt;<span class="number">1</span>],qe,fa[N+<span class="number">1</span>],dis[N+<span class="number">1</span>];</div><div class="line"><span class="keyword">bool</span> vis[N+<span class="number">1</span>];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> w,<span class="keyword">int</span> v)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	e[em].to=b,e[em].w=w,e[em].v=v,e[em].ne=p[a],p[a]=em++;</div><div class="line">	e[em].to=a,e[em].w=<span class="number">0</span>,e[em].v=-v,e[em].ne=p[b],p[b]=em++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">wxhcoder</span><span class="params">(<span class="keyword">int</span> s,<span class="keyword">int</span> t,<span class="keyword">int</span> &amp;cost)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	cost=<span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> flow=<span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="built_in">memset</span>(dis,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(dis));</div><div class="line">		<span class="built_in">memset</span>(fa,<span class="number">0x3f</span>,<span class="keyword">sizeof</span>(fa));</div><div class="line">		dis[s]=<span class="number">0</span>; </div><div class="line">		vis[s]=<span class="number">1</span>;</div><div class="line">		q[<span class="number">0</span>]=s,qe=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i^qe;i++)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> k=q[i&amp;Nf];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=p[k];j;j=e[j].ne)</div><div class="line">				<span class="keyword">if</span>(e[j].w&amp;&amp;dis[e[j].to]&gt;dis[k]+e[j].v)</div><div class="line">				&#123;</div><div class="line">					dis[e[j].to]=dis[k]+e[j].v;</div><div class="line">					fa[e[j].to]=j^<span class="number">1</span>;</div><div class="line">					<span class="keyword">if</span>(!vis[e[j].to])q[(qe++)&amp;Nf]=e[j].to,vis[e[j].to]=<span class="number">1</span>;</div><div class="line">				&#125;</div><div class="line">			vis[k]=<span class="number">0</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(fa[t]==<span class="number">0x3f3f3f3f</span>)<span class="keyword">break</span>;</div><div class="line">		<span class="keyword">int</span> rfl=<span class="number">0x7fffffff</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=e[fa[i]].to)</div><div class="line">			repl(rfl,e[fa[i]^<span class="number">1</span>].w);</div><div class="line">		cost+=dis[t]*rfl;</div><div class="line">		flow+=rfl;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=t;i!=s;i=e[fa[i]].to)</div><div class="line">			e[fa[i]].w+=rfl,e[fa[i]^<span class="number">1</span>].w-=rfl;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> flow;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> n,m,a[<span class="number">100</span>],b[<span class="number">100</span>],g[<span class="number">100</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	in,n,m;</div><div class="line">	fo0(i,n)in,a[i];</div><div class="line">	fo0(i,n)in,b[i];</div><div class="line">	<span class="keyword">int</span> S=n*<span class="number">2</span>,T=n*<span class="number">2</span>+<span class="number">1</span>;</div><div class="line">	fo0(i,n)add(S,i,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	fo0(i,n)add(i+n,T,<span class="number">1</span>,<span class="number">0</span>);</div><div class="line">	fo0(i,n)</div><div class="line">	&#123;</div><div class="line">		mset(g,<span class="number">0xff</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x=a[i],j=<span class="number">0</span>;!~g[x];x=(ll)x*m%n,j++)</div><div class="line">			g[x]=j;</div><div class="line">		fo(j,i+<span class="number">1</span>,n<span class="number">-1</span>)<span class="keyword">if</span>(~g[a[j]])add(i,j+n,<span class="number">1</span>,g[a[j]]*(a[j]+<span class="number">1</span>));</div><div class="line">	&#125;</div><div class="line">	fo0(i,n)add(S,i+n,<span class="number">1</span>,b[i]);</div><div class="line">	<span class="keyword">int</span> cost,flow=wxhcoder(S,T,cost);</div><div class="line">	out,cost,<span class="string">'\n'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/杂题-NOI/">杂题 NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/DP-NOI/">
      DP---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="飞镖"><a href="#飞镖" class="headerlink" title="飞镖"></a>飞镖</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/dongh.jpg" alt=""><br>【题目描述】<br>小N 和小A 在玩扔飞镖游戏，N<em>M的格子上每个格子有一个0~9 的数<br>字，因为他们技术都不是特别厉害，所以如果瞄准了(x,y)这个格子，就会<br>等概率打中以这个格子为中心的3</em>3 的格子。他们一共轮流投了K 轮飞<br>镖，每一轮都是小N 先投，投完后小A 投。小N 和小A 都十分聪明，他<br>们一定会选择最优的策略，小A 想知道他获胜的概率是多少呢（平局情况<br>视为小A 获胜0.5 局）？<br>【输入数据】<br>第一行2 个整数N,M<br>接下来N 行每行M个整数表示这个格子的分数。<br>最后一个整数K 表示他们投的轮数。<br>【输出数据】<br>输出小A 获胜的概率，保留4 位小数。<br>【样例输入】<br> 7 3<br>8 8 8<br>8 0 8<br>8 8 8<br>0 0 0<br>0 0 0<br>9 9 9<br>9 9 9<br>1<br>【样例输出】<br>0.5370<br>【数据范围】<br>30%的数据满足K≤2。<br>100%的数据满足N,M,K≤20。 </p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>Ada<br>我们考虑一次操作，能影响这次操作决策的仅仅是两为选手的分差，于是可以用一个数组F[0..1][i][j]，表示当前轮到第1（2）个人操作时，还剩下j轮没有操作，当前两人分差时i的获胜概率。这样当j=0时可以直接算出F,然后考虑转移：枚举这个人选择的扔的地点是哪里，然后九个格子取平均（用之前已经算过的F，这时考虑分差的加减），然后对所有扔的地点取获胜概率的最大值即可。<br>时间复杂度：O（N<em>M</em>9K*K）</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lf double</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> cha 190</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 25</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,k,a[N][N];</div><div class="line"><span class="keyword">int</span> fx[<span class="number">10</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</div><div class="line"><span class="keyword">int</span> fy[<span class="number">10</span>]=&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;;</div><div class="line">lf f[N][<span class="number">400</span>],g[N][<span class="number">400</span>];<span class="comment">//gÏÈÊÖ,fºóÊÖ </span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span> (c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) f=(c==<span class="string">'-'</span>)?<span class="number">-1</span>:<span class="number">1</span>,c=getchar();</div><div class="line">	<span class="keyword">while</span> (c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>) x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"ada.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"ada.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=read(),m=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)	<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;=m; j++)	a[i][j]=read();</div><div class="line">	k=read();</div><div class="line">	f[<span class="number">0</span>][cha]=<span class="number">0.5</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">9</span>*k; i++) f[<span class="number">0</span>][i+cha]=<span class="number">1.0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=k; i++) &#123; <span class="comment">//ÂÖÊý </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=-(k-i+<span class="number">1</span>)*<span class="number">9</span>; j&lt;=(k-i+<span class="number">1</span>)*<span class="number">9</span>; j++) <span class="comment">//·Ö²î·¶Î§ </span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">2</span>; x&lt;n; x++) <span class="comment">//Ã¶¾Ùµã </span></div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">2</span>; y&lt;m; y++) &#123;</div><div class="line">					lf res=<span class="number">0</span>;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> kk=<span class="number">0</span>; kk&lt;<span class="number">9</span>; kk++)</div><div class="line">						res+=f[i<span class="number">-1</span>][j-a[x+fx[kk]][y+fy[kk]]+cha]; <span class="comment">//ÖÜÎ§9¸öµã </span></div><div class="line">					g[i][j+cha]=max(g[i][j+cha],<span class="number">1.0</span>-res/<span class="number">9</span>);</div><div class="line">				&#125;</div><div class="line">	<span class="comment">//¸´ÔÓ¶ÈO(20*20*9*2*20*20) </span></div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j=-(k-i)*<span class="number">9</span>; j&lt;=(k-i)*<span class="number">9</span>; j++)</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> x=<span class="number">2</span>; x&lt;n; x++)</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> y=<span class="number">2</span>; y&lt;m; y++) &#123;</div><div class="line">					lf res=<span class="number">0</span>;</div><div class="line">					<span class="keyword">for</span>(<span class="keyword">int</span> kk=<span class="number">0</span>; kk&lt;<span class="number">9</span>; kk++)</div><div class="line">						res+=g[i][j+a[x+fx[kk]][y+fy[kk]]+cha];</div><div class="line">					f[i][j+cha]=max(f[i][j+cha],<span class="number">1.0</span>-res/<span class="number">9</span>);</div><div class="line">				&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,<span class="number">1.0</span>-f[k][cha]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="设计铁路"><a href="#设计铁路" class="headerlink" title="设计铁路"></a>设计铁路</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/a18.jpg" alt=""><br>【题目描述】<br>A 省有一条东西向的公路经常堵车，为解决这一问题，省政府对此展<br>开了调查。调查后得知，这条公路两侧有很多村落，每个村落里都住着很<br>多个信仰c 教的教徒，每周日都会开着自家的车沿公路到B 地去“膜拜”<br>他们的教主，这便是堵车的原因。详细调查显示：这里总共有N 个村<br>落，并且它们都在B 地的东边。编号为i 的村落住有Ri 个信仰c 教的教<br>徒，距离B 地的距离为Ti（单位：公里）。<br>为解决这一问题，A 省政府决定在这条公路下修建一条地下快速铁路<br>来缓解交通，并沿线修建若干个车站（B 地会修建终点站，不算车站）。<br>每名教徒都会先往B 地方向开车（如果他所在村庄处恰好有车站就不必开<br>车了），到最近的一个快速铁路车站时换乘（如果直接开到B 地就不用换<br>乘了），再通过快速铁路到B 地。<br>但A 政府遇到一个难题：修建多少个车站以及在哪修建车站。一个修<br>建车站的方案中，如果修建过多的车站则会花费过多的钱，但修建的车站<br>少了或者修建的位置不对又会导致公路的拥堵。A 政府为了协调这两方<br>面，采用评分的方式来衡量一个方案的好坏（分数越大方案越坏）：每修<br>建一个车站会增加m 的分数，在某一次“膜拜”中（只考虑去，不考虑返<br>回），每导致1 个教徒开车行驶1 公里会增加1 分。<br>现请你设计一个修建车站的方案，使得分数最小。请输出这个最小的<br>分数。<br>【输入说明】<br>输入的第一行包含两个正整数n、m。<br>之后n 行每行两个正整数Ti、Ri。<br>【输出说明】<br>输出一个整数，表示最小的分数。<br>【样例输入】<br>4 20<br>25 3<br>5 3<br>25 2<br>20 5<br>【样例输出】<br>55<br>【数据范围】<br>对于20%的数据，n&lt;=200；<br>对于60%的数据，n&lt;=2000；<br>对于100%的数据，n&lt;=40000，m&lt;=2000000000，Ti&lt;=1000000，Ri&lt;=1000。 </p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>Design<br>典型的动态规划，写出转移方程后可以看出能用斜率优化，直接套模板就好了。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">4e5</span>+<span class="number">5</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">peo</span></span></div><div class="line"><span class="class">&#123;</span></div><div class="line">	<span class="keyword">int</span> pos,num;</div><div class="line">&#125;p[maxn];</div><div class="line"><span class="keyword">int</span> q[maxn],n,m;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[maxn],sum[maxn],ans;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> j)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">return</span> (<span class="keyword">double</span>(dp[k]-dp[j])/<span class="keyword">double</span>(p[k].pos-p[j].pos));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(peo x,peo y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">return</span> x.pos&lt;y.pos;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	freopen(<span class="string">"design.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"design.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;p[i].pos,&amp;p[i].num);</div><div class="line">	sort(p+<span class="number">1</span>,p+<span class="number">1</span>+n,cmp);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	sum[i]=sum[i<span class="number">-1</span>]+p[i].num;</div><div class="line">	q[<span class="number">0</span>]=<span class="number">1</span>;<span class="keyword">int</span> l=<span class="number">0</span>,r=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)	dp[<span class="number">0</span>]+=p[i].num*p[i].pos;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">	&#123;</div><div class="line">	    <span class="keyword">while</span>(l&lt;r&amp;&amp;judge(q[l+<span class="number">1</span>],q[l])&lt;=sum[i<span class="number">-1</span>]-sum[n])	l++;</div><div class="line">	    dp[i]=dp[q[l]]+m-(sum[n]-sum[i<span class="number">-1</span>])*(p[i].pos-p[q[l]].pos);</div><div class="line">	    <span class="keyword">while</span>(l&lt;r&amp;&amp;judge(i,q[r])&lt;judge(q[r],q[r<span class="number">-1</span>]))	r--;</div><div class="line">	    q[++r]=i;</div><div class="line">	&#125;</div><div class="line">	ans=<span class="number">0x3f3f3f3f3f3f3f3f</span>ll;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)	ans=min(dp[i],ans);</div><div class="line"><span class="comment">//	printf("%lld\n",ans);</span></div><div class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="双排序"><a href="#双排序" class="headerlink" title="双排序"></a>双排序</h1><p><img src="http://i1.hdslb.com/bfs/archive/aff9cd795ee2174b317bd82724c7d18badefc0eb.jpg" alt=""><br>【题目描述】<br>一个长方形的网格每个格子里有一个小写英文字母。我们称这个网格<br>是双排序(doubly sorted)的，当每一行从左到右都是不下降的，每一列从上<br>到下也是不下降的。在下面的例子中，前两个网格是双排序的，而后两个<br>不是。</p>
<p>  abc ace  aceg base<br>  def ade  cdef base<br>  ghi bdg  xxyy base</p>
<p>  给你一个部分格子填了英文字母的网格。你的任务是计算有多少种方<br>式把剩下的格子填满，使所得网格是双排序的。答案可能很大，你只要输<br>出方案数对10007 取模的余数。<br>【输入数据】<br>第一行一个整数T，表示数据组数。接下来有T 组数据。每组数据的<br>第一行有两个整数R 和C，表示网格的行数和列数。接下来R 行，每行有<br>一个长度为C 的字符串，表示部分填写的网格。每个字符是一个小写英文<br>字母，或’.’（表示这个格子没有被填写）。<br>【输出数据】<br>对每组数据，输出一行。这行包含”Case #X: y”，X 是这组数据的编号<br>（从1 开始），y 是可能的双排序网格的个数，模10007。<br>【样例输入】<br>3<br>2 2<br>ad<br>c.<br>3 3<br>.a.<br>a.z<br>.z.<br>4 4<br>….<br>.a..<br>.kf.<br>….<br>【样例输出】<br>Case #1: 23<br>Case #2: 7569<br>Case #3: 0<br>【数据范围】<br>T = 40<br>每个字符都是’.’或小写字母。<br>对于30%的数据（10s）<br>1 ≤ R, C ≤ 4<br>对于100%的数据（2min）<br>1 ≤ R, C ≤ 10<br><strong>为了防止各位大神AK 完无聊，如果你这题第二个点的内存在64M。内，且时间在1min 内，将给你额外加40 分。</strong></p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>Sort<br>考虑双排序的网格，从左上到右下不减，也就是说对与一个字母c，所有&lt;=c的字母的轮廓线一定是一个从左下到右上的一条路径。然后可以用状态压缩维护这个路径，由于棋盘为10<em>10，那么这条路径包含10个(向右)和十个(向上)，总共个数为C(10,20)。为了避免重复转移，应按照行的顺序将轮廓线向右边推进。<br>时间复杂度：O（C(10,20)</em>N^2×26）</p>
<h2 id="code-2"><a href="#code-2" class="headerlink" title="code"></a>code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">\\wxh大佬果然达成了附加<span class="number">40</span>分的副本！！！</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> xx first</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> yy second</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fill( x, y ) memset( x, y, sizeof x )</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> copy( x, y ) memset( x, y, sizeof x )</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line"><span class="keyword">typedef</span> pair &lt; <span class="keyword">int</span>, <span class="keyword">int</span> &gt; pa;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">12</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXM = <span class="number">200010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXV = <span class="number">1048577</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">10007</span>;</div><div class="line"><span class="keyword">int</span> n, m, h[MAXM], id[MAXV], id_cnt, dp[<span class="number">27</span>][MAXM][MAXN], kth[MAXM][<span class="number">21</span>], cas;</div><div class="line"><span class="keyword">bool</span> vis[<span class="number">27</span>][MAXM][MAXN];</div><div class="line"><span class="keyword">char</span> ch[MAXN][MAXN];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">inc</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> y)</span> </span>&#123; x += y; <span class="keyword">if</span>( x &gt;= mod ) x -= mod; &#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> alpha, <span class="keyword">int</span> S, <span class="keyword">int</span> x)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	<span class="keyword">int</span> &amp;ret = dp[ alpha ][ S ][ x ];</div><div class="line">	<span class="keyword">if</span>( vis[ alpha ][ S ][ x ] ) <span class="keyword">return</span> ret; vis[ alpha ][ S ][ x ] = <span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>( alpha == <span class="number">26</span> ) <span class="keyword">return</span> ret = ( S == id_cnt );</div><div class="line">	<span class="keyword">if</span>( x &lt; m ) ret = dfs( alpha, S, x + <span class="number">1</span> ); <span class="keyword">else</span> ret = dfs( alpha + <span class="number">1</span>, S, <span class="number">1</span> );</div><div class="line">	<span class="keyword">int</span> k = kth[ S ][ x ];</div><div class="line">	<span class="keyword">if</span>( k != n + m - <span class="number">1</span> &amp;&amp; !( h[ S ] &amp; ( <span class="number">1</span> &lt;&lt; k + <span class="number">1</span> ) ) )</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> t = n + m - k - x;</div><div class="line">		<span class="keyword">if</span>( ch[ t ][ x ] == <span class="string">'.'</span> || ch[ t ][ x ] == alpha + <span class="string">'a'</span> ) inc( ret, dfs( alpha, id[ h[ S ] ^ ( <span class="number">1</span> &lt;&lt; k ) ^ ( <span class="number">1</span> &lt;&lt; k + <span class="number">1</span> ) ] , x ) );</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">	fill( vis, <span class="number">0</span> ); id_cnt = <span class="number">0</span>;</div><div class="line">	<span class="built_in">scanf</span>( <span class="string">"%d%d"</span>, &amp;n, &amp;m );</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = n ; i ; i-- )</div><div class="line">		<span class="built_in">scanf</span>( <span class="string">"%s"</span>, ch[ i ] + <span class="number">1</span> );</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; ( <span class="number">1</span> &lt;&lt; n + m ) ; i++ )</div><div class="line">		<span class="keyword">if</span>( __builtin_popcount( i ) == m ) h[ id[ i ] = ++id_cnt ] = i;</div><div class="line">	<span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= id_cnt; i++ )</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> S = h[ i ];</div><div class="line">		<span class="keyword">for</span>( <span class="keyword">int</span> j = n + m - <span class="number">1</span>, t = <span class="number">0</span> ; ~j ; j-- )</div><div class="line">			<span class="keyword">if</span>( S &gt;&gt; j &amp; <span class="number">1</span> )</div><div class="line">				kth[ i ][ ++t ] = j;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>( <span class="string">"Case #%d: %d\n"</span>, ++cas, dfs( <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span> ) );</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FIO <span class="meta-string">"sort"</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> wxh010910</span></div><div class="line">	freopen( <span class="string">"data.in"</span>, <span class="string">"r"</span>, <span class="built_in">stdin</span> );</div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">	freopen( FIO<span class="string">".in"</span> , <span class="string">"r"</span>, <span class="built_in">stdin</span>  );</div><div class="line">	freopen( FIO<span class="string">".out"</span>, <span class="string">"w"</span>, <span class="built_in">stdout</span> );</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">	<span class="keyword">int</span> T;</div><div class="line">	<span class="built_in">scanf</span>( <span class="string">"%d"</span>, &amp;T );</div><div class="line">	<span class="keyword">while</span>( T-- ) solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/DP-NOI/">DP NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/07/最短路-NOI/">
      最短路---NOI
    </a>
  </h2>
  
  <time>
    Apr 7, 2017
  </time>
  <section class="content">
	  <h1 id="最短路径-shortest"><a href="#最短路径-shortest" class="headerlink" title="最短路径(shortest)"></a>最短路径(shortest)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1" alt="">.jpg)</p>
<p>256MB 1seconds<br>【题目描述】<br>给定无向图，包含n个顶点，m条无向边，边上有权值。从1号点出发不经过i号点到达n号点的最短路径计作di，求d2..dn-1。<br>【输入格式】<br>第一行两个正整数n，m，表示点的数量和边的数量。<br>随后m行，每行三个正整数x、y、z，表示x到y的边权值为z。<br>【输出格式】<br>     仅一行，包含n-2个整数，依次为d2..dn-1。<br>【输入样例】<br>4 4<br>1 2 1<br>1 3 1<br>2 4 2<br>3 4 1<br>【输出样例】<br>2 3<br>【数据规模与约定】<br>对于100%的数据，n, m&lt;=200000。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>如果考试的话，我<strong>绝壁</strong>写个SPFA大暴力，最多改写手写循环队列，了事。orz wxh大佬。。。。<br>自己的大暴力。。。。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;set&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x,y) for(int i=x;i&gt;=y;i--)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x,y) for(int i=x;i&lt;=y;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2100000000</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x)  memset(x,0,sizeof(x))</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"ans"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> from,to,dist;</div><div class="line">	Edge(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d):from(u),to(v),dist(d)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">200000</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SPFA</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> n,m;</div><div class="line">	<span class="built_in">vector</span>&lt;Edge&gt; edges;</div><div class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[maxn];</div><div class="line">	<span class="keyword">bool</span> done[maxn];</div><div class="line">	<span class="keyword">int</span> d[maxn];</div><div class="line">	<span class="keyword">int</span> p[maxn];</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</div><div class="line">		<span class="keyword">this</span>-&gt;n=n;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)G[i].clear();</div><div class="line">		edges.clear();</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddEdge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">AddDedge</span><span class="params">(<span class="keyword">int</span> from,<span class="keyword">int</span> to,<span class="keyword">int</span> dist)</span></span>&#123;</div><div class="line">		edges.push_back(Edge(from,to,dist));</div><div class="line">		m=edges.size();</div><div class="line">		G[from].push_back(m<span class="number">-1</span>);</div><div class="line">		edges.push_back(Edge(dist,to,from));</div><div class="line">		m=edges.size();</div><div class="line">		G[dist].push_back(m<span class="number">-1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfa</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)d[i]=INF;</div><div class="line">		d[s]=<span class="number">0</span>;</div><div class="line">		done[s]=<span class="number">1</span>;</div><div class="line">		Q.push(s);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">spfas</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</div><div class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; Q;</div><div class="line">		<span class="built_in">memset</span>(done,<span class="number">0</span>,<span class="keyword">sizeof</span>(done));	</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=n;i++)d[i]=INF;</div><div class="line">		d[<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">		done[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		Q.push(<span class="number">1</span>);</div><div class="line">		<span class="keyword">while</span>(!Q.empty())&#123;</div><div class="line">			<span class="keyword">int</span> u=Q.front();Q.pop();</div><div class="line">			done[u]=<span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;G[u].size();i++)&#123;</div><div class="line">				Edge&amp; e=edges[G[u][i]];</div><div class="line">				<span class="keyword">if</span>(e.to!=s&amp;&amp;d[u]&lt;INF&amp;&amp;d[e.to]&gt;d[u]+e.dist)&#123;</div><div class="line">					d[e.to]=d[u]+e.dist;</div><div class="line">					p[e.to]=G[u][i];</div><div class="line">					<span class="keyword">if</span>(!done[e.to])&#123;</div><div class="line">						Q.push(e.to);</div><div class="line">						done[e.to]=<span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line">SPFA slover;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	slover.init(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">		slover.AddDedge(readin(),readin(),readin());</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">2</span>;i&lt;n;i++)</div><div class="line">		slover.spfas(i),<span class="built_in">cout</span>&lt;&lt;slover.d[n]&lt;&lt;<span class="string">' '</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>fastest正解<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 200100</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lld long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> lld inf = <span class="number">1e18</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,np,next,va;</div><div class="line">	<span class="keyword">bool</span> mark;</div><div class="line">&#125;e[maxn*<span class="number">2</span>];</div><div class="line"><span class="keyword">int</span> head[maxn];</div><div class="line"><span class="keyword">int</span> e_cnt = <span class="number">1</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add_e</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> va)</span></span>&#123;</div><div class="line">	e[++e_cnt] = (edge)&#123;u,v,head[u],va,<span class="number">0</span>&#125;;</div><div class="line">	head[u] = e_cnt;</div><div class="line">	e[++e_cnt] = (edge)&#123;v,u,head[v],va,<span class="number">0</span>&#125;;</div><div class="line">	head[v] = e_cnt;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line">lld dis[maxn],dis_n[<span class="number">2</span>][maxn];</div><div class="line"><span class="keyword">int</span> ide[maxn];</div><div class="line"><span class="keyword">bool</span> inq[maxn];</div><div class="line"><span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; qx;</div><div class="line"><span class="keyword">int</span> co[maxn],co_mx;</div><div class="line"><span class="keyword">int</span> fa[maxn];</div><div class="line">lld anss[maxn];</div><div class="line"><span class="keyword">bool</span> isva[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[x];ne;ne = e[ne].next)&#123;</div><div class="line">		<span class="keyword">if</span>(!e[ne].mark || e[ne].np == fa[x]) <span class="keyword">continue</span>;</div><div class="line">		fa[e[ne].np] = x;</div><div class="line">		<span class="keyword">if</span>(!co[e[ne].np]) co[e[ne].np] = co[x];</div><div class="line">		dfs(e[ne].np);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dat</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> l,r;</div><div class="line">	lld va;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> dat&amp; x) <span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">return</span> va &lt; x.va;</div><div class="line">	&#125;</div><div class="line">&#125;dt[maxn];</div><div class="line"><span class="keyword">int</span> dt_ct = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> pre[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getp</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> x == pre[x]?x:(pre[x]=getp(pre[x]));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=n;++i) anss[i] = dis_n[<span class="number">0</span>][i] = dis_n[<span class="number">1</span>][i] = dis[i] = inf;</div><div class="line">	dis[<span class="number">1</span>] = <span class="number">0</span>;</div><div class="line">	qx.push(<span class="number">1</span>);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne = e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">if</span>(dis[cur] &gt; dis[now] + e[ne].va)&#123;</div><div class="line">				dis[cur] = dis[now] + e[ne].va;</div><div class="line">				ide[cur] = ne;</div><div class="line">				<span class="keyword">if</span>(!inq[cur]) inq[cur]=<span class="number">1</span>,qx.push(cur);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	co_mx = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) ++co_mx;</div><div class="line">	co[n] = co_mx+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> k = ide[n];k;k = ide[e[k].u]) isva[e[k].u] = <span class="number">1</span>,co[e[k].u] = co_mx--;</div><div class="line">	co_mx = co[n];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n;++i) e[ide[i]].mark = e[ide[i] ^ <span class="number">1</span>].mark = <span class="number">1</span>;	</div><div class="line">	dfs(<span class="number">1</span>);</div><div class="line">	dis_n[<span class="number">0</span>][n] = <span class="number">0</span>;</div><div class="line">	qx.push(n);</div><div class="line">	<span class="keyword">while</span>(!qx.empty())&#123;</div><div class="line">		<span class="keyword">int</span> now = qx.front();</div><div class="line">		qx.pop();</div><div class="line">		inq[now] = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> ne = head[now];ne;ne=e[ne].next)&#123;</div><div class="line">			<span class="keyword">int</span> cur = e[ne].np;</div><div class="line">			<span class="keyword">bool</span> fg = <span class="number">0</span>;</div><div class="line">			<span class="keyword">if</span>(dis_n[<span class="number">0</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">				dis_n[<span class="number">0</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">				fg = <span class="number">1</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!isva[cur])&#123;</div><div class="line">				<span class="keyword">if</span>(co[cur] == co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">1</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">1</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span>(co[cur] &lt; co[now])&#123;</div><div class="line">					<span class="keyword">if</span>(dis_n[<span class="number">1</span>][cur] &gt; dis_n[<span class="number">0</span>][now] + e[ne].va)&#123;</div><div class="line">						dis_n[<span class="number">1</span>][cur] = dis_n[<span class="number">0</span>][now] + e[ne].va;</div><div class="line">						fg = <span class="number">1</span>;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(fg &amp;&amp; !inq[cur]) inq[cur] = <span class="number">1</span>,qx.push(cur);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	dis_n[<span class="number">1</span>][n] = <span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= e_cnt;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(e[i].mark) <span class="keyword">continue</span>;</div><div class="line">		<span class="keyword">int</span> u = e[i].u,v = e[i].np,va = e[i].va;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]<span class="number">-1</span>) dt[++dt_ct] = (dat)&#123;co[u]+<span class="number">1</span>,co[v]<span class="number">-1</span>,dis_n[<span class="number">0</span>][v]+va+dis[u]&#125;;</div><div class="line">		<span class="keyword">if</span>(co[u]+<span class="number">1</span> &lt;= co[v]) anss[co[v]] = min(anss[co[v]],dis_n[<span class="number">1</span>][v]+va+dis[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=co_mx+<span class="number">1</span>;++i) pre[i] = i;</div><div class="line">	sort(dt+<span class="number">1</span>,dt+<span class="number">1</span>+dt_ct);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=dt_ct;++i)&#123;</div><div class="line">		<span class="keyword">int</span> l = dt[i].l,r = dt[i].r;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> nxt = getp(l);nxt &lt;= r;)&#123;</div><div class="line">			anss[nxt] = min(anss[nxt],dt[i].va);</div><div class="line">			pre[nxt] = nxt+<span class="number">1</span>;</div><div class="line">			nxt = getp(nxt+<span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i &lt;= n<span class="number">-1</span>;++i)&#123;</div><div class="line">		<span class="keyword">if</span>(!isva[i]) <span class="built_in">printf</span>(<span class="string">"%lld "</span>,dis[n]);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%lld "</span>,anss[co[i]]);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> a1,a2,a3;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"shortest.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"shortest.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=m;++i)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;a1,&amp;a2,&amp;a3);</div><div class="line">		add_e(a1,a2,a3);</div><div class="line">	&#125;</div><div class="line">	solve();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="第一视角-blind"><a href="#第一视角-blind" class="headerlink" title="第一视角(blind)"></a>第一视角(blind)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(2" alt="">.png)<br>【问题描述】<br>QQ：我来给你出道题！给定一个有向图，包含n个点（编号1至n）和m条边，求1号点到2号点的最短路。<br>你：这个问题太简单了，……<br>QQ：我们增加一些难度，这m条边中有一条指定的边坏掉了，它不能经过。问这种情况下1号点到2号点的最短路。<br>你：直接把坏掉的那条边删掉，然后再求最短路不就好了。问题似乎没有变难呀！<br>QQ：这是由于你开了“上帝视角”，你知道哪条边是坏的，当然简单了！如果你是以“第一视角”去寻找最短路，换句话讲，最初你并不知道哪条边是坏的，只有走到“坏边”的起点后，才知道这条边是不能通过的。这种情况下，你要从1号点走到2号点，最少要走多少距离呀。<br>你：那当然要看是哪条边坏掉啦！不同的边坏掉答案是不一样的。<br>QQ：那……你帮我算算，最坏情况下需要走多远。<br>你：好的！马上就去写程序！<br>【输入格式】<br>第一行包含两个正整数n、m，分别表示点数和边数。<br>随后m行，每行三个正整数x、y、w，表示有一条从x到y的有向边，距离为w。<br>【输出格式】<br>仅一行，包含一个正整数，表示最坏情况下需要走多少距离。若不能到达，输出-1。<br>【样例输入】<br>4 6<br>1 3 1<br>1 4 1<br>3 1 5<br>4 1 10<br>3 2 3<br>4 2 2<br>【样例输出】<br>9<br>【样例说明】<br>首先给出一种错误的思路：<br>假设边（1-3）坏了，最短路是1-4-2，距离为3；<br>假设边（1-4）或（4-2）坏了，最短路是1-3-2，距离为4；<br>假设边（3-1）或（4-1）或（3-2）坏了，最短路仍为1-4-2，距离为3；<br>综上，最坏情况下最短路是4。<br>这种思路的错误在于仍然开启了“上帝视角”。换句话讲，它的决策是基于已知哪条边坏掉的。具体地讲，当我站在1号点时并不能确定边（3-2）和边（4-2）中哪条边坏了，此时我必须决定走（1-3）还是（1-4），而不是根据（3-2）和（4-2）哪条坏了这个信息决定走向3还是走向4。<br>下面介绍正确思路。首先站在1号点，确认（1-3）有没有坏。如果（1-3）坏了，直接走1-4-2到达终点，距离仅为3。如果（1-3）没坏，先从1走到3。此时站在3，确认（3-2）有没有坏。如果（3-2）坏了，则从3回到1再经过4最终到达2，整个路径为1-3-1-4-2，距离为9；如果（3-2）没坏，则整个路径为1-3-2，距离为4。综上最坏情况下距离为9。<br>另一种方法是先确认（1-4）有没有坏，如果坏了走1-3-2，如果没坏就走到2再确认（2-4）有没有坏。这种方法最差的可能是1-4-1-3-2，距离为15，不如上一个方法。<br>【数据规模与约定】<br>对于20%的数据，n&lt;=5；<br>对于30%的数据，n&lt;=10；<br>对于50%的数据，n&lt;=20；<br>对于100%的数据，n&lt;=100, m&lt;=500, 边的距离不超过1000。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> y, w, next;</div><div class="line">&#125; <span class="built_in">map</span>[<span class="number">1010</span>];</div><div class="line"><span class="keyword">int</span> num = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> d[<span class="number">110</span>], know[<span class="number">110</span>], head[<span class="number">110</span>], head1[<span class="number">110</span>], flag[<span class="number">110</span>], dis[<span class="number">501</span>][<span class="number">110</span>], dis0[<span class="number">110</span>];</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head[x];</div><div class="line">    head[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">newedge1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> w, <span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="built_in">map</span>[c].y = y;</div><div class="line">    <span class="built_in">map</span>[c].w = w;</div><div class="line">    <span class="built_in">map</span>[c].next = head1[x];</div><div class="line">    head1[x] = c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    freopen(<span class="string">"blind.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">    freopen(<span class="string">"blind.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        head[i] = <span class="number">-1</span>;</div><div class="line">        head1[i] = <span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m; i++) &#123;</div><div class="line">        <span class="keyword">int</span> x, y, w;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;w);</div><div class="line">        newedge(x, y, w, i);</div><div class="line">        newedge1(y, x, w, i+m);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;m; k++) &#123;</div><div class="line">        <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">        d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">        flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis[k][i] = <span class="number">9999999</span>;</div><div class="line">        dis[k][<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">            <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">                <span class="keyword">if</span> (j == k+m) <span class="keyword">continue</span>;</div><div class="line">                <span class="keyword">if</span> (dis[k][i] + <span class="built_in">map</span>[j].w &lt; dis[k][<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    dis[k][<span class="built_in">map</span>[j].y] = dis[k][i] + <span class="built_in">map</span>[j].w;</div><div class="line">                    <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                        flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                        d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            flag[i] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) &#123;</div><div class="line">        know[i] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next)</div><div class="line">            know[i] = max(know[i], dis[j][i]);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> st = <span class="number">0</span>, ed = <span class="number">1</span>;</div><div class="line">    d[<span class="number">0</span>] = <span class="number">2</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) flag[i] = <span class="literal">true</span>;</div><div class="line">    flag[<span class="number">2</span>] = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dis0[i] = <span class="number">9999999</span>;</div><div class="line">    dis0[<span class="number">2</span>] = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (st &lt; ed) &#123;</div><div class="line">        <span class="keyword">int</span> i = d[(st++) % n];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=head1[i]; j&gt;<span class="number">-1</span>; j=<span class="built_in">map</span>[j].next) &#123;</div><div class="line">            <span class="keyword">if</span> (dis0[<span class="built_in">map</span>[j].y] &gt; <span class="built_in">map</span>[j].w + dis0[i] &amp;&amp; dis0[<span class="built_in">map</span>[j].y] &gt; know[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                dis0[<span class="built_in">map</span>[j].y] = max(<span class="built_in">map</span>[j].w + dis0[i], know[<span class="built_in">map</span>[j].y]);</div><div class="line">                <span class="keyword">if</span> (flag[<span class="built_in">map</span>[j].y]) &#123;</div><div class="line">                    flag[<span class="built_in">map</span>[j].y] = <span class="literal">false</span>;</div><div class="line">                    d[(ed++) % n] = <span class="built_in">map</span>[j].y;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        flag[i] = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (dis0[<span class="number">1</span>] == <span class="number">9999999</span>) dis0[<span class="number">1</span>] = <span class="number">-1</span>;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, dis0[<span class="number">1</span>]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="打字机-typewriter"><a href="#打字机-typewriter" class="headerlink" title="打字机(typewriter)"></a>打字机(typewriter)</h1><p><img src="http://gf.ppgame.com/CKFinderJava/1/files/1%20(1" alt="">.png)<br>256MB 1seconds<br>【题目描述】<br>最近，小J在搬家的过程中发现了一台古老的打字机，好奇的小J决定研究如何使用它。<br>首先，需要将一条长度为m的纸带放入打字机。打字机上共有26个按键，分别是小写字母’a’-‘z’。每当你按下一个按键时，打字机就会立即在纸带上打印出那个字符，并将纸带平移一个单位距离。<br>聪明的小J很快就掌握了这款打字机的使用技巧，并尝试一些新的挑战。他拿出了一本字典，挑选了n个单词，并给每个单词设定了分数。纸带中每包含一次指定的单词，就会得到它对应的分数。例如单词’eye’分数为2，’year’分数为3，那么纸带’eyeyeyear’分数为9分。小J希望挑战自己，打出分数最高的纸带。<br>特别地，小J也会偶尔手抖，按到自己并不想输入的字符。由于这台古老的打字机没有退格（删除）功能，所以小J只能接受按错这个事实，重新规划他在按错的情况下如何得最高分。倘若小J有可能在任意位置按错按键，并保证整个过程中按错的次数不超过k次，那么请你算出他在最坏情况下的最高得分是多少。<br>【输入格式】<br>输入数据第一行包含3个非负整数n, m, k，分别表示单词数量、纸带长度和最多按错次数。<br>随后n行，每行包含一个字符串Si和正整数Ai，由空格隔开，描述这个单词及其得分。<br>【输出格式】<br>     仅一行，包含一个整数，表示最坏情况下的最大得分。<br>【输入样例】<br>2 4 1<br>w 1<br>ha 9<br>【输出样例】<br>9<br>【样例说明】<br>首先，展示一种错误的思路：<br>共4种情况，即第1位按错、第2位按错、第3位按错和第4位按错。<br>1、第1位按错（不妨假设按成’x’，下同），最高得分为’xwha’，得分为10。<br>2、第2位按错，最高得分为’wxha’，同样为10分。<br>3、第3位按错，最高得分为’haxw’，同样为10分。<br>4、第4位按错，最高得分为’hawx’，同样为10分。<br>综上，最坏情况下最高得分为10分。<br>这种思路的错误之处在于，你不能根据哪一位按错决定你第一位按哪个键。换一种说法，你在哪一位按错，是要在你按下那一个按键之后才能知道的事情。所以正确的思路如下：<br>    1、第1位先按’h’，倘若按对，goto2，倘若按错，goto4，<br>    2、第2位按’a’，倘若按对，goto3，倘若按错，goto5，<br>    3、第3位第4位均按’w’，至多错1次，最终的纸带为’hawx’或’haxw’，得分为10分。<br>    4、由于已经错过1次，后面不会再错，后面三位按’haw’，最终的纸带为’xhaw’，得分为10分。<br>    5、由于已经错过1次，后面不会再错，后面两位按’ha’，最终纸带为’hxha’，得分为9分。<br>综上，最坏情况下，最高得分为9分。<br>【数据规模与约定】<br>对于30%的数据，n=1；<br>另有30%的数据，k=0；<br>对于100%的数据，n&lt;=100，m&lt;=500，∑|Si|&lt;=500，Ai&lt;=1000，k&lt;=5。</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>不愧是标准正解，不需要数据分治，我还是一只蒟蒻啊！！！！<br>数据三处分治。。有点怂。。。不过在线提交std却会超时，bzoj上我这道题是rank third！！！<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i) for(register int i=0;i&lt;=cnt;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i) for(register int i=1;i&lt;=26;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,j) for(register int i=0;i&lt;j;i++)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; </div><div class="line"><span class="keyword">char</span> s[<span class="number">510</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> di[<span class="number">210</span>][<span class="number">210</span>],ret[<span class="number">210</span>][<span class="number">210</span>],tmp[<span class="number">210</span>][<span class="number">210</span>],ans,M,P,tot;</div><div class="line"><span class="keyword">int</span> a[<span class="number">110</span>],ch[<span class="number">510</span>][<span class="number">27</span>],nxt[<span class="number">510</span>],la[<span class="number">510</span>],w[<span class="number">510</span>],cnt,q[<span class="number">510</span>],h,t,x,y,K,m,f[<span class="number">520</span>][<span class="number">520</span>][<span class="number">6</span>],n;</div><div class="line"><span class="keyword">bool</span> used[<span class="number">510</span>][<span class="number">510</span>][<span class="number">6</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">addnew</span><span class="params">(<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> now=<span class="number">0</span>,n=<span class="built_in">strlen</span>(s),x;</div><div class="line">    rep(i,n)&#123;</div><div class="line">        x=s[i]<span class="number">-96</span>;</div><div class="line">        <span class="keyword">if</span>(!ch[now][x])ch[now][x]=++cnt;</div><div class="line">        now=ch[now][x];</div><div class="line">    &#125;</div><div class="line">    w[now]+=v;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">getnxt</span><span class="params">()</span></span>&#123;</div><div class="line">    h=<span class="number">1</span>;t=<span class="number">0</span>; </div><div class="line">    rez(i)<span class="keyword">if</span>(ch[<span class="number">0</span>][i])t++,q[t]=ch[<span class="number">0</span>][i]; </div><div class="line">    <span class="keyword">while</span>(h&lt;=t)&#123;</div><div class="line">        x=q[h++]; </div><div class="line">        rez(i)&#123;</div><div class="line">            <span class="keyword">int</span> j=ch[x][i]; </div><div class="line">            <span class="keyword">if</span>(!j)&#123;ch[x][i]=ch[nxt[x]][i];<span class="keyword">continue</span>;&#125; </div><div class="line">            y=nxt[x];</div><div class="line">            <span class="keyword">while</span>(y&amp;&amp;!ch[y][i])y=nxt[y]; </div><div class="line">            nxt[j]=ch[y][i];</div><div class="line">            w[j]+=w[nxt[j]]; </div><div class="line">            <span class="keyword">if</span>(w[nxt[j]])la[j]=nxt[j]; </div><div class="line">            <span class="keyword">else</span> la[j]=la[nxt[j]]; </div><div class="line">            q[++t]=j;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dp</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> x,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(k&gt;K||used[n][x][k])<span class="keyword">return</span>;</div><div class="line">    used[n][x][k]=<span class="number">1</span>,f[n][x][k]=w[x];</div><div class="line">    <span class="keyword">if</span>(n==m)<span class="keyword">return</span>; </div><div class="line">    <span class="keyword">int</span> maxn=<span class="number">-707185547707185547L</span>L,maxb=<span class="number">0</span>; </div><div class="line">    rez(i)&#123;</div><div class="line">        dp(n+<span class="number">1</span>,ch[x][i],k); </div><div class="line">        <span class="keyword">if</span>(k&lt;K)dp(n+<span class="number">1</span>,ch[x][i],k+<span class="number">1</span>); </div><div class="line">        <span class="keyword">if</span>(f[n+<span class="number">1</span>][ch[x][i]][k]&gt;maxn)maxn=f[n+<span class="number">1</span>][ch[x][i]][k],maxb=i;</div><div class="line">    &#125;</div><div class="line">    maxn=<span class="number">707185547707185547L</span>L;</div><div class="line">    rez(i)<span class="keyword">if</span>(i==maxb)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k]);</div><div class="line">          <span class="keyword">else</span> <span class="keyword">if</span>(k&lt;K)maxn=min(maxn,f[n+<span class="number">1</span>][ch[x][i]][k+<span class="number">1</span>]);</div><div class="line">    f[n][x][k]+=maxn;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">slover</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">bool</span> chu)</span></span>&#123;</div><div class="line">    ans=<span class="number">0</span>;<span class="keyword">if</span>(chu)&#123; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">		res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">        res(i)res(j)ret[i][j]=di[i][j];M--;</div><div class="line">        <span class="keyword">while</span>(M)&#123;</div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            <span class="keyword">if</span>(M&amp;<span class="number">1</span>)&#123;</div><div class="line">                res(i)res(k)res(j)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">                res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">            &#125; </div><div class="line">            res(i)res(j)tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            res(i)res(k)res(j)tmp[i][j]=max(tmp[i][j],di[i][k]+di[k][j]); </div><div class="line">            res(i)res(j)di[i][j]=tmp[i][j]; </div><div class="line">            M&gt;&gt;=<span class="number">1</span>;</div><div class="line">        &#125; </div><div class="line">        <span class="built_in">memset</span>(di,<span class="number">0xef</span>,<span class="keyword">sizeof</span>(di)); </div><div class="line">        res(i)rez(j)di[i][ch[i][j]]=w[ch[i][j]]; </div><div class="line">    &#125;<span class="keyword">else</span>&#123; </div><div class="line">        res(i)res(j)&#123; </div><div class="line">            tmp[i][j]=<span class="number">-707185547707185547L</span>L; </div><div class="line">            res(k)tmp[i][j]=max(ret[i][k]+di[k][j],tmp[i][j]); </div><div class="line">        &#125;</div><div class="line">        res(i)res(j)ret[i][j]=tmp[i][j]; </div><div class="line">    &#125; </div><div class="line">    res(i)ans=max(ans,ret[<span class="number">0</span>][i]); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</div><div class="line">    M=m,P=M<span class="number">-300</span>,tot=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(;P&lt;=M<span class="number">-250</span>;P++)&#123;</div><div class="line">        rep(i,<span class="number">300</span>)res(j)rep(k,K+<span class="number">1</span>)used[i][j][k]=<span class="number">0</span>; </div><div class="line">        m=M-P;dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>); </div><div class="line">        slover(P,(P==M<span class="number">-300</span>)); </div><div class="line">        tot=max(tot,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]+ans); </div><div class="line">    &#125; </div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>,tot+<span class="number">1</span>); </div><div class="line">&#125; </div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> res,flag=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=ch<span class="number">-48</span>+res*<span class="number">10</span>;res*=flag;</div><div class="line">	<span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//freopen(NAME".in","r",stdin);</span></div><div class="line">	<span class="comment">//freopen(NAME".out","w",stdout);</span></div><div class="line">	n=readin(),m=readin(),K=readin();</div><div class="line">    rep(i,n)<span class="built_in">scanf</span>(<span class="string">"%s"</span>,s),a[i+<span class="number">1</span>]=readin(),addnew(a[i+<span class="number">1</span>]);</div><div class="line">    getnxt();</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K==<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">200</span>)&#123;slover(m,<span class="number">1</span>);<span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    <span class="keyword">if</span>(m&gt;<span class="number">500</span>&amp;&amp;K!=<span class="number">0</span>&amp;&amp;cnt&lt;=<span class="number">51</span>)&#123;work();<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">    dp(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>标程<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> L = <span class="number">1010</span>, S=<span class="number">26</span>, M=<span class="number">1010</span>, INF = <span class="number">99999999</span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></div><div class="line">    Node * son[S];</div><div class="line">    Node * next;</div><div class="line">    <span class="keyword">int</span> value;</div><div class="line">&#125; node[L];</div><div class="line"><span class="keyword">int</span> n, m, k, x, num=<span class="number">0</span>;</div><div class="line"><span class="keyword">char</span> s[L];</div><div class="line"><span class="keyword">int</span> g1[L], g2[L];</div><div class="line"><span class="keyword">int</span> f1[L][<span class="number">11</span>], f2[L][<span class="number">11</span>];</div><div class="line">Node * root;</div><div class="line">Node * unknown = node;</div><div class="line"><span class="function">Node * <span class="title">new_node</span><span class="params">()</span> </span>&#123;</div><div class="line">    Node * now = &amp;node[num++];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        now-&gt;son[k] = unknown;</div><div class="line">    now-&gt;next = unknown;</div><div class="line">    now-&gt;value = <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> now;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    unknown = new_node();</div><div class="line">    root = new_node();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">        unknown-&gt;son[k] = root;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;k);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s%d"</span>, s, &amp;x);</div><div class="line">        <span class="keyword">int</span> len = <span class="built_in">strlen</span>(s);</div><div class="line">        Node * now = root;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;len; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[s[j]-<span class="string">'a'</span>] == unknown)</div><div class="line">                now-&gt;son[s[j]-<span class="string">'a'</span>] = new_node();</div><div class="line">            now = now-&gt;son[s[j]-<span class="string">'a'</span>];</div><div class="line">        &#125;</div><div class="line">        now-&gt;value += x;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">    for (int i=0; i&lt;num; i++) &#123;</span></div><div class="line"><span class="comment">        printf("before: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</span></div><div class="line"><span class="comment">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</span></div><div class="line"><span class="comment">                node[i].next - node, node[i].value);</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="built_in">queue</span>&lt;Node *&gt; q;</div><div class="line">    q.push(root);</div><div class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</div><div class="line">        Node * now = q.front();</div><div class="line">        q.pop();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k=<span class="number">0</span>; k&lt;S; k++)</div><div class="line">            <span class="keyword">if</span> (now-&gt;son[k] != unknown) &#123;</div><div class="line">                now-&gt;son[k]-&gt;next = now-&gt;next-&gt;son[k];</div><div class="line">                now-&gt;son[k]-&gt;value += now-&gt;next-&gt;son[k]-&gt;value;</div><div class="line">                q.push(now-&gt;son[k]);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                now-&gt;son[k] = now-&gt;next-&gt;son[k];</div><div class="line">            &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/*</span></div><div class="line"><span class="comment">    for (int i=0; i&lt;num; i++) &#123;</span></div><div class="line"><span class="comment">        printf("after: node %d: son = [%d, %d, %d], next = %d, value = %d\n",</span></div><div class="line"><span class="comment">                i, node[i].son[0] - node, node[i].son[1] - node, node[i].son[2] - node,</span></div><div class="line"><span class="comment">                node[i].next - node, node[i].value);</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line"><span class="comment">    */</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve_without_k</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">        g1[j] = node[j].value;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g2[j] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                g2[j] = max(g2[j], g1[t] + node[j].value);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//printf("g[%d][%d] = %d\n", i, j, g2[j]);</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            g1[j] = g2[j];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, g2[root-node]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            f1[j][<span class="number">0</span>] = node[j].value;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">1</span>; r&lt;=k; r++) &#123;</div><div class="line">            f1[j][r] = -INF;</div><div class="line">            f1[j][r] = node[j].value;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=m<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f2[j][r] = -INF;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                    <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                    f2[j][r] = max(f2[j][r], f1[t][r] + node[j].value);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> c=<span class="number">0</span>; c&lt;S; c++) &#123;</div><div class="line">                        <span class="keyword">int</span> t = node[j].son[c] - node;</div><div class="line">                        f2[j][r] = min(f2[j][r], f1[t][r<span class="number">-1</span>] + node[j].value);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//printf("g[%d][%d][%d] = %d\n", i, j, r, f2[j][r]);</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">1</span>; j&lt;num; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> r=<span class="number">0</span>; r&lt;=k; r++) &#123;</div><div class="line">                f1[j][r] = f2[j][r];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, f2[root-node][k]);</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"typewriter.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"typewriter.ans"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    init();</div><div class="line">    build();</div><div class="line">    <span class="comment">//solve_without_k();</span></div><div class="line">    solve();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/最短路-NOI/">最短路 NOI</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/04/图论专题/">
      图论专题
    </a>
  </h2>
  
  <time>
    Apr 4, 2017
  </time>
  <section class="content">
	  <h2 id="四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。"><a href="#四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。" class="headerlink" title="四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。"></a>四道模板题，就少些题解了，第一道题是并查集加维护，蓝书上写到过。第二道题是最短路，观察数据范围，SPFA明显优于DIj就完了，第三道题trajan缩点两次建图，第四道题就一道for了n次的最小生成树。</h2><h1 id="Problem-1-bricks"><a href="#Problem-1-bricks" class="headerlink" title="Problem 1. bricks"></a>Problem 1. bricks</h1><p><img src="http://img.hb.aicdn.com/70ddf00fb9aab2509b0e1b86fb9acd80716fd14316d3fd-tlSzfU_fw658" alt=""><br>Input file: bricks.in<br>Output file: bricks.out<br>Time limit: 1 second<br>jyb 在BUAA 天天被大神虐，所以只能去搬砖了。终于在2019 年的夏天，菜菜的jyb 找不到工作，真的去工地搬砖了。jyb 的工头cky 是一个很麻烦的人，他会让jyb 按某种方式搬砖，还问会问一些奇怪的问题。现在有n 块砖，m 次操作。操作有两种：</p>
<ol>
<li>M x y 把编号为x 的砖所在的一摞砖搬到编号为y 的砖所在的一摞砖的上面。如果x 和y 在同一摞砖则忽略这个操作。（最初，每块砖都是单独一摞）</li>
<li>C x 询问x 下面压着多少块砖。<br>jyb 搬砖实在是太累了，想请你帮忙回答一下cky 工头的询问。<br>Input<br>第1 行，2 个整数n; m，表示一共有多少块砖以及有多少操作。<br>接下来m 行，每行一个操作，操作表示形式与前文一致。<br>Output<br>对于每次询问操作，输出答案<br>Sample<br>bricks.in<br>6 6<br>M 1 6<br>C 1<br>M 2 4<br>M 2 6<br>C 3<br>C 4<br>bricks.out<br>1<br>0<br>2<br>Note<br>• 对于30% 的数据，1&lt;=n,m&lt;= \(10^3\)<br>• 对于60% 的数据，1&lt;=n&lt;= \(10^4\) ,1&lt;=m&lt;= \(10^5\)<br>• 对于100% 的数据，1&lt;=n&lt;= \(20^5\),1&lt;=m&lt;= \(30^6\) <h2 id="题解——并查集"><a href="#题解——并查集" class="headerlink" title="题解——并查集"></a>题解——并查集</h2>用链表什么的暴力枚举题意，最坏复杂度是O( \(m^2\) )的。<br>注意到每次都是移动一摞砖，其实问题就是集合的合并，只是这个集合是一个有序的，我们还需要知道每个元素在集合中的位置。我们可以利用并查集高效的来解决。我们引入一个dep数组，对于祖先节点（将每摞砖最上方的一块设为祖先，设最下面的为祖先也是可以的），我们记录该集合中一共有多少块砖，对于其他节点，我们记录它上方有多少块砖，这样我们可以很容易地计算出下方有多少块。这样在合并x和y（设他们祖先为 \(f_x\) ， \(f_y\) ）时，我们将dep[ \(f_x\) ]赋给dep[ \(f_y\) ]（因为移到了上方， \(f_x\) 有多少块 \(f_y\) 上方就有多少块），然后dep[ \(f_x\) ]要加上原本的dep[ \(f_y\) ]。难点就是在合并的过程中，dep数组怎么维护。其实很简单，只需要在路径压缩时顺带维护即可，如果一个节点x的祖先 \(f_x\) 不是祖先（即已被合并过），那么dep[x]加上dep[ \(f_x\) ]即可（等于头上又多了一摞砖，所以要加上）。<br>时间复杂度O( \(α()\) )<h2 id="code"><a href="#code" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"bricks"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez,flag=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="keyword">char</span> c;</div><div class="line"><span class="keyword">int</span> x,y,n,m,fa[<span class="number">3000020</span>][<span class="number">2</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(x==fa[x][<span class="number">0</span>])<span class="keyword">return</span> x;</div><div class="line">	<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> f=fa[x][<span class="number">0</span>];</div><div class="line">		fa[x][<span class="number">0</span>]=find(fa[x][<span class="number">0</span>]);</div><div class="line">		<span class="keyword">if</span>(fa[f][<span class="number">0</span>]!=f)fa[x][<span class="number">1</span>]+=fa[f][<span class="number">1</span>];</div><div class="line">		<span class="keyword">return</span> fa[x][<span class="number">0</span>];</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)fa[i][<span class="number">0</span>]=i,fa[i][<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">" %s"</span>,&amp;c);</div><div class="line">		<span class="keyword">if</span>(c==<span class="string">'M'</span>)&#123;</div><div class="line">			<span class="keyword">if</span>((x=find(readin()))!=(y=find(readin())))&#123;</div><div class="line">				fa[y][<span class="number">0</span>]=x,n=fa[y][<span class="number">1</span>];</div><div class="line">				fa[y][<span class="number">1</span>]=fa[x][<span class="number">1</span>];</div><div class="line">				fa[x][<span class="number">1</span>]+=n;</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">if</span>((x=readin())==fa[x][<span class="number">0</span>])<span class="built_in">cout</span>&lt;&lt;fa[x][<span class="number">1</span>]<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			<span class="keyword">else</span> y=find(x),<span class="built_in">cout</span>&lt;&lt;fa[y][<span class="number">1</span>]-fa[x][<span class="number">1</span>]<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Problem-2-drive"><a href="#Problem-2-drive" class="headerlink" title="Problem 2. drive"></a>Problem 2. drive</h1><p><img src="http://img.hb.aicdn.com/95ac6353a3b13c65ed3e1c31492daccc5b9e30cb245378-E01mfY_fw658" alt=""><br>Input file: drive.in<br>Output file: drive.out<br>Time limit: 2 second<br>工头 cky 最近开了一家贸易公司，开始经商。作为 cky 的忠实小弟，jyb 当了 cky 老总的司机。一天晚上，cky 突然找到了一个新的客户，所以第二天一早要急着从成都去上海谈生意（设全国一共有 n 个城市, 成都编号为 1，上海编号为 n），城市之间有高速公路，每条高速公路都有一个最高限速和长度。cky 想：我应该在今晚就告诉客户我最快多久能到上海，不然客户就可能先和别人谈生意了。所以他就让 jyb 计算一下最快多久能到。<br>jyb 作为一名经验丰富的老司机，看了一眼天气预报，天气预报说：全国范围内有一条高速公路第二天可能下大雨（大雨天气的话，车速会下降 75%），但坑爹的是居然不知道是哪一条，准确信息要第二天一早才知道。现在jyb 拥有全国高速公路图，为了回答一个尽量早但又不失信于客户的时间，jyb 想请你帮帮忙。<br>ps: 虽然cky 很急，但是他还是告诫jyb 不能超速行驶。第二天知道哪会下雨后，jyb 自然会作出正确的抉择。迟到肯定就是失信于客户啦！<br>Input<br>第1 行，2 个整数n; m，表示城市数和高速公路数。<br>接下来m行，每行4 个整数u; v; speed; length，表示该条高速公路连接的两个城市u; v，以及最高限速speed<br>和路长length。<br>Output<br>输出满足题意的时间，保留4 位小数。<br>Sample<br>drive.in     drive.out<br>3 3          4.0000<br>1 2 100 100<br>2 3 100 100<br>1 3 100 400<br>2 1          4.0000<br>1 2 100 100<br>Note<br>• 对于30% 的数据，1&lt;=n&lt;= \(10^2\) ,1&lt;=m&lt;=\(10^3\)<br>• 对于100% 的数据,1&lt;=n&lt;= \(4*10^3\) ,1&lt;=m&lt;= \(10^4\) ,60&lt;=speed&lt;=120,200&lt;=length&lt;=1000</p>
<h2 id="题解——最短路"><a href="#题解——最短路" class="headerlink" title="题解——最短路"></a>题解——最短路</h2><p>如果没有大雾天气，很显然就是求一个最短路就行了。但是由于大雾天气的存在，如果大雾天气出现在乐最短路的路径上，那么肯定不能按照最快的时间到达，如果这样的话很可能就失信与客户。所以我们就需要枚举最短路径上每条高速公路出现大雾天气的情况，再求最短路，可得一个最糟的情况，即得到在不失信于客户的前提下的最快时间。<br>注意到数据范围，每条高速公路的行驶时间最多相差10倍，spfa的时间复杂度的上界大概为O( \(kM\) )，k = 10，而朴素Dijkstra求一次最短路为稳定O( \(n^2\) )，总的最坏为O( \(n^3\) )，所以我们采用spfa或者堆优化Dijkstra算法(jyb写的STL堆优被卡了两个点)求最短路。</p>
<h2 id="code-1"><a href="#code-1" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"drive"</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">20010</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">return</span> resez;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edges</span>&#123;</span><span class="keyword">int</span> u,v,next;<span class="keyword">double</span> w;&#125;edge[M];</div><div class="line"><span class="keyword">int</span> n,m,q[N],head,tail,u,v,hu[N],num,pre[N],vis[N];</div><div class="line"><span class="keyword">double</span> dis[N],tmp,len;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">double</span> w)</span></span>&#123;edge[++num].u=u;edge[num].v=v;edge[num].w=w;edge[num].next=hu[u];hu[u]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">spfa</span><span class="params">(<span class="keyword">bool</span> flag)</span></span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)dis[i]=<span class="number">100000000.0</span>;</div><div class="line">	head=<span class="number">0</span>;tail=q[<span class="number">0</span>]=vis[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">while</span>(head!=tail)&#123;</div><div class="line">		u=q[head];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u];i;i=edge[i].next)&#123;</div><div class="line">			<span class="keyword">if</span>(v=edge[i].v,dis[v]&gt;dis[u]+edge[i].w)&#123;</div><div class="line">				<span class="keyword">if</span>(dis[v]=dis[u]+edge[i].w,flag)pre[v]=i;</div><div class="line">				<span class="keyword">if</span>(!vis[v])&#123;</div><div class="line">					vis[v]=<span class="number">1</span>;</div><div class="line">					q[tail]=v;</div><div class="line">					tail=(tail+<span class="number">1</span>)%n;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		vis[u]=<span class="number">0</span>;head=(head+<span class="number">1</span>)%n;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> dis[n];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	n=readin(),m=readin();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		u=readin(),v=readin();</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%lf%lf"</span>,&amp;tmp,&amp;len);</div><div class="line">		addedge(u,v,len/tmp);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">double</span> ans=spfa(<span class="number">1</span>);m=n;</div><div class="line">	<span class="keyword">while</span>(m!=<span class="number">1</span>)&#123;</div><div class="line">		edge[pre[m]].w*=<span class="number">4.0</span>;</div><div class="line">		ans=max(ans,spfa(<span class="number">0</span>));</div><div class="line">		edge[pre[m]].w/=<span class="number">4.0</span>;</div><div class="line">		m=edge[pre[m]].u;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-3-graph"><a href="#Problem-3-graph" class="headerlink" title="Problem 3. graph"></a>Problem 3. graph</h1><p><img src="http://img.hb.aicdn.com/db259e221f0a4a0fc9590648a7be8e8132a97ed22381f2-Qvr1ZT_fw658" alt=""><br>Input file: graph.in<br>Output file: graph.out<br>Time limit: 1 second<br>jyb 给大家讲过强连通分量，强连通分量中的任意两点之间都可以互相到达。这个条件感觉很苛刻，大部分图都不能满足。现在jyb 告诉你一个新的概念：单向连通图；如果有向图中，对于任意节点 \(v_1\)  和 \(v_2\) ，至少存在从 \(v_1\)  到 \(v_2\)  和从 \(v_2\)  到 \(v_1\) 的路径中的一条，则为单向连通图。现在给出若干个有向图，jyb 想问你它们是不是单向连通图。<br>Input<br>第1 行，1 个整数T, 表示数据组数，对于每组数据：<br>第1 行，2 个整数n; m，表示点数和边数<br>接下来m 行，每行2 个整数u,v, 表示u 到v 有一条单向边。题目保证u! = v<br>Output<br>对于每组数据，如果是则输出”Yes”, 不是则输出”No”（均不含引号）<br>Sample<br>graph.in<br>2<br>3 2<br>1 3<br>2 3<br>3 2<br>1 2<br>2 3<br>graph.out<br>No<br>Yes<br>Note<br>• 对于30% 的数据,1 &lt;=n &lt;=100，1  m &lt;= 100<br>• 对于100% 的数据,1  &lt;=T  &lt;=5,1 &lt;=n &lt;=30000，1 &lt;= m&lt;= \(2 *10^5\) 。</p>
<h2 id="题解——tarjan求SCC-拓扑排序"><a href="#题解——tarjan求SCC-拓扑排序" class="headerlink" title="题解——tarjan求SCC+拓扑排序"></a>题解——tarjan求SCC+拓扑排序</h2><p>暴力做法：Floyd求任意两点连通性。（给了30%的分）<br>我们知道，对于在同一SCC中的两点，它们是互相可达的，这也意味着一个SCC中的所有点和其他点的连通性都是一样的，显然我们可以将原图缩点简化问题。经过tarjan缩点后，得到了一个DAG，我们很容易想到如果一个图“分叉”，那么分叉上的点肯定是互不可达的，所以原图必须是“一条链”。为什么对链打引号呢？是因为这条链不用很严格，比如1-&gt;2 2-&gt;3 3-&gt;4 1-&gt;4 2-&gt;4这样的图也是满足的，且可能还有重边，所以只用入度出度去判断的方法容易出错，dfs去走一条链的办法也比较麻烦（我没想出有什么简单的办法）。我们利用拓扑排序，若一直都是一个入度为0的点（队中至多有一个点），那么就是满足题意的。<br>Ps：可以先写一个floyd来对拍（因为时间代价很低）<br>时间复杂度O( \(n+m\))</p>
<h2 id="code-2"><a href="#code-2" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"graph"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> clr(x) memset((x),0,sizeof(x))</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100010</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">400010</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">readin</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> resez;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">return</span> resez;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span>&#123;</span><span class="keyword">int</span> v,next;&#125;edge[M];</div><div class="line"><span class="keyword">int</span> T,hu[N][<span class="number">2</span>],num,tot,top,cnt,numm,Q[N],head,tail,u,v,n,m,P[N],temp[N],low[N],vis[N],<span class="built_in">stack</span>[N],fa[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v=<span class="number">0</span>)</span></span>&#123;</div><div class="line">	temp[u]=low[u]=++tot;</div><div class="line">	vis[u]=<span class="number">1</span>;<span class="built_in">stack</span>[++top]=u;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u][<span class="number">0</span>];i!=<span class="number">0</span>;i=edge[i].next)</div><div class="line">		<span class="keyword">if</span>(v=edge[i].v,!temp[v])dfs(v),low[u]=min(low[v],low[u]);</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(vis[v]&amp;&amp;temp[v]&lt;low[u])low[u]=temp[v];</div><div class="line">	<span class="keyword">if</span>(temp[u]==low[u])&#123;</div><div class="line">		cnt++;</div><div class="line">		<span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">			<span class="keyword">int</span> x=<span class="built_in">stack</span>[top--];</div><div class="line">			vis[x]=<span class="number">0</span>;</div><div class="line">			fa[x]=cnt;</div><div class="line">			<span class="keyword">if</span>(x==u)<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d)</span></span>&#123;edge[++num].v=v;edge[num].next=hu[u][d];hu[u][d]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	T=readin();</div><div class="line">	<span class="keyword">while</span>(T--)&#123;</div><div class="line">		n=readin(),m=readin();</div><div class="line">		num=cnt=tot=<span class="number">0</span>;</div><div class="line">		clr(hu),clr(temp),clr(P),clr(low);</div><div class="line">		<span class="keyword">while</span>(m--)addedge(readin(),readin(),<span class="number">0</span>);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!temp[i])dfs(i);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=hu[i][<span class="number">0</span>];j;j=edge[j].next)</div><div class="line">				<span class="keyword">if</span>(fa[i]!=fa[edge[j].v])&#123;</div><div class="line">					P[fa[edge[j].v]]++;</div><div class="line">					addedge(fa[i],fa[edge[j].v],<span class="number">1</span>);</div><div class="line">				&#125;</div><div class="line">		<span class="keyword">int</span> ans=<span class="number">1</span>;head=tail=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=cnt;i++)<span class="keyword">if</span>(!P[i])Q[tail++]=i;</div><div class="line">		<span class="keyword">while</span>(head&lt;tail)&#123;</div><div class="line">			<span class="keyword">if</span>(tail-head&gt;<span class="number">1</span>)&#123;</div><div class="line">				ans=<span class="number">0</span>;<span class="keyword">break</span>;</div><div class="line">			&#125;u=Q[head];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=hu[u][<span class="number">1</span>];i;i=edge[i].next)</div><div class="line">				<span class="keyword">if</span>(v=edge[i].v,P[v]--,P[v]==<span class="number">0</span>)Q[tail++]=v;</div><div class="line">			++head;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span>(ans)<span class="built_in">cout</span>&lt;&lt;<span class="string">"Yes"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="string">"No"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-4-airplane"><a href="#Problem-4-airplane" class="headerlink" title="Problem 4. airplane"></a>Problem 4. airplane</h1><p><img src="http://img.hb.aicdn.com/4212b1e5badf24cd495a126ec21e4d71fb5f310c250569-GXTxSA_fw658" alt=""><br>Input file: airplane.in<br>Output file: airplane.out<br>Time limit: 1 second<br>cky 公司的运营蒸蒸日上，由于出差实在太频繁，而且坐汽车有些太慢了，所以 cky 想要顺势直接进驻航空业。cky 所在的国家天朝有 n 个城市，m 个航空公司，每两个城市之间可能有一条航线运营（双向），一共有k 条航线，每条航线都属于某一航空公司。现在cky 希望收购一家航空公司（为了涉足航空业以及防垄断，cky 必须且只能购买一家航空公司），使得他能通过飞机从任意城市到达目的城市（允许转机），当然很可能没有一家公司能满足cky 的要求，所以cky 还需收购其他公司掌控的航线。每个航空公司都有一个市值，每条航线都有一个收购价。现在cky 想知道他最少需要花费多少钱。<br>Input<br>第1 行，3 个整数n; m;k，表示城市数量，航空公司数和航线数。城市用1; 2; ……; n 编号。接下来一行，一共 m 个整数，第 i 个整数  \( a_i \) 表示第 i 个航空公司的市值。接下来 k 行，每行 4 个整数 \(u_i, v_i,cost_i,b_i\)。表示第i 条航线连接城市u,v，价值cost，所属航空公司为b。题目保证u! = v题目保证有解。<br>Output<br>输出最少需要花费多少钱。<br>Sample<br>airplane.in<br>4 3 3<br>100 150 200<br>1 2 100 1<br>1 3 160 2<br>1 4 220 3<br>airplane.out<br>460<br>Note<br>• 对于50% 的数据，1&lt;= n&lt;=  1000，1&lt;=  m&lt;= 1000，1&lt;=  k &lt;= 10000；<br>• 对于100% 的数据，1&lt;=  n &lt;= 2000，1 &lt;= m &lt;=2000，1&lt;=  k&lt;=  200000, \( 1&lt;=b_i&lt;=m,1&lt;=cost_i,a_i&lt;=10^8\) 。</p>
<h2 id="题解——最小生成树"><a href="#题解——最小生成树" class="headerlink" title="题解——最小生成树"></a>题解——最小生成树</h2><p>最朴素的做法：枚举航空公司，将本公司的航线加入，然后做一遍MST，时间复杂度是O( \(klog_k+mk\) )的。<br>但我们注意到“在最小生成树中任意一条边都是连接两个集合边权最小的一条边”，这个是MST一个非常重要的结论，是Prim和kruscal算法中贪心的核心。利用这条性质我们可以知道，对于每个航空公司，我们只需要原图MST中得到的航线即可得到最优购买方案。所以更优的做法是：先跑一次MST，把得到的边记录下来，然后枚举航空公司，还是先讲本公司的边全部加进去，然后只用扫一边第一次MST中记录下来的边，用kruscal的方法去构造树即可。时间复杂度为O( \(klog_k+nm \) )。<br>对于本题，50%的数据是可以O(mk)过的，最后30%的数据我特别构造了一下,必须枚举到排序后的最后几条边才能构造出一颗生成树，所以O( \(mk\) )应该是过不了的，此外的20%数据是随机数据，加了构造出树就跳出判断的代码可能会过（但是jyb写的mk的没过。。）；另外，50%的数据需要long long</p>
<h2 id="code-3"><a href="#code-3" class="headerlink" title="code:"></a>code:</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long </span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"airplane"</span> </span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">200002</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2002</span>;</div><div class="line"><span class="keyword">const</span> ll INF=<span class="number">1l</span>l&lt;&lt;<span class="number">60</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">    <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">data</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,v;ll w;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> data &amp;rhs)<span class="keyword">const</span>&#123;</div><div class="line">		<span class="keyword">return</span> w&lt;rhs.w;</div><div class="line">	&#125;</div><div class="line">&#125;dis[M],mst[N];</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edges</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> u,v,next;</div><div class="line">&#125;edge[M];</div><div class="line"><span class="keyword">int</span> hu[N],num,fa[N],n,m,k,cnt,u,v,tmp,w;</div><div class="line">ll ans,a[N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> tmp,<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;edge[++num].u=u;edge[num].v=v;edge[num].next=hu[tmp];hu[tmp]=num;&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> x==fa[x]?x:fa[x]=find(fa[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m),readin(k);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)readin(a[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</div><div class="line">		readin(dis[i].u),readin(dis[i].v),readin(dis[i].w),readin(tmp);</div><div class="line">		addedge(tmp,dis[i].u,dis[i].v);</div><div class="line">	&#125;</div><div class="line">	sort(dis+<span class="number">1</span>,dis+<span class="number">1</span>+k);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)fa[i]=i;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=k;i++)&#123;</div><div class="line">		<span class="keyword">int</span> x=find(dis[i].u),y=find(dis[i].v);</div><div class="line">		<span class="keyword">if</span>(x!=y)&#123;</div><div class="line">			fa[y]=x;</div><div class="line">			mst[++cnt]=dis[i];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	ans=INF;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=n;j++)fa[j]=j;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=hu[i];j;j=edge[j].next)&#123;</div><div class="line">			<span class="keyword">int</span> x=find(edge[j].u),y=find(edge[j].v);</div><div class="line">			<span class="keyword">if</span>(x!=y)fa[y]=x;</div><div class="line">		&#125;</div><div class="line">		ll tot=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=cnt;j++)&#123;</div><div class="line">			<span class="keyword">int</span> x=find(mst[j].u),y=find(mst[j].v);</div><div class="line">			<span class="keyword">if</span>(x!=y)&#123;</div><div class="line">				fa[y]=x;</div><div class="line">				tot+=mst[j].w;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		ans=min(ans,tot+a[i]);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/图论/">图论</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（三）——从动态到可持久化/">
      可持久化并查集（三）——从动态到可持久化
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h4 id="其实在上一篇：可持久化并查集（二）——从镜像到动态"><a href="#其实在上一篇：可持久化并查集（二）——从镜像到动态" class="headerlink" title="其实在上一篇：可持久化并查集（二）——从镜像到动态"></a>其实在上一篇：<a href="http://blog.csdn.net/lemonoil/article/details/57085381" target="_blank" rel="external">可持久化并查集（二）——从镜像到动态</a></h4><p>中已经可以算是一个伪可持久化了，但是对于历史查询等操作无能为力。。所以本篇重点介绍可持久化操作<br><img src="http://img.blog.csdn.net/20170226155123601?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="BZOJ-3673"><a href="#BZOJ-3673" class="headerlink" title="BZOJ 3673"></a>BZOJ 3673</h1><p><a href="https://vjudge.net/problem/HYSBZ-3673" target="_blank" rel="external">题目连接</a></p>
<blockquote>
<p>这题不知道出题人什么做法，但是代码很短的样子<br>UPD：出题人用的是rope，即stl中的可持久化平衡树<br>KuribohG神犇告诉了我可以用可持久化线段树实现可持久化数组T T<br>既然都有可持久化数组了，只要用个再并查集的启发式合并就能妥妥的水过了（这样每次只要修改一个fa）<br>并查集的启发式合并就是按秩合并，初始所有集合秩为0<br>合并把秩小的树根的父亲设为秩大的树根<br>如果秩相同，则随便选取一个作为父节点并将它的秩+1<br>秩和fa一样维护<br>但是其实这题数据随机的话随便合并就行了，根本不用按秩合并什么的<br>UPD：秩其实有的时候很不好用，维护子树大小比较赞。。。<br>另外，ndsf发现只要直接暴力就能虐了T T<br><a href="http://hzwer.com/3951.html" target="_blank" rel="external">引用自hzwer</a></p>
</blockquote>
<p>所以可以发现<del>暴力出奇迹</del>大力发展可持久化并查集是解决当今<del>膜蛤事件</del>。。。的唯一方法！！<br>最终我们还是写份<del>正解</del>（hfu说没有正解，只有更好的暴力）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> N 2000005</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,sz;</div><div class="line"><span class="keyword">int</span> root[N],ls[N],rs[N],v[N],deep[N];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> &amp;k,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(!k)k=++sz;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;v[k]=l;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	build(ls[k],l,mid);</div><div class="line">	build(rs[k],mid+<span class="number">1</span>,r);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> &amp;y,<span class="keyword">int</span> pos,<span class="keyword">int</span> val)</span></span>&#123;</div><div class="line">	y=++sz;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;v[y]=val;deep[y]=deep[x];<span class="keyword">return</span>;&#125;</div><div class="line">	ls[y]=ls[x];rs[y]=rs[x];</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)</div><div class="line">		modify(l,mid,ls[x],ls[y],pos,val);</div><div class="line">	<span class="keyword">else</span> modify(mid+<span class="number">1</span>,r,rs[x],rs[y],pos,val);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)<span class="keyword">return</span> k;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)<span class="keyword">return</span> query(ls[k],l,mid,pos);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> query(rs[k],mid+<span class="number">1</span>,r,pos);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> pos)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(l==r)&#123;deep[k]++;<span class="keyword">return</span>;&#125;</div><div class="line">	<span class="keyword">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(pos&lt;=mid)add(ls[k],l,mid,pos);</div><div class="line">	<span class="keyword">else</span> add(rs[k],mid+<span class="number">1</span>,r,pos);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> k,<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> p=query(k,<span class="number">1</span>,n,x);</div><div class="line">	<span class="keyword">return</span> x==v[p]?p:find(k,v[p]);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> f,k,a,b;</div><div class="line">	<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</div><div class="line">	build(root[<span class="number">0</span>],<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="built_in">cin</span>&gt;&gt;f;</div><div class="line">		<span class="keyword">if</span>(f==<span class="number">1</span>)&#123;</div><div class="line">			root[i]=root[i<span class="number">-1</span>];</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</div><div class="line">			<span class="keyword">int</span> p=find(root[i],a),q=find(root[i],b);</div><div class="line">			<span class="keyword">if</span>(v[p]==v[q])<span class="keyword">continue</span>;</div><div class="line">			<span class="keyword">if</span>(deep[p]&gt;deep[q])swap(p,q);</div><div class="line">			modify(<span class="number">1</span>,n,root[i<span class="number">-1</span>],root[i],v[p],v[q]);</div><div class="line">			<span class="keyword">if</span>(deep[p]==deep[q])add(root[i],<span class="number">1</span>,n,v[q]);</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">2</span>)&#123;</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;k;root[i]=root[k];</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(f==<span class="number">3</span>)&#123;</div><div class="line">			root[i]=root[i<span class="number">-1</span>];</div><div class="line">			<span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</div><div class="line">		    <span class="keyword">int</span> p=find(root[i],a),q=find(root[i],b);</div><div class="line">			<span class="keyword">if</span>(v[p]==v[q])<span class="built_in">cout</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">			<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>又是熟悉的线段树（貌似从主席树开始就阴魂不散了），复杂度因线段树而多加了一个log,但是以数据结构的标准数据范围来说，这点复杂度仍然是极好的，加上读入输出优化后可以从300ms-&gt;40ms<br>亲自手测。</p>
<p>rope大发好！！！！<br>-<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ext/rope&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> fo(i,a,b) for(i=a;i&lt;=b;i++)</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_cxx;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">20000</span>+<span class="number">10</span>;</div><div class="line">rope&lt;<span class="keyword">int</span>&gt; *b[maxn];</div><div class="line"><span class="keyword">int</span> a[maxn];</div><div class="line"><span class="keyword">int</span> i,j,k,l,t,n,m,ans;</div><div class="line"><span class="keyword">bool</span> flag;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfa</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (b[id]-&gt;at(x)==<span class="number">0</span>) <span class="keyword">return</span> x;</div><div class="line">    b[id]-&gt;replace(x,getfa(id,b[id]-&gt;at(x)));</div><div class="line">    <span class="keyword">return</span> b[id]-&gt;at(x);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    flag=<span class="number">0</span>;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">    fo(i,<span class="number">1</span>,n) a[i]=<span class="number">0</span>;</div><div class="line">    b[<span class="number">0</span>]=<span class="keyword">new</span> rope&lt;<span class="keyword">int</span>&gt; (a,a+n+<span class="number">1</span>);</div><div class="line">    fo(i,<span class="number">1</span>,m)&#123;</div><div class="line">        b[i]=<span class="keyword">new</span> rope&lt;<span class="keyword">int</span>&gt; (*b[i<span class="number">-1</span>]);</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;t);</div><div class="line">        <span class="keyword">if</span> (t==<span class="number">1</span>)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;j,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) j^=ans,k^=ans;</div><div class="line">            j=getfa(i,j);</div><div class="line">            k=getfa(i,k);</div><div class="line">            <span class="keyword">if</span> (j!=k) b[i]-&gt;replace(k,j);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (t==<span class="number">2</span>)&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) k^=ans;</div><div class="line">            b[i]=b[k];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;j,&amp;k);</div><div class="line">            <span class="keyword">if</span> (flag) j^=ans,k^=ans;</div><div class="line">            j=getfa(i,j);</div><div class="line">            k=getfa(i,k);</div><div class="line">            <span class="keyword">if</span> (j!=k) ans=<span class="number">0</span>;<span class="keyword">else</span> ans=<span class="number">1</span>;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>由于这道题数据太水(zky大大别打我),所以还有一个<del>加强连</del>加强版。</p>
<h1 id="BZOJ-3674"><a href="#BZOJ-3674" class="headerlink" title="BZOJ  3674"></a>BZOJ  3674</h1><p><a href="https://vjudge.net/problem/HYSBZ-3674" target="_blank" rel="external">题目连接</a><br>什么强制在线。。。这种管用的手段。。除了<strong>xor</strong>就没有一点新意吗？（作死吐槽）<br>回归主题，对于上一篇来说，反正都是非离线做法，转个在线水水水！！！！<br>其实用类似于主席树的方法应该可以硬钢过这道题吧<br>代码就用上面的那一份改改就好了，这里就不发出来了。</p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1><p>到这里，可持久化并查集的三部曲就结束了，不知道大家发没发现，这三篇都有一个共同特点？</p>
<p>图片都是博丽灵梦！！！<br>-</p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构-并查集/">数据结构 并查集</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（二）——从镜像到动态/">
      可持久化并查集（二）——从镜像到动态
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>uva 11987<br><a href="https://vjudge.net/problem/UVA-11987" target="_blank" rel="external">题目连接</a><br><img src="http://img.blog.csdn.net/20170225170624845?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>code<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100010</span>;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="keyword">int</span> father[MAXN];</div><div class="line"><span class="keyword">int</span> sum[MAXN],num[MAXN];</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=res*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</div><div class="line">        father[i]=i+n;</div><div class="line">        father[i+n]=i+n;</div><div class="line">        sum[i+n]=i;</div><div class="line">        num[i+n]=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> father[x]!=x?father[x]=find(father[x]):x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> mark,x,y;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)!=EOF)&#123;</div><div class="line">         init();</div><div class="line">         <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</div><div class="line">             readin(mark);</div><div class="line">             <span class="keyword">if</span>(mark==<span class="number">1</span>)&#123;</div><div class="line">                readin(x),readin(y);</div><div class="line">                <span class="keyword">int</span> fx=find(x),fy=find(y);</div><div class="line">                <span class="keyword">if</span>(fx!=fy)&#123;</div><div class="line">                    father[fx]=fy;</div><div class="line">                    sum[fy]+=sum[fx];</div><div class="line">                    num[fy]+=num[fx];</div><div class="line">                &#125;</div><div class="line">             &#125;<span class="keyword">else</span> <span class="keyword">if</span>(mark==<span class="number">2</span>)&#123;</div><div class="line">                readin(x),readin(y);</div><div class="line">                <span class="keyword">int</span> fx=find(x),fy=find(y);</div><div class="line">                <span class="keyword">if</span>(fx!=fy)&#123;</div><div class="line">                   father[x]=fy;</div><div class="line">                   sum[fy]+=x,sum[fx]-=x;</div><div class="line">                   num[fy]++,num[fx]--;</div><div class="line">                &#125;</div><div class="line">             &#125;<span class="keyword">else</span>&#123;</div><div class="line">                 <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</div><div class="line">                 <span class="keyword">int</span> fx=find(x);</div><div class="line">                 <span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>,num[fx],sum[fx]);</div><div class="line">             &#125;</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>紧接着囚犯的是伪可持久化并查集（动态并查集）<br>同样的，这里也用到了<strong>镜像</strong>的思想，以多开一倍空间来存储自己的另外一种状态。从而来实现动态的并查集<code>father[i]=i+n；father[i+n]=i+n;</code> 就是这样，i与i’（i+n）同时指向了i+n这样一个<strong>虚拟id</strong>，接下会发生什么就可以模拟了。如果x union y，则x指向y的虚拟id，重指y时并不会改变x及曾是x的子节点因并查集而变到f[y]只是指向一个虚拟id的事实，从而一切的动态移除，合并，统计就可以在并查集强大的空间复杂度为O(N)，建立一个集合的时间复杂度为O(1)，N次合并M查找的时间复杂度为O(MAlpha(N))的处理下解决了。</p>
<h1 id="模拟镜像"><a href="#模拟镜像" class="headerlink" title="模拟镜像"></a>模拟镜像</h1><p>先来三个点1,2,3<br><img src="http://img.blog.csdn.net/20170226150512963?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>创建它们的镜像<br><img src="http://img.blog.csdn.net/20170226150532135?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>操作1 union 1 与 2（本来应该这样）<br><img src="http://img.blog.csdn.net/20170226150648532?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>实际上是这样<br><img src="http://img.blog.csdn.net/20170226150816830?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>这样union 3 与 1，move 2 to another point<br>就会这样（虚线代表本身的union对象，实线表示路径压缩后的union对象）<br><img src="http://img.blog.csdn.net/20170226151246754?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="move"><a href="#move" class="headerlink" title="move"></a>move</h2><p><img src="http://img.blog.csdn.net/20170226151625541?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>我们发现了1与3仍在一个集合内（2的镜像5中），只是2指向了X，但以2为父亲的1与3未受其move的印象。<br>这就是<strong>镜像</strong>的<strong>终极奥义</strong>，在虚拟中完成实际的操作（好中二的说。。。。）<br>欲知后事如何（还有后事？）（废话可持久化还没有实现呢！）：<br>请看下期<br><a href="http://blog.csdn.net/lemonoil/article/details/57416510" target="_blank" rel="external">可持久化并查集（三）——从动态到可持久化</a></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构-并查集/">数据结构 并查集</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/可持久化并查集（一）——从阿克曼函数到镜像/">
      可持久化并查集（一）——从阿克曼函数到镜像
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>noip2010<br><img src="http://img.blog.csdn.net/20170225174508885?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>以下题目可以跳过。</p>
<h1 id="关押罪犯"><a href="#关押罪犯" class="headerlink" title="关押罪犯"></a>关押罪犯</h1><p>(prison.pas/c/cpp)<br>【问题描述】<br>S 城现有两座监狱，一共关押着N 名罪犯，编号分别为1~N。他们之间的关系自然也极不和谐。很多罪犯之间甚至积怨已久，如果客观条件具备则随时可能爆发冲突。我们用“怨气值”（一个正整数值）来表示某两名罪犯之间的仇恨程度，怨气值越大，则这两名罪犯之间的积怨越多。如果两名怨气值为c 的罪犯被关押在同一监狱，他们俩之间会发生摩擦，并造成影响力为c 的冲突事件。<br>每年年末，警察局会将本年内监狱中的所有冲突事件按影响力从大到小排成一个列表，然后上报到S 城Z 市长那里。公务繁忙的Z 市长只会去看列表中的第一个事件的影响力，如果影响很坏，他就会考虑撤换警察局长。<br>在详细考察了N 名罪犯间的矛盾关系后，警察局长觉得压力巨大。他准备将罪犯们在<br>两座监狱内重新分配，以求产生的冲突事件影响力都较小，从而保住自己的乌纱帽。假设只要处于同一监狱内的某两个罪犯间有仇恨，那么他们一定会在每年的某个时候发生摩擦。那么，应如何分配罪犯，才能使Z 市长看到的那个冲突事件的影响力最小？这个最小值是多少？<br>【输入】<br>输入文件名为prison.in。输入文件的每行中两个数之间用一个空格隔开。<br>第一行为两个正整数N 和M，分别表示罪犯的数目以及存在仇恨的罪犯对数。<br>接下来的M 行每行为三个正整数aj，bj，cj，表示aj 号和bj 号罪犯之间存在仇恨，其怨<br>气值为 cj。数据保证 a b N j j 1 ≤ &lt; ≤ ，0 &lt; ≤ 1,000,000,000 j c ，且每对罪犯组合只出现一<br>次。<br>【输出】<br>输出文件prison.out 共1 行，为Z 市长看到的那个冲突事件的影响力。如果本年内监狱中未发生任何冲突事件，请输出0。</p>
<blockquote>
<p>【输入输出样例】<br>prison.in、<br>4 6<br>1 4 2534<br>2 3 3512<br>1 2 28351<br>1 3 6618<br>2 4 1805<br>3 4 12884<br>prison.out<br>3512</p>
</blockquote>
<p>【输入输出样例说明】<br>罪犯之间的怨气值如下面左图所示，右图所示为罪犯的分配方法，市长看到的冲突事件<br><img src="http://img.blog.csdn.net/20170218165823605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>影响力是3512（由2 号和3 号罪犯引发）。其他任何分法都不会比这个分法更优。<br>【数据范围】<br>对于30%的数据有N≤ 15。<br>对于70%的数据有N≤ 2000，M≤ 50000。<br>对于100%的数据有N≤ 20000，M≤ 100000。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>二分暴力可以过，然而我用并查集。开一个<strong>镜像</strong> N来代表当f[x]!=f[y]时若将其连接的情况。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> f[<span class="number">60010</span>],n,m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> x,y,z;</div><div class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> node &amp;rhs)<span class="keyword">const</span> &#123;<span class="keyword">return</span> z&gt;rhs.z;&#125;</div><div class="line">&#125;p[<span class="number">100010</span>];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> f[x]==x?x:x=find(f[x]);&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"prison.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);freopen(<span class="string">"prison.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n*<span class="number">2</span>+<span class="number">10</span>;i++)f[i]=i;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;p[i].x,&amp;p[i].y,&amp;p[i].z);</div><div class="line">	sort(p+<span class="number">1</span>,p+<span class="number">1</span>+m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;</div><div class="line">		<span class="keyword">int</span> x=find(p[i].x),y=find(p[i].y);</div><div class="line">		<span class="keyword">if</span>(x==y)&#123;<span class="built_in">cout</span>&lt;&lt;p[i].z&lt;&lt;<span class="built_in">endl</span>;<span class="keyword">return</span> <span class="number">0</span>;&#125;</div><div class="line">		f[x]=find(p[i].y+n),f[y]=find(p[i].x+n);</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="正题-重点"><a href="#正题-重点" class="headerlink" title="正题 重点"></a>正题 重点</h1><p>通过上面的一道noip半水题，我们可以发现一个问题，就是并查集的复杂度？不是O（n）吧。<br><a href="http://baike.baidu.com/link?url=qsPtY-oFSl8qhK-1JjN9W5vT3U1bxdMM_8eueFEX96IDhskreDRWsp2Vnpo7_KTpO6d9vWlPkd9o1nXcSh82b8KQSjsVoxgPwRo8vvEQBoA3ODFxlVTc3ldivcKwob1xT_wYWhNfWseWByNvT2hV_a" target="_blank" rel="external">阿克曼函数</a>普及并查集知识。<br><a href="http://blog.csdn.net/?aspxerrorpath=/youngyangyang04/article/details/7453564" target="_blank" rel="external">http://blog.csdn.net/?aspxerrorpath=/youngyangyang04/article/details/7453564</a><br>正常来说，并查集的复杂度是很优的，至少比二分贪心O(\(nlog_2^n\))要好很多。<br>并查集进行n次查找的时间复杂度是O(n )（执行n-1次合并和m≥n次查找）。其中 是一个增长极其缓慢的函数，它是阿克曼函数（Ackermann Function）的某个反函数。它可以看作是小于5的。所以可以认为并查集的时间复杂度几乎是线性的。</p>
<h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p>这个中二的名字就是接下来我要重点讲诉的东西，它以多一倍的空间表示了在原有基础上，i的i’（<strong>虚拟id</strong>），如果任何j指向i时都指向i’那么i变动时不就不会印象j的指向?<br>预知后事如何，请看下回分解：<br><a href="http://blog.csdn.net/lemonoil/article/details/57085381" target="_blank" rel="external">可持久化并查集（二）——从镜像到动态</a></p>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/可持久化-并查集/">可持久化 并查集</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/数据结构专题/">
      数据结构专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h2 id="最后一题无语（有序链剖……）"><a href="#最后一题无语（有序链剖……）" class="headerlink" title="最后一题无语（有序链剖……）"></a>最后一题无语（有序链剖……）</h2><h1 id="Problem-1-rotinv"><a href="#Problem-1-rotinv" class="headerlink" title="Problem 1. rotinv"></a>Problem 1. rotinv</h1><p><img src="http://img.blog.csdn.net/20170318170923717?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170049180?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170155620?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000000</span> + <span class="number">10</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="keyword">int</span> a[N+N];</div><div class="line"><span class="keyword">int</span> bit[N*<span class="number">24</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> ans,cnt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> delta)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = pos;i&lt;=n;i+=i&amp;-i)bit[i] += delta;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> right)</span></span>&#123;</div><div class="line">	<span class="keyword">int</span> rt=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=right;i;i-=i&amp;-i)rt += bit[i];</div><div class="line">	<span class="keyword">return</span> rt;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	freopen(<span class="string">"rotinv.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"rotinv.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</div><div class="line">		readin(a[i]);</div><div class="line">		a[n+i]=a[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++ ) &#123;</div><div class="line">		cnt+=(i<span class="number">-1</span>)-query(a[i]);</div><div class="line">		build(a[i],+<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= n + n; i++ ) &#123;</div><div class="line">		build(a[i-n],<span class="number">-1</span>);</div><div class="line">		cnt+=n<span class="number">-1</span>-query(a[i]);</div><div class="line">		cnt-=query(a[i-n]<span class="number">-1</span>);</div><div class="line">		build(a[i],+<span class="number">1</span>);</div><div class="line">		ans+=cnt;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-2-rise"><a href="#Problem-2-rise" class="headerlink" title="Problem 2. rise"></a>Problem 2. rise</h1><p><img src="http://img.blog.csdn.net/20170318170939374?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170336324?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170421605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500000</span>+<span class="number">10</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">resez</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);resez=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> left,right,child_left,child_right,maxn;</div><div class="line">	Node *ch[<span class="number">2</span>];</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> h)</span></span>&#123;</div><div class="line">		<span class="keyword">if</span>(left==right)<span class="keyword">return</span> h&lt;maxn;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">return</span> (h&lt;ch[<span class="number">0</span>]-&gt;maxn)?ch[<span class="number">0</span>]-&gt;find(h)+child_right:ch[<span class="number">1</span>]-&gt;find(h);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</div><div class="line">		maxn=max(ch[<span class="number">0</span>]-&gt;maxn,ch[<span class="number">1</span>]-&gt;maxn);</div><div class="line">		child_right=ch[<span class="number">1</span>]-&gt;find(ch[<span class="number">0</span>]-&gt;maxn);</div><div class="line">		child_left=ch[<span class="number">0</span>]-&gt;child_left+child_right;</div><div class="line">	&#125;</div><div class="line">&#125;pool[N&lt;&lt;<span class="number">1</span>],*point=pool,*root,*a[N];</div><div class="line"><span class="keyword">int</span> n,m,high[N],head,tail,l,r;</div><div class="line"><span class="function">Node *<span class="title">build</span><span class="params">(<span class="keyword">int</span> left,<span class="keyword">int</span> right)</span></span>&#123;</div><div class="line">	Node *node=++point;</div><div class="line">	node-&gt;left=left;</div><div class="line">	node-&gt;right=right;</div><div class="line">	<span class="keyword">if</span>(left==right)&#123;</div><div class="line">		node-&gt;child_left=<span class="number">1</span>;</div><div class="line">		node-&gt;child_right=<span class="number">0</span>;</div><div class="line">		node-&gt;maxn=high[left];</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(left+right)&gt;&gt;<span class="number">1</span>;</div><div class="line">		node-&gt;ch[<span class="number">0</span>]=build(left,mid);</div><div class="line">		node-&gt;ch[<span class="number">1</span>]=build(mid+<span class="number">1</span>,right);</div><div class="line">		node-&gt;update();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> node;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ask</span><span class="params">(Node *node,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L&lt;=node-&gt;left&amp;&amp;node-&gt;right&lt;=R)&#123;</div><div class="line">		a[++tail]=node;<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">int</span> mid=(node-&gt;left+node-&gt;right)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(L&lt;=mid)ask(node-&gt;ch[<span class="number">0</span>],L,R);</div><div class="line">	<span class="keyword">if</span>(R&gt;mid)ask(node-&gt;ch[<span class="number">1</span>],L,R);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	head=<span class="number">1</span>,tail=<span class="number">0</span>;</div><div class="line">	ask(root,L,R);</div><div class="line">	<span class="keyword">int</span> cnt=<span class="number">0</span>,ans=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=head;i&lt;=tail;i++)&#123;</div><div class="line">		ans+=a[i]-&gt;find(cnt);</div><div class="line">		cnt=max(cnt,a[i]-&gt;maxn);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"rise.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"rise.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)readin(high[i]);</div><div class="line">	root=build(<span class="number">1</span>,n);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		readin(l),readin(r);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(l,r));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Problem-3-seqmod"><a href="#Problem-3-seqmod" class="headerlink" title="Problem 3. seqmod"></a>Problem 3. seqmod</h1><p>（神题特此附上两张图！！！）<br><img src="http://img.blog.csdn.net/20170318171013771?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318171029381?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318170530702?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p><img src="http://img.blog.csdn.net/20170318170634904?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>idy002大神发明了有序链剖。。。然而并不知道。。。<br><a href="http://www.cnblogs.com/idy002/p/4563611.html" target="_blank" rel="external">有序链剖（神！！！）</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100000</span> + <span class="number">10</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=N&lt;&lt;<span class="number">1</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> Mod=<span class="number">31</span>;</div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">readin</span>(<span class="title">T</span> &amp;<span class="title">res</span>)&#123;</span></div><div class="line">	<span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>);res=ch<span class="number">-48</span>;</div><div class="line">	<span class="keyword">while</span>((ch=getchar())&lt;=<span class="string">'9'</span>&amp;&amp;ch&gt;=<span class="string">'0'</span>)res=res*<span class="number">10</span>+ch<span class="number">-48</span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span>&#123;</span></div><div class="line">	<span class="keyword">int</span> v,len;</div><div class="line">	Point()&#123;&#125;</div><div class="line">	Point(<span class="keyword">int</span> v,<span class="keyword">int</span> len):v(v),len(len)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">int</span> head[N],wght[M],dest[M],last[M],etot;</div><div class="line"><span class="keyword">int</span> depf[N],siz[N],son[N],top[N],father[N],val[N],in[N],rank[N],deps[N],pos_id;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></div><div class="line">	Point ab,ba;</div><div class="line">	Node *ls,*rs;</div><div class="line">&#125;point_pool[N*<span class="number">4</span>],*tail=point_pool,*root;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">	deps[<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;N;i++)</div><div class="line">		deps[i]=deps[i<span class="number">-1</span>]*<span class="number">10</span>%Mod;</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">link</span><span class="params">(<span class="keyword">const</span> Point &amp;a,<span class="keyword">const</span> Point &amp;b)</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> Point((a.v * deps[b.len] + b.v) % Mod,a.len + b.len);</div><div class="line">&#125;</div><div class="line"><span class="function">Node *<span class="title">build</span><span class="params">(<span class="keyword">int</span> lf,<span class="keyword">int</span> rg)</span></span>&#123;</div><div class="line">	Node *nd=++tail;</div><div class="line">	<span class="keyword">if</span>(lf == rg)&#123;</div><div class="line">		nd-&gt;ab=nd-&gt;ba=Point(val[rank[lf]],<span class="number">1</span>);</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">		nd-&gt;ls=build(lf,mid);</div><div class="line">		nd-&gt;rs=build(mid + <span class="number">1</span>,rg);</div><div class="line">		nd-&gt;ab=link(nd-&gt;ls-&gt;ab,nd-&gt;rs-&gt;ab);</div><div class="line">		nd-&gt;ba=link(nd-&gt;rs-&gt;ba,nd-&gt;ls-&gt;ba);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> nd;</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">query_ab</span><span class="params">(Node *nd,<span class="keyword">int</span> lf,<span class="keyword">int</span> rg,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L &lt;= lf &amp;&amp; rg &lt;= R) <span class="keyword">return</span> nd-&gt;ab;</div><div class="line">	<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(R &lt;= mid) <span class="keyword">return</span> query_ab(nd-&gt;ls,lf,mid,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(L&gt;mid) <span class="keyword">return</span> query_ab(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> link(</div><div class="line">			query_ab(nd-&gt;ls,lf,mid,L,R),</div><div class="line">			query_ab(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R));</div><div class="line">&#125;</div><div class="line"><span class="function">Point <span class="title">query_father</span><span class="params">(Node *nd,<span class="keyword">int</span> lf,<span class="keyword">int</span> rg,<span class="keyword">int</span> L,<span class="keyword">int</span> R)</span></span>&#123;</div><div class="line">	<span class="keyword">if</span>(L &lt;= lf &amp;&amp; rg &lt;= R) <span class="keyword">return</span> nd-&gt;ba;</div><div class="line">	<span class="keyword">int</span> mid=(lf + rg)&gt;&gt;<span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span>(R &lt;= mid) <span class="keyword">return</span> query_father(nd-&gt;ls,lf,mid,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(L&gt;mid) <span class="keyword">return</span> query_father(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">return</span> link(</div><div class="line">			query_father(nd-&gt;rs,mid+<span class="number">1</span>,rg,L,R),</div><div class="line">			query_father(nd-&gt;ls,lf,mid,L,R));</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">adde</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v,<span class="keyword">int</span> d)</span></span>&#123;</div><div class="line">	etot++;</div><div class="line">	dest[etot]=v;</div><div class="line">	last[etot]=head[u];</div><div class="line">	wght[etot]=d;</div><div class="line">	head[u]=etot;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs1</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	siz[u]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> t=head[u]; t; t=last[t])&#123;</div><div class="line">		<span class="keyword">int</span> v=dest[t];</div><div class="line">		<span class="keyword">if</span>(v == father[u]) <span class="keyword">continue</span>;</div><div class="line">		father[v]=u;</div><div class="line">		depf[v]=depf[u] + <span class="number">1</span>;</div><div class="line">		val[v]=wght[t];</div><div class="line">		dfs1(v);</div><div class="line">		siz[u] += siz[v];</div><div class="line">		<span class="keyword">if</span>(siz[v]&gt;siz[son[u]]) son[u]=v;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs2</span><span class="params">(<span class="keyword">int</span> u)</span></span>&#123;</div><div class="line">	in[u]=++pos_id;</div><div class="line">	rank[pos_id]=u;</div><div class="line">	<span class="keyword">if</span>(son[u])&#123;</div><div class="line">		top[son[u]]=top[u];</div><div class="line">		dfs2(son[u]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> t=head[u]; t; t=last[t])&#123;</div><div class="line">		<span class="keyword">int</span> v=dest[t];</div><div class="line">		<span class="keyword">if</span>(v == father[u] || v == son[u]) <span class="keyword">continue</span>;</div><div class="line">		top[v]=v;</div><div class="line">		dfs2(v);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span>&#123;</div><div class="line">	Point y_x(0,0),x_y(0,0);</div><div class="line">	<span class="keyword">while</span>(top[u]!=top[v])&#123;</div><div class="line">		<span class="keyword">if</span>(depf[top[u]]&gt;depf[top[v]])&#123;</div><div class="line">			y_x=link(y_x,query_father(root,<span class="number">1</span>,pos_id,in[top[u]],in[u]));</div><div class="line">			u=father[top[u]];</div><div class="line">		&#125; <span class="keyword">else</span>&#123;</div><div class="line">			x_y=link(query_ab(root,<span class="number">1</span>,pos_id,in[top[v]],in[v]),x_y);</div><div class="line">			v=father[top[v]];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span>(depf[u]&gt;depf[v])&#123;</div><div class="line">		y_x=link(y_x,query_father(root,<span class="number">1</span>,pos_id,in[v]+<span class="number">1</span>,in[u]));</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span>(depf[v]&gt;depf[u])&#123;</div><div class="line">		x_y=link(query_ab(root,<span class="number">1</span>,pos_id,in[u]+<span class="number">1</span>,in[v]),x_y);</div><div class="line">	&#125;</div><div class="line">	Point ans=link(y_x,x_y);</div><div class="line">	<span class="keyword">return</span> ans.v;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(<span class="string">"seqmod.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"seqmod.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)&#123;</div><div class="line">		<span class="keyword">int</span> u,v,d;</div><div class="line">		readin(u),readin(v),readin(d),</div><div class="line">		adde(u,v,d);</div><div class="line">		adde(v,u,d);</div><div class="line">	&#125;</div><div class="line">	init();</div><div class="line">	father[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	depf[<span class="number">1</span>]=<span class="number">0</span>;</div><div class="line">	dfs1(<span class="number">1</span>);</div><div class="line">	top[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	dfs2(<span class="number">1</span>);</div><div class="line">	root=build(<span class="number">1</span>,pos_id);</div><div class="line">	<span class="keyword">while</span>(m--)&#123;</div><div class="line">		<span class="keyword">int</span> u,v;</div><div class="line">		readin(u),readin(v);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(u,v));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数据结构/">数据结构</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/数论专题/">
      数论专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <p>第一道题题意不明，1.5h，100分。。。无语。</p>
<h1 id="单峰数列"><a href="#单峰数列" class="headerlink" title="单峰数列"></a>单峰数列</h1><p><img src="http://img.blog.csdn.net/20170318165027651?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318163703436?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p> 单峰数列<br>我们从大到小放，除最大数以外每一个数只能放在前面放的所有数的最左边或最右边.<br>于是去除单调递增单调递减重复计算，答案为2^n-2，特判n = 1 和p = 1.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PROB <span class="meta-string">"sequence"</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="function">qword <span class="title">times_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">0</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=(ret+x)%mod;</div><div class="line">				x=(x+x)%mod;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>%mod;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)</div><div class="line">						ret=times_mod(ret,x,mod);</div><div class="line">				x=times_mod(x,x,mod);</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		freopen(PROB<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(PROB<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		qword n,mod;</div><div class="line">		<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">"%I64u%I64u"</span>,&amp;n,&amp;mod))</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (n==<span class="number">1</span>)</div><div class="line">				&#123;</div><div class="line">						<span class="built_in">printf</span>(<span class="string">"%I64u\n"</span>,<span class="number">1</span>%mod);</div><div class="line">						<span class="keyword">continue</span>;</div><div class="line">				&#125;</div><div class="line">				qword ans=pow_mod(<span class="number">2</span>,n,mod)<span class="number">-2</span>;</div><div class="line">				ans=(ans+mod)%mod;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%I64u\n"</span>,ans);</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="数学题（裸题）"><a href="#数学题（裸题）" class="headerlink" title="数学题（裸题）"></a>数学题（裸题）</h1><p><img src="http://img.blog.csdn.net/20170318165218637?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br><img src="http://img.blog.csdn.net/20170318163954296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>题意：已知B，A%p，求(A/B)%p.<br>设A  B ans (mod p)<br>原问题变成了已知B  ans mod p 求ans.<br>我们直接套用拓展欧几里得算法模板.<br>B ans + k p = n<br>由于保证gcd 为1，所以ans 在p 内只有一个解.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="function">qword <span class="title">ext_gcd</span><span class="params">(qword a,qword b,qword &amp;x,qword &amp;y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">        <span class="keyword">if</span> (a%b==<span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">                <span class="comment">//a*x+b*y==b</span></div><div class="line">                x=<span class="number">0</span>;y=<span class="number">1</span>;</div><div class="line">                <span class="keyword">return</span> y;</div><div class="line">        &#125;</div><div class="line">        qword ret=ext_gcd(b,a%b,x,y);</div><div class="line">        qword tx=x,ty=y;</div><div class="line">        x=ty;</div><div class="line">        y=tx-a/b*ty;</div><div class="line">        <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y,qword mod)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=ret*x%mod;</div><div class="line">				x=x*x%mod;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		<span class="keyword">int</span> nn;</div><div class="line">		freopen(<span class="string">"calc.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(<span class="string">"calc.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;nn);</div><div class="line">		<span class="keyword">while</span> (nn--)</div><div class="line">		&#123;</div><div class="line">				qword n,b;</div><div class="line">				qword p;</div><div class="line">				<span class="built_in">scanf</span>(<span class="string">"%I64d%I64d%I64d"</span>,&amp;n,&amp;b,&amp;p);</div><div class="line">				<span class="comment">//n=A%9973</span></div><div class="line">				<span class="comment">//n=b*d%9973</span></div><div class="line">				<span class="comment">//n=b*d+9973*k</span></div><div class="line">				qword d0,k0;</div><div class="line">				<span class="comment">//d0=pow_mod(b,9971,9973);</span></div><div class="line">				ext_gcd(b,p,d0,k0);</div><div class="line">				d0=d0*n%p;</div><div class="line">				d0=(d0+p)%p;</div><div class="line">				<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,d0);</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="定情信物（bzoj-3823）"><a href="#定情信物（bzoj-3823）" class="headerlink" title="定情信物（bzoj 3823）"></a>定情信物（bzoj 3823）</h1><p><img src="http://img.blog.csdn.net/20170318165609399?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>Description<br>都说程序员找不到妹子,可是无人知晓,三生石上竟然还刻着属于小 E 的一笔。<br>那一天,小 E 穷尽毕生的积蓄,赠与了妹子一个非同寻常的定情信物。那是一个小小的正方体,但透过它,可以看到过去,可以洞彻天机。<br>这份信物仿佛一只深邃的眼。当看透它看似简单的外表后,深邃的内心却最是可以叩击人的灵魂的。不出所料,妹子果然被这个信物超越空间的美所吸引。<br>“易有太极,是生两仪,两仪生四象,四象生八卦。,八卦定吉凶,吉凶生大业。”<br>这句箴言在其上得到了完美的诠释。是的,这正是一个超正方体。<br>小 E 告诉妹子,他的情意也如这份信物一样深厚。现在妹子想知道,小 E 对她的情意究竟有几分?<br>我们知道,点动成线,线动成面,面动成体……即 n 维超立方体可看作由 n-1 维超立方体沿垂直于它的所有的棱的方向平移得到的立体图形。我们可以将点看作 0 维超立方体,将直线看作 1 维超立方体,将正方形看作 2 维超立方体……依此类推。<br>任何一个 n 维超立方体(n&gt;0)都是由低维的超立方体元素组成的:它的 n-1 维表面是 n-1 维的超立方体,它的 n-2 维边缘是 n-2 维的超立方体,它的 n-3 维元素是 n-3 维的超立方体……<br>小 E 对妹子的情意即为在他的定情信物——K 维超立方体中,含有每一维的元素个数。由于元素个数可能较大,只需要输出它所包含的每一维元素个数模 P 后的异或和。<br>Input<br>两个整数 K、P,详见题目叙述。<br>Output<br>一个非负整数,表示小 E 的定情信物所包含的每一维元素个数模 P 后的异或和。注意:异或和可能会大于 P。</p>
<blockquote>
<p>Sample Input<br>input 1<br>3 7<br>Input 2<br>4 2333<br>Input 3<br>12 7723<br>Sample Output<br>Output1<br>3<br>Output 2<br>33<br>Output 3<br>360</p>
</blockquote>
<p>Hint<br>对于样例2的解释:<br>一个三维超立方体含有 8 个零维元素、12 个一维元素、6 个二维元素、1 个三维元素,模 7 后分别为 1,5,6,1,异或和为 1^5^6^1=3。<br>对于 100%的数据,N≤10^7,P 为 10^9 内的素数。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>找规律可得：\(a<em>i = C(n,i)2</em>{n-i}\)<br>脑补也很容易能把规律推出来，一个n 维超正方体有n 个维度，那么要确定其中的一个k 维元素，就是在这n 个维度中选择k 个维度，个数\(C(n,k)\)，剩下\(n-k\)个维度可以任意平移，所以再乘\(2^{n-k}\)于是下一步就是如何求ai，直接扫一遍，将答案表示成//(t*p^k//)，存下了t，k就存下了答案，线性筛预处理处逆元，分别推出\(C(n,i)\)，\(2^i\)，乘起来再异或就是答案了。 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cassert&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 11000000</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> qword;</div><div class="line"><span class="keyword">int</span> inv[MAXN];</div><div class="line"><span class="keyword">int</span> prime[<span class="number">1100000</span>],topp=<span class="number">-1</span>;</div><div class="line"><span class="keyword">bool</span> pflag[MAXN];</div><div class="line">qword n,p;</div><div class="line"><span class="function">qword <span class="title">pow_mod</span><span class="params">(qword x,qword y)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		qword ret=<span class="number">1</span>;</div><div class="line">		<span class="keyword">while</span> (y)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (y&amp;<span class="number">1</span>)ret=ret*x%p;</div><div class="line">				x=x*x%p;</div><div class="line">				y&gt;&gt;=<span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		inv[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++)</div><div class="line">		&#123;</div><div class="line">				<span class="keyword">if</span> (!pflag[i])</div><div class="line">				&#123;</div><div class="line">						prime[++topp]=i;</div><div class="line">						inv[i]=pow_mod(i,p<span class="number">-2</span>);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=topp &amp;&amp; (qword)i*prime[j]&lt;MAXN;j++)</div><div class="line">				&#123;</div><div class="line">						pflag[i*prime[j]]=<span class="literal">true</span>;</div><div class="line">						inv[i*prime[j]]=(qword)inv[i]*inv[prime[j]]%p;</div><div class="line">						<span class="keyword">if</span> (i%prime[j]==<span class="number">0</span>)<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">		&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">		freopen(<span class="string">"cube.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">		freopen(<span class="string">"cube.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">		<span class="built_in">scanf</span>(<span class="string">"%I64d%I64d"</span>,&amp;n,&amp;p);</div><div class="line">		qword x,y,z;</div><div class="line">		<span class="keyword">int</span> i,j,k;</div><div class="line">		qword ans=<span class="number">0</span>;</div><div class="line">		init();</div><div class="line">		x=<span class="number">1</span>;y=<span class="number">1</span>;</div><div class="line">		ans^=x*y%p;</div><div class="line">		<span class="keyword">int</span> totp=<span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span> (i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">		&#123;</div><div class="line">				x=x*<span class="number">2</span>%p;</div><div class="line">				z=n-i+<span class="number">1</span>;</div><div class="line">				<span class="keyword">while</span> (z%p==<span class="number">0</span>)totp++,z/=p;</div><div class="line">				y=y*z%p;</div><div class="line">				z=i;</div><div class="line">				<span class="keyword">while</span> (z%p==<span class="number">0</span>)totp--,z/=p;</div><div class="line">				y=y*inv[z%p]%p;</div><div class="line">				ans^=totp?<span class="number">0</span>:x*y%p;</div><div class="line">		&#125;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/数论/">数论</a>
	  </div>
    

  </section>
</article>
  
    <article class="post ">

  
  <h2 class="title">
    <a href="/2017/04/02/dp专题/">
      dp专题
    </a>
  </h2>
  
  <time>
    Apr 2, 2017
  </time>
  <section class="content">
	  <h2 id="220分，加上long-long-成320分。。。无语，果真需要更加细致地分析数据啊！！！"><a href="#220分，加上long-long-成320分。。。无语，果真需要更加细致地分析数据啊！！！" class="headerlink" title="220分，加上long long 成320分。。。无语，果真需要更加细致地分析数据啊！！！"></a>220分，加上long long 成320分。。。无语，果真需要更加细致地分析数据啊！！！</h2><h1 id="天平（balance-in-balance-out）"><a href="#天平（balance-in-balance-out）" class="headerlink" title="天平（balance.in/balance.out）"></a>天平（balance.in/balance.out）</h1><p><img src="http://img.blog.csdn.net/20170325165516496?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>物理老师YJ有一个长杆天平，天平的两臂长均为15，将长杆看作x轴，则平衡点在0位置处，负数位置在左臂上，正数位置在右臂上。长杆上有n个位置有挂钩可以挂秤砣。YJ有m个秤砣，质量分别为gi，每个挂钩可以不挂也可以挂任意个秤砣。YJ想要知道，在使用所有秤砣的条件下，有多少种不同的挂秤砣的方案，可以使得天平平衡？问题太过复杂，仅凭物理知识难以解决，所以请你来帮助他。<br>天平的平衡条件是所有秤砣的位置<em>质量之和为0。例如有质量为2,3,4的秤砣分别挂在-3,-2,3位置处，则2</em>(-3) + 3<em>(-2) + 4</em>3 == 0，天平是平衡的。<br>【输入格式】<br>第一行两个数n，m。表示挂钩的数目和秤砣的数目。<br>第二行n个不同且递增的数，第i个数表示第i个挂钩的位置，数的范围在[-15,15]内。<br>第三行m个不同且递增的数，第i个数表示第i个秤砣的质量，数的范围在[1,25]内。<br>【输出格式】<br>一个整数，代表能使得天平平衡的方案数。</p>
<blockquote>
<p>【输入样例】<br>2 4<br>-2 3<br>3 4 5 8<br>【输出样例】<br>2</p>
</blockquote>
<p>【样例解释】<br>方案1: (-2)<em>(3+4+5) + 3 </em>8 = 0<br>方案2: (-2)<em> (4+8) +  3 </em>(3+5) = 0<br>【数据规模】<br>10% 数据满足2≤n,m≤4。<br>100% 数据满足2≤n,m≤20。</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>简单的DP。<br>考虑天平的状态可以用秤砣质量<em>距离来表示，而题目情况下，天平的全部秤砣质量</em>距离在(-7500,7500)(20<em> 25</em>15 = 7500)以内。故可以以此状态来dp。<br>类似背包问题，把每一个秤砣挂在不同地方，对应成n<em>m个物品，转移方程f[i][j]+=f[i-1][j-dis[k]</em>mg[i]] (i=1..n,j=0..15000,k=1..m)。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"balance"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> n,m,c[<span class="number">100</span>],w[<span class="number">100</span>];</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span>  dp[<span class="number">30</span>][<span class="number">15001</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)readin(c[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)readin(w[i]);</div><div class="line">	dp[<span class="number">0</span>][<span class="number">7500</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">15000</span>;j++)</div><div class="line">			<span class="keyword">if</span>(dp[i<span class="number">-1</span>][j])<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> k=<span class="number">1</span>;k&lt;=n;k++)</div><div class="line">				dp[i][j+w[i]*c[k]]+=dp[i<span class="number">-1</span>][j];</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;dp[m][<span class="number">7500</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="山峰数（hill-in-hill-out）"><a href="#山峰数（hill-in-hill-out）" class="headerlink" title="山峰数（hill.in/hill.out）"></a>山峰数（hill.in/hill.out）</h1><p><img src="http://img.blog.csdn.net/20170325165450469?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>山峰数是指数字排列中不存在山谷(先降后升)的数，例如0,5,13,12321都是山峰数，101，1110000111都不是山峰数。<br>现给出n个数，请依次判断它们是否为山峰数，如果不是，输出-1。如果是，求出比它小的数中有多少个山峰数。<br>【输入格式】<br>第一行一个数n，表示询问数目。<br>接下来n行，每一行一个数x，表示询问的数。<br>【输出格式】<br>输出有n行，x如果不是山峰数，输出-1。x如果是山峰数，则输出有多少个比它小的山峰数。</p>
<blockquote>
<p>【输入样例】<br>5<br>10<br>55<br>101<br>1000<br>1234321<br>【输出样例】<br>10<br>55<br>-1<br>715<br>94708</p>
</blockquote>
<p>【数据规模】<br>20% 数据满足x ≤ 10^6。<br>100% 数据满足n ≤ 10, x ≤ 10^60</p>
<h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>数位DP<br>在数位dp的模板基础上，加入参数nu和isdown，nu表示上一个数填的多少，isdown表示当前是在上升期还是在下降期，然后使用模板记忆化搜索即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"hill"</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> T;</div><div class="line">ll dp[<span class="number">77</span>][<span class="number">11</span>][<span class="number">2</span>];</div><div class="line"><span class="keyword">char</span> s[<span class="number">77</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;<span class="keyword">int</span> flag=<span class="number">1</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&lt;<span class="string">'0'</span>||ch&gt;<span class="string">'9'</span>)<span class="keyword">if</span>(ch==<span class="string">'-'</span>)flag=<span class="number">-1</span>;resez=ch<span class="number">-48</span>;</div><div class="line">  <span class="keyword">while</span>((ch=getchar())&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)resez=resez*<span class="number">10</span>+ ch<span class="number">-48</span>;resez*=flag;</div><div class="line">&#125;</div><div class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> pos,<span class="keyword">int</span> pre,<span class="keyword">int</span> state,<span class="keyword">int</span> fp)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(pos&lt;<span class="number">0</span>)<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span>(!fp&amp;&amp;dp[pos][pre][state]!=<span class="number">-1</span>)<span class="keyword">return</span> dp[pos][pre][state];</div><div class="line">    ll ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> fpmax=fp?s[pos]-<span class="string">'0'</span>:<span class="number">9</span>;</div><div class="line">    <span class="keyword">if</span>(state)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=min(fpmax,pre<span class="number">-1</span>);i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">0</span>,fp&amp;&amp;i==fpmax);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=pre;i&lt;=fpmax;i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">1</span>,fp&amp;&amp;i==fpmax);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=min(fpmax,pre);i++)</div><div class="line">            ans+=dfs(pos<span class="number">-1</span>,i,<span class="number">0</span>,fp&amp;&amp;i==fpmax);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(!fp)dp[pos][pre][state]=ans;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    <span class="built_in">memset</span>(dp,<span class="number">-1</span>,<span class="keyword">sizeof</span>(dp));</div><div class="line">    readin(T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%s"</span>,s);</div><div class="line">        <span class="keyword">int</span> len=<span class="built_in">strlen</span>(s),flag=<span class="number">0</span>,gg=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>,j=len<span class="number">-1</span>;i&lt;j;i++,j--)swap(s[i],s[j]);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len<span class="number">-1</span>;i++)&#123;</div><div class="line">            <span class="keyword">if</span>(s[i]&lt;s[i+<span class="number">1</span>]&amp;&amp;flag)&#123;</div><div class="line">                gg=<span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(s[i]&gt;s[i+<span class="number">1</span>])flag=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(gg)<span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,dfs(len<span class="number">-1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>)<span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="粉刷匠2（draw-in-draw-out）"><a href="#粉刷匠2（draw-in-draw-out）" class="headerlink" title="粉刷匠2（draw.in/draw.out）"></a>粉刷匠2（draw.in/draw.out）</h1><p><img src="http://img.blog.csdn.net/20170325165405906?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>有一个4*N的木板需要粉刷，第i行j列的颜色记为A(i, j)。<br>有256种颜色，记为0..255，为了使得粉刷比较好看，粉刷需要满足如下要求:</p>
<ol>
<li>A(x,y) &gt;= A(x,y-1)</li>
<li>有一些指定的(x1, y1)和(x2, y2)，要求A(x1, y1) = A(x2, y2)<br>请问有多少种满足要求的粉刷方式？输出答案的最后5位即可。<br>【输入格式】<br>第一行两个数n, m，表示木板的长度，和指定规则的条目个数。<br>接下来m行，每行四个数x1,y1,x2,y1，此规则表示A(x1, y1) 需要等于 A(x2, y2)<br>。<br>【输出格式】<br>一个整数，表示答案的末5位。<blockquote>
<p>【输入样例1】<br>1 0<br>【输出样例1】<br>67296<br>【输入样例2】<br>1 3<br>1 1 2 1<br>1 1 3 1<br>4 1 3 1<br>【输出样例2】<br>00256</p>
</blockquote>
</li>
</ol>
<p>【提示】<br>5<br>输出可以使用%05d输出。<br>【数据规模】<br>30% 数据满足 n ≤ 3，m = 0。<br>100% 数据满足1 ≤ n ≤ 15，0 ≤ M ≤ 100，X1,X2≤4，Y1,Y2≤n</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>30分的做法：dp[i][c1][c2][c3]表示第i行，第一列填到c1，第二列填到c2,，第三列填到c3的方法总数。转移时如果暴力枚举转移仍然会TLE，需要使用完全背包的降低维度思想，列出转移方程：dp[i][c1][c2][c3]= dp[i-1][c1][c2][c3] + dp[i] [c1-1][c2][c3] + dp[i] [c1][c2-1][c3] + dp[i][c1][c2][c3-1]。这样才不会TLE。<br>100分的做法：换一种dp思路，我们不按照常规思维枚举行列，而是从小到大枚举颜色。若当前枚举到的颜色为i，我们使用dp[l1][l2][l3][l4]表示每一行使用当前颜色涂到哪一个位置。<br>假设有一行现在是123344556，现在涂7，显然涂7只能涂序列的后缀，比如涂成123777777，或者123344577才能符合条件。所以考虑枚举当前颜色涂到哪个后缀来转移，转移时同样需要使用完全背包的降维思想优化。<br>对于限制条件，我们需要把不符合限制条件的去掉，什么样的方案符合限制条件呢？对于限制条件A(x1, y1) = A(x2, y2)，和当前枚举到的颜色i，要么x1行和x2行，当前颜色都涂到了y1,y2位置，要么都没有涂到y1,y2位置。除此之外的都是不合法的方案，我们事先处理好一个vis数组，vis[l1][l2][l3][l4]表示四行分别涂到l1,l2,l3,l4，是否可行，在dp时如果遇到标记不可行的vis，这dp值设为0即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> res(i,x) for(register int i=1;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rek(i,x) for(register int i=0;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rez(i,x) for(i=0;i&lt;=x;i++)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> f[<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>];</div><div class="line"><span class="keyword">bool</span> vis[<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>][<span class="number">16</span>];</div><div class="line"><span class="keyword">int</span> x1[<span class="number">105</span>],x2[<span class="number">105</span>],y1[<span class="number">105</span>],y2[<span class="number">105</span>];</div><div class="line"><span class="keyword">int</span> n,m,c[<span class="number">4</span>];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>);resez = ch - <span class="number">48</span>;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)resez = resez * <span class="number">10</span> + ch - <span class="number">48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123; </div><div class="line">	freopen(<span class="string">"draw.in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(<span class="string">"draw.out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">	readin(n),readin(m);</div><div class="line">	res(i,m)&#123;</div><div class="line">		readin(x1[i]),readin(y1[i]),readin(x2[i]),readin(y2[i]);</div><div class="line">		x1[i]--;x2[i]--;</div><div class="line">	&#125;</div><div class="line">	res(i,m)rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)&#123;</div><div class="line">		<span class="keyword">if</span>(c[x1[i]]&gt;=y1[i] ^ c[x2[i]]&gt;=y2[i])</div><div class="line">			vis[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=<span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">	rek(color,<span class="number">255</span>)&#123;</div><div class="line">		rek(col,<span class="number">3</span>)rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)</div><div class="line">			<span class="keyword">if</span>(c[col]&lt;n)&#123;</div><div class="line">				<span class="keyword">int</span> tmp=f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]];</div><div class="line">				c[col]++;</div><div class="line">				f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=(f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]+tmp)%<span class="number">100000</span>;</div><div class="line">				c[col]--;</div><div class="line">			&#125;</div><div class="line">		rez(c[<span class="number">0</span>],n)rez(c[<span class="number">1</span>],n)rez(c[<span class="number">2</span>],n)rez(c[<span class="number">3</span>],n)</div><div class="line">			<span class="keyword">if</span>(vis[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]])</div><div class="line">				f[c[<span class="number">0</span>]][c[<span class="number">1</span>]][c[<span class="number">2</span>]][c[<span class="number">3</span>]]=<span class="number">0</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%05d\n"</span>,f[n][n][n][n]);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="棋盘（knight-in-knight-out）"><a href="#棋盘（knight-in-knight-out）" class="headerlink" title="棋盘（knight.in/knight.out）"></a>棋盘（knight.in/knight.out）</h1><p><img src="http://img.blog.csdn.net/20170325165340745?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>有一个N*M的棋盘，要在上面摆上knight，每个格子可以放至多一个knight。<br>knight的攻击范围如下图：<br><img src="http://img.blog.csdn.net/20170325165115620?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGVtb25vaWw=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>所有knight不能互相攻击，请问总共有多少可行的摆法？答案对1000000007取模。<br>【输入格式】<br>第一行个数t，表示测试的组数。<br>接下来t组，每组两个整数，n和m。<br>【输出格式】<br>一共t行，第i行表示第i组的答案。</p>
<blockquote>
<p>【输入样例】<br>4<br>1 2<br>2 2<br>3 2<br>3 31415926<br>【输出样例】<br>4<br>16<br>36<br>933912086</p>
</blockquote>
<p>【数据规模】<br>70% 数据满足m≤100。<br>100% 数据满足t≤10, n≤3, m≤10^9。</p>
<h2 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h2><p>n非常小，所以考虑状态压缩动态规划，每一行使用一个二级制串表示当前行的摆knight情况。用f[i][j][k]表示第i行，前一行为j，前一行的前一行为k时的方法总数，转移时枚举三行的状态，判断合法情况转移即可。<br>如果枚举每一行转移，可以得70分。如果将状态转移矩阵化，使用矩阵快速幂，可以通过全部测试数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NAME <span class="meta-string">"knight"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> maxn 256</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 1000000007ll</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&#123;</span></div><div class="line">    <span class="keyword">int</span> Matrix[maxn][maxn];<span class="comment">//矩阵 </span></div><div class="line">    <span class="keyword">int</span> row,col;<span class="comment">//矩阵行列数 </span></div><div class="line">&#125;;</div><div class="line"><span class="function">Matrix <span class="title">mod_mul</span><span class="params">(Matrix a,Matrix b,ll p)</span></span>&#123;<span class="comment">//矩阵乘法 </span></div><div class="line">    Matrix ans;</div><div class="line">    ans.row=a.row;</div><div class="line">    ans.col=b.col;</div><div class="line">    <span class="built_in">memset</span>(ans.Matrix,<span class="number">0</span>,<span class="keyword">sizeof</span>(ans.Matrix));</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ans.row;i++)      </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;a.col;k++)</div><div class="line">            <span class="keyword">if</span>(a.Matrix[i][k])</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;ans.col;j++)</div><div class="line">                &#123;</div><div class="line">                    ans.Matrix[i][j]+=<span class="number">1l</span>l*a.Matrix[i][k]*b.Matrix[k][j]%p;</div><div class="line">                    ans.Matrix[i][j]%=p;</div><div class="line">                &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function">Matrix <span class="title">mod_pow</span><span class="params">(Matrix a,<span class="keyword">int</span> k,ll p)</span></span>&#123;<span class="comment">//矩阵快速幂 昨天才打的。。。。 </span></div><div class="line">    Matrix ans;</div><div class="line">    ans.row=a.row;</div><div class="line">    ans.col=a.col;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.row;i++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a.col;j++)</div><div class="line">            ans.Matrix[i][j]=(i==j);</div><div class="line">    <span class="keyword">while</span>(k)&#123;</div><div class="line">        <span class="keyword">if</span>(k&amp;<span class="number">1</span>)ans=mod_mul(ans,a,p);</div><div class="line">        a=mod_mul(a,a,p);</div><div class="line">        k&gt;&gt;=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> T,n,m,a[<span class="number">5</span>][<span class="number">5</span>];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">deal</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>*m;i++)</div><div class="line">        <span class="keyword">if</span>(x&amp;(<span class="number">1</span>&lt;&lt;i))a[i/m][i%m]=<span class="number">1</span>;</div><div class="line">        <span class="keyword">else</span> a[i/m][i%m]=<span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> dx[]=&#123;<span class="number">-2</span>,<span class="number">-2</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>&#125;;</div><div class="line"><span class="keyword">int</span> dy[]=&#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-2</span>,<span class="number">2</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> j=<span class="number">0</span>;j&lt;m;j++)</div><div class="line">            <span class="keyword">if</span>(a[i][j])<span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> k=<span class="number">0</span>;k&lt;<span class="number">8</span>;k++)&#123;</div><div class="line">                    <span class="keyword">int</span> ii=i+dx[k],jj=j+dy[k];</div><div class="line">                    <span class="keyword">if</span>(ii&lt;<span class="number">0</span>||ii&gt;=<span class="number">3</span>||jj&lt;<span class="number">0</span>||jj&gt;=m)<span class="keyword">continue</span>;</div><div class="line">                    <span class="keyword">if</span>(a[ii][jj])<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line">Matrix A,B;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">readin</span><span class="params">(<span class="keyword">int</span> &amp;resez)</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">char</span> ch;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>);resez = ch - <span class="number">48</span>;</div><div class="line">  <span class="keyword">while</span> ((ch = getchar()) &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)resez = resez * <span class="number">10</span> + ch - <span class="number">48</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">	freopen(NAME<span class="string">".in"</span>,<span class="string">"r"</span>,<span class="built_in">stdin</span>);</div><div class="line">	freopen(NAME<span class="string">".out"</span>,<span class="string">"w"</span>,<span class="built_in">stdout</span>);</div><div class="line">    readin(T);</div><div class="line">    <span class="keyword">while</span>(T--)&#123;</div><div class="line">        readin(m),readin(n);</div><div class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,<span class="number">1</span>&lt;&lt;m);</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> M=<span class="number">1</span>&lt;&lt;(m&lt;&lt;<span class="number">1</span>),N=<span class="number">1</span>&lt;&lt;(<span class="number">3</span>*m);</div><div class="line">        B.row=M,B.col=<span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++)&#123;</div><div class="line">            deal(i);</div><div class="line">            B.Matrix[i][<span class="number">0</span>]=check();</div><div class="line">        &#125;</div><div class="line">        A.row=A.col=M;</div><div class="line">        <span class="built_in">memset</span>(A.Matrix,<span class="number">0</span>,<span class="keyword">sizeof</span>(A.Matrix));</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;N;i++)&#123;</div><div class="line">            <span class="keyword">int</span> x=i&gt;&gt;m,y=i&amp;(M<span class="number">-1</span>);</div><div class="line">            deal(i);</div><div class="line">            <span class="keyword">if</span>(check())A.Matrix[x][y]=<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        A=mod_pow(A,n<span class="number">-2</span>,mod);</div><div class="line">        A=mod_mul(A,B,mod);</div><div class="line">        ll ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">register</span> <span class="keyword">int</span> i=<span class="number">0</span>;i&lt;M;i++)ans=(ans+A.Matrix[i][<span class="number">0</span>])%mod;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%I64d\n"</span>,ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


    
    
    
	  <div class="tags">
      <a class="tag-link" href="/tags/DP/">DP</a>
	  </div>
    

  </section>
</article>
  
</section>



      <script>setLoadingBarProgress(60);</script>
    </main>
    
    <footer id="footer" class="clearfix">
  
  
	<div class="search">
	  <form name="searchform" id="searchform" class="u-search-form">
	    <input type="text" id="searchinput" class="u-search-input" placeholder="Looking for something?" />
	    <button type="submit" id="u-search-btn-submit" class="u-search-btn-submit">
	      <span class="icon icon-search"></span>
	    </button>
	  </form>
	</div>
	

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/artchen" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/otakism" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
        <a href="https://plus.google.com/+ArtChenOtakism/posts" class="social google"
          target="_blank" rel="external">
          <span class="icon icon-google"></span>
        </a>
      
        <a href="http://weibo.com/otakism/" class="social sina-weibo"
          target="_blank" rel="external">
          <span class="icon icon-sina-weibo"></span>
        </a>
      
    
  </div>
  
  <div>Theme <span class="codename">Typescript</span> designed by <a href="http://rakugaki.me/" target="_blank">Art Chen</a>.</div>
  <div>&copy; <a href="/">PIVIX</a></div>
  
</footer>


    <script>setLoadingBarProgress(80);</script>
    
  </div>

  
<script>
  var disqus_shortname = 'https://lemonoilP.github.io';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>




<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>

<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "google";
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
  
</body>
</html>
